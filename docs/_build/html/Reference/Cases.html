

<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8" />
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  
  <title>5. Real Code Cases &mdash; Exakat 1 documentation</title>
  

  
  <link rel="stylesheet" href="../_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
  <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
  <link rel="stylesheet" href="../_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../_static/css/exakat.css" type="text/css" />

  
  

  
  

  

  
  <!--[if lt IE 9]>
    <script src="../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
    
      <script type="text/javascript" id="documentation_options" data-url_root="../" src="../_static/documentation_options.js"></script>
        <script data-url_root="../" id="documentation_options" src="../_static/documentation_options.js"></script>
        <script src="../_static/jquery.js"></script>
        <script src="../_static/underscore.js"></script>
        <script src="../_static/doctools.js"></script>
    
    <script type="text/javascript" src="../_static/js/theme.js"></script>

    
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="Installation" href="../Administrator/Installation.html" />
    <link rel="prev" title="4. Cobblers" href="Cobblers.html" /> 
</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
          

          
            <a href="../index.html" class="icon icon-home"> Exakat
          

          
          </a>

          
            
            
              <div class="version">
                2.2.2
              </div>
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        
        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <ul>
<li class="toctree-l1"><a class="reference internal" href="../Introduction.html">Introduction</a></li>
<li class="toctree-l1"><a class="reference internal" href="../Changelog.html">Release Note</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">GETTING STARTED</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../Gettingstarted/Bare.html">with a Bare metal installation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../Gettingstarted/Docker.html">with a Docker installation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../Gettingstarted/Tutorials.html">Tutorials</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">USER GUIDE</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../User/Overview.html">Overview</a></li>
<li class="toctree-l1"><a class="reference internal" href="../User/PHPversion.html">PHP Version</a></li>
<li class="toctree-l1"><a class="reference internal" href="../User/Support.html">Library &amp; Framework Support</a></li>
<li class="toctree-l1"><a class="reference internal" href="../User/Configuration.html">Configuration</a></li>
<li class="toctree-l1"><a class="reference internal" href="../User/Scoping.html">Scoping analysis</a></li>
<li class="toctree-l1"><a class="reference internal" href="../User/Rule.html">Rule</a></li>
<li class="toctree-l1"><a class="reference internal" href="../User/Report.html">Report</a></li>
<li class="toctree-l1"><a class="reference internal" href="../User/Cobbler.html">Cobbler</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">REFERENCE GUIDE</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="Rules.html">1. Rules</a></li>
<li class="toctree-l1"><a class="reference internal" href="Rulesets.html">2. Rulesets</a></li>
<li class="toctree-l1"><a class="reference internal" href="Reports.html">3. Reports</a></li>
<li class="toctree-l1"><a class="reference internal" href="Cobblers.html">4. Cobblers</a></li>
<li class="toctree-l1 current"><a class="current reference internal" href="#">5. Real Code Cases</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#introduction">5.1. Introduction</a></li>
<li class="toctree-l2"><a class="reference internal" href="#list-of-real-code-cases">5.2. List of real code Cases</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#ambiguous-array-index">5.2.1. Ambiguous Array Index</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#prestashop">5.2.1.1. PrestaShop</a></li>
<li class="toctree-l4"><a class="reference internal" href="#mautic">5.2.1.2. Mautic</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#getting-last-element">5.2.2. Getting Last Element</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#thelia">5.2.2.1. Thelia</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#multiple-index-definition">5.2.3. Multiple Index Definition</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#magento">5.2.3.1. Magento</a></li>
<li class="toctree-l4"><a class="reference internal" href="#mediawiki">5.2.3.2. MediaWiki</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#non-constant-index-in-array">5.2.4. Non-constant Index In Array</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#dolibarr">5.2.4.1. Dolibarr</a></li>
<li class="toctree-l4"><a class="reference internal" href="#zencart">5.2.4.2. Zencart</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#randomly-sorted-arrays">5.2.5. Randomly Sorted Arrays</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#contao">5.2.5.1. Contao</a></li>
<li class="toctree-l4"><a class="reference internal" href="#vanilla">5.2.5.2. Vanilla</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#slice-arrays-first">5.2.6. Slice Arrays First</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#wordpress">5.2.6.1. WordPress</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#abstract-or-implements">5.2.7. Abstract Or Implements</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#zurmo">5.2.7.1. Zurmo</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#ambiguous-visibilities">5.2.8. Ambiguous Visibilities</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#typo3">5.2.8.1. Typo3</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#avoid-optional-properties">5.2.9. Avoid Optional Properties</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#churchcrm">5.2.9.1. ChurchCRM</a></li>
<li class="toctree-l4"><a class="reference internal" href="#case-dolibarr-classes-avoidoptionalproperties">5.2.9.2. Dolibarr</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#cant-instantiate-class">5.2.10. Cant Instantiate Class</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#case-wordpress-classes-cantinstantiateclass">5.2.10.1. WordPress</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#class-interface-or-trait-with-identical-names">5.2.11. Class, Interface Or Trait With Identical Names</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#shopware">5.2.11.1. shopware</a></li>
<li class="toctree-l4"><a class="reference internal" href="#nextcloud">5.2.11.2. NextCloud</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#could-be-abstract-class">5.2.12. Could Be Abstract Class</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#edusoho">5.2.12.1. Edusoho</a></li>
<li class="toctree-l4"><a class="reference internal" href="#case-shopware-classes-couldbeabstractclass">5.2.12.2. shopware</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#could-be-private-class-constant">5.2.13. Could Be Private Class Constant</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#phinx">5.2.13.1. Phinx</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#method-could-be-static">5.2.14. Method Could Be Static</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#fuelcms">5.2.14.1. FuelCMS</a></li>
<li class="toctree-l4"><a class="reference internal" href="#expressionengine">5.2.14.2. ExpressionEngine</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#disconnected-classes">5.2.15. Disconnected Classes</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#case-wordpress-classes-disconnectedclasses">5.2.15.1. WordPress</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#don-t-send-this-in-constructor">5.2.16. Don’t Send $this In Constructor</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#woocommerce">5.2.16.1. Woocommerce</a></li>
<li class="toctree-l4"><a class="reference internal" href="#case-contao-classes-dontsendthisinconstructor">5.2.16.2. Contao</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#don-t-unset-properties">5.2.17. Don’t Unset Properties</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#case-vanilla-classes-dontunsetproperties">5.2.17.1. Vanilla</a></li>
<li class="toctree-l4"><a class="reference internal" href="#case-typo3-classes-dontunsetproperties">5.2.17.2. Typo3</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#empty-classes">5.2.18. Empty Classes</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#case-wordpress-classes-emptyclass">5.2.18.1. WordPress</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#incompatible-signature-methods">5.2.19. Incompatible Signature Methods</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#suitecrm">5.2.19.1. SuiteCrm</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#incompatible-signature-methods-with-covariance">5.2.20. Incompatible Signature Methods With Covariance</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#case-suitecrm-classes-incompatiblesignature74">5.2.20.1. SuiteCrm</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#assign-default-to-properties">5.2.21. Assign Default To Properties</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#livezilla">5.2.21.1. LiveZilla</a></li>
<li class="toctree-l4"><a class="reference internal" href="#phpmyadmin">5.2.21.2. phpMyAdmin</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#forgotten-visibility">5.2.22. Forgotten Visibility</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#case-fuelcms-classes-nonppp">5.2.22.1. FuelCMS</a></li>
<li class="toctree-l4"><a class="reference internal" href="#case-livezilla-classes-nonppp">5.2.22.2. LiveZilla</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#non-static-methods-called-in-a-static">5.2.23. Non Static Methods Called In A Static</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#dolphin">5.2.23.1. Dolphin</a></li>
<li class="toctree-l4"><a class="reference internal" href="#case-magento-classes-nonstaticmethodscalledstatic">5.2.23.2. Magento</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#var-keyword">5.2.24. Var Keyword</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#xataface">5.2.24.1. xataface</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#parent-first">5.2.25. Parent First</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#case-shopware-classes-parentfirst">5.2.25.1. shopware</a></li>
<li class="toctree-l4"><a class="reference internal" href="#case-prestashop-classes-parentfirst">5.2.25.2. PrestaShop</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#property-could-be-local">5.2.26. Property Could Be Local</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#case-mautic-classes-propertycouldbelocal">5.2.26.1. Mautic</a></li>
<li class="toctree-l4"><a class="reference internal" href="#case-typo3-classes-propertycouldbelocal">5.2.26.2. Typo3</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#never-used-properties">5.2.27. Never Used Properties</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#case-wordpress-classes-propertyneverused">5.2.27.1. WordPress</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#property-used-in-one-method-only">5.2.28. Property Used In One Method Only</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#case-contao-classes-propertyusedinonemethodonly">5.2.28.1. Contao</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#redefined-default">5.2.29. Redefined Default</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#piwigo">5.2.29.1. Piwigo</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#redefined-private-property">5.2.30. Redefined Private Property</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#case-zurmo-classes-redefinedprivateproperty">5.2.30.1. Zurmo</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#scalar-or-object-property">5.2.31. Scalar Or Object Property</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#sugarcrm">5.2.31.1. SugarCrm</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#could-use-self">5.2.32. Could Use self</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#case-wordpress-classes-shoulduseself">5.2.32.1. WordPress</a></li>
<li class="toctree-l4"><a class="reference internal" href="#case-livezilla-classes-shoulduseself">5.2.32.2. LiveZilla</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#static-methods-can-t-contain-this">5.2.33. Static Methods Can’t Contain $this</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#case-xataface-classes-staticcontainsthis">5.2.33.1. xataface</a></li>
<li class="toctree-l4"><a class="reference internal" href="#case-sugarcrm-classes-staticcontainsthis">5.2.33.2. SugarCrm</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#this-belongs-to-classes-or-traits">5.2.34. $this Belongs To Classes Or Traits</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#openemr">5.2.34.1. OpenEMR</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#too-many-children">5.2.35. Too Many Children</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#case-typo3-classes-toomanychildren">5.2.35.1. Typo3</a></li>
<li class="toctree-l4"><a class="reference internal" href="#case-woocommerce-classes-toomanychildren">5.2.35.2. Woocommerce</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#too-many-injections">5.2.36. Too Many Injections</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#case-nextcloud-classes-toomanyinjections">5.2.36.1. NextCloud</a></li>
<li class="toctree-l4"><a class="reference internal" href="#case-thelia-classes-toomanyinjections">5.2.36.2. Thelia</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#wrong-access-style-to-property">5.2.37. Wrong Access Style to Property</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#humo-gen">5.2.37.1. HuMo-Gen</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#undefined-properties">5.2.38. Undefined Properties</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#case-wordpress-classes-undefinedproperty">5.2.38.1. WordPress</a></li>
<li class="toctree-l4"><a class="reference internal" href="#case-mediawiki-classes-undefinedproperty">5.2.38.2. MediaWiki</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#undefined-static-or-self">5.2.39. Undefined static:: Or self::</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#case-xataface-classes-undefinedstaticmp">5.2.39.1. xataface</a></li>
<li class="toctree-l4"><a class="reference internal" href="#case-sugarcrm-classes-undefinedstaticmp">5.2.39.2. SugarCrm</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#unitialized-properties">5.2.40. Unitialized Properties</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#spip">5.2.40.1. SPIP</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#unresolved-instanceof">5.2.41. Unresolved Instanceof</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#case-wordpress-classes-unresolvedinstanceof">5.2.41.1. WordPress</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#unused-private-properties">5.2.42. Unused Private Properties</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#case-openemr-classes-unusedprivateproperty">5.2.42.1. OpenEMR</a></li>
<li class="toctree-l4"><a class="reference internal" href="#phpadsnew">5.2.42.2. phpadsnew</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#use-class-operator">5.2.43. Use ::Class Operator</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#case-typo3-classes-useclassoperator">5.2.43.1. Typo3</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#use-instanceof">5.2.44. Use Instanceof</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#teampass">5.2.44.1. TeamPass</a></li>
<li class="toctree-l4"><a class="reference internal" href="#case-zencart-classes-useinstanceof">5.2.44.2. Zencart</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#weak-typing">5.2.45. Weak Typing</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#case-teampass-classes-weaktype">5.2.45.1. TeamPass</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#wrong-class-name-case">5.2.46. Wrong Class Name Case</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#case-wordpress-classes-wrongcase">5.2.46.1. WordPress</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#illegal-name-for-method">5.2.47. Illegal Name For Method</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#case-prestashop-classes-wrongname">5.2.47.1. PrestaShop</a></li>
<li class="toctree-l4"><a class="reference internal" href="#case-magento-classes-wrongname">5.2.47.2. Magento</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#bad-constants-names">5.2.48. Bad Constants Names</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#case-prestashop-constants-badconstantnames">5.2.48.1. PrestaShop</a></li>
<li class="toctree-l4"><a class="reference internal" href="#case-zencart-constants-badconstantnames">5.2.48.2. Zencart</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#use-const">5.2.49. Use const</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#case-phpmyadmin-constants-constrecommended">5.2.49.1. phpMyAdmin</a></li>
<li class="toctree-l4"><a class="reference internal" href="#case-piwigo-constants-constrecommended">5.2.49.2. Piwigo</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#invalid-constant-name">5.2.50. Invalid Constant Name</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#case-openemr-constants-invalidname">5.2.50.1. OpenEMR</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#multiple-constant-definition">5.2.51. Multiple Constant Definition</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#case-dolibarr-constants-multipleconstantdefinition">5.2.51.1. Dolibarr</a></li>
<li class="toctree-l4"><a class="reference internal" href="#openconf">5.2.51.2. OpenConf</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#exception-order">5.2.52. Exception Order</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#case-woocommerce-exceptions-alreadycaught">5.2.52.1. Woocommerce</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#could-use-try">5.2.53. Could Use Try</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#case-mautic-exceptions-couldusetry">5.2.53.1. Mautic</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#rethrown-exceptions">5.2.54. Rethrown Exceptions</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#case-prestashop-exceptions-rethrown">5.2.54.1. PrestaShop</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#throw-functioncall">5.2.55. Throw Functioncall</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#case-sugarcrm-exceptions-throwfunctioncall">5.2.55.1. SugarCrm</a></li>
<li class="toctree-l4"><a class="reference internal" href="#case-zurmo-exceptions-throwfunctioncall">5.2.55.2. Zurmo</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#useless-catch">5.2.56. Useless Catch</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#case-zurmo-exceptions-uselesscatch">5.2.56.1. Zurmo</a></li>
<li class="toctree-l4"><a class="reference internal" href="#case-prestashop-exceptions-uselesscatch">5.2.56.2. PrestaShop</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#add-default-value">5.2.57. Add Default Value</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#case-zurmo-functions-adddefaultvalue">5.2.57.1. Zurmo</a></li>
<li class="toctree-l4"><a class="reference internal" href="#case-typo3-functions-adddefaultvalue">5.2.57.2. Typo3</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#aliases-usage">5.2.58. Aliases Usage</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#cleverstyle">5.2.58.1. Cleverstyle</a></li>
<li class="toctree-l4"><a class="reference internal" href="#case-phpmyadmin-functions-aliasesusage">5.2.58.2. phpMyAdmin</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#use-named-boolean-in-argument-definition">5.2.59. Use Named Boolean In Argument Definition</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#case-phpmyadmin-functions-avoidbooleanargument">5.2.59.1. phpMyAdmin</a></li>
<li class="toctree-l4"><a class="reference internal" href="#case-cleverstyle-functions-avoidbooleanargument">5.2.59.2. Cleverstyle</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#callback-function-needs-return">5.2.60. Callback Function Needs Return</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#case-contao-functions-callbackneedsreturn">5.2.60.1. Contao</a></li>
<li class="toctree-l4"><a class="reference internal" href="#phpdocumentor">5.2.60.2. Phpdocumentor</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#closure-could-be-a-callback">5.2.61. Closure Could Be A Callback</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#tine20">5.2.61.1. Tine20</a></li>
<li class="toctree-l4"><a class="reference internal" href="#case-nextcloud-functions-closure2string">5.2.61.2. NextCloud</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#could-be-typehinted-callable">5.2.62. Could Be Typehinted Callable</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#case-magento-functions-couldbecallable">5.2.62.1. Magento</a></li>
<li class="toctree-l4"><a class="reference internal" href="#case-prestashop-functions-couldbecallable">5.2.62.2. PrestaShop</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#could-be-static-closure">5.2.63. Could Be Static Closure</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#case-piwigo-functions-couldbestaticclosure">5.2.63.1. Piwigo</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#deep-definitions">5.2.64. Deep Definitions</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#case-dolphin-functions-deepdefinitions">5.2.64.1. Dolphin</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#empty-function">5.2.65. Empty Function</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#case-contao-functions-emptyfunction">5.2.65.1. Contao</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#mismatched-default-arguments">5.2.66. Mismatched Default Arguments</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#case-spip-functions-mismatcheddefaultarguments">5.2.66.1. SPIP</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#mismatched-typehint">5.2.67. Mismatched Typehint</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#case-wordpress-functions-mismatchedtypehint">5.2.67.1. WordPress</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#never-called-parameter">5.2.68. Never Called Parameter</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#case-piwigo-functions-neverusedparameter">5.2.68.1. Piwigo</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#no-boolean-as-default">5.2.69. No Boolean As Default</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#case-openconf-functions-nobooleanasdefault">5.2.69.1. OpenConf</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#no-class-as-typehint">5.2.70. No Class As Typehint</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#case-vanilla-functions-noclassastypehint">5.2.70.1. Vanilla</a></li>
<li class="toctree-l4"><a class="reference internal" href="#case-phpmyadmin-functions-noclassastypehint">5.2.70.2. phpMyAdmin</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#no-return-used">5.2.71. No Return Used</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#case-spip-functions-noreturnused">5.2.71.1. SPIP</a></li>
<li class="toctree-l4"><a class="reference internal" href="#case-livezilla-functions-noreturnused">5.2.71.2. LiveZilla</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#one-letter-functions">5.2.72. One Letter Functions</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#thinkphp">5.2.72.1. ThinkPHP</a></li>
<li class="toctree-l4"><a class="reference internal" href="#case-cleverstyle-functions-oneletterfunctions">5.2.72.2. Cleverstyle</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#only-variable-passed-by-reference">5.2.73. Only Variable Passed By Reference</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#case-dolphin-functions-onlyvariablepassedbyreference">5.2.73.1. Dolphin</a></li>
<li class="toctree-l4"><a class="reference internal" href="#phpipam">5.2.73.2. PhpIPAM</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#relay-function">5.2.74. Relay Function</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#case-teampass-functions-relayfunction">5.2.74.1. TeamPass</a></li>
<li class="toctree-l4"><a class="reference internal" href="#case-spip-functions-relayfunction">5.2.74.2. SPIP</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#argument-should-be-typehinted">5.2.75. Argument Should Be Typehinted</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#case-dolphin-functions-shouldbetypehinted">5.2.75.1. Dolphin</a></li>
<li class="toctree-l4"><a class="reference internal" href="#case-mautic-functions-shouldbetypehinted">5.2.75.2. Mautic</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#should-use-constants">5.2.76. Should Use Constants</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#case-tine20-functions-shoulduseconstants">5.2.76.1. Tine20</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#too-many-local-variables">5.2.77. Too Many Local Variables</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#case-humo-gen-functions-toomanylocalvariables">5.2.77.1. HuMo-Gen</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#too-many-parameters">5.2.78. Too Many Parameters</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#case-wordpress-functions-toomanyparameters">5.2.78.1. WordPress</a></li>
<li class="toctree-l4"><a class="reference internal" href="#case-churchcrm-functions-toomanyparameters">5.2.78.2. ChurchCRM</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#unused-arguments">5.2.79. Unused Arguments</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#case-thinkphp-functions-unusedarguments">5.2.79.1. ThinkPHP</a></li>
<li class="toctree-l4"><a class="reference internal" href="#case-phpmyadmin-functions-unusedarguments">5.2.79.2. phpMyAdmin</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#unused-functions">5.2.80. Unused Functions</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#case-woocommerce-functions-unusedfunctions">5.2.80.1. Woocommerce</a></li>
<li class="toctree-l4"><a class="reference internal" href="#case-piwigo-functions-unusedfunctions">5.2.80.2. Piwigo</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#unused-inherited-variable-in-closure">5.2.81. Unused Inherited Variable In Closure</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#case-shopware-functions-unusedinheritedvariable">5.2.81.1. shopware</a></li>
<li class="toctree-l4"><a class="reference internal" href="#case-mautic-functions-unusedinheritedvariable">5.2.81.2. Mautic</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#use-constant-as-arguments">5.2.82. Use Constant As Arguments</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#tikiwiki">5.2.82.1. Tikiwiki</a></li>
<li class="toctree-l4"><a class="reference internal" href="#case-shopware-functions-useconstantasarguments">5.2.82.2. shopware</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#useless-referenced-argument">5.2.83. Useless Referenced Argument</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#case-woocommerce-functions-uselessreferenceargument">5.2.83.1. Woocommerce</a></li>
<li class="toctree-l4"><a class="reference internal" href="#case-magento-functions-uselessreferenceargument">5.2.83.2. Magento</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#useless-return">5.2.84. Useless Return</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#case-thinkphp-functions-uselessreturn">5.2.84.1. ThinkPHP</a></li>
<li class="toctree-l4"><a class="reference internal" href="#case-vanilla-functions-uselessreturn">5.2.84.2. Vanilla</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#wrong-number-of-arguments">5.2.85. Wrong Number Of Arguments</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#case-xataface-functions-wrongnumberofarguments">5.2.85.1. xataface</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#wrong-optional-parameter">5.2.86. Wrong Optional Parameter</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#case-fuelcms-functions-wrongoptionalparameter">5.2.86.1. FuelCMS</a></li>
<li class="toctree-l4"><a class="reference internal" href="#case-vanilla-functions-wrongoptionalparameter">5.2.86.2. Vanilla</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#already-parents-interface">5.2.87. Already Parents Interface</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#case-wordpress-interfaces-alreadyparentsinterface">5.2.87.1. WordPress</a></li>
<li class="toctree-l4"><a class="reference internal" href="#case-thelia-interfaces-alreadyparentsinterface">5.2.87.2. Thelia</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#undefined-interfaces">5.2.88. Undefined Interfaces</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#case-xataface-interfaces-undefinedinterfaces">5.2.88.1. xataface</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#unused-interfaces">5.2.89. Unused Interfaces</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#case-tine20-interfaces-unusedinterfaces">5.2.89.1. Tine20</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#useless-interfaces">5.2.90. Useless Interfaces</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#case-woocommerce-interfaces-uselessinterfaces">5.2.90.1. Woocommerce</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#hidden-use-expression">5.2.91. Hidden Use Expression</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#case-tikiwiki-namespaces-hiddenuse">5.2.91.1. Tikiwiki</a></li>
<li class="toctree-l4"><a class="reference internal" href="#case-openemr-namespaces-hiddenuse">5.2.91.2. OpenEMR</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#multiple-alias-definitions">5.2.92. Multiple Alias Definitions</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#case-churchcrm-namespaces-multiplealiasdefinitions">5.2.92.1. ChurchCRM</a></li>
<li class="toctree-l4"><a class="reference internal" href="#case-phinx-namespaces-multiplealiasdefinitions">5.2.92.2. Phinx</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#no-array-merge-in-loops">5.2.93. No array_merge() In Loops</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#case-tine20-performances-arraymergeinloops">5.2.93.1. Tine20</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#double-array-flip">5.2.94. Double array_flip()</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#case-nextcloud-performances-doublearrayflip">5.2.94.1. NextCloud</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#isset-on-the-whole-array">5.2.95. Isset() On The Whole Array</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#case-tine20-performances-issetwholearray">5.2.95.1. Tine20</a></li>
<li class="toctree-l4"><a class="reference internal" href="#case-expressionengine-performances-issetwholearray">5.2.95.2. ExpressionEngine</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#joining-file">5.2.96. Joining file()</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#case-wordpress-performances-joinfile">5.2.96.1. WordPress</a></li>
<li class="toctree-l4"><a class="reference internal" href="#case-spip-performances-joinfile">5.2.96.2. SPIP</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#logical-to-in-array">5.2.97. Logical To in_array</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#case-zencart-performances-logicaltoinarray">5.2.97.1. Zencart</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#make-one-call-with-array">5.2.98. Make One Call With Array</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#case-humo-gen-performances-makeonecall">5.2.98.1. HuMo-Gen</a></li>
<li class="toctree-l4"><a class="reference internal" href="#case-edusoho-performances-makeonecall">5.2.98.2. Edusoho</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#avoid-concat-in-loop">5.2.99. Avoid Concat In Loop</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#case-suitecrm-performances-noconcatinloop">5.2.99.1. SuiteCrm</a></li>
<li class="toctree-l4"><a class="reference internal" href="#case-thinkphp-performances-noconcatinloop">5.2.99.2. ThinkPHP</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#avoid-glob-usage">5.2.100. Avoid glob() Usage</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#case-phinx-performances-noglob">5.2.100.1. Phinx</a></li>
<li class="toctree-l4"><a class="reference internal" href="#case-nextcloud-performances-noglob">5.2.100.2. NextCloud</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#no-count-with-0">5.2.101. No Count With 0</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#case-contao-performances-notcountnull">5.2.101.1. Contao</a></li>
<li class="toctree-l4"><a class="reference internal" href="#case-wordpress-performances-notcountnull">5.2.101.2. WordPress</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#pre-increment">5.2.102. Pre-increment</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#case-expressionengine-performances-prepostincrement">5.2.102.1. ExpressionEngine</a></li>
<li class="toctree-l4"><a class="reference internal" href="#traq">5.2.102.2. Traq</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#slow-functions">5.2.103. Slow Functions</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#case-churchcrm-performances-slowfunctions">5.2.103.1. ChurchCRM</a></li>
<li class="toctree-l4"><a class="reference internal" href="#case-suitecrm-performances-slowfunctions">5.2.103.2. SuiteCrm</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#strpos-too-much">5.2.104. strpos() Too Much</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#case-wordpress-performances-strpostoomuch">5.2.104.1. WordPress</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#substring-first">5.2.105. Substring First</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#case-spip-performances-substrfirst">5.2.105.1. SPIP</a></li>
<li class="toctree-l4"><a class="reference internal" href="#case-prestashop-performances-substrfirst">5.2.105.2. PrestaShop</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#time-vs-strtotime">5.2.106. time() Vs strtotime()</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#case-woocommerce-performances-timevsstrtotime">5.2.106.1. Woocommerce</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#assign-with-and-precedence">5.2.107. Assign With And Precedence</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#case-xataface-php-assignand">5.2.107.1. xataface</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#avoid-set-error-handler-context-argument">5.2.108. Avoid set_error_handler $context Argument</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#case-shopware-php-avoidseterrorhandlercontextarg">5.2.108.1. shopware</a></li>
<li class="toctree-l4"><a class="reference internal" href="#case-vanilla-php-avoidseterrorhandlercontextarg">5.2.108.2. Vanilla</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#use-random-int">5.2.109. Use random_int()</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#case-thelia-php-betterrand">5.2.109.1. Thelia</a></li>
<li class="toctree-l4"><a class="reference internal" href="#case-fuelcms-php-betterrand">5.2.109.2. FuelCMS</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#deprecated-php-functions">5.2.110. Deprecated PHP Functions</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#case-dolphin-php-deprecated">5.2.110.1. Dolphin</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#wrong-fopen-mode">5.2.111. Wrong fopen() Mode</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#case-tikiwiki-php-fopenmode">5.2.111.1. Tikiwiki</a></li>
<li class="toctree-l4"><a class="reference internal" href="#case-humo-gen-php-fopenmode">5.2.111.2. HuMo-Gen</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#incompilable-files">5.2.112. Incompilable Files</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#case-xataface-php-incompilable">5.2.112.1. xataface</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#wrong-parameter-type">5.2.113. Wrong Parameter Type</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#case-zencart-php-internalparametertype">5.2.113.1. Zencart</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#isset-multiple-arguments">5.2.114. Isset Multiple Arguments</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#case-thinkphp-php-issetmultipleargs">5.2.114.1. ThinkPHP</a></li>
<li class="toctree-l4"><a class="reference internal" href="#case-livezilla-php-issetmultipleargs">5.2.114.2. LiveZilla</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#logical-should-use-symbolic-operators">5.2.115. Logical Should Use Symbolic Operators</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#case-cleverstyle-php-logicalinletters">5.2.115.1. Cleverstyle</a></li>
<li class="toctree-l4"><a class="reference internal" href="#case-openconf-php-logicalinletters">5.2.115.2. OpenConf</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#possible-missing-subpattern">5.2.116. Possible Missing Subpattern</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#case-phpmyadmin-php-missingsubpattern">5.2.116.1. phpMyAdmin</a></li>
<li class="toctree-l4"><a class="reference internal" href="#case-spip-php-missingsubpattern">5.2.116.2. SPIP</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#for-exponent">5.2.117. ** For Exponent</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#case-traq-php-newexponent">5.2.117.1. Traq</a></li>
<li class="toctree-l4"><a class="reference internal" href="#case-teampass-php-newexponent">5.2.117.2. TeamPass</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#no-class-in-global">5.2.118. No Class In Global</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#case-dolphin-php-noclassinglobal">5.2.118.1. Dolphin</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#no-reference-for-ternary">5.2.119. No Reference For Ternary</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#case-phpadsnew-php-noreferenceforternary">5.2.119.1. phpadsnew</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#pathinfo-returns-may-vary">5.2.120. Pathinfo() Returns May Vary</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#case-nextcloud-php-pathinforeturns">5.2.120.1. NextCloud</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#preg-match-all-flag">5.2.121. preg_match_all() Flag</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#case-fuelcms-php-pregmatchallflag">5.2.121.1. FuelCMS</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#php-keywords-as-names">5.2.122. PHP Keywords As Names</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#case-churchcrm-php-reservednames">5.2.122.1. ChurchCRM</a></li>
<li class="toctree-l4"><a class="reference internal" href="#case-xataface-php-reservednames">5.2.122.2. xataface</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#should-preprocess-chr">5.2.123. Should Preprocess Chr()</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#case-phpadsnew-php-shouldpreprocess">5.2.123.1. phpadsnew</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#should-use-array-filter">5.2.124. Should Use array_filter()</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#case-xataface-php-shouldusearrayfilter">5.2.124.1. xataface</a></li>
<li class="toctree-l4"><a class="reference internal" href="#case-shopware-php-shouldusearrayfilter">5.2.124.2. shopware</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#should-use-coalesce">5.2.125. Should Use Coalesce</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#case-churchcrm-php-shouldusecoalesce">5.2.125.1. ChurchCRM</a></li>
<li class="toctree-l4"><a class="reference internal" href="#case-cleverstyle-php-shouldusecoalesce">5.2.125.2. Cleverstyle</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#strtr-arguments">5.2.126. Strtr Arguments</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#case-suitecrm-php-strtrarguments">5.2.126.1. SuiteCrm</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#too-many-native-calls">5.2.127. Too Many Native Calls</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#case-spip-php-toomanynativecalls">5.2.127.1. SPIP</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#use-php-object-api">5.2.128. Use PHP Object API</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#case-wordpress-php-useobjectapi">5.2.128.1. WordPress</a></li>
<li class="toctree-l4"><a class="reference internal" href="#case-prestashop-php-useobjectapi">5.2.128.2. PrestaShop</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#use-pathinfo">5.2.129. Use Pathinfo</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#case-suitecrm-php-usepathinfo">5.2.129.1. SuiteCrm</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#use-pathinfo-arguments">5.2.130. Use pathinfo() Arguments</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#zend-config">5.2.130.1. Zend-Config</a></li>
<li class="toctree-l4"><a class="reference internal" href="#case-thinkphp-php-usepathinfoargs">5.2.130.2. ThinkPHP</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#use-session-start-options">5.2.131. Use session_start() Options</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#case-wordpress-php-usesessionstartoptions">5.2.131.1. WordPress</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#debuginfo-usage">5.2.132. __debugInfo() Usage</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#case-dolibarr-php-debuginfousage">5.2.132.1. Dolibarr</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#old-style-autoload">5.2.133. Old Style __autoload()</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#case-piwigo-php-oldautoloadusage">5.2.133.1. Piwigo</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#compare-hash">5.2.134. Compare Hash</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#case-traq-security-comparehash">5.2.134.1. Traq</a></li>
<li class="toctree-l4"><a class="reference internal" href="#case-livezilla-security-comparehash">5.2.134.2. LiveZilla</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#configure-extract">5.2.135. Configure Extract</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#case-zurmo-security-configureextract">5.2.135.1. Zurmo</a></li>
<li class="toctree-l4"><a class="reference internal" href="#case-dolibarr-security-configureextract">5.2.135.2. Dolibarr</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#safe-curl-options">5.2.136. Safe Curl Options</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#case-openconf-security-curloptions">5.2.136.1. OpenConf</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#don-t-echo-error">5.2.137. Don’t Echo Error</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#case-churchcrm-security-dontechoerror">5.2.137.1. ChurchCRM</a></li>
<li class="toctree-l4"><a class="reference internal" href="#case-phpdocumentor-security-dontechoerror">5.2.137.2. Phpdocumentor</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#encoded-simple-letters">5.2.138. Encoded Simple Letters</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#case-zurmo-security-encodedletters">5.2.138.1. Zurmo</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#mkdir-default">5.2.139. Mkdir Default</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#case-mautic-security-mkdirdefault">5.2.139.1. Mautic</a></li>
<li class="toctree-l4"><a class="reference internal" href="#case-openemr-security-mkdirdefault">5.2.139.2. OpenEMR</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#register-globals">5.2.140. Register Globals</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#case-teampass-security-registerglobals">5.2.140.1. TeamPass</a></li>
<li class="toctree-l4"><a class="reference internal" href="#xoops">5.2.140.2. XOOPS</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#should-use-prepared-statement">5.2.141. Should Use Prepared Statement</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#case-dolibarr-security-shouldusepreparedstatement">5.2.141.1. Dolibarr</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#unserialize-second-arg">5.2.142. Unserialize Second Arg</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#case-piwigo-security-unserializesecondarg">5.2.142.1. Piwigo</a></li>
<li class="toctree-l4"><a class="reference internal" href="#case-livezilla-security-unserializesecondarg">5.2.142.2. LiveZilla</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#adding-zero">5.2.143. Adding Zero</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#case-thelia-structures-addzero">5.2.143.1. Thelia</a></li>
<li class="toctree-l4"><a class="reference internal" href="#case-openemr-structures-addzero">5.2.143.2. OpenEMR</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#altering-foreach-without-reference">5.2.144. Altering Foreach Without Reference</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#case-contao-structures-alteringforeachwithoutreference">5.2.144.1. Contao</a></li>
<li class="toctree-l4"><a class="reference internal" href="#case-wordpress-structures-alteringforeachwithoutreference">5.2.144.2. WordPress</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#bail-out-early">5.2.145. Bail Out Early</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#case-openemr-structures-bailoutearly">5.2.145.1. OpenEMR</a></li>
<li class="toctree-l4"><a class="reference internal" href="#opencfp">5.2.145.2. opencfp</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#use-basename-suffix">5.2.146. Use Basename Suffix</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#case-nextcloud-structures-basenamesuffix">5.2.146.1. NextCloud</a></li>
<li class="toctree-l4"><a class="reference internal" href="#case-dolibarr-structures-basenamesuffix">5.2.146.2. Dolibarr</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#strict-comparison-with-booleans">5.2.147. Strict Comparison With Booleans</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#case-phinx-structures-booleanstrictcomparison">5.2.147.1. Phinx</a></li>
<li class="toctree-l4"><a class="reference internal" href="#case-typo3-structures-booleanstrictcomparison">5.2.147.2. Typo3</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#buried-assignation">5.2.148. Buried Assignation</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#case-xoops-structures-buriedassignation">5.2.148.1. XOOPS</a></li>
<li class="toctree-l4"><a class="reference internal" href="#case-mautic-structures-buriedassignation">5.2.148.2. Mautic</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#cast-to-boolean">5.2.149. Cast To Boolean</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#case-mediawiki-structures-casttoboolean">5.2.149.1. MediaWiki</a></li>
<li class="toctree-l4"><a class="reference internal" href="#case-dolibarr-structures-casttoboolean">5.2.149.2. Dolibarr</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#catch-overwrite-variable">5.2.150. Catch Overwrite Variable</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#case-phpipam-structures-catchshadowsvariable">5.2.150.1. PhpIPAM</a></li>
<li class="toctree-l4"><a class="reference internal" href="#case-suitecrm-structures-catchshadowsvariable">5.2.150.2. SuiteCrm</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#check-all-types">5.2.151. Check All Types</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#case-zend-config-structures-checkalltypes">5.2.151.1. Zend-Config</a></li>
<li class="toctree-l4"><a class="reference internal" href="#case-vanilla-structures-checkalltypes">5.2.151.2. Vanilla</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#check-json">5.2.152. Check JSON</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#case-woocommerce-structures-checkjson">5.2.152.1. Woocommerce</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#common-alternatives">5.2.153. Common Alternatives</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#case-dolibarr-structures-commonalternatives">5.2.153.1. Dolibarr</a></li>
<li class="toctree-l4"><a class="reference internal" href="#case-nextcloud-structures-commonalternatives">5.2.153.2. NextCloud</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#continue-is-for-loop">5.2.154. Continue Is For Loop</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#case-xoops-structures-continueisforloop">5.2.154.1. XOOPS</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#could-be-else">5.2.155. Could Be Else</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#case-sugarcrm-structures-couldbeelse">5.2.155.1. SugarCrm</a></li>
<li class="toctree-l4"><a class="reference internal" href="#case-openemr-structures-couldbeelse">5.2.155.2. OpenEMR</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#could-be-static">5.2.156. Could Be Static</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#case-dolphin-structures-couldbestatic">5.2.156.1. Dolphin</a></li>
<li class="toctree-l4"><a class="reference internal" href="#case-contao-structures-couldbestatic">5.2.156.2. Contao</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#could-use-array-fill-keys">5.2.157. Could Use array_fill_keys</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#case-churchcrm-structures-couldusearrayfillkeys">5.2.157.1. ChurchCRM</a></li>
<li class="toctree-l4"><a class="reference internal" href="#case-phpipam-structures-couldusearrayfillkeys">5.2.157.2. PhpIPAM</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#could-use-array-unique">5.2.158. Could Use array_unique</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#case-dolibarr-structures-couldusearrayunique">5.2.158.1. Dolibarr</a></li>
<li class="toctree-l4"><a class="reference internal" href="#case-openemr-structures-couldusearrayunique">5.2.158.2. OpenEMR</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#could-use-compact">5.2.159. Could Use Compact</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#case-wordpress-structures-couldusecompact">5.2.159.1. WordPress</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#could-use-dir">5.2.160. Could Use __DIR__</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#case-woocommerce-structures-couldusedir">5.2.160.1. Woocommerce</a></li>
<li class="toctree-l4"><a class="reference internal" href="#case-piwigo-structures-couldusedir">5.2.160.2. Piwigo</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#could-use-short-assignation">5.2.161. Could Use Short Assignation</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#case-churchcrm-structures-coulduseshortassignation">5.2.161.1. ChurchCRM</a></li>
<li class="toctree-l4"><a class="reference internal" href="#case-thelia-structures-coulduseshortassignation">5.2.161.2. Thelia</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#could-use-str-repeat">5.2.162. Could Use str_repeat()</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#case-zencart-structures-couldusestrrepeat">5.2.162.1. Zencart</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#dangling-array-references">5.2.163. Dangling Array References</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#case-typo3-structures-danglingarrayreferences">5.2.163.1. Typo3</a></li>
<li class="toctree-l4"><a class="reference internal" href="#case-sugarcrm-structures-danglingarrayreferences">5.2.163.2. SugarCrm</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#dir-then-slash">5.2.164. __DIR__ Then Slash</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#case-traq-structures-dirthenslash">5.2.164.1. Traq</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#don-t-loop-on-yield">5.2.165. Don’t Loop On Yield</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#case-dolibarr-structures-dontlooponyield">5.2.165.1. Dolibarr</a></li>
<li class="toctree-l4"><a class="reference internal" href="#case-tikiwiki-structures-dontlooponyield">5.2.165.2. Tikiwiki</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#dont-mix">5.2.166. Dont Mix ++</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#case-contao-structures-dontmixplusplus">5.2.166.1. Contao</a></li>
<li class="toctree-l4"><a class="reference internal" href="#case-typo3-structures-dontmixplusplus">5.2.166.2. Typo3</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#echo-with-concat">5.2.167. Echo With Concat</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#case-phpdocumentor-structures-echowithconcat">5.2.167.1. Phpdocumentor</a></li>
<li class="toctree-l4"><a class="reference internal" href="#case-teampass-structures-echowithconcat">5.2.167.2. TeamPass</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#else-if-versus-elseif">5.2.168. Else If Versus Elseif</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#case-teampass-structures-elseifelseif">5.2.168.1. TeamPass</a></li>
<li class="toctree-l4"><a class="reference internal" href="#case-phpdocumentor-structures-elseifelseif">5.2.168.2. Phpdocumentor</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#empty-blocks">5.2.169. Empty Blocks</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#case-cleverstyle-structures-emptyblocks">5.2.169.1. Cleverstyle</a></li>
<li class="toctree-l4"><a class="reference internal" href="#case-phpipam-structures-emptyblocks">5.2.169.2. PhpIPAM</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#empty-instructions">5.2.170. Empty Instructions</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#case-zurmo-structures-emptylines">5.2.170.1. Zurmo</a></li>
<li class="toctree-l4"><a class="reference internal" href="#case-thinkphp-structures-emptylines">5.2.170.2. ThinkPHP</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#empty-try-catch">5.2.171. Empty Try Catch</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#case-livezilla-structures-emptytrycatch">5.2.171.1. LiveZilla</a></li>
<li class="toctree-l4"><a class="reference internal" href="#case-mautic-structures-emptytrycatch">5.2.171.2. Mautic</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#empty-with-expression">5.2.172. Empty With Expression</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#case-humo-gen-structures-emptywithexpression">5.2.172.1. HuMo-Gen</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#error-reporting-with-integers">5.2.173. error_reporting() With Integers</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#case-sugarcrm-structures-errorreportingwithinteger">5.2.173.1. SugarCrm</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#eval-usage">5.2.174. Eval() Usage</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#case-xoops-structures-evalusage">5.2.174.1. XOOPS</a></li>
<li class="toctree-l4"><a class="reference internal" href="#case-mautic-structures-evalusage">5.2.174.2. Mautic</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#eval-without-try">5.2.175. eval() Without Try</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#case-fuelcms-structures-evalwithouttry">5.2.175.1. FuelCMS</a></li>
<li class="toctree-l4"><a class="reference internal" href="#case-expressionengine-structures-evalwithouttry">5.2.175.2. ExpressionEngine</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#exit-usage">5.2.176. Exit() Usage</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#case-traq-structures-exitusage">5.2.176.1. Traq</a></li>
<li class="toctree-l4"><a class="reference internal" href="#case-thinkphp-structures-exitusage">5.2.176.2. ThinkPHP</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#failed-substr-comparison">5.2.177. Failed Substr Comparison</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#case-zurmo-structures-failingsubstrcomparison">5.2.177.1. Zurmo</a></li>
<li class="toctree-l4"><a class="reference internal" href="#case-mediawiki-structures-failingsubstrcomparison">5.2.177.2. MediaWiki</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#foreach-reference-is-not-modified">5.2.178. Foreach Reference Is Not Modified</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#case-dolibarr-structures-foreachreferenceisnotmodified">5.2.178.1. Dolibarr</a></li>
<li class="toctree-l4"><a class="reference internal" href="#case-vanilla-structures-foreachreferenceisnotmodified">5.2.178.2. Vanilla</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#overwritten-source-and-value">5.2.179. Overwritten Source And Value</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#case-churchcrm-structures-foreachsourcevalue">5.2.179.1. ChurchCRM</a></li>
<li class="toctree-l4"><a class="reference internal" href="#case-expressionengine-structures-foreachsourcevalue">5.2.179.2. ExpressionEngine</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#function-subscripting-old-style">5.2.180. Function Subscripting, Old Style</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#case-openconf-structures-functionpresubscripting">5.2.180.1. OpenConf</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#case-identical-conditions">5.2.181. Identical Conditions</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#case-wordpress-structures-identicalconditions">5.2.181.1. WordPress</a></li>
<li class="toctree-l4"><a class="reference internal" href="#case-dolibarr-structures-identicalconditions">5.2.181.2. Dolibarr</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#case-identical-on-both-sides">5.2.182. Identical On Both Sides</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#case-phpmyadmin-structures-identicalonbothsides">5.2.182.1. phpMyAdmin</a></li>
<li class="toctree-l4"><a class="reference internal" href="#case-humo-gen-structures-identicalonbothsides">5.2.182.2. HuMo-Gen</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#if-with-same-conditions">5.2.183. If With Same Conditions</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#case-phpmyadmin-structures-ifwithsameconditions">5.2.183.1. phpMyAdmin</a></li>
<li class="toctree-l4"><a class="reference internal" href="#case-phpdocumentor-structures-ifwithsameconditions">5.2.183.2. Phpdocumentor</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#inconsistent-concatenation">5.2.184. Inconsistent Concatenation</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#case-fuelcms-structures-inconsistentconcatenation">5.2.184.1. FuelCMS</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#indices-are-int-or-string">5.2.185. Indices Are Int Or String</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#case-zencart-structures-indicesareintorstring">5.2.185.1. Zencart</a></li>
<li class="toctree-l4"><a class="reference internal" href="#case-mautic-structures-indicesareintorstring">5.2.185.2. Mautic</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#invalid-regex">5.2.186. Invalid Regex</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#case-sugarcrm-structures-invalidregex">5.2.186.1. SugarCrm</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#is-actually-zero">5.2.187. Is Actually Zero</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#case-dolibarr-structures-iszero">5.2.187.1. Dolibarr</a></li>
<li class="toctree-l4"><a class="reference internal" href="#case-suitecrm-structures-iszero">5.2.187.2. SuiteCrm</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#list-may-omit-variables">5.2.188. list() May Omit Variables</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#case-openconf-structures-listomissions">5.2.188.1. OpenConf</a></li>
<li class="toctree-l4"><a class="reference internal" href="#case-fuelcms-structures-listomissions">5.2.188.2. FuelCMS</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#logical-mistakes">5.2.189. Logical Mistakes</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#case-dolibarr-structures-logicalmistakes">5.2.189.1. Dolibarr</a></li>
<li class="toctree-l4"><a class="reference internal" href="#case-cleverstyle-structures-logicalmistakes">5.2.189.2. Cleverstyle</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#lone-blocks">5.2.190. Lone Blocks</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#case-thinkphp-structures-loneblock">5.2.190.1. ThinkPHP</a></li>
<li class="toctree-l4"><a class="reference internal" href="#case-tine20-structures-loneblock">5.2.190.2. Tine20</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#long-arguments">5.2.191. Long Arguments</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#case-cleverstyle-structures-longarguments">5.2.191.1. Cleverstyle</a></li>
<li class="toctree-l4"><a class="reference internal" href="#case-contao-structures-longarguments">5.2.191.2. Contao</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#mismatched-ternary-alternatives">5.2.192. Mismatched Ternary Alternatives</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#case-phpadsnew-structures-mismatchedternary">5.2.192.1. phpadsnew</a></li>
<li class="toctree-l4"><a class="reference internal" href="#case-openemr-structures-mismatchedternary">5.2.192.2. OpenEMR</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#missing-cases-in-switch">5.2.193. Missing Cases In Switch</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#case-tikiwiki-structures-missingcases">5.2.193.1. Tikiwiki</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#mixed-concat-and-interpolation">5.2.194. Mixed Concat And Interpolation</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#case-suitecrm-structures-mixedconcatinterpolation">5.2.194.1. SuiteCrm</a></li>
<li class="toctree-l4"><a class="reference internal" href="#case-edusoho-structures-mixedconcatinterpolation">5.2.194.2. Edusoho</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#multiples-identical-case">5.2.195. Multiples Identical Case</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#case-sugarcrm-structures-multipledefinedcase">5.2.195.1. SugarCrm</a></li>
<li class="toctree-l4"><a class="reference internal" href="#case-expressionengine-structures-multipledefinedcase">5.2.195.2. ExpressionEngine</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#multiple-type-variable">5.2.196. Multiple Type Variable</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#case-typo3-structures-multipletypevariable">5.2.196.1. Typo3</a></li>
<li class="toctree-l4"><a class="reference internal" href="#case-vanilla-structures-multipletypevariable">5.2.196.2. Vanilla</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#multiply-by-one">5.2.197. Multiply By One</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#case-sugarcrm-structures-multiplybyone">5.2.197.1. SugarCrm</a></li>
<li class="toctree-l4"><a class="reference internal" href="#case-edusoho-structures-multiplybyone">5.2.197.2. Edusoho</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#named-regex">5.2.198. Named Regex</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#case-phinx-structures-namedregex">5.2.198.1. Phinx</a></li>
<li class="toctree-l4"><a class="reference internal" href="#case-shopware-structures-namedregex">5.2.198.2. shopware</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#nested-ifthen">5.2.199. Nested Ifthen</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#case-livezilla-structures-nestedifthen">5.2.199.1. LiveZilla</a></li>
<li class="toctree-l4"><a class="reference internal" href="#case-mediawiki-structures-nestedifthen">5.2.199.2. MediaWiki</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#nested-ternary">5.2.200. Nested Ternary</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#case-spip-structures-nestedternary">5.2.200.1. SPIP</a></li>
<li class="toctree-l4"><a class="reference internal" href="#case-zencart-structures-nestedternary">5.2.200.2. Zencart</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#always-positive-comparison">5.2.201. Always Positive Comparison</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#case-magento-structures-nevernegative">5.2.201.1. Magento</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#next-month-trap">5.2.202. Next Month Trap</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#case-contao-structures-nextmonthtrap">5.2.202.1. Contao</a></li>
<li class="toctree-l4"><a class="reference internal" href="#case-edusoho-structures-nextmonthtrap">5.2.202.2. Edusoho</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#no-choice">5.2.203. No Choice</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#case-nextcloud-structures-nochoice">5.2.203.1. NextCloud</a></li>
<li class="toctree-l4"><a class="reference internal" href="#case-zencart-structures-nochoice">5.2.203.2. Zencart</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#no-direct-usage">5.2.204. No Direct Usage</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#case-edusoho-structures-nodirectusage">5.2.204.1. Edusoho</a></li>
<li class="toctree-l4"><a class="reference internal" href="#case-xoops-structures-nodirectusage">5.2.204.2. XOOPS</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#no-empty-regex">5.2.205. No Empty Regex</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#case-tikiwiki-structures-noemptyregex">5.2.205.1. Tikiwiki</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#no-hardcoded-hash">5.2.206. No Hardcoded Hash</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#case-shopware-structures-nohardcodedhash">5.2.206.1. shopware</a></li>
<li class="toctree-l4"><a class="reference internal" href="#case-sugarcrm-structures-nohardcodedhash">5.2.206.2. SugarCrm</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#no-hardcoded-ip">5.2.207. No Hardcoded Ip</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#case-openemr-structures-nohardcodedip">5.2.207.1. OpenEMR</a></li>
<li class="toctree-l4"><a class="reference internal" href="#case-nextcloud-structures-nohardcodedip">5.2.207.2. NextCloud</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#no-hardcoded-path">5.2.208. No Hardcoded Path</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#case-tine20-structures-nohardcodedpath">5.2.208.1. Tine20</a></li>
<li class="toctree-l4"><a class="reference internal" href="#case-thelia-structures-nohardcodedpath">5.2.208.2. Thelia</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#no-hardcoded-port">5.2.209. No Hardcoded Port</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#case-wordpress-structures-nohardcodedport">5.2.209.1. WordPress</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#no-isset-with-empty">5.2.210. No isset() With empty()</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#case-xoops-structures-noissetwithempty">5.2.210.1. XOOPS</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#no-need-for-else">5.2.211. No Need For Else</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#case-thelia-structures-noneedforelse">5.2.211.1. Thelia</a></li>
<li class="toctree-l4"><a class="reference internal" href="#case-thinkphp-structures-noneedforelse">5.2.211.2. ThinkPHP</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#no-parenthesis-for-language-construct">5.2.212. No Parenthesis For Language Construct</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#case-phpdocumentor-structures-noparenthesisforlanguageconstruct">5.2.212.1. Phpdocumentor</a></li>
<li class="toctree-l4"><a class="reference internal" href="#case-phpmyadmin-structures-noparenthesisforlanguageconstruct">5.2.212.2. phpMyAdmin</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#avoid-substr-one">5.2.213. Avoid Substr() One</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#case-churchcrm-structures-nosubstrone">5.2.213.1. ChurchCRM</a></li>
<li class="toctree-l4"><a class="reference internal" href="#case-livezilla-structures-nosubstrone">5.2.213.2. LiveZilla</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#operator">5.2.214. &#64; Operator</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#case-phinx-structures-noscream">5.2.214.1. Phinx</a></li>
<li class="toctree-l4"><a class="reference internal" href="#case-phpipam-structures-noscream">5.2.214.2. PhpIPAM</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#not-not">5.2.215. Not Not</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#case-cleverstyle-structures-notnot">5.2.215.1. Cleverstyle</a></li>
<li class="toctree-l4"><a class="reference internal" href="#case-tine20-structures-notnot">5.2.215.2. Tine20</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#objects-don-t-need-references">5.2.216. Objects Don’t Need References</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#case-zencart-structures-objectreferences">5.2.216.1. Zencart</a></li>
<li class="toctree-l4"><a class="reference internal" href="#case-xoops-structures-objectreferences">5.2.216.2. XOOPS</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#include-once-usage">5.2.217. include_once() Usage</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#case-xoops-structures-onceusage">5.2.217.1. XOOPS</a></li>
<li class="toctree-l4"><a class="reference internal" href="#case-tikiwiki-structures-onceusage">5.2.217.2. Tikiwiki</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#one-if-is-sufficient">5.2.218. One If Is Sufficient</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#case-tikiwiki-structures-oneifissufficient">5.2.218.1. Tikiwiki</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#several-instructions-on-the-same-line">5.2.219. Several Instructions On The Same Line</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#case-piwigo-structures-onelinetwoinstructions">5.2.219.1. Piwigo</a></li>
<li class="toctree-l4"><a class="reference internal" href="#case-tine20-structures-onelinetwoinstructions">5.2.219.2. Tine20</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#or-die">5.2.220. Or Die</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#case-tine20-structures-ordie">5.2.220.1. Tine20</a></li>
<li class="toctree-l4"><a class="reference internal" href="#case-openconf-structures-ordie">5.2.220.2. OpenConf</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#php7-dirname">5.2.221. PHP7 Dirname</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#case-openconf-structures-php7dirname">5.2.221.1. OpenConf</a></li>
<li class="toctree-l4"><a class="reference internal" href="#case-mediawiki-structures-php7dirname">5.2.221.2. MediaWiki</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#phpinfo">5.2.222. Phpinfo</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#case-dolphin-structures-phpinfousage">5.2.222.1. Dolphin</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#possible-increment">5.2.223. Possible Increment</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#case-zurmo-structures-possibleincrement">5.2.223.1. Zurmo</a></li>
<li class="toctree-l4"><a class="reference internal" href="#case-mediawiki-structures-possibleincrement">5.2.223.2. MediaWiki</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#printf-number-of-arguments">5.2.224. Printf Number Of Arguments</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#case-phpipam-structures-printfarguments">5.2.224.1. PhpIPAM</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#property-variable-confusion">5.2.225. Property Variable Confusion</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#case-phpipam-structures-propertyvariableconfusion">5.2.225.1. PhpIPAM</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#queries-in-loops">5.2.226. Queries In Loops</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#case-teampass-structures-queriesinloop">5.2.226.1. TeamPass</a></li>
<li class="toctree-l4"><a class="reference internal" href="#case-openemr-structures-queriesinloop">5.2.226.2. OpenEMR</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#repeated-print">5.2.227. Repeated print()</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#case-edusoho-structures-repeatedprint">5.2.227.1. Edusoho</a></li>
<li class="toctree-l4"><a class="reference internal" href="#case-humo-gen-structures-repeatedprint">5.2.227.2. HuMo-Gen</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#repeated-regex">5.2.228. Repeated Regex</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#case-vanilla-structures-repeatedregex">5.2.228.1. Vanilla</a></li>
<li class="toctree-l4"><a class="reference internal" href="#case-tikiwiki-structures-repeatedregex">5.2.228.2. Tikiwiki</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#return-true-false">5.2.229. Return True False</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#case-mautic-structures-returntruefalse">5.2.229.1. Mautic</a></li>
<li class="toctree-l4"><a class="reference internal" href="#case-fuelcms-structures-returntruefalse">5.2.229.2. FuelCMS</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#same-conditions-in-condition">5.2.230. Same Conditions In Condition</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#case-teampass-structures-sameconditions">5.2.230.1. TeamPass</a></li>
<li class="toctree-l4"><a class="reference internal" href="#case-typo3-structures-sameconditions">5.2.230.2. Typo3</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#should-chain-exception">5.2.231. Should Chain Exception</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#case-magento-structures-shouldchainexception">5.2.231.1. Magento</a></li>
<li class="toctree-l4"><a class="reference internal" href="#case-tine20-structures-shouldchainexception">5.2.231.2. Tine20</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#should-make-ternary">5.2.232. Should Make Ternary</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#case-churchcrm-structures-shouldmaketernary">5.2.232.1. ChurchCRM</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#preprocessable">5.2.233. Preprocessable</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#case-phpadsnew-structures-shouldpreprocess">5.2.233.1. phpadsnew</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#should-use-foreach">5.2.234. Should Use Foreach</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#case-expressionengine-structures-shoulduseforeach">5.2.234.1. ExpressionEngine</a></li>
<li class="toctree-l4"><a class="reference internal" href="#case-woocommerce-structures-shoulduseforeach">5.2.234.2. Woocommerce</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#should-use-math">5.2.235. Should Use Math</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#case-openemr-structures-shouldusemath">5.2.235.1. OpenEMR</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#should-use-operator">5.2.236. Should Use Operator</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#case-zencart-structures-shoulduseoperator">5.2.236.1. Zencart</a></li>
<li class="toctree-l4"><a class="reference internal" href="#case-sugarcrm-structures-shoulduseoperator">5.2.236.2. SugarCrm</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#simplify-regex">5.2.237. Simplify Regex</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#case-zurmo-structures-simplepreg">5.2.237.1. Zurmo</a></li>
<li class="toctree-l4"><a class="reference internal" href="#case-openconf-structures-simplepreg">5.2.237.2. OpenConf</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#strpos-like-comparison">5.2.238. Strpos()-like Comparison</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#case-piwigo-structures-strposcompare">5.2.238.1. Piwigo</a></li>
<li class="toctree-l4"><a class="reference internal" href="#case-thelia-structures-strposcompare">5.2.238.2. Thelia</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#drop-substr-last-arg">5.2.239. Drop Substr Last Arg</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#case-suitecrm-structures-substrlastarg">5.2.239.1. SuiteCrm</a></li>
<li class="toctree-l4"><a class="reference internal" href="#case-tine20-structures-substrlastarg">5.2.239.2. Tine20</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#suspicious-comparison">5.2.240. Suspicious Comparison</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#case-phpipam-structures-suspiciouscomparison">5.2.240.1. PhpIPAM</a></li>
<li class="toctree-l4"><a class="reference internal" href="#case-expressionengine-structures-suspiciouscomparison">5.2.240.2. ExpressionEngine</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#switch-to-switch">5.2.241. Switch To Switch</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#case-thelia-structures-switchtoswitch">5.2.241.1. Thelia</a></li>
<li class="toctree-l4"><a class="reference internal" href="#case-xoops-structures-switchtoswitch">5.2.241.2. XOOPS</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#switch-without-default">5.2.242. Switch Without Default</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#case-zencart-structures-switchwithoutdefault">5.2.242.1. Zencart</a></li>
<li class="toctree-l4"><a class="reference internal" href="#case-traq-structures-switchwithoutdefault">5.2.242.2. Traq</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#ternary-in-concat">5.2.243. Ternary In Concat</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#case-teampass-structures-ternaryinconcat">5.2.243.1. TeamPass</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#test-then-cast">5.2.244. Test Then Cast</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#case-dolphin-structures-testthencast">5.2.244.1. Dolphin</a></li>
<li class="toctree-l4"><a class="reference internal" href="#case-suitecrm-structures-testthencast">5.2.244.2. SuiteCrm</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#timestamp-difference">5.2.245. Timestamp Difference</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#case-zurmo-structures-timestampdifference">5.2.245.1. Zurmo</a></li>
<li class="toctree-l4"><a class="reference internal" href="#case-shopware-structures-timestampdifference">5.2.245.2. shopware</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#unconditional-break-in-loop">5.2.246. Unconditional Break In Loop</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#case-livezilla-structures-unconditionloopbreak">5.2.246.1. LiveZilla</a></li>
<li class="toctree-l4"><a class="reference internal" href="#case-mediawiki-structures-unconditionloopbreak">5.2.246.2. MediaWiki</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#unpreprocessed-values">5.2.247. Unpreprocessed Values</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#case-zurmo-structures-unpreprocessed">5.2.247.1. Zurmo</a></li>
<li class="toctree-l4"><a class="reference internal" href="#case-piwigo-structures-unpreprocessed">5.2.247.2. Piwigo</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#unused-global">5.2.248. Unused Global</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#case-dolphin-structures-unusedglobal">5.2.248.1. Dolphin</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#use-count-recursive">5.2.249. Use Count Recursive</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#case-wordpress-structures-usecountrecursive">5.2.249.1. WordPress</a></li>
<li class="toctree-l4"><a class="reference internal" href="#case-prestashop-structures-usecountrecursive">5.2.249.2. PrestaShop</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#use-list-with-foreach">5.2.250. Use List With Foreach</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#case-mediawiki-structures-uselistwithforeach">5.2.250.1. MediaWiki</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#use-positive-condition">5.2.251. Use Positive Condition</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#case-spip-structures-usepositivecondition">5.2.251.1. SPIP</a></li>
<li class="toctree-l4"><a class="reference internal" href="#case-expressionengine-structures-usepositivecondition">5.2.251.2. ExpressionEngine</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#useless-brackets">5.2.252. Useless Brackets</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#case-churchcrm-structures-uselessbrackets">5.2.252.1. ChurchCRM</a></li>
<li class="toctree-l4"><a class="reference internal" href="#case-piwigo-structures-uselessbrackets">5.2.252.2. Piwigo</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#useless-type-casting">5.2.253. Useless Type Casting</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#case-fuelcms-structures-uselesscasting">5.2.253.1. FuelCMS</a></li>
<li class="toctree-l4"><a class="reference internal" href="#case-thinkphp-structures-uselesscasting">5.2.253.2. ThinkPHP</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#useless-check">5.2.254. Useless Check</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#case-magento-structures-uselesscheck">5.2.254.1. Magento</a></li>
<li class="toctree-l4"><a class="reference internal" href="#case-phinx-structures-uselesscheck">5.2.254.2. Phinx</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#useless-global">5.2.255. Useless Global</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#case-zencart-structures-uselessglobal">5.2.255.1. Zencart</a></li>
<li class="toctree-l4"><a class="reference internal" href="#case-humo-gen-structures-uselessglobal">5.2.255.2. HuMo-Gen</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#useless-parenthesis">5.2.256. Useless Parenthesis</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#case-mautic-structures-uselessparenthesis">5.2.256.1. Mautic</a></li>
<li class="toctree-l4"><a class="reference internal" href="#case-woocommerce-structures-uselessparenthesis">5.2.256.2. Woocommerce</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#useless-switch">5.2.257. Useless Switch</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#case-phpdocumentor-structures-uselessswitch">5.2.257.1. Phpdocumentor</a></li>
<li class="toctree-l4"><a class="reference internal" href="#case-dolphin-structures-uselessswitch">5.2.257.2. Dolphin</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#useless-unset">5.2.258. Useless Unset</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#case-tine20-structures-uselessunset">5.2.258.1. Tine20</a></li>
<li class="toctree-l4"><a class="reference internal" href="#case-typo3-structures-uselessunset">5.2.258.2. Typo3</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#var-dump-usage">5.2.259. var_dump()… Usage</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#case-tine20-structures-vardumpusage">5.2.259.1. Tine20</a></li>
<li class="toctree-l4"><a class="reference internal" href="#case-piwigo-structures-vardumpusage">5.2.259.2. Piwigo</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#while-list-each">5.2.260. While(List() = Each())</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#case-openemr-structures-whilelisteach">5.2.260.1. OpenEMR</a></li>
<li class="toctree-l4"><a class="reference internal" href="#case-dolphin-structures-whilelisteach">5.2.260.2. Dolphin</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#wrong-range-check">5.2.261. Wrong Range Check</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#case-dolibarr-structures-wrongrange">5.2.261.1. Dolibarr</a></li>
<li class="toctree-l4"><a class="reference internal" href="#case-wordpress-structures-wrongrange">5.2.261.2. WordPress</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#preg-replace-with-option-e">5.2.262. preg_replace With Option e</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#case-edusoho-structures-pregoptione">5.2.262.1. Edusoho</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#dependant-trait">5.2.263. Dependant Trait</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#case-zencart-traits-dependanttrait">5.2.263.1. Zencart</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#multiple-usage-of-same-trait">5.2.264. Multiple Usage Of Same Trait</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#case-nextcloud-traits-multipleusage">5.2.264.1. NextCloud</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#no-real-comparison">5.2.265. No Real Comparison</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#case-magento-type-norealcomparison">5.2.265.1. Magento</a></li>
<li class="toctree-l4"><a class="reference internal" href="#case-spip-type-norealcomparison">5.2.265.2. SPIP</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#one-variable-string">5.2.266. One Variable String</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#case-tikiwiki-type-onevariablestrings">5.2.266.1. Tikiwiki</a></li>
<li class="toctree-l4"><a class="reference internal" href="#case-nextcloud-type-onevariablestrings">5.2.266.2. NextCloud</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#should-typecast">5.2.267. Should Typecast</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#case-xataface-type-shouldtypecast">5.2.267.1. xataface</a></li>
<li class="toctree-l4"><a class="reference internal" href="#case-openconf-type-shouldtypecast">5.2.267.2. OpenConf</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#silently-cast-integer">5.2.268. Silently Cast Integer</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#case-mediawiki-type-silentlycastinteger">5.2.268.1. MediaWiki</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#strings-with-strange-space">5.2.269. Strings With Strange Space</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#case-openemr-type-stringwithstrangespace">5.2.269.1. OpenEMR</a></li>
<li class="toctree-l4"><a class="reference internal" href="#case-thelia-type-stringwithstrangespace">5.2.269.2. Thelia</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#inconsistent-variable-usage">5.2.270. Inconsistent Variable Usage</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#case-wordpress-variables-inconsistentusage">5.2.270.1. WordPress</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#lost-references">5.2.271. Lost References</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#case-wordpress-variables-lostreferences">5.2.271.1. WordPress</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#strange-name-for-variables">5.2.272. Strange Name For Variables</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#case-fuelcms-variables-strangename">5.2.272.1. FuelCMS</a></li>
<li class="toctree-l4"><a class="reference internal" href="#case-phpipam-variables-strangename">5.2.272.2. PhpIPAM</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#non-ascii-variables">5.2.273. Non Ascii Variables</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#case-magento-variables-variablenonascii">5.2.273.1. Magento</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#used-once-variables">5.2.274. Used Once Variables</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#case-shopware-variables-variableusedonce">5.2.274.1. shopware</a></li>
<li class="toctree-l4"><a class="reference internal" href="#case-vanilla-variables-variableusedonce">5.2.274.2. Vanilla</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#used-once-variables-in-scope">5.2.275. Used Once Variables (In Scope)</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#case-shopware-variables-variableusedoncebycontext">5.2.275.1. shopware</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#written-only-variables">5.2.276. Written Only Variables</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#case-dolibarr-variables-writtenonlyvariable">5.2.276.1. Dolibarr</a></li>
<li class="toctree-l4"><a class="reference internal" href="#case-suitecrm-variables-writtenonlyvariable">5.2.276.2. SuiteCrm</a></li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
</ul>
<p class="caption" role="heading"><span class="caption-text">ADMINISTRATOR GUIDE</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../Administrator/Installation.html">Installation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../Administrator/Upgrading.html">Upgrading</a></li>
<li class="toctree-l1"><a class="reference internal" href="../Administrator/Configuration.html">Configuration</a></li>
<li class="toctree-l1"><a class="reference internal" href="../Administrator/Commands.html">Commands</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">OTHERS</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../FAQ.html">Frequently Asked Questions</a></li>
<li class="toctree-l1"><a class="reference internal" href="../Definitions.html">Glossary</a></li>
<li class="toctree-l1"><a class="reference internal" href="../Annex.html">Annex</a></li>
</ul>

            
          
        </div>
        
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">Exakat</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          

















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="../index.html" class="icon icon-home"></a> &raquo;</li>
        
      <li><span class="section-number">5. </span>Real Code Cases</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
          
            <a href="../_sources/Reference/Cases.rst.txt" rel="nofollow"> View page source</a>
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="real-code-cases">
<span id="cases"></span><h1><span class="section-number">5. </span>Real Code Cases<a class="headerlink" href="#real-code-cases" title="Permalink to this headline">¶</a></h1>
<div class="section" id="introduction">
<h2><span class="section-number">5.1. </span>Introduction<a class="headerlink" href="#introduction" title="Permalink to this headline">¶</a></h2>
<p>All the examples in this section are real code, extracted from major PHP applications.</p>
</div>
<div class="section" id="list-of-real-code-cases">
<h2><span class="section-number">5.2. </span>List of real code Cases<a class="headerlink" href="#list-of-real-code-cases" title="Permalink to this headline">¶</a></h2>
<div class="section" id="ambiguous-array-index">
<span id="case-ambiguous-array-index"></span><h3><span class="section-number">5.2.1. </span>Ambiguous Array Index<a class="headerlink" href="#ambiguous-array-index" title="Permalink to this headline">¶</a></h3>
<div class="section" id="prestashop">
<span id="case-prestashop-arrays-ambiguouskeys"></span><h4><span class="section-number">5.2.1.1. </span>PrestaShop<a class="headerlink" href="#prestashop" title="Permalink to this headline">¶</a></h4>
<p><a class="reference internal" href="Rules.html#ambiguous-array-index"><span class="std std-ref">Ambiguous Array Index</span></a>, in src/PrestaShopBundle/Install/Install.php:532.</p>
<p>Null, as a key, is actually the empty string.</p>
<div class="highlight-php notranslate"><div class="highlight"><pre><span></span><span class="nv">$list</span> <span class="o">=</span> <span class="k">array</span><span class="p">(</span>
            <span class="s1">&#39;products&#39;</span> <span class="o">=&gt;</span> <span class="nx">_PS_PROD_IMG_DIR_</span><span class="p">,</span>
            <span class="s1">&#39;categories&#39;</span> <span class="o">=&gt;</span> <span class="nx">_PS_CAT_IMG_DIR_</span><span class="p">,</span>
            <span class="s1">&#39;manufacturers&#39;</span> <span class="o">=&gt;</span> <span class="nx">_PS_MANU_IMG_DIR_</span><span class="p">,</span>
            <span class="s1">&#39;suppliers&#39;</span> <span class="o">=&gt;</span> <span class="nx">_PS_SUPP_IMG_DIR_</span><span class="p">,</span>
            <span class="s1">&#39;stores&#39;</span> <span class="o">=&gt;</span> <span class="nx">_PS_STORE_IMG_DIR_</span><span class="p">,</span>
            <span class="k">null</span> <span class="o">=&gt;</span> <span class="nx">_PS_IMG_DIR_</span><span class="o">.</span><span class="s1">&#39;l/&#39;</span><span class="p">,</span> <span class="c1">// Little trick to copy images in img/l/ path with all types</span>
        <span class="p">);</span>
</pre></div>
</div>
</div>
<div class="section" id="mautic">
<span id="case-mautic-arrays-ambiguouskeys"></span><h4><span class="section-number">5.2.1.2. </span>Mautic<a class="headerlink" href="#mautic" title="Permalink to this headline">¶</a></h4>
<p><a class="reference internal" href="Rules.html#ambiguous-array-index"><span class="std std-ref">Ambiguous Array Index</span></a>, in app/bundles/CoreBundle/Entity/CommonRepository.php:314.</p>
<p>True is turned into 1 (integer), and false is turned into 0 (integer).</p>
<div class="highlight-php notranslate"><div class="highlight"><pre><span></span><span class="k">foreach</span> <span class="p">(</span><span class="nv">$metadata</span><span class="o">-&gt;</span><span class="na">getAssociationMappings</span><span class="p">()</span> <span class="k">as</span> <span class="nv">$field</span> <span class="o">=&gt;</span> <span class="nv">$association</span><span class="p">)</span> <span class="p">{</span>
                    <span class="k">if</span> <span class="p">(</span><span class="nb">in_array</span><span class="p">(</span><span class="nv">$association</span><span class="p">[</span><span class="s1">&#39;type&#39;</span><span class="p">],</span> <span class="p">[</span><span class="nx">ClassMetadataInfo</span><span class="o">::</span><span class="na">ONE_TO_ONE</span><span class="p">,</span> <span class="nx">ClassMetadataInfo</span><span class="o">::</span><span class="na">MANY_TO_ONE</span><span class="p">]))</span> <span class="p">{</span>
                        <span class="nv">$baseCols</span><span class="p">[</span><span class="k">true</span><span class="p">][</span><span class="nv">$entityClass</span><span class="p">][]</span>  <span class="o">=</span> <span class="nv">$association</span><span class="p">[</span><span class="s1">&#39;joinColumns&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">][</span><span class="s1">&#39;name&#39;</span><span class="p">];</span>
                        <span class="nv">$baseCols</span><span class="p">[</span><span class="k">false</span><span class="p">][</span><span class="nv">$entityClass</span><span class="p">][]</span> <span class="o">=</span> <span class="nv">$field</span><span class="p">;</span>
                    <span class="p">}</span>
                <span class="p">}</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="getting-last-element">
<span id="case-getting-last-element"></span><h3><span class="section-number">5.2.2. </span>Getting Last Element<a class="headerlink" href="#getting-last-element" title="Permalink to this headline">¶</a></h3>
<div class="section" id="thelia">
<span id="case-thelia-arrays-gettinglastelement"></span><h4><span class="section-number">5.2.2.1. </span>Thelia<a class="headerlink" href="#thelia" title="Permalink to this headline">¶</a></h4>
<p><a class="reference internal" href="Rules.html#getting-last-element"><span class="std std-ref">Getting Last Element</span></a>, in /core/lib/Thelia/Core/Security/AccessManager.php:61.</p>
<p>This code extract the last element with array_slice (position -1) as an array, then get the element in the array with current().</p>
<div class="highlight-php notranslate"><div class="highlight"><pre><span></span><span class="nb">current</span><span class="p">(</span><span class="nx">\array_slice</span><span class="p">(</span><span class="nx">self</span><span class="o">::</span><span class="nv">$accessPows</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="k">true</span><span class="p">))</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="multiple-index-definition">
<span id="case-multiple-index-definition"></span><h3><span class="section-number">5.2.3. </span>Multiple Index Definition<a class="headerlink" href="#multiple-index-definition" title="Permalink to this headline">¶</a></h3>
<div class="section" id="magento">
<span id="case-magento-arrays-multipleidenticalkeys"></span><h4><span class="section-number">5.2.3.1. </span>Magento<a class="headerlink" href="#magento" title="Permalink to this headline">¶</a></h4>
<p><a class="reference internal" href="Rules.html#multiple-index-definition"><span class="std std-ref">Multiple Index Definition</span></a>, in app/code/core/Mage/Adminhtml/Block/System/Convert/Gui/Grid.php:80.</p>
<p>‘type’ is defined twice. The first one, ‘options’ is overwritten.</p>
<div class="highlight-php notranslate"><div class="highlight"><pre><span></span><span class="nv">$this</span><span class="o">-&gt;</span><span class="na">addColumn</span><span class="p">(</span><span class="s1">&#39;store_id&#39;</span><span class="p">,</span> <span class="k">array</span><span class="p">(</span>
            <span class="s1">&#39;header&#39;</span>    <span class="o">=&gt;</span> <span class="nx">Mage</span><span class="o">::</span><span class="na">helper</span><span class="p">(</span><span class="s1">&#39;adminhtml&#39;</span><span class="p">)</span><span class="o">-&gt;</span><span class="na">__</span><span class="p">(</span><span class="s1">&#39;Store&#39;</span><span class="p">),</span>
            <span class="s1">&#39;type&#39;</span>      <span class="o">=&gt;</span> <span class="s1">&#39;options&#39;</span><span class="p">,</span>
            <span class="s1">&#39;align&#39;</span>     <span class="o">=&gt;</span> <span class="s1">&#39;center&#39;</span><span class="p">,</span>
            <span class="s1">&#39;index&#39;</span>     <span class="o">=&gt;</span> <span class="s1">&#39;store_id&#39;</span><span class="p">,</span>
            <span class="s1">&#39;type&#39;</span>      <span class="o">=&gt;</span> <span class="s1">&#39;store&#39;</span><span class="p">,</span>
            <span class="s1">&#39;width&#39;</span>     <span class="o">=&gt;</span> <span class="s1">&#39;200px&#39;</span><span class="p">,</span>
        <span class="p">));</span>
</pre></div>
</div>
</div>
<div class="section" id="mediawiki">
<span id="case-mediawiki-arrays-multipleidenticalkeys"></span><h4><span class="section-number">5.2.3.2. </span>MediaWiki<a class="headerlink" href="#mediawiki" title="Permalink to this headline">¶</a></h4>
<p><a class="reference internal" href="Rules.html#multiple-index-definition"><span class="std std-ref">Multiple Index Definition</span></a>, in resources/Resources.php:223.</p>
<p>‘target’ is repeated, though with the same values. This is just dead code.</p>
<div class="highlight-php notranslate"><div class="highlight"><pre><span></span><span class="c1">// inside a big array</span>
    <span class="s1">&#39;jquery.getAttrs&#39;</span> <span class="o">=&gt;</span> <span class="p">[</span>
            <span class="s1">&#39;targets&#39;</span> <span class="o">=&gt;</span> <span class="p">[</span> <span class="s1">&#39;desktop&#39;</span><span class="p">,</span> <span class="s1">&#39;mobile&#39;</span> <span class="p">],</span>
            <span class="s1">&#39;scripts&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;resources/src/jquery/jquery.getAttrs.js&#39;</span><span class="p">,</span>
            <span class="s1">&#39;targets&#39;</span> <span class="o">=&gt;</span> <span class="p">[</span> <span class="s1">&#39;desktop&#39;</span><span class="p">,</span> <span class="s1">&#39;mobile&#39;</span> <span class="p">],</span>
    <span class="p">],</span>
    <span class="c1">// big array continues</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="non-constant-index-in-array">
<span id="case-non-constant-index-in-array"></span><h3><span class="section-number">5.2.4. </span>Non-constant Index In Array<a class="headerlink" href="#non-constant-index-in-array" title="Permalink to this headline">¶</a></h3>
<div class="section" id="dolibarr">
<span id="case-dolibarr-arrays-nonconstantarray"></span><h4><span class="section-number">5.2.4.1. </span>Dolibarr<a class="headerlink" href="#dolibarr" title="Permalink to this headline">¶</a></h4>
<p><a class="reference internal" href="Rules.html#non-constant-index-in-array"><span class="std std-ref">Non-constant Index In Array</span></a>, in htdocs/includes/OAuth/Common/Storage/DoliStorage.php:245.</p>
<p>The <cite>state</cite> constant in the <cite>$result</cite> array is coming from the SQL query. There is no need to make this a constant : making it a string will remove some warnings in the logs.</p>
<div class="highlight-php notranslate"><div class="highlight"><pre><span></span><span class="k">public</span> <span class="k">function</span> <span class="nf">hasAuthorizationState</span><span class="p">(</span><span class="nv">$service</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="c1">// get state from db</span>
        <span class="nx">dol_syslog</span><span class="p">(</span><span class="s2">&quot;get state from db&quot;</span><span class="p">);</span>
        <span class="nv">$sql</span> <span class="o">=</span> <span class="s2">&quot;SELECT state FROM &quot;</span><span class="o">.</span><span class="nx">MAIN_DB_PREFIX</span><span class="o">.</span><span class="s2">&quot;oauth_state&quot;</span><span class="p">;</span>
        <span class="nv">$sql</span><span class="o">.=</span> <span class="s2">&quot; WHERE service=&#39;&quot;</span><span class="o">.</span><span class="nv">$this</span><span class="o">-&gt;</span><span class="na">db</span><span class="o">-&gt;</span><span class="na">escape</span><span class="p">(</span><span class="nv">$service</span><span class="p">)</span><span class="o">.</span><span class="s2">&quot;&#39;&quot;</span><span class="p">;</span>
        <span class="nv">$resql</span> <span class="o">=</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">db</span><span class="o">-&gt;</span><span class="na">query</span><span class="p">(</span><span class="nv">$sql</span><span class="p">);</span>
        <span class="nv">$result</span> <span class="o">=</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">db</span><span class="o">-&gt;</span><span class="na">fetch_array</span><span class="p">(</span><span class="nv">$resql</span><span class="p">);</span>
        <span class="nv">$states</span><span class="p">[</span><span class="nv">$service</span><span class="p">]</span> <span class="o">=</span> <span class="nv">$result</span><span class="p">[</span><span class="nx">state</span><span class="p">];</span>
        <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">states</span><span class="p">[</span><span class="nv">$service</span><span class="p">]</span> <span class="o">=</span> <span class="nv">$states</span><span class="p">[</span><span class="nv">$service</span><span class="p">];</span>

        <span class="k">return</span> <span class="nb">is_array</span><span class="p">(</span><span class="nv">$states</span><span class="p">)</span>
        <span class="o">&amp;&amp;</span> <span class="nb">isset</span><span class="p">(</span><span class="nv">$states</span><span class="p">[</span><span class="nv">$service</span><span class="p">])</span>
        <span class="o">&amp;&amp;</span> <span class="k">null</span> <span class="o">!==</span> <span class="nv">$states</span><span class="p">[</span><span class="nv">$service</span><span class="p">];</span>
    <span class="p">}</span>
</pre></div>
</div>
</div>
<div class="section" id="zencart">
<span id="case-zencart-arrays-nonconstantarray"></span><h4><span class="section-number">5.2.4.2. </span>Zencart<a class="headerlink" href="#zencart" title="Permalink to this headline">¶</a></h4>
<p><a class="reference internal" href="Rules.html#non-constant-index-in-array"><span class="std std-ref">Non-constant Index In Array</span></a>, in app/library/zencart/Services/src/LeadLanguagesRoutes.php:112.</p>
<p>The <cite>fields</cite> constant in the <cite>$tableEntry</cite> which holds a list of tables. It seems to be a SQL result, but it is conveniently abstracted with <cite>$this-&gt;listener-&gt;getTableList()</cite>, so we can’t be sure.</p>
<div class="highlight-php notranslate"><div class="highlight"><pre><span></span><span class="k">public</span> <span class="k">function</span> <span class="nf">updateLanguageTables</span><span class="p">(</span><span class="nv">$insertId</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="nv">$tableList</span> <span class="o">=</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">listener</span><span class="o">-&gt;</span><span class="na">getTableList</span><span class="p">();</span>
        <span class="k">if</span> <span class="p">(</span><span class="nb">count</span><span class="p">(</span><span class="nv">$tableList</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
            <span class="k">return</span><span class="p">;</span>
        <span class="p">}</span>
        <span class="k">foreach</span> <span class="p">(</span><span class="nv">$tableList</span> <span class="k">as</span> <span class="nv">$tableEntry</span><span class="p">)</span> <span class="p">{</span>
            <span class="nv">$languageKeyField</span> <span class="o">=</span> <span class="nx">issetorArray</span><span class="p">(</span><span class="nv">$tableEntry</span><span class="p">,</span> <span class="s1">&#39;languageKeyField&#39;</span><span class="p">,</span> <span class="s1">&#39;language_id&#39;</span><span class="p">);</span>
            <span class="nv">$sql</span> <span class="o">=</span> <span class="s2">&quot; INSERT IGNORE INTO :table: (&quot;</span><span class="p">;</span>
            <span class="nv">$sql</span> <span class="o">=</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">dbConn</span><span class="o">-&gt;</span><span class="na">bindVars</span><span class="p">(</span><span class="nv">$sql</span><span class="p">,</span> <span class="s1">&#39;:table:&#39;</span><span class="p">,</span> <span class="nv">$tableEntry</span> <span class="p">[</span><span class="s1">&#39;table&#39;</span><span class="p">],</span> <span class="s1">&#39;noquotestring&#39;</span><span class="p">);</span>
            <span class="nv">$sql</span> <span class="o">.=</span> <span class="nv">$languageKeyField</span><span class="o">.</span> <span class="s2">&quot;, &quot;</span><span class="p">;</span>
            <span class="nv">$fieldNames</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span><span class="p">;</span>
            <span class="k">foreach</span> <span class="p">(</span><span class="nv">$tableEntry</span><span class="p">[</span><span class="nx">fields</span><span class="p">]</span> <span class="k">as</span> <span class="nv">$fieldName</span> <span class="o">=&gt;</span> <span class="nv">$fieldType</span><span class="p">)</span> <span class="p">{</span>
                <span class="nv">$fieldNames</span> <span class="o">.=</span> <span class="nv">$fieldName</span> <span class="o">.</span> <span class="s2">&quot;, &quot;</span><span class="p">;</span>
            <span class="p">}</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="randomly-sorted-arrays">
<span id="case-randomly-sorted-arrays"></span><h3><span class="section-number">5.2.5. </span>Randomly Sorted Arrays<a class="headerlink" href="#randomly-sorted-arrays" title="Permalink to this headline">¶</a></h3>
<div class="section" id="contao">
<span id="case-contao-arrays-randomlysortedliterals"></span><h4><span class="section-number">5.2.5.1. </span>Contao<a class="headerlink" href="#contao" title="Permalink to this headline">¶</a></h4>
<p><a class="reference internal" href="Rules.html#randomly-sorted-arrays"><span class="std std-ref">Randomly Sorted Arrays</span></a>, in system/modules/core/dca/tl_module.php:259.</p>
<p>The array array(‘maxlength’, ‘decodeEntities’, ‘tl_class’) is configured multiple times in this file. Most of them is in the second form, but some are in the first form. (Multiple occurrences in this file).</p>
<div class="highlight-php notranslate"><div class="highlight"><pre><span></span><span class="k">array</span><span class="p">(</span><span class="s1">&#39;maxlength&#39;</span> <span class="o">=&gt;</span> <span class="mi">255</span><span class="p">,</span> <span class="s1">&#39;decodeEntities&#39;</span> <span class="o">=&gt;</span> <span class="k">true</span><span class="p">,</span> <span class="s1">&#39;tl_class&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;w50&#39;</span><span class="p">)</span> <span class="c1">// Line 246</span>
<span class="k">array</span><span class="p">(</span><span class="s1">&#39;decodeEntities&#39;</span> <span class="o">=&gt;</span> <span class="k">true</span><span class="p">,</span> <span class="s1">&#39;maxlength&#39;</span> <span class="o">=&gt;</span> <span class="mi">255</span><span class="p">,</span> <span class="s1">&#39;tl_class&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;w50&#39;</span><span class="p">);</span> <span class="c1">// ligne 378</span>
</pre></div>
</div>
</div>
<div class="section" id="vanilla">
<span id="case-vanilla-arrays-randomlysortedliterals"></span><h4><span class="section-number">5.2.5.2. </span>Vanilla<a class="headerlink" href="#vanilla" title="Permalink to this headline">¶</a></h4>
<p><a class="reference internal" href="Rules.html#randomly-sorted-arrays"><span class="std std-ref">Randomly Sorted Arrays</span></a>, in applications/dashboard/models/class.activitymodel.php:308.</p>
<p>‘Photo’ moved from last to second. This array is used with a ‘Join’ key, and is the base for a SQL table JOIN. As such, order is important. If this is the case, it seems unusual that the order is not the same for a join using the same tables. If it is not the case, arrays may be reordered.</p>
<div class="highlight-php notranslate"><div class="highlight"><pre><span></span><span class="cm">/* L 305 */</span>        <span class="nx">Gdn</span><span class="o">::</span><span class="na">userModel</span><span class="p">()</span><span class="o">-&gt;</span><span class="na">joinUsers</span><span class="p">(</span>
            <span class="nv">$result</span><span class="o">-&gt;</span><span class="na">resultArray</span><span class="p">(),</span>
            <span class="p">[</span><span class="s1">&#39;ActivityUserID&#39;</span><span class="p">,</span> <span class="s1">&#39;RegardingUserID&#39;</span><span class="p">],</span>
            <span class="p">[</span><span class="s1">&#39;Join&#39;</span> <span class="o">=&gt;</span> <span class="p">[</span><span class="s1">&#39;Name&#39;</span><span class="p">,</span> <span class="s1">&#39;Email&#39;</span><span class="p">,</span> <span class="s1">&#39;Gender&#39;</span><span class="p">,</span> <span class="s1">&#39;Photo&#39;</span><span class="p">]]</span>
        <span class="p">);</span>

<span class="c1">// L 385</span>
        <span class="nx">Gdn</span><span class="o">::</span><span class="na">userModel</span><span class="p">()</span><span class="o">-&gt;</span><span class="na">joinUsers</span><span class="p">(</span><span class="nv">$result</span><span class="p">,</span> <span class="p">[</span><span class="s1">&#39;ActivityUserID&#39;</span><span class="p">,</span> <span class="s1">&#39;RegardingUserID&#39;</span><span class="p">],</span> <span class="p">[</span><span class="s1">&#39;Join&#39;</span> <span class="o">=&gt;</span> <span class="p">[</span><span class="s1">&#39;Name&#39;</span><span class="p">,</span> <span class="s1">&#39;Photo&#39;</span><span class="p">,</span> <span class="s1">&#39;Email&#39;</span><span class="p">,</span> <span class="s1">&#39;Gender&#39;</span><span class="p">]]);</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="slice-arrays-first">
<span id="case-slice-arrays-first"></span><h3><span class="section-number">5.2.6. </span>Slice Arrays First<a class="headerlink" href="#slice-arrays-first" title="Permalink to this headline">¶</a></h3>
<div class="section" id="wordpress">
<span id="case-wordpress-arrays-slicefirst"></span><h4><span class="section-number">5.2.6.1. </span>WordPress<a class="headerlink" href="#wordpress" title="Permalink to this headline">¶</a></h4>
<p><a class="reference internal" href="Rules.html#slice-arrays-first"><span class="std std-ref">Slice Arrays First</span></a>, in modules/InboundEmail/InboundEmail.php:1080.</p>
<p>Instead of reading ALL the keys, and then, keeping only the first fifty, why not read the 50 first items from the array, and then extract the keys?</p>
<div class="highlight-php notranslate"><div class="highlight"><pre><span></span><span class="nv">$results</span> <span class="o">=</span> <span class="nb">array_slice</span><span class="p">(</span><span class="nb">array_keys</span><span class="p">(</span><span class="nv">$diff</span><span class="p">),</span> <span class="mi">0</span> <span class="p">,</span><span class="mi">50</span><span class="p">);</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="abstract-or-implements">
<span id="case-abstract-or-implements"></span><h3><span class="section-number">5.2.7. </span>Abstract Or Implements<a class="headerlink" href="#abstract-or-implements" title="Permalink to this headline">¶</a></h3>
<div class="section" id="zurmo">
<span id="case-zurmo-classes-abstractorimplements"></span><h4><span class="section-number">5.2.7.1. </span>Zurmo<a class="headerlink" href="#zurmo" title="Permalink to this headline">¶</a></h4>
<p><a class="reference internal" href="Rules.html#abstract-or-implements"><span class="std std-ref">Abstract Or Implements</span></a>, in app/protected/extensions/zurmoinc/framework/views/MassEditProgressView.php:30.</p>
<p>The class MassEditProgressView extends ProgressView, which is an abstract class. That class defines one abstract method : abstract protected function headerLabelPrefixContent(). Yet, the class MassEditProgressView doesn’t implements this method. This means that the class can’t be instatiated, and indeed, it isn’t. The class MassEditProgressView is subclassed, by the class MarketingListMembersMassSubscribeProgressView, which implements the method headerLabelPrefixContent(). As such, MassEditProgressView should be marked abstract, so as to prevent any instantiation attempt.</p>
<div class="highlight-php notranslate"><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">MassEditProgressView</span> <span class="k">extends</span> <span class="nx">ProgressView</span> <span class="p">{</span>
    <span class="cm">/**/</span>
<span class="p">}</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="ambiguous-visibilities">
<span id="case-ambiguous-visibilities"></span><h3><span class="section-number">5.2.8. </span>Ambiguous Visibilities<a class="headerlink" href="#ambiguous-visibilities" title="Permalink to this headline">¶</a></h3>
<div class="section" id="typo3">
<span id="case-typo3-classes-ambiguousvisibilities"></span><h4><span class="section-number">5.2.8.1. </span>Typo3<a class="headerlink" href="#typo3" title="Permalink to this headline">¶</a></h4>
<p><a class="reference internal" href="Rules.html#ambiguous-visibilities"><span class="std std-ref">Ambiguous Visibilities</span></a>, in typo3/sysext/backend/Classes/Controller/NewRecordController.php:90.</p>
<p>$allowedNewTables is declared once  protected and once public. $allowedNewTables is rare : 2 occurences. This may lead to confusion about access to this property.</p>
<div class="highlight-php notranslate"><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">NewRecordController</span>
<span class="p">{</span>
<span class="o">/..</span> <span class="nx">many</span> <span class="nx">lines</span><span class="o">../</span>
    <span class="sd">/**</span>
<span class="sd">     * @var array</span>
<span class="sd">     */</span>
    <span class="k">protected</span> <span class="nv">$allowedNewTables</span><span class="p">;</span>

<span class="k">class</span> <span class="nc">DatabaseRecordList</span>
<span class="p">{</span>
<span class="o">/..../</span>
    <span class="sd">/**</span>
<span class="sd">     * Used to indicate which tables (values in the array) that can have a</span>
<span class="sd">     * create-new-record link. If the array is empty, all tables are allowed.</span>
<span class="sd">     *</span>
<span class="sd">     * @var string[]</span>
<span class="sd">     */</span>
    <span class="k">public</span> <span class="nv">$allowedNewTables</span> <span class="o">=</span> <span class="p">[];</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="avoid-optional-properties">
<span id="case-avoid-optional-properties"></span><h3><span class="section-number">5.2.9. </span>Avoid Optional Properties<a class="headerlink" href="#avoid-optional-properties" title="Permalink to this headline">¶</a></h3>
<div class="section" id="churchcrm">
<span id="case-churchcrm-classes-avoidoptionalproperties"></span><h4><span class="section-number">5.2.9.1. </span>ChurchCRM<a class="headerlink" href="#churchcrm" title="Permalink to this headline">¶</a></h4>
<p><a class="reference internal" href="Rules.html#avoid-optional-properties"><span class="std std-ref">Avoid Optional Properties</span></a>, in src/ChurchCRM/BackupManager.php:401.</p>
<p>Backuptype is initialized with null, and yet, it isn’t checked for any invalid valid values, in particular in switch() structures.</p>
<div class="highlight-php notranslate"><div class="highlight"><pre><span></span><span class="c1">// BackupType is initialized with null</span>
  <span class="k">class</span> <span class="nc">JobBase</span>
  <span class="p">{</span>
      <span class="sd">/**</span>
<span class="sd">        *</span>
<span class="sd">        * @var BackupType</span>
<span class="sd">        */</span>
      <span class="k">protected</span> <span class="nv">$BackupType</span><span class="p">;</span>

<span class="c1">// In the child class BackupJob, BackupType may be of any type</span>
  <span class="k">class</span> <span class="nc">BackupJob</span> <span class="k">extends</span> <span class="nx">JobBase</span>
  <span class="p">{</span>
      <span class="sd">/**</span>
<span class="sd">       *</span>
<span class="sd">       * @param String $BaseName</span>
<span class="sd">       * @param BackupType $BackupType</span>
<span class="sd">       * @param Boolean $IncludeExtraneousFiles</span>
<span class="sd">       */</span>
      <span class="k">public</span> <span class="k">function</span> <span class="fm">__construct</span><span class="p">(</span><span class="nv">$BaseName</span><span class="p">,</span> <span class="nv">$BackupType</span><span class="p">,</span> <span class="nv">$IncludeExtraneousFiles</span><span class="p">,</span> <span class="nv">$EncryptBackup</span><span class="p">,</span> <span class="nv">$BackupPassword</span><span class="p">)</span>
      <span class="p">{</span>
          <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">BackupType</span> <span class="o">=</span> <span class="nv">$BackupType</span><span class="p">;</span>


<span class="c1">// Later, Backtype is not checked with all values :</span>
          <span class="k">try</span> <span class="p">{</span>
              <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">DecryptBackup</span><span class="p">();</span>
              <span class="k">switch</span> <span class="p">(</span><span class="nv">$this</span><span class="o">-&gt;</span><span class="na">BackupType</span><span class="p">)</span> <span class="p">{</span>
              <span class="k">case</span> <span class="nx">BackupType</span><span class="o">::</span><span class="na">SQL</span><span class="o">:</span>
                <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">RestoreSQLBackup</span><span class="p">(</span><span class="nv">$this</span><span class="o">-&gt;</span><span class="na">RestoreFile</span><span class="p">);</span>
                <span class="k">break</span><span class="p">;</span>
              <span class="k">case</span> <span class="nx">BackupType</span><span class="o">::</span><span class="na">GZSQL</span><span class="o">:</span>
                <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">RestoreGZSQL</span><span class="p">();</span>
                <span class="k">break</span><span class="p">;</span>
              <span class="k">case</span> <span class="nx">BackupType</span><span class="o">::</span><span class="na">FullBackup</span><span class="o">:</span>
                <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">RestoreFullBackup</span><span class="p">();</span>
                <span class="k">break</span><span class="p">;</span>
<span class="c1">// Note  : no default case here</span>
            <span class="p">}</span>
</pre></div>
</div>
</div>
<div class="section" id="case-dolibarr-classes-avoidoptionalproperties">
<span id="id1"></span><h4><span class="section-number">5.2.9.2. </span>Dolibarr<a class="headerlink" href="#case-dolibarr-classes-avoidoptionalproperties" title="Permalink to this headline">¶</a></h4>
<p><a class="reference internal" href="Rules.html#avoid-optional-properties"><span class="std std-ref">Avoid Optional Properties</span></a>, in htdocs/product/stock/class/productlot.class.php:149.</p>
<p>$this-&gt;fk_product is tested for value 11 times while being used in this class. All detected situations were checking the presence of the property before usage.</p>
<div class="highlight-php notranslate"><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">Productlot</span> <span class="k">extends</span> <span class="nx">CommonObject</span>
<span class="p">{</span>
<span class="c1">// more code</span>
    <span class="sd">/**</span>
<span class="sd">     * @var int ID</span>
<span class="sd">     */</span>
    <span class="k">public</span> <span class="nv">$fk_product</span><span class="p">;</span>

<span class="c1">// Checked usage of fk_product</span>
<span class="c1">// line 341</span>
            <span class="nv">$sql</span> <span class="o">.=</span> <span class="s1">&#39; fk_product = &#39;</span><span class="o">.</span><span class="p">(</span><span class="nb">isset</span><span class="p">(</span><span class="nv">$this</span><span class="o">-&gt;</span><span class="na">fk_product</span><span class="p">)</span> <span class="o">?</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">fk_product</span> <span class="o">:</span> <span class="s2">&quot;null&quot;</span><span class="p">)</span><span class="o">.</span><span class="s1">&#39;,&#39;</span><span class="p">;</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="cant-instantiate-class">
<span id="case-cant-instantiate-class"></span><h3><span class="section-number">5.2.10. </span>Cant Instantiate Class<a class="headerlink" href="#cant-instantiate-class" title="Permalink to this headline">¶</a></h3>
<div class="section" id="case-wordpress-classes-cantinstantiateclass">
<span id="id2"></span><h4><span class="section-number">5.2.10.1. </span>WordPress<a class="headerlink" href="#case-wordpress-classes-cantinstantiateclass" title="Permalink to this headline">¶</a></h4>
<p><a class="reference internal" href="Rules.html#cant-instantiate-class"><span class="std std-ref">Cant Instantiate Class</span></a>, in wp-admin/includes/misc.php:74.</p>
<p>This code actually loads the file, join it, then split it again. file() would be sufficient.</p>
<div class="highlight-php notranslate"><div class="highlight"><pre><span></span><span class="nv">$markerdata</span> <span class="o">=</span> <span class="nb">explode</span><span class="p">(</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">,</span> <span class="nb">implode</span><span class="p">(</span> <span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="nb">file</span><span class="p">(</span> <span class="nv">$filename</span> <span class="p">)</span> <span class="p">)</span> <span class="p">);</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="class-interface-or-trait-with-identical-names">
<span id="case-class-interface-or-trait-with-identical-names"></span><h3><span class="section-number">5.2.11. </span>Class, Interface Or Trait With Identical Names<a class="headerlink" href="#class-interface-or-trait-with-identical-names" title="Permalink to this headline">¶</a></h3>
<div class="section" id="shopware">
<span id="case-shopware-classes-citsamename"></span><h4><span class="section-number">5.2.11.1. </span>shopware<a class="headerlink" href="#shopware" title="Permalink to this headline">¶</a></h4>
<p><a class="reference internal" href="Rules.html#class-interface-or-trait-with-identical-names"><span class="std std-ref">Class, Interface Or Trait With Identical Names</span></a>, in engine/Shopware/Components/Form/Interfaces/Element.php:30.</p>
<p>Most Element classes extends ModelEntity, which is an abstract class. There is also an interface, called Element, for forms. And, last, one of the class Element extends JsonSerializable, which is a PHP native interface. Namespaces are definitely crucial to understand which Element is which.</p>
<div class="highlight-php notranslate"><div class="highlight"><pre><span></span><span class="k">interface</span> <span class="nx">Element</span> <span class="p">{</span> <span class="cm">/**/</span> <span class="p">}</span> <span class="c1">// in engine/Shopware/Components/Form/Interfaces/Element.php:30</span>

<span class="k">class</span> <span class="nc">Element</span> <span class="k">implements</span> <span class="nx">\JsonSerializable</span> <span class="p">{</span> <span class="cm">/**/</span> <span class="p">}</span>         <span class="c1">// in engine/Shopware/Bundle/EmotionBundle/Struct/Element.php:29</span>

<span class="k">class</span> <span class="nc">Element</span> <span class="k">extends</span> <span class="nx">ModelEntity</span> <span class="p">{</span> <span class="cm">/**/</span> <span class="p">}</span>  <span class="c1">// in /engine/Shopware/Models/Document/Element.php:37</span>
</pre></div>
</div>
</div>
<div class="section" id="nextcloud">
<span id="case-nextcloud-classes-citsamename"></span><h4><span class="section-number">5.2.11.2. </span>NextCloud<a class="headerlink" href="#nextcloud" title="Permalink to this headline">¶</a></h4>
<p><a class="reference internal" href="Rules.html#class-interface-or-trait-with-identical-names"><span class="std std-ref">Class, Interface Or Trait With Identical Names</span></a>, in lib/private/Files/Storage/Storage.php:33.</p>
<p>Interface Storage extends another Storage class. Here, the fully qualified name is used, so we can understand which storage is which at read time : a ‘use’ alias would make this line more confusing.</p>
<div class="highlight-php notranslate"><div class="highlight"><pre><span></span><span class="k">interface</span> <span class="nx">Storage</span> <span class="k">extends</span> <span class="nx">\OCP\Files\Storage</span> <span class="p">{</span> <span class="cm">/**/</span> <span class="p">}</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="could-be-abstract-class">
<span id="case-could-be-abstract-class"></span><h3><span class="section-number">5.2.12. </span>Could Be Abstract Class<a class="headerlink" href="#could-be-abstract-class" title="Permalink to this headline">¶</a></h3>
<div class="section" id="edusoho">
<span id="case-edusoho-classes-couldbeabstractclass"></span><h4><span class="section-number">5.2.12.1. </span>Edusoho<a class="headerlink" href="#edusoho" title="Permalink to this headline">¶</a></h4>
<p><a class="reference internal" href="Rules.html#could-be-abstract-class"><span class="std std-ref">Could Be Abstract Class</span></a>, in src/Biz/Task/Strategy/BaseStrategy.php:14.</p>
<p>BaseStrategy is extended by NormalStrategy, DefaultStrategy (Not shown here), but it is not instantiated itself.</p>
<div class="highlight-php notranslate"><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">BaseStrategy</span> <span class="p">{</span>
    <span class="c1">// Class code</span>
<span class="p">}</span>
</pre></div>
</div>
</div>
<div class="section" id="case-shopware-classes-couldbeabstractclass">
<span id="id3"></span><h4><span class="section-number">5.2.12.2. </span>shopware<a class="headerlink" href="#case-shopware-classes-couldbeabstractclass" title="Permalink to this headline">¶</a></h4>
<p><a class="reference internal" href="Rules.html#could-be-abstract-class"><span class="std std-ref">Could Be Abstract Class</span></a>, in engine/Shopware/Plugins/Default/Core/PaymentMethods/Components/GenericPaymentMethod.php:31.</p>
<p>A ‘Generic’ class sounds like a class that could be ‘abstract’.</p>
<div class="highlight-php notranslate"><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">GenericPaymentMethod</span> <span class="k">extends</span> <span class="nx">BasePaymentMethod</span> <span class="p">{</span>
    <span class="c1">// More class code</span>
<span class="p">}</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="could-be-private-class-constant">
<span id="case-could-be-private-class-constant"></span><h3><span class="section-number">5.2.13. </span>Could Be Private Class Constant<a class="headerlink" href="#could-be-private-class-constant" title="Permalink to this headline">¶</a></h3>
<div class="section" id="phinx">
<span id="case-phinx-classes-couldbeprivateconstante"></span><h4><span class="section-number">5.2.13.1. </span>Phinx<a class="headerlink" href="#phinx" title="Permalink to this headline">¶</a></h4>
<p><a class="reference internal" href="Rules.html#could-be-private-class-constant"><span class="std std-ref">Could Be Private Class Constant</span></a>, in src/Phinx/Db/Adapter/MysqlAdapter.php:46.</p>
<p>The code includes a fair number of class constants. The one listed here are only used to define TEXT columns in MySQL, with their maximal size. Since they are only intented to be used by the MySQL driver, they may be private.</p>
<div class="highlight-php notranslate"><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">MysqlAdapter</span> <span class="k">extends</span> <span class="nx">PdoAdapter</span> <span class="k">implements</span> <span class="nx">AdapterInterface</span>
<span class="p">{</span>

<span class="c1">//.....</span>
    <span class="k">const</span> <span class="no">TEXT_SMALL</span>   <span class="o">=</span> <span class="mi">255</span><span class="p">;</span>
    <span class="k">const</span> <span class="no">TEXT_REGULAR</span> <span class="o">=</span> <span class="mi">65535</span><span class="p">;</span>
    <span class="k">const</span> <span class="no">TEXT_MEDIUM</span>  <span class="o">=</span> <span class="mi">16777215</span><span class="p">;</span>
    <span class="k">const</span> <span class="no">TEXT_LONG</span>    <span class="o">=</span> <span class="mi">4294967295</span><span class="p">;</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="method-could-be-static">
<span id="case-method-could-be-static"></span><h3><span class="section-number">5.2.14. </span>Method Could Be Static<a class="headerlink" href="#method-could-be-static" title="Permalink to this headline">¶</a></h3>
<div class="section" id="fuelcms">
<span id="case-fuelcms-classes-couldbestatic"></span><h4><span class="section-number">5.2.14.1. </span>FuelCMS<a class="headerlink" href="#fuelcms" title="Permalink to this headline">¶</a></h4>
<p><a class="reference internal" href="Rules.html#method-could-be-static"><span class="std std-ref">Method Could Be Static</span></a>, in fuel/modules/fuel/models/Fuel_assets_model.php:240.</p>
<p>This method makes no usage of $this : it only works on the incoming argument, $file. This may even be a function.</p>
<div class="highlight-php notranslate"><div class="highlight"><pre><span></span><span class="k">public</span> <span class="k">function</span> <span class="nf">get_file</span><span class="p">(</span><span class="nv">$file</span><span class="p">)</span>
    <span class="p">{</span>
            <span class="c1">// if no extension is provided, then we determine that it needs to be decoded</span>
            <span class="k">if</span> <span class="p">(</span><span class="nb">strpos</span><span class="p">(</span><span class="nv">$file</span><span class="p">,</span> <span class="s1">&#39;.&#39;</span><span class="p">)</span> <span class="o">===</span> <span class="k">FALSE</span><span class="p">)</span>
            <span class="p">{</span>
                    <span class="nv">$file</span> <span class="o">=</span> <span class="nx">uri_safe_decode</span><span class="p">(</span><span class="nv">$file</span><span class="p">);</span>
            <span class="p">}</span>
            <span class="k">return</span> <span class="nv">$file</span><span class="p">;</span>
    <span class="p">}</span>
</pre></div>
</div>
</div>
<div class="section" id="expressionengine">
<span id="case-expressionengine-classes-couldbestatic"></span><h4><span class="section-number">5.2.14.2. </span>ExpressionEngine<a class="headerlink" href="#expressionengine" title="Permalink to this headline">¶</a></h4>
<p><a class="reference internal" href="Rules.html#method-could-be-static"><span class="std std-ref">Method Could Be Static</span></a>, in system/ee/legacy/libraries/Upload.ph:859.</p>
<p>This method returns the list of mime type, by using a hidden global value : ee() is a functioncall that give access to the external storage of values.</p>
<div class="highlight-php notranslate"><div class="highlight"><pre><span></span><span class="sd">/**</span>
<span class="sd">     * List of Mime Types</span>
<span class="sd">     *</span>
<span class="sd">     * This is a list of mime types.  We use it to validate</span>
<span class="sd">     * the allowed types set by the developer</span>
<span class="sd">     *</span>
<span class="sd">     * @param       string</span>
<span class="sd">     * @return      string</span>
<span class="sd">     */</span>
    <span class="k">public</span> <span class="k">function</span> <span class="nf">mimes_types</span><span class="p">(</span><span class="nv">$mime</span><span class="p">)</span>
    <span class="p">{</span>
            <span class="nx">ee</span><span class="p">()</span><span class="o">-&gt;</span><span class="na">load</span><span class="o">-&gt;</span><span class="na">library</span><span class="p">(</span><span class="s1">&#39;mime_type&#39;</span><span class="p">);</span>
            <span class="k">return</span> <span class="nx">ee</span><span class="p">()</span><span class="o">-&gt;</span><span class="na">mime_type</span><span class="o">-&gt;</span><span class="na">isSafeForUpload</span><span class="p">(</span><span class="nv">$mime</span><span class="p">);</span>
    <span class="p">}</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="disconnected-classes">
<span id="case-disconnected-classes"></span><h3><span class="section-number">5.2.15. </span>Disconnected Classes<a class="headerlink" href="#disconnected-classes" title="Permalink to this headline">¶</a></h3>
<div class="section" id="case-wordpress-classes-disconnectedclasses">
<span id="id4"></span><h4><span class="section-number">5.2.15.1. </span>WordPress<a class="headerlink" href="#case-wordpress-classes-disconnectedclasses" title="Permalink to this headline">¶</a></h4>
<p><a class="reference internal" href="Rules.html#disconnected-classes"><span class="std std-ref">Disconnected Classes</span></a>, in wp-admin/includes/misc.php:74.</p>
<p>This code actually loads the file, join it, then split it again. file() would be sufficient.</p>
<div class="highlight-php notranslate"><div class="highlight"><pre><span></span><span class="nv">$markerdata</span> <span class="o">=</span> <span class="nb">explode</span><span class="p">(</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">,</span> <span class="nb">implode</span><span class="p">(</span> <span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="nb">file</span><span class="p">(</span> <span class="nv">$filename</span> <span class="p">)</span> <span class="p">)</span> <span class="p">);</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="don-t-send-this-in-constructor">
<span id="case-don-t-send-this-in-constructor"></span><h3><span class="section-number">5.2.16. </span>Don’t Send $this In Constructor<a class="headerlink" href="#don-t-send-this-in-constructor" title="Permalink to this headline">¶</a></h3>
<div class="section" id="woocommerce">
<span id="case-woocommerce-classes-dontsendthisinconstructor"></span><h4><span class="section-number">5.2.16.1. </span>Woocommerce<a class="headerlink" href="#woocommerce" title="Permalink to this headline">¶</a></h4>
<p><a class="reference internal" href="Rules.html#don-t-send-this-in-constructor"><span class="std std-ref">Don’t Send $this In Constructor</span></a>, in includes/class-wc-cart.php:107.</p>
<p>WC_Cart_Session and WC_Cart_Fees receives $this, the current object, at a moment where it is not consistent : for example, tax_display_cart hasn’t been set yet. Although it may be unexpected to have an object called WC_Cart being called by the session or the fees, this is still a temporary inconsistence.</p>
<div class="highlight-php notranslate"><div class="highlight"><pre><span></span><span class="sd">/**</span>
<span class="sd">     * Constructor for the cart class. Loads options and hooks in the init method.</span>
<span class="sd">     */</span>
    <span class="k">public</span> <span class="k">function</span> <span class="fm">__construct</span><span class="p">()</span> <span class="p">{</span>
            <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">session</span>          <span class="o">=</span> <span class="k">new</span> <span class="nx">WC_Cart_Session</span><span class="p">(</span> <span class="nv">$this</span> <span class="p">);</span>
            <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">fees_api</span>         <span class="o">=</span> <span class="k">new</span> <span class="nx">WC_Cart_Fees</span><span class="p">(</span> <span class="nv">$this</span> <span class="p">);</span>
            <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">tax_display_cart</span> <span class="o">=</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">is_tax_displayed</span><span class="p">();</span>

            <span class="c1">// Register hooks for the objects.</span>
            <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">session</span><span class="o">-&gt;</span><span class="na">init</span><span class="p">();</span>
</pre></div>
</div>
</div>
<div class="section" id="case-contao-classes-dontsendthisinconstructor">
<span id="id5"></span><h4><span class="section-number">5.2.16.2. </span>Contao<a class="headerlink" href="#case-contao-classes-dontsendthisinconstructor" title="Permalink to this headline">¶</a></h4>
<p><a class="reference internal" href="Rules.html#don-t-send-this-in-constructor"><span class="std std-ref">Don’t Send $this In Constructor</span></a>, in system/modules/core/library/Contao/Model.php:110.</p>
<p>$this is send to $objRegistry. $objRegistry is obtained with a factory, ModelRegistry::getInstance(). It is probably fully prepared at that point. Yet, $objRegistry is called and used to fill $this properties with full values. At some point, $objRegistry return values without having a handle on a fully designed object.</p>
<div class="highlight-php notranslate"><div class="highlight"><pre><span></span><span class="sd">/**</span>
<span class="sd">     * Load the relations and optionally process a result set</span>
<span class="sd">     *</span>
<span class="sd">     * @param \Database\Result $objResult An optional database result</span>
<span class="sd">     */</span>
    <span class="k">public</span> <span class="k">function</span> <span class="fm">__construct</span><span class="p">(</span><span class="nx">\Database\Result</span> <span class="nv">$objResult</span><span class="o">=</span><span class="k">null</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="c1">// Some code was removed</span>
                    <span class="nv">$objRegistry</span> <span class="o">=</span> <span class="nx">\Model\Registry</span><span class="o">::</span><span class="na">getInstance</span><span class="p">();</span>

                    <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">setRow</span><span class="p">(</span><span class="nv">$arrData</span><span class="p">);</span> <span class="c1">// see #5439</span>
                    <span class="nv">$objRegistry</span><span class="o">-&gt;</span><span class="na">register</span><span class="p">(</span><span class="nv">$this</span><span class="p">);</span>

        <span class="c1">// More code below</span>
        <span class="c1">// $this-&gt; are set</span>
        <span class="c1">// $objRegistry is called</span>
    <span class="p">}</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="don-t-unset-properties">
<span id="case-don-t-unset-properties"></span><h3><span class="section-number">5.2.17. </span>Don’t Unset Properties<a class="headerlink" href="#don-t-unset-properties" title="Permalink to this headline">¶</a></h3>
<div class="section" id="case-vanilla-classes-dontunsetproperties">
<span id="id6"></span><h4><span class="section-number">5.2.17.1. </span>Vanilla<a class="headerlink" href="#case-vanilla-classes-dontunsetproperties" title="Permalink to this headline">¶</a></h4>
<p><a class="reference internal" href="Rules.html#don-t-unset-properties"><span class="std std-ref">Don’t Unset Properties</span></a>, in applications/dashboard/models/class.activitymodel.php:1073.</p>
<p>The _NotificationQueue property, in this class, is defined as an array. Here, it is destroyed, then recreated. The unset() is too much, as the assignation is sufficient to reset the array</p>
<div class="highlight-php notranslate"><div class="highlight"><pre><span></span><span class="sd">/**</span>
<span class="sd">     * Clear notification queue.</span>
<span class="sd">     *</span>
<span class="sd">     * @since 2.0.17</span>
<span class="sd">     * @access public</span>
<span class="sd">     */</span>
    <span class="k">public</span> <span class="k">function</span> <span class="nf">clearNotificationQueue</span><span class="p">()</span> <span class="p">{</span>
        <span class="nb">unset</span><span class="p">(</span><span class="nv">$this</span><span class="o">-&gt;</span><span class="na">_NotificationQueue</span><span class="p">);</span>
        <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">_NotificationQueue</span> <span class="o">=</span> <span class="p">[];</span>
    <span class="p">}</span>
</pre></div>
</div>
</div>
<div class="section" id="case-typo3-classes-dontunsetproperties">
<span id="id7"></span><h4><span class="section-number">5.2.17.2. </span>Typo3<a class="headerlink" href="#case-typo3-classes-dontunsetproperties" title="Permalink to this headline">¶</a></h4>
<p><a class="reference internal" href="Rules.html#don-t-unset-properties"><span class="std std-ref">Don’t Unset Properties</span></a>, in typo3/sysext/linkvalidator/Classes/Linktype/InternalLinktype.php:73.</p>
<p>The property errorParams is emptied by unsetting it. The property is actually defined in the above class, as an array. Until the next error is added to this list, any access to the error list has to be checked with isset(), or yield an ‘Undefined’ warning.</p>
<div class="highlight-php notranslate"><div class="highlight"><pre><span></span><span class="k">public</span> <span class="k">function</span> <span class="nf">checkLink</span><span class="p">(</span><span class="nv">$url</span><span class="p">,</span> <span class="nv">$softRefEntry</span><span class="p">,</span> <span class="nv">$reference</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="nv">$anchor</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span><span class="p">;</span>
        <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">responseContent</span> <span class="o">=</span> <span class="k">true</span><span class="p">;</span>
        <span class="c1">// Might already contain values - empty it</span>
        <span class="nb">unset</span><span class="p">(</span><span class="nv">$this</span><span class="o">-&gt;</span><span class="na">errorParams</span><span class="p">);</span>
<span class="c1">//....</span>

<span class="k">abstract</span> <span class="k">class</span> <span class="nc">AbstractLinktype</span> <span class="k">implements</span> <span class="nx">LinktypeInterface</span>
<span class="p">{</span>
    <span class="sd">/**</span>
<span class="sd">     * Contains parameters needed for the rendering of the error message</span>
<span class="sd">     *</span>
<span class="sd">     * @var array</span>
<span class="sd">     */</span>
    <span class="k">protected</span> <span class="nv">$errorParams</span> <span class="o">=</span> <span class="p">[];</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="empty-classes">
<span id="case-empty-classes"></span><h3><span class="section-number">5.2.18. </span>Empty Classes<a class="headerlink" href="#empty-classes" title="Permalink to this headline">¶</a></h3>
<div class="section" id="case-wordpress-classes-emptyclass">
<span id="id8"></span><h4><span class="section-number">5.2.18.1. </span>WordPress<a class="headerlink" href="#case-wordpress-classes-emptyclass" title="Permalink to this headline">¶</a></h4>
<p><a class="reference internal" href="Rules.html#empty-classes"><span class="std std-ref">Empty Classes</span></a>, in wp-includes/SimplePie/Core.php:54.</p>
<p>Empty class, but documented as backward compatibility.</p>
<div class="highlight-php notranslate"><div class="highlight"><pre><span></span><span class="sd">/**</span>
<span class="sd"> * SimplePie class.</span>
<span class="sd"> *</span>
<span class="sd"> * Class for backward compatibility.</span>
<span class="sd"> *</span>
<span class="sd"> * @deprecated Use {@see SimplePie} directly</span>
<span class="sd"> * @package SimplePie</span>
<span class="sd"> * @subpackage API</span>
<span class="sd"> */</span>
<span class="k">class</span> <span class="nc">SimplePie_Core</span> <span class="k">extends</span> <span class="nx">SimplePie</span>
<span class="p">{</span>

<span class="p">}</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="incompatible-signature-methods">
<span id="case-incompatible-signature-methods"></span><h3><span class="section-number">5.2.19. </span>Incompatible Signature Methods<a class="headerlink" href="#incompatible-signature-methods" title="Permalink to this headline">¶</a></h3>
<div class="section" id="suitecrm">
<span id="case-suitecrm-classes-incompatiblesignature"></span><h4><span class="section-number">5.2.19.1. </span>SuiteCrm<a class="headerlink" href="#suitecrm" title="Permalink to this headline">¶</a></h4>
<p><a class="reference internal" href="Rules.html#incompatible-signature-methods"><span class="std std-ref">Incompatible Signature Methods</span></a>, in modules/Home/Dashlets/RSSDashlet/RSSDashlet.php:138.</p>
<p>The class in the RSSDashlet.php file has an ‘array’ typehint which is not in the parent Dashlet class. While both files compile separately, they yield a PHP warning when running : typehinting mismatch only yields a warning.</p>
<div class="highlight-php notranslate"><div class="highlight"><pre><span></span><span class="c1">// File /modules/Home/Dashlets/RSSDashlet/RSSDashlet.php</span>
    <span class="k">public</span> <span class="k">function</span> <span class="nf">saveOptions</span><span class="p">(</span>
        <span class="k">array</span> <span class="nv">$req</span>
        <span class="p">)</span>
    <span class="p">{</span>

<span class="c1">// File /include/Dashlets/Dashlets.php</span>
    <span class="k">public</span> <span class="k">function</span> <span class="nf">saveOptions</span><span class="p">(</span> <span class="nv">$req</span> <span class="p">)</span> <span class="p">{</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="incompatible-signature-methods-with-covariance">
<span id="case-incompatible-signature-methods-with-covariance"></span><h3><span class="section-number">5.2.20. </span>Incompatible Signature Methods With Covariance<a class="headerlink" href="#incompatible-signature-methods-with-covariance" title="Permalink to this headline">¶</a></h3>
<div class="section" id="case-suitecrm-classes-incompatiblesignature74">
<span id="id9"></span><h4><span class="section-number">5.2.20.1. </span>SuiteCrm<a class="headerlink" href="#case-suitecrm-classes-incompatiblesignature74" title="Permalink to this headline">¶</a></h4>
<p><a class="reference internal" href="Rules.html#incompatible-signature-methods-with-covariance"><span class="std std-ref">Incompatible Signature Methods With Covariance</span></a>, in modules/Home/Dashlets/RSSDashlet/RSSDashlet.php:138.</p>
<p>The class in the RSSDashlet.php file has an ‘array’ typehint which is not in the parent Dashlet class. While both files compile separately, they yield a PHP warning when running : typehinting mismatch only yields a warning.</p>
<div class="highlight-php notranslate"><div class="highlight"><pre><span></span><span class="c1">// File /modules/Home/Dashlets/RSSDashlet/RSSDashlet.php</span>
    <span class="k">public</span> <span class="k">function</span> <span class="nf">saveOptions</span><span class="p">(</span>
        <span class="k">array</span> <span class="nv">$req</span>
        <span class="p">)</span>
    <span class="p">{</span>

<span class="c1">// File /include/Dashlets/Dashlets.php</span>
    <span class="k">public</span> <span class="k">function</span> <span class="nf">saveOptions</span><span class="p">(</span> <span class="nv">$req</span> <span class="p">)</span> <span class="p">{</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="assign-default-to-properties">
<span id="case-assign-default-to-properties"></span><h3><span class="section-number">5.2.21. </span>Assign Default To Properties<a class="headerlink" href="#assign-default-to-properties" title="Permalink to this headline">¶</a></h3>
<div class="section" id="livezilla">
<span id="case-livezilla-classes-makedefault"></span><h4><span class="section-number">5.2.21.1. </span>LiveZilla<a class="headerlink" href="#livezilla" title="Permalink to this headline">¶</a></h4>
<p><a class="reference internal" href="Rules.html#assign-default-to-properties"><span class="std std-ref">Assign Default To Properties</span></a>, in livezilla/_lib/functions.external.inc.php:174.</p>
<p>Flags may default to array() in the class definition. Filled array(), with keys and values, are also possible.</p>
<div class="highlight-php notranslate"><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">OverlayChat</span>
<span class="p">{</span>
    <span class="k">public</span> <span class="nv">$Botmode</span><span class="p">;</span>
    <span class="k">public</span> <span class="nv">$Human</span><span class="p">;</span>
    <span class="k">public</span> <span class="nv">$HumanGeneral</span><span class="p">;</span>
    <span class="k">public</span> <span class="nv">$RepollRequired</span><span class="p">;</span>
    <span class="k">public</span> <span class="nv">$OperatorCount</span><span class="p">;</span>
    <span class="k">public</span> <span class="nv">$Flags</span><span class="p">;</span>
    <span class="k">public</span> <span class="nv">$LastMessageReceived</span><span class="p">;</span>
    <span class="k">public</span> <span class="nv">$LastPostReceived</span><span class="p">;</span>
    <span class="k">public</span> <span class="nv">$IsHumanChatAvailable</span><span class="p">;</span>
    <span class="k">public</span> <span class="nv">$IsChatAvailable</span><span class="p">;</span>
    <span class="k">public</span> <span class="nv">$ChatHTML</span><span class="p">;</span>
    <span class="k">public</span> <span class="nv">$OverlayHTML</span><span class="p">;</span>
    <span class="k">public</span> <span class="nv">$PostHTML</span><span class="p">;</span>
    <span class="k">public</span> <span class="nv">$FullLoad</span><span class="p">;</span>
    <span class="k">public</span> <span class="nv">$LanguageRequired</span> <span class="o">=</span> <span class="k">false</span><span class="p">;</span>
    <span class="k">public</span> <span class="nv">$LastPoster</span><span class="p">;</span>
    <span class="k">public</span> <span class="nv">$EyeCatcher</span><span class="p">;</span>
    <span class="k">public</span> <span class="nv">$GroupBuilder</span><span class="p">;</span>
    <span class="k">public</span> <span class="nv">$CurrentOperatorId</span><span class="p">;</span>
    <span class="k">public</span> <span class="nv">$BotTitle</span><span class="p">;</span>
    <span class="k">public</span> <span class="nv">$OperatorPostCount</span><span class="p">;</span>
    <span class="k">public</span> <span class="nv">$PlaySound</span><span class="p">;</span>
    <span class="k">public</span> <span class="nv">$SpeakingToHTML</span><span class="p">;</span>
    <span class="k">public</span> <span class="nv">$SpeakingToAdded</span><span class="p">;</span>
    <span class="k">public</span> <span class="nv">$Version</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>

    <span class="k">public</span> <span class="k">static</span> <span class="nv">$MaxPosts</span> <span class="o">=</span> <span class="mi">50</span><span class="p">;</span>
    <span class="k">public</span> <span class="k">static</span> <span class="nv">$Response</span><span class="p">;</span>

    <span class="k">function</span> <span class="fm">__construct</span><span class="p">()</span>
    <span class="p">{</span>
        <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">Flags</span> <span class="o">=</span> <span class="k">array</span><span class="p">();</span>
        <span class="nx">VisitorChat</span><span class="o">::</span><span class="nv">$Router</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">ChatRouter</span><span class="p">();</span>
    <span class="p">}</span>
</pre></div>
</div>
</div>
<div class="section" id="phpmyadmin">
<span id="case-phpmyadmin-classes-makedefault"></span><h4><span class="section-number">5.2.21.2. </span>phpMyAdmin<a class="headerlink" href="#phpmyadmin" title="Permalink to this headline">¶</a></h4>
<p><a class="reference internal" href="Rules.html#assign-default-to-properties"><span class="std std-ref">Assign Default To Properties</span></a>, in libraries/classes/Console.ph:55.</p>
<p>_isEnabled may default to true. It could also default to a class constant.</p>
<div class="highlight-php notranslate"><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">Console</span>
<span class="p">{</span>
    <span class="sd">/**</span>
<span class="sd">     * Whether to display anything</span>
<span class="sd">     *</span>
<span class="sd">     * @access private</span>
<span class="sd">     * @var bool</span>
<span class="sd">     */</span>
    <span class="k">private</span> <span class="nv">$_isEnabled</span><span class="p">;</span>

<span class="c1">// some code ignored here</span>
    <span class="sd">/**</span>
<span class="sd">     * Creates a new class instance</span>
<span class="sd">     */</span>
    <span class="k">public</span> <span class="k">function</span> <span class="fm">__construct</span><span class="p">()</span>
    <span class="p">{</span>
        <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">_isEnabled</span> <span class="o">=</span> <span class="k">true</span><span class="p">;</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="forgotten-visibility">
<span id="case-forgotten-visibility"></span><h3><span class="section-number">5.2.22. </span>Forgotten Visibility<a class="headerlink" href="#forgotten-visibility" title="Permalink to this headline">¶</a></h3>
<div class="section" id="case-fuelcms-classes-nonppp">
<span id="id10"></span><h4><span class="section-number">5.2.22.1. </span>FuelCMS<a class="headerlink" href="#case-fuelcms-classes-nonppp" title="Permalink to this headline">¶</a></h4>
<p><a class="reference internal" href="Rules.html#forgotten-visibility"><span class="std std-ref">Forgotten Visibility</span></a>, in /fuel/modules/fuel/controllers/Module.php:713.</p>
<p>Missing visibility for the index() method,and all the methods in the Module class.</p>
<div class="highlight-php notranslate"><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">Module</span> <span class="k">extends</span> <span class="nx">Fuel_base_controller</span> <span class="p">{</span>

    <span class="c1">// --------------------------------------------------------------------</span>

    <span class="sd">/**</span>
<span class="sd">     * Displays the list (table) view</span>
<span class="sd">     *</span>
<span class="sd">     * @access      public</span>
<span class="sd">     * @return      void</span>
<span class="sd">     */</span>
    <span class="k">function</span> <span class="nf">index</span><span class="p">()</span>
    <span class="p">{</span>
            <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">items</span><span class="p">();</span>
    <span class="p">}</span>
</pre></div>
</div>
</div>
<div class="section" id="case-livezilla-classes-nonppp">
<span id="id11"></span><h4><span class="section-number">5.2.22.2. </span>LiveZilla<a class="headerlink" href="#case-livezilla-classes-nonppp" title="Permalink to this headline">¶</a></h4>
<p><a class="reference internal" href="Rules.html#forgotten-visibility"><span class="std std-ref">Forgotten Visibility</span></a>, in livezilla/_lib/objects.global.users.inc.php:2516.</p>
<p>Static method that could be public.</p>
<div class="highlight-php notranslate"><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">Visitor</span> <span class="k">extends</span> <span class="nx">BaseUser</span>
<span class="p">{</span>
<span class="c1">// Lots of code</span>

    <span class="k">static</span> <span class="k">function</span> <span class="nf">CreateSPAMFilter</span><span class="p">(</span><span class="nv">$_userId</span><span class="p">,</span><span class="nv">$_base64</span><span class="o">=</span><span class="k">true</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="k">if</span><span class="p">(</span><span class="o">!</span><span class="k">empty</span><span class="p">(</span><span class="nx">Server</span><span class="o">::</span><span class="nv">$Configuration</span><span class="o">-&gt;</span><span class="na">File</span><span class="p">[</span><span class="nx">gl_sfa</span><span class="p">]))</span>
        <span class="p">{</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="non-static-methods-called-in-a-static">
<span id="case-non-static-methods-called-in-a-static"></span><h3><span class="section-number">5.2.23. </span>Non Static Methods Called In A Static<a class="headerlink" href="#non-static-methods-called-in-a-static" title="Permalink to this headline">¶</a></h3>
<div class="section" id="dolphin">
<span id="case-dolphin-classes-nonstaticmethodscalledstatic"></span><h4><span class="section-number">5.2.23.1. </span>Dolphin<a class="headerlink" href="#dolphin" title="Permalink to this headline">¶</a></h4>
<p><a class="reference internal" href="Rules.html#non-static-methods-called-in-a-static"><span class="std std-ref">Non Static Methods Called In A Static</span></a>, in Dolphin-v.7.3.5/xmlrpc/BxDolXMLRPCFriends.php:11.</p>
<p>getIdByNickname() is indeed defined in the class ‘BxDolXMLRPCUtil’ and it calls the database. The class relies on functions (not methods) to query the database with the correct connexion.</p>
<div class="highlight-php notranslate"><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">BxDolXMLRPCFriends</span>
<span class="p">{</span>
    <span class="k">function</span> <span class="nf">getFriends</span><span class="p">(</span><span class="nv">$sUser</span><span class="p">,</span> <span class="nv">$sPwd</span><span class="p">,</span> <span class="nv">$sNick</span><span class="p">,</span> <span class="nv">$sLang</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="nv">$iIdProfile</span> <span class="o">=</span> <span class="nx">BxDolXMLRPCUtil</span><span class="o">::</span><span class="na">getIdByNickname</span> <span class="p">(</span><span class="nv">$sNick</span><span class="p">);</span>
</pre></div>
</div>
</div>
<div class="section" id="case-magento-classes-nonstaticmethodscalledstatic">
<span id="id12"></span><h4><span class="section-number">5.2.23.2. </span>Magento<a class="headerlink" href="#case-magento-classes-nonstaticmethodscalledstatic" title="Permalink to this headline">¶</a></h4>
<p><a class="reference internal" href="Rules.html#non-static-methods-called-in-a-static"><span class="std std-ref">Non Static Methods Called In A Static</span></a>, in app/code/core/Mage/Paypal/Model/Payflowlink.php:143.</p>
<p>Mage_Payment_Model_Method_Abstract is an abstract class : this way, it is not possible to instantiate it and then, access its methods. The class is extended, so it could be called from one of the objects. Although, the troubling part is that isAvailable() uses $this, so it can’t be static.</p>
<div class="highlight-php notranslate"><div class="highlight"><pre><span></span><span class="nx">Mage_Payment_Model_Method_Abstract</span><span class="o">::</span><span class="na">isAvailable</span><span class="p">(</span><span class="nv">$quote</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="var-keyword">
<span id="case-var-keyword"></span><h3><span class="section-number">5.2.24. </span>Var Keyword<a class="headerlink" href="#var-keyword" title="Permalink to this headline">¶</a></h3>
<div class="section" id="xataface">
<span id="case-xataface-classes-oldstylevar"></span><h4><span class="section-number">5.2.24.1. </span>xataface<a class="headerlink" href="#xataface" title="Permalink to this headline">¶</a></h4>
<p><a class="reference internal" href="Rules.html#var-keyword"><span class="std std-ref">Var Keyword</span></a>, in SQL/Parser/wrapper.php:24.</p>
<p>With the usage of var and a first method bearing the name of the class, this is PHP 4 code that is still in use.</p>
<div class="highlight-php notranslate"><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">SQL_Parser_wrapper</span> <span class="p">{</span>

    <span class="k">var</span> <span class="nv">$_data</span><span class="p">;</span>
    <span class="k">var</span> <span class="nv">$_tableLookup</span><span class="p">;</span>
    <span class="k">var</span> <span class="nv">$_parser</span><span class="p">;</span>

    <span class="k">function</span> <span class="nf">SQL_Parser_wrapper</span><span class="p">(</span><span class="o">&amp;</span><span class="nv">$data</span><span class="p">,</span> <span class="nv">$dialect</span><span class="o">=</span><span class="s1">&#39;MySQL&#39;</span><span class="p">){</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="parent-first">
<span id="case-parent-first"></span><h3><span class="section-number">5.2.25. </span>Parent First<a class="headerlink" href="#parent-first" title="Permalink to this headline">¶</a></h3>
<div class="section" id="case-shopware-classes-parentfirst">
<span id="id13"></span><h4><span class="section-number">5.2.25.1. </span>shopware<a class="headerlink" href="#case-shopware-classes-parentfirst" title="Permalink to this headline">¶</a></h4>
<p><a class="reference internal" href="Rules.html#parent-first"><span class="std std-ref">Parent First</span></a>, in wp-admin/includes/misc.php:74.</p>
<p>Here, the parent is called last. Givent that $title is defined in the same class, it seems that $name may be defined in the BaseContainer class. In fact, it is not, and BasecContainer and FieldSet are fairly independant classes. Thus, the parent::__construct call could be first here, though more as a coding convention.</p>
<div class="highlight-php notranslate"><div class="highlight"><pre><span></span><span class="sd">/**</span>
<span class="sd"> * Class FieldSet</span>
<span class="sd"> */</span>
<span class="k">class</span> <span class="nc">FieldSet</span> <span class="k">extends</span> <span class="nx">BaseContainer</span>
<span class="p">{</span>
    <span class="sd">/**</span>
<span class="sd">     * @var string</span>
<span class="sd">     */</span>
    <span class="k">protected</span> <span class="nv">$title</span><span class="p">;</span>

    <span class="sd">/**</span>
<span class="sd">     * @param string $name</span>
<span class="sd">     * @param string $title</span>
<span class="sd">     */</span>
    <span class="k">public</span> <span class="k">function</span> <span class="fm">__construct</span><span class="p">(</span><span class="nv">$name</span><span class="p">,</span> <span class="nv">$title</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">title</span> <span class="o">=</span> <span class="nv">$title</span><span class="p">;</span>
        <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">name</span> <span class="o">=</span> <span class="nv">$name</span><span class="p">;</span>
        <span class="k">parent</span><span class="o">::</span><span class="na">__construct</span><span class="p">();</span>
    <span class="p">}</span>
</pre></div>
</div>
</div>
<div class="section" id="case-prestashop-classes-parentfirst">
<span id="id14"></span><h4><span class="section-number">5.2.25.2. </span>PrestaShop<a class="headerlink" href="#case-prestashop-classes-parentfirst" title="Permalink to this headline">¶</a></h4>
<p><a class="reference internal" href="Rules.html#parent-first"><span class="std std-ref">Parent First</span></a>, in controllers/admin/AdminPatternsController.php:30.</p>
<p>A good number of properties are set in the current object even before the parent AdminController(Core) is called. ‘table’ and ‘lang’ acts as default values for the parent class, as it (the parent class) would set them to another default value. Many properties are used, but not defined in the current class, nor its parent. This approach prevents the constructor from requesting too many arguments. Yet, as such, it is difficult to follow which of the initial values are transmitted via protected/public properties rather than using the __construct() call.</p>
<div class="highlight-php notranslate"><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">AdminPatternsControllerCore</span> <span class="k">extends</span> <span class="nx">AdminController</span>
<span class="p">{</span>
    <span class="k">public</span> <span class="nv">$name</span> <span class="o">=</span> <span class="s1">&#39;patterns&#39;</span><span class="p">;</span>

    <span class="k">public</span> <span class="k">function</span> <span class="fm">__construct</span><span class="p">()</span>
    <span class="p">{</span>
        <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">bootstrap</span> <span class="o">=</span> <span class="k">true</span><span class="p">;</span>
        <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">show_toolbar</span> <span class="o">=</span> <span class="k">false</span><span class="p">;</span>
        <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">context</span> <span class="o">=</span> <span class="nx">Context</span><span class="o">::</span><span class="na">getContext</span><span class="p">();</span>

        <span class="k">parent</span><span class="o">::</span><span class="na">__construct</span><span class="p">();</span>
    <span class="p">}</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="property-could-be-local">
<span id="case-property-could-be-local"></span><h3><span class="section-number">5.2.26. </span>Property Could Be Local<a class="headerlink" href="#property-could-be-local" title="Permalink to this headline">¶</a></h3>
<div class="section" id="case-mautic-classes-propertycouldbelocal">
<span id="id15"></span><h4><span class="section-number">5.2.26.1. </span>Mautic<a class="headerlink" href="#case-mautic-classes-propertycouldbelocal" title="Permalink to this headline">¶</a></h4>
<p><a class="reference internal" href="Rules.html#property-could-be-local"><span class="std std-ref">Property Could Be Local</span></a>, in app/bundles/EmailBundle/Model/SendEmailToContact.php:47.</p>
<p>$translator is a private property, provided at construction time. It is private, and only used in the processBadEmails() method. $translator may be turned into a parameter for processBadEmails(), and make the class slimmer.</p>
<div class="highlight-php notranslate"><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">SendEmailToContact</span>
<span class="p">{</span>
    <span class="sd">/**</span>
<span class="sd">     * @var TranslatorInterface</span>
<span class="sd">     */</span>
    <span class="k">private</span> <span class="nv">$translator</span><span class="p">;</span>

<span class="c1">// Skipped code</span>

    <span class="sd">/**</span>
<span class="sd">     * SendEmailToContact constructor.</span>
<span class="sd">     *</span>
<span class="sd">     * @param MailHelper          $mailer</span>
<span class="sd">     * @param StatRepository      $statRepository</span>
<span class="sd">     * @param DoNotContact        $dncModel</span>
<span class="sd">     * @param TranslatorInterface $translator</span>
<span class="sd">     */</span>
    <span class="k">public</span> <span class="k">function</span> <span class="fm">__construct</span><span class="p">(</span><span class="nx">MailHelper</span> <span class="nv">$mailer</span><span class="p">,</span> <span class="nx">StatHelper</span> <span class="nv">$statHelper</span><span class="p">,</span> <span class="nx">DoNotContact</span> <span class="nv">$dncModel</span><span class="p">,</span> <span class="nx">TranslatorInterface</span> <span class="nv">$translator</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">mailer</span>     <span class="o">=</span> <span class="nv">$mailer</span><span class="p">;</span>
        <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">statHelper</span> <span class="o">=</span> <span class="nv">$statHelper</span><span class="p">;</span>
        <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">dncModel</span>   <span class="o">=</span> <span class="nv">$dncModel</span><span class="p">;</span>
        <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">translator</span> <span class="o">=</span> <span class="nv">$translator</span><span class="p">;</span>
    <span class="p">}</span>

<span class="c1">// Skipped code</span>

    <span class="sd">/**</span>
<span class="sd">     * Add DNC entries for bad emails to get them out of the queue permanently.</span>
<span class="sd">     */</span>
    <span class="k">protected</span> <span class="k">function</span> <span class="nf">processBadEmails</span><span class="p">()</span>
    <span class="p">{</span>
        <span class="c1">// Update bad emails as bounces</span>
        <span class="k">if</span> <span class="p">(</span><span class="nb">count</span><span class="p">(</span><span class="nv">$this</span><span class="o">-&gt;</span><span class="na">badEmails</span><span class="p">))</span> <span class="p">{</span>
            <span class="k">foreach</span> <span class="p">(</span><span class="nv">$this</span><span class="o">-&gt;</span><span class="na">badEmails</span> <span class="k">as</span> <span class="nv">$contactId</span> <span class="o">=&gt;</span> <span class="nv">$contactEmail</span><span class="p">)</span> <span class="p">{</span>
                <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">dncModel</span><span class="o">-&gt;</span><span class="na">addDncForContact</span><span class="p">(</span>
                    <span class="nv">$contactId</span><span class="p">,</span>
                    <span class="p">[</span><span class="s1">&#39;email&#39;</span> <span class="o">=&gt;</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">emailEntityId</span><span class="p">],</span>
                    <span class="nx">DNC</span><span class="o">::</span><span class="na">BOUNCED</span><span class="p">,</span>
                    <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">translator</span><span class="o">-&gt;</span><span class="na">trans</span><span class="p">(</span><span class="s1">&#39;mautic.email.bounce.reason.bad_email&#39;</span><span class="p">),</span>
                    <span class="k">true</span><span class="p">,</span>
                    <span class="k">false</span>
                <span class="p">);</span>
            <span class="p">}</span>
        <span class="p">}</span>
    <span class="p">}</span>
</pre></div>
</div>
</div>
<div class="section" id="case-typo3-classes-propertycouldbelocal">
<span id="id16"></span><h4><span class="section-number">5.2.26.2. </span>Typo3<a class="headerlink" href="#case-typo3-classes-propertycouldbelocal" title="Permalink to this headline">¶</a></h4>
<p><a class="reference internal" href="Rules.html#property-could-be-local"><span class="std std-ref">Property Could Be Local</span></a>, in typo3/sysext/install/Classes/Updates/MigrateUrlTypesInPagesUpdate.php:28.</p>
<p>$urltypes is a private property, with a list of protocols for communicationss. It acts as a constant, being only read in the executeUpdate() method : constants may hold arrays. If this property has to evolve in the future, an accessor to update it will be necessary. Until then, this list may be hardcoded in the method.</p>
<div class="highlight-php notranslate"><div class="highlight"><pre><span></span><span class="sd">/**</span>
<span class="sd"> * Merge URLs divided in pages.urltype and pages.url into pages.url</span>
<span class="sd"> * @internal This class is only meant to be used within EXT:install and is not part of the TYPO3 Core API.</span>
<span class="sd"> */</span>
<span class="k">class</span> <span class="nc">MigrateUrlTypesInPagesUpdate</span> <span class="k">implements</span> <span class="nx">UpgradeWizardInterface</span>
<span class="p">{</span>
    <span class="k">private</span> <span class="nv">$urltypes</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="s1">&#39;http://&#39;</span><span class="p">,</span> <span class="s1">&#39;ftp://&#39;</span><span class="p">,</span> <span class="s1">&#39;mailto:&#39;</span><span class="p">,</span> <span class="s1">&#39;https://&#39;</span><span class="p">];</span>

<span class="c1">// Skipped code</span>

    <span class="sd">/**</span>
<span class="sd">     * Moves data from pages.urltype to pages.url</span>
<span class="sd">     *</span>
<span class="sd">     * @return bool</span>
<span class="sd">     */</span>
    <span class="k">public</span> <span class="k">function</span> <span class="nf">executeUpdate</span><span class="p">()</span><span class="o">:</span> <span class="nx">bool</span>
    <span class="p">{</span>
        <span class="k">foreach</span> <span class="p">(</span><span class="nv">$this</span><span class="o">-&gt;</span><span class="na">databaseTables</span> <span class="k">as</span> <span class="nv">$databaseTable</span><span class="p">)</span> <span class="p">{</span>
            <span class="nv">$connection</span> <span class="o">=</span> <span class="nx">GeneralUtility</span><span class="o">::</span><span class="na">makeInstance</span><span class="p">(</span><span class="nx">ConnectionPool</span><span class="o">::</span><span class="na">class</span><span class="p">)</span>
                <span class="o">-&gt;</span><span class="na">getConnectionForTable</span><span class="p">(</span><span class="nv">$databaseTable</span><span class="p">);</span>

            <span class="c1">// Process records that have entries in pages.urltype</span>
            <span class="nv">$queryBuilder</span> <span class="o">=</span> <span class="nv">$connection</span><span class="o">-&gt;</span><span class="na">createQueryBuilder</span><span class="p">();</span>
            <span class="nv">$queryBuilder</span><span class="o">-&gt;</span><span class="na">getRestrictions</span><span class="p">()</span><span class="o">-&gt;</span><span class="na">removeAll</span><span class="p">();</span>
            <span class="nv">$statement</span> <span class="o">=</span> <span class="nv">$queryBuilder</span><span class="o">-&gt;</span><span class="na">select</span><span class="p">(</span><span class="s1">&#39;uid&#39;</span><span class="p">,</span> <span class="s1">&#39;urltype&#39;</span><span class="p">,</span> <span class="s1">&#39;url&#39;</span><span class="p">)</span>
                <span class="o">-&gt;</span><span class="na">from</span><span class="p">(</span><span class="nv">$databaseTable</span><span class="p">)</span>
                <span class="o">-&gt;</span><span class="na">where</span><span class="p">(</span>
                    <span class="nv">$queryBuilder</span><span class="o">-&gt;</span><span class="na">expr</span><span class="p">()</span><span class="o">-&gt;</span><span class="na">neq</span><span class="p">(</span><span class="s1">&#39;urltype&#39;</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span>
                    <span class="nv">$queryBuilder</span><span class="o">-&gt;</span><span class="na">expr</span><span class="p">()</span><span class="o">-&gt;</span><span class="na">neq</span><span class="p">(</span><span class="s1">&#39;url&#39;</span><span class="p">,</span> <span class="nv">$queryBuilder</span><span class="o">-&gt;</span><span class="na">createPositionalParameter</span><span class="p">(</span><span class="s1">&#39;&#39;</span><span class="p">))</span>
                <span class="p">)</span>
                <span class="o">-&gt;</span><span class="na">execute</span><span class="p">();</span>

            <span class="k">while</span> <span class="p">(</span><span class="nv">$row</span> <span class="o">=</span> <span class="nv">$statement</span><span class="o">-&gt;</span><span class="na">fetch</span><span class="p">())</span> <span class="p">{</span>
                <span class="nv">$url</span> <span class="o">=</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">urltypes</span><span class="p">[(</span><span class="nx">int</span><span class="p">)</span><span class="nv">$row</span><span class="p">[</span><span class="s1">&#39;urltype&#39;</span><span class="p">]]</span> <span class="o">.</span> <span class="nv">$row</span><span class="p">[</span><span class="s1">&#39;url&#39;</span><span class="p">];</span>
                <span class="nv">$updateQueryBuilder</span> <span class="o">=</span> <span class="nv">$connection</span><span class="o">-&gt;</span><span class="na">createQueryBuilder</span><span class="p">();</span>
                <span class="nv">$updateQueryBuilder</span>
                    <span class="o">-&gt;</span><span class="na">update</span><span class="p">(</span><span class="nv">$databaseTable</span><span class="p">)</span>
                    <span class="o">-&gt;</span><span class="na">where</span><span class="p">(</span>
                        <span class="nv">$updateQueryBuilder</span><span class="o">-&gt;</span><span class="na">expr</span><span class="p">()</span><span class="o">-&gt;</span><span class="na">eq</span><span class="p">(</span>
                            <span class="s1">&#39;uid&#39;</span><span class="p">,</span>
                            <span class="nv">$updateQueryBuilder</span><span class="o">-&gt;</span><span class="na">createNamedParameter</span><span class="p">(</span><span class="nv">$row</span><span class="p">[</span><span class="s1">&#39;uid&#39;</span><span class="p">],</span> <span class="nx">\PDO</span><span class="o">::</span><span class="na">PARAM_INT</span><span class="p">)</span>
                        <span class="p">)</span>
                    <span class="p">)</span>
                    <span class="o">-&gt;</span><span class="na">set</span><span class="p">(</span><span class="s1">&#39;url&#39;</span><span class="p">,</span> <span class="nv">$updateQueryBuilder</span><span class="o">-&gt;</span><span class="na">createNamedParameter</span><span class="p">(</span><span class="nv">$url</span><span class="p">),</span> <span class="k">false</span><span class="p">)</span>
                    <span class="o">-&gt;</span><span class="na">set</span><span class="p">(</span><span class="s1">&#39;urltype&#39;</span><span class="p">,</span> <span class="mi">0</span><span class="p">);</span>
                <span class="nv">$updateQueryBuilder</span><span class="o">-&gt;</span><span class="na">execute</span><span class="p">();</span>
            <span class="p">}</span>
        <span class="p">}</span>
        <span class="k">return</span> <span class="k">true</span><span class="p">;</span>
    <span class="p">}</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="never-used-properties">
<span id="case-never-used-properties"></span><h3><span class="section-number">5.2.27. </span>Never Used Properties<a class="headerlink" href="#never-used-properties" title="Permalink to this headline">¶</a></h3>
<div class="section" id="case-wordpress-classes-propertyneverused">
<span id="id17"></span><h4><span class="section-number">5.2.27.1. </span>WordPress<a class="headerlink" href="#case-wordpress-classes-propertyneverused" title="Permalink to this headline">¶</a></h4>
<p><a class="reference internal" href="Rules.html#never-used-properties"><span class="std std-ref">Never Used Properties</span></a>, in wp-admin/includes/misc.php:74.</p>
<p>This code actually loads the file, join it, then split it again. file() would be sufficient.</p>
<div class="highlight-php notranslate"><div class="highlight"><pre><span></span><span class="nv">$markerdata</span> <span class="o">=</span> <span class="nb">explode</span><span class="p">(</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">,</span> <span class="nb">implode</span><span class="p">(</span> <span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="nb">file</span><span class="p">(</span> <span class="nv">$filename</span> <span class="p">)</span> <span class="p">)</span> <span class="p">);</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="property-used-in-one-method-only">
<span id="case-property-used-in-one-method-only"></span><h3><span class="section-number">5.2.28. </span>Property Used In One Method Only<a class="headerlink" href="#property-used-in-one-method-only" title="Permalink to this headline">¶</a></h3>
<div class="section" id="case-contao-classes-propertyusedinonemethodonly">
<span id="id18"></span><h4><span class="section-number">5.2.28.1. </span>Contao<a class="headerlink" href="#case-contao-classes-propertyusedinonemethodonly" title="Permalink to this headline">¶</a></h4>
<p><a class="reference internal" href="Rules.html#property-used-in-one-method-only"><span class="std std-ref">Property Used In One Method Only</span></a>, in calendar-bundle/src/Resources/contao/modules/ModuleEventlist.php:38.</p>
<p>Date is protected property. It is used only in the compile() method, and it is not used by the parent class. As such, it may be turned into a local variable.</p>
<div class="highlight-php notranslate"><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">ModuleEventlist</span> <span class="k">extends</span> <span class="nx">Events</span>
<span class="p">{</span>

    <span class="sd">/**</span>
<span class="sd">     * Current date object</span>
<span class="sd">     * @var Date</span>
<span class="sd">     */</span>
    <span class="k">protected</span> <span class="nv">$Date</span><span class="p">;</span>

<span class="c1">// Date is used in function compile() only</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="redefined-default">
<span id="case-redefined-default"></span><h3><span class="section-number">5.2.29. </span>Redefined Default<a class="headerlink" href="#redefined-default" title="Permalink to this headline">¶</a></h3>
<div class="section" id="piwigo">
<span id="case-piwigo-classes-redefineddefault"></span><h4><span class="section-number">5.2.29.1. </span>Piwigo<a class="headerlink" href="#piwigo" title="Permalink to this headline">¶</a></h4>
<p><a class="reference internal" href="Rules.html#redefined-default"><span class="std std-ref">Redefined Default</span></a>, in admin/include/updates.class.php:34.</p>
<p>default_themes is defined as an empty array, then filled with new values. Same for default_plugins. Both may be defined as declaration time, and not during the constructor.</p>
<div class="highlight-php notranslate"><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">updates</span>
<span class="p">{</span>
  <span class="k">var</span> <span class="nv">$types</span> <span class="o">=</span> <span class="k">array</span><span class="p">();</span>
  <span class="k">var</span> <span class="nv">$plugins</span><span class="p">;</span>
  <span class="k">var</span> <span class="nv">$themes</span><span class="p">;</span>
  <span class="k">var</span> <span class="nv">$languages</span><span class="p">;</span>
  <span class="k">var</span> <span class="nv">$missing</span> <span class="o">=</span> <span class="k">array</span><span class="p">();</span>
  <span class="k">var</span> <span class="nv">$default_plugins</span> <span class="o">=</span> <span class="k">array</span><span class="p">();</span>
  <span class="k">var</span> <span class="nv">$default_themes</span> <span class="o">=</span> <span class="k">array</span><span class="p">();</span>
  <span class="k">var</span> <span class="nv">$default_languages</span> <span class="o">=</span> <span class="k">array</span><span class="p">();</span>
  <span class="k">var</span> <span class="nv">$merged_extensions</span> <span class="o">=</span> <span class="k">array</span><span class="p">();</span>
  <span class="k">var</span> <span class="nv">$merged_extension_url</span> <span class="o">=</span> <span class="s1">&#39;http://piwigo.org/download/merged_extensions.txt&#39;</span><span class="p">;</span>

  <span class="k">function</span> <span class="fm">__construct</span><span class="p">(</span><span class="nv">$page</span><span class="o">=</span><span class="s1">&#39;updates&#39;</span><span class="p">)</span>
  <span class="p">{</span>
    <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">types</span> <span class="o">=</span> <span class="k">array</span><span class="p">(</span><span class="s1">&#39;plugins&#39;</span><span class="p">,</span> <span class="s1">&#39;themes&#39;</span><span class="p">,</span> <span class="s1">&#39;languages&#39;</span><span class="p">);</span>

    <span class="k">if</span> <span class="p">(</span><span class="nb">in_array</span><span class="p">(</span><span class="nv">$page</span><span class="p">,</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">types</span><span class="p">))</span>
    <span class="p">{</span>
      <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">types</span> <span class="o">=</span> <span class="k">array</span><span class="p">(</span><span class="nv">$page</span><span class="p">);</span>
    <span class="p">}</span>
    <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">default_themes</span> <span class="o">=</span> <span class="k">array</span><span class="p">(</span><span class="s1">&#39;clear&#39;</span><span class="p">,</span> <span class="s1">&#39;dark&#39;</span><span class="p">,</span> <span class="s1">&#39;Sylvia&#39;</span><span class="p">,</span> <span class="s1">&#39;elegant&#39;</span><span class="p">,</span> <span class="s1">&#39;smartpocket&#39;</span><span class="p">);</span>
    <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">default_plugins</span> <span class="o">=</span> <span class="k">array</span><span class="p">(</span><span class="s1">&#39;AdminTools&#39;</span><span class="p">,</span> <span class="s1">&#39;TakeATour&#39;</span><span class="p">,</span> <span class="s1">&#39;language_switch&#39;</span><span class="p">,</span> <span class="s1">&#39;LocalFilesEditor&#39;</span><span class="p">);</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="redefined-private-property">
<span id="case-redefined-private-property"></span><h3><span class="section-number">5.2.30. </span>Redefined Private Property<a class="headerlink" href="#redefined-private-property" title="Permalink to this headline">¶</a></h3>
<div class="section" id="case-zurmo-classes-redefinedprivateproperty">
<span id="id19"></span><h4><span class="section-number">5.2.30.1. </span>Zurmo<a class="headerlink" href="#case-zurmo-classes-redefinedprivateproperty" title="Permalink to this headline">¶</a></h4>
<p><a class="reference internal" href="Rules.html#redefined-private-property"><span class="std std-ref">Redefined Private Property</span></a>, in app/protected/modules/zurmo/models/OwnedCustomField.php:51.</p>
<p>The class OwnedCustomField is part of a large class tree : OwnedCustomField extends CustomField,
CustomField extends BaseCustomField, BaseCustomField extends RedBeanModel, RedBeanModel extends BeanModel.</p>
<p>Since $canHaveBean is distinct in BeanModel and in OwnedCustomField, the public method getCanHaveBean() also had to be overloaded.</p>
<div class="highlight-php notranslate"><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">OwnedCustomField</span> <span class="k">extends</span> <span class="nx">CustomField</span>
    <span class="p">{</span>
        <span class="sd">/**</span>
<span class="sd">         * OwnedCustomField does not need to have a bean because it stores no attributes and has no relations</span>
<span class="sd">         * @see RedBeanModel::canHaveBean();</span>
<span class="sd">         * @var boolean</span>
<span class="sd">         */</span>
        <span class="k">private</span> <span class="k">static</span> <span class="nv">$canHaveBean</span> <span class="o">=</span> <span class="k">false</span><span class="p">;</span>

<span class="o">/..../</span>

        <span class="sd">/**</span>
<span class="sd">         * @see RedBeanModel::getHasBean()</span>
<span class="sd">         */</span>
        <span class="k">public</span> <span class="k">static</span> <span class="k">function</span> <span class="nf">getCanHaveBean</span><span class="p">()</span>
        <span class="p">{</span>
            <span class="k">if</span> <span class="p">(</span><span class="nb">get_called_class</span><span class="p">()</span> <span class="o">==</span> <span class="s1">&#39;OwnedCustomField&#39;</span><span class="p">)</span>
            <span class="p">{</span>
                <span class="k">return</span> <span class="nx">self</span><span class="o">::</span><span class="nv">$canHaveBean</span><span class="p">;</span>
            <span class="p">}</span>
            <span class="k">return</span> <span class="k">parent</span><span class="o">::</span><span class="na">getCanHaveBean</span><span class="p">();</span>
        <span class="p">}</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="scalar-or-object-property">
<span id="case-scalar-or-object-property"></span><h3><span class="section-number">5.2.31. </span>Scalar Or Object Property<a class="headerlink" href="#scalar-or-object-property" title="Permalink to this headline">¶</a></h3>
<div class="section" id="sugarcrm">
<span id="case-sugarcrm-classes-scalarorobjectproperty"></span><h4><span class="section-number">5.2.31.1. </span>SugarCrm<a class="headerlink" href="#sugarcrm" title="Permalink to this headline">¶</a></h4>
<p><a class="reference internal" href="Rules.html#scalar-or-object-property"><span class="std std-ref">Scalar Or Object Property</span></a>, in SugarCE-Full-6.5.26/data/Link.php:54.</p>
<p>The _relationship property starts its life as a string, and becomes an object later.</p>
<div class="highlight-php notranslate"><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">Link</span> <span class="p">{</span>

    <span class="cm">/* Private variables.*/</span>
    <span class="k">var</span> <span class="nv">$_log</span><span class="p">;</span>
    <span class="k">var</span> <span class="nv">$_relationship_name</span><span class="p">;</span> <span class="c1">//relationship this attribute is tied to.</span>
    <span class="k">var</span> <span class="nv">$_bean</span><span class="p">;</span> <span class="c1">//stores a copy of the bean.</span>
    <span class="k">var</span> <span class="nv">$_relationship</span><span class="o">=</span> <span class="s1">&#39;&#39;</span><span class="p">;</span>

<span class="c1">/// More code.....</span>

<span class="c1">// line 92</span>
            <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">_relationship</span><span class="o">=</span><span class="k">new</span> <span class="nx">Relationship</span><span class="p">();</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="could-use-self">
<span id="case-could-use-self"></span><h3><span class="section-number">5.2.32. </span>Could Use self<a class="headerlink" href="#could-use-self" title="Permalink to this headline">¶</a></h3>
<div class="section" id="case-wordpress-classes-shoulduseself">
<span id="id20"></span><h4><span class="section-number">5.2.32.1. </span>WordPress<a class="headerlink" href="#case-wordpress-classes-shoulduseself" title="Permalink to this headline">¶</a></h4>
<p><a class="reference internal" href="Rules.html#could-use-self"><span class="std std-ref">Could Use self</span></a>, in wp-admin/includes/misc.php:74.</p>
<p>Securimage could be called self.</p>
<div class="highlight-php notranslate"><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">Securimage</span>
<span class="p">{</span>
<span class="c1">// Lots of code</span>
            <span class="nx">Securimage</span><span class="o">::</span><span class="nv">$_captchaId</span> <span class="o">=</span> <span class="nv">$id</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>
</div>
</div>
<div class="section" id="case-livezilla-classes-shoulduseself">
<span id="id21"></span><h4><span class="section-number">5.2.32.2. </span>LiveZilla<a class="headerlink" href="#case-livezilla-classes-shoulduseself" title="Permalink to this headline">¶</a></h4>
<p><a class="reference internal" href="Rules.html#could-use-self"><span class="std std-ref">Could Use self</span></a>, in livezilla/_lib/objects.global.users.inc.php:1599.</p>
<p>Using self makes it obvious that Operator::GetSystemId() is a local call, while Communication::GetParameter() is external.</p>
<div class="highlight-php notranslate"><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">Operator</span> <span class="k">extends</span> <span class="nx">BaseUser</span>
<span class="p">{</span>
    <span class="k">static</span> <span class="k">function</span> <span class="nf">ReadParams</span><span class="p">()</span>
    <span class="p">{</span>
        <span class="k">if</span><span class="p">(</span><span class="o">!</span><span class="k">empty</span><span class="p">(</span><span class="nv">$_POST</span><span class="p">[</span><span class="nx">POST_EXTERN_REQUESTED_INTERNID</span><span class="p">]))</span>
            <span class="k">return</span> <span class="nx">Communication</span><span class="o">::</span><span class="na">GetParameter</span><span class="p">(</span><span class="nx">POST_EXTERN_REQUESTED_INTERNID</span><span class="p">,,</span><span class="nv">$c</span><span class="p">,</span><span class="nx">FILTER_SANITIZE_SPECIAL_CHARS</span><span class="p">,</span><span class="k">null</span><span class="p">,</span><span class="mi">32</span><span class="p">);</span>
        <span class="k">else</span> <span class="k">if</span><span class="p">(</span><span class="o">!</span><span class="k">empty</span><span class="p">(</span><span class="nv">$_GET</span><span class="p">[</span><span class="nx">operator</span><span class="p">]))</span>
        <span class="p">{</span>
            <span class="nv">$userid</span> <span class="o">=</span> <span class="nx">Communication</span><span class="o">::</span><span class="na">GetParameter</span><span class="p">(</span><span class="nx">operator</span><span class="p">,,</span><span class="nv">$c</span><span class="p">,</span><span class="nx">FILTER_SANITIZE_SPECIAL_CHARS</span><span class="p">,</span><span class="k">null</span><span class="p">,</span><span class="mi">32</span><span class="p">,</span><span class="k">false</span><span class="p">,</span><span class="k">false</span><span class="p">);</span>
            <span class="nv">$sysid</span> <span class="o">=</span> <span class="nx">Operator</span><span class="o">::</span><span class="na">GetSystemId</span><span class="p">(</span><span class="nv">$userid</span><span class="p">);</span>
<span class="p">}</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="static-methods-can-t-contain-this">
<span id="case-static-methods-can-t-contain-this"></span><h3><span class="section-number">5.2.33. </span>Static Methods Can’t Contain $this<a class="headerlink" href="#static-methods-can-t-contain-this" title="Permalink to this headline">¶</a></h3>
<div class="section" id="case-xataface-classes-staticcontainsthis">
<span id="id22"></span><h4><span class="section-number">5.2.33.1. </span>xataface<a class="headerlink" href="#case-xataface-classes-staticcontainsthis" title="Permalink to this headline">¶</a></h4>
<p><a class="reference internal" href="Rules.html#static-methods-can-t-contain-this"><span class="std std-ref">Static Methods Can’t Contain $this</span></a>, in Dataface/LanguageTool.php:48.</p>
<p>$this is hidden in the arguments of the static call to the method.</p>
<div class="highlight-php notranslate"><div class="highlight"><pre><span></span><span class="k">public</span> <span class="k">static</span> <span class="k">function</span> <span class="nf">loadRealm</span><span class="p">(</span><span class="nv">$name</span><span class="p">){</span>
            <span class="k">return</span> <span class="nx">self</span><span class="o">::</span><span class="na">getInstance</span><span class="p">(</span><span class="nv">$this</span><span class="o">-&gt;</span><span class="na">app</span><span class="o">-&gt;</span><span class="na">_conf</span><span class="p">[</span><span class="s1">&#39;default_language&#39;</span><span class="p">])</span><span class="o">-&gt;</span><span class="na">loadRealm</span><span class="p">(</span><span class="nv">$name</span><span class="p">);</span>
    <span class="p">}</span>
</pre></div>
</div>
</div>
<div class="section" id="case-sugarcrm-classes-staticcontainsthis">
<span id="id23"></span><h4><span class="section-number">5.2.33.2. </span>SugarCrm<a class="headerlink" href="#case-sugarcrm-classes-staticcontainsthis" title="Permalink to this headline">¶</a></h4>
<p><a class="reference internal" href="Rules.html#static-methods-can-t-contain-this"><span class="std std-ref">Static Methods Can’t Contain $this</span></a>, in SugarCE-Full-6.5.26/modules/ACLActions/ACLAction.php:332.</p>
<p>Notice how $this is tested for existence before using it. It seems strange, at first, but we have to remember that if $this is never set when calling a static method, a static method may be called with $this. Confusingly, this static method may be called in two ways.</p>
<div class="highlight-php notranslate"><div class="highlight"><pre><span></span><span class="k">static</span> <span class="k">function</span> <span class="nf">hasAccess</span><span class="p">(</span><span class="nv">$is_owner</span><span class="o">=</span><span class="k">false</span><span class="p">,</span> <span class="nv">$access</span> <span class="o">=</span> <span class="mi">0</span><span class="p">){</span>

        <span class="k">if</span><span class="p">(</span><span class="nv">$access</span> <span class="o">!=</span> <span class="mi">0</span> <span class="o">&amp;&amp;</span> <span class="nv">$access</span> <span class="o">==</span> <span class="nx">ACL_ALLOW_ALL</span> <span class="o">||</span> <span class="p">(</span><span class="nv">$is_owner</span> <span class="o">&amp;&amp;</span> <span class="nv">$access</span> <span class="o">==</span> <span class="nx">ACL_ALLOW_OWNER</span><span class="p">))</span><span class="k">return</span> <span class="k">true</span><span class="p">;</span>
       <span class="c1">//if this exists, then this function is not static, so check the aclaccess parameter</span>
        <span class="k">if</span><span class="p">(</span><span class="nb">isset</span><span class="p">(</span><span class="nv">$this</span><span class="p">)</span> <span class="o">&amp;&amp;</span> <span class="nb">isset</span><span class="p">(</span><span class="nv">$this</span><span class="o">-&gt;</span><span class="na">aclaccess</span><span class="p">)){</span>
            <span class="k">if</span><span class="p">(</span><span class="nv">$this</span><span class="o">-&gt;</span><span class="na">aclaccess</span> <span class="o">==</span> <span class="nx">ACL_ALLOW_ALL</span> <span class="o">||</span> <span class="p">(</span><span class="nv">$is_owner</span> <span class="o">&amp;&amp;</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">aclaccess</span> <span class="o">==</span> <span class="nx">ACL_ALLOW_OWNER</span><span class="p">))</span>
            <span class="k">return</span> <span class="k">true</span><span class="p">;</span>
        <span class="p">}</span>
        <span class="k">return</span> <span class="k">false</span><span class="p">;</span>
    <span class="p">}</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="this-belongs-to-classes-or-traits">
<span id="case-this-belongs-to-classes-or-traits"></span><h3><span class="section-number">5.2.34. </span>$this Belongs To Classes Or Traits<a class="headerlink" href="#this-belongs-to-classes-or-traits" title="Permalink to this headline">¶</a></h3>
<div class="section" id="openemr">
<span id="case-openemr-classes-thisisforclasses"></span><h4><span class="section-number">5.2.34.1. </span>OpenEMR<a class="headerlink" href="#openemr" title="Permalink to this headline">¶</a></h4>
<p><a class="reference internal" href="Rules.html#this-belongs-to-classes-or-traits"><span class="std std-ref">$this Belongs To Classes Or Traits</span></a>, in ccr/display.php:24.</p>
<p>$this is used to call the document_upload_download_log() method, although this piece of code is not part of a class, nor is included in a class.</p>
<div class="highlight-php notranslate"><div class="highlight"><pre><span></span><span class="o">&lt;?</span><span class="nx">php</span>
<span class="k">require_once</span><span class="p">(</span><span class="nb">dirname</span><span class="p">(</span><span class="no">__FILE__</span><span class="p">)</span> <span class="o">.</span> <span class="s2">&quot;/../interface/globals.php&quot;</span><span class="p">);</span>

<span class="nv">$type</span> <span class="o">=</span> <span class="nv">$_GET</span><span class="p">[</span><span class="s1">&#39;type&#39;</span><span class="p">];</span>
<span class="nv">$document_id</span> <span class="o">=</span> <span class="nv">$_GET</span><span class="p">[</span><span class="s1">&#39;doc_id&#39;</span><span class="p">];</span>
<span class="nv">$d</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Document</span><span class="p">(</span><span class="nv">$document_id</span><span class="p">);</span>
<span class="nv">$url</span> <span class="o">=</span>  <span class="nv">$d</span><span class="o">-&gt;</span><span class="na">get_url</span><span class="p">();</span>
<span class="nv">$storagemethod</span> <span class="o">=</span> <span class="nv">$d</span><span class="o">-&gt;</span><span class="na">get_storagemethod</span><span class="p">();</span>
<span class="nv">$couch_docid</span> <span class="o">=</span> <span class="nv">$d</span><span class="o">-&gt;</span><span class="na">get_couch_docid</span><span class="p">();</span>
<span class="nv">$couch_revid</span> <span class="o">=</span> <span class="nv">$d</span><span class="o">-&gt;</span><span class="na">get_couch_revid</span><span class="p">();</span>

<span class="k">if</span> <span class="p">(</span><span class="nv">$couch_docid</span> <span class="o">&amp;&amp;</span> <span class="nv">$couch_revid</span><span class="p">)</span> <span class="p">{</span>
    <span class="nv">$couch</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">CouchDB</span><span class="p">();</span>
    <span class="nv">$data</span> <span class="o">=</span> <span class="k">array</span><span class="p">(</span><span class="nv">$GLOBALS</span><span class="p">[</span><span class="s1">&#39;couchdb_dbase&#39;</span><span class="p">],</span><span class="nv">$couch_docid</span><span class="p">);</span>
    <span class="nv">$resp</span> <span class="o">=</span> <span class="nv">$couch</span><span class="o">-&gt;</span><span class="na">retrieve_doc</span><span class="p">(</span><span class="nv">$data</span><span class="p">);</span>
    <span class="nv">$xml</span> <span class="o">=</span> <span class="nb">base64_decode</span><span class="p">(</span><span class="nv">$resp</span><span class="o">-&gt;</span><span class="na">data</span><span class="p">);</span>
    <span class="k">if</span> <span class="p">(</span><span class="nv">$content</span><span class="o">==</span><span class="s1">&#39;&#39;</span> <span class="o">&amp;&amp;</span> <span class="nv">$GLOBALS</span><span class="p">[</span><span class="s1">&#39;couchdb_log&#39;</span><span class="p">]</span><span class="o">==</span><span class="mi">1</span><span class="p">)</span> <span class="p">{</span>
        <span class="nv">$log_content</span> <span class="o">=</span> <span class="nb">date</span><span class="p">(</span><span class="s1">&#39;Y-m-d H:i:s&#39;</span><span class="p">)</span><span class="o">.</span><span class="s2">&quot; ==&gt; Retrieving document</span><span class="se">\r\n</span><span class="s2">&quot;</span><span class="p">;</span>
        <span class="nv">$log_content</span> <span class="o">=</span> <span class="nb">date</span><span class="p">(</span><span class="s1">&#39;Y-m-d H:i:s&#39;</span><span class="p">)</span><span class="o">.</span><span class="s2">&quot; ==&gt; URL: &quot;</span><span class="o">.</span><span class="nv">$url</span><span class="o">.</span><span class="s2">&quot;</span><span class="se">\r\n</span><span class="s2">&quot;</span><span class="p">;</span>
        <span class="nv">$log_content</span> <span class="o">.=</span> <span class="nb">date</span><span class="p">(</span><span class="s1">&#39;Y-m-d H:i:s&#39;</span><span class="p">)</span><span class="o">.</span><span class="s2">&quot; ==&gt; CouchDB Document Id: &quot;</span><span class="o">.</span><span class="nv">$couch_docid</span><span class="o">.</span><span class="s2">&quot;</span><span class="se">\r\n</span><span class="s2">&quot;</span><span class="p">;</span>
        <span class="nv">$log_content</span> <span class="o">.=</span> <span class="nb">date</span><span class="p">(</span><span class="s1">&#39;Y-m-d H:i:s&#39;</span><span class="p">)</span><span class="o">.</span><span class="s2">&quot; ==&gt; CouchDB Revision Id: &quot;</span><span class="o">.</span><span class="nv">$couch_revid</span><span class="o">.</span><span class="s2">&quot;</span><span class="se">\r\n</span><span class="s2">&quot;</span><span class="p">;</span>
        <span class="nv">$log_content</span> <span class="o">.=</span> <span class="nb">date</span><span class="p">(</span><span class="s1">&#39;Y-m-d H:i:s&#39;</span><span class="p">)</span><span class="o">.</span><span class="s2">&quot; ==&gt; Failed to fetch document content from CouchDB.</span><span class="se">\r\n</span><span class="s2">&quot;</span><span class="p">;</span>
        <span class="c1">//$log_content .= date(&#39;Y-m-d H:i:s&#39;).&quot; ==&gt; Will try to download file from HardDisk if exists.\r\n\r\n&quot;;</span>
        <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">document_upload_download_log</span><span class="p">(</span><span class="nv">$d</span><span class="o">-&gt;</span><span class="na">get_foreign_id</span><span class="p">(),</span> <span class="nv">$log_content</span><span class="p">);</span>
        <span class="k">die</span><span class="p">(</span><span class="nx">xlt</span><span class="p">(</span><span class="s2">&quot;File retrieval from CouchDB failed&quot;</span><span class="p">));</span>
    <span class="p">}</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="too-many-children">
<span id="case-too-many-children"></span><h3><span class="section-number">5.2.35. </span>Too Many Children<a class="headerlink" href="#too-many-children" title="Permalink to this headline">¶</a></h3>
<div class="section" id="case-typo3-classes-toomanychildren">
<span id="id24"></span><h4><span class="section-number">5.2.35.1. </span>Typo3<a class="headerlink" href="#case-typo3-classes-toomanychildren" title="Permalink to this headline">¶</a></h4>
<p><a class="reference internal" href="Rules.html#too-many-children"><span class="std std-ref">Too Many Children</span></a>, in typo3/sysext/backend/Classes/Form/AbstractNode.php:26.</p>
<p>More than 15 children for this class : 15 is the default configuration.</p>
<div class="highlight-php notranslate"><div class="highlight"><pre><span></span><span class="k">abstract</span> <span class="k">class</span> <span class="nc">AbstractNode</span> <span class="k">implements</span> <span class="nx">NodeInterface</span><span class="p">,</span> <span class="nx">LoggerAwareInterface</span> <span class="p">{</span>
</pre></div>
</div>
</div>
<div class="section" id="case-woocommerce-classes-toomanychildren">
<span id="id25"></span><h4><span class="section-number">5.2.35.2. </span>Woocommerce<a class="headerlink" href="#case-woocommerce-classes-toomanychildren" title="Permalink to this headline">¶</a></h4>
<p><a class="reference internal" href="Rules.html#too-many-children"><span class="std std-ref">Too Many Children</span></a>, in includes/abstracts/abstract-wc-rest-controller.php:30.</p>
<p>This class is extended 22 times, more than the default configuration of 15.</p>
<div class="highlight-php notranslate"><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">WC_REST_Controller</span> <span class="k">extends</span> <span class="nx">WP_REST_Controller</span> <span class="p">{</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="too-many-injections">
<span id="case-too-many-injections"></span><h3><span class="section-number">5.2.36. </span>Too Many Injections<a class="headerlink" href="#too-many-injections" title="Permalink to this headline">¶</a></h3>
<div class="section" id="case-nextcloud-classes-toomanyinjections">
<span id="id26"></span><h4><span class="section-number">5.2.36.1. </span>NextCloud<a class="headerlink" href="#case-nextcloud-classes-toomanyinjections" title="Permalink to this headline">¶</a></h4>
<p><a class="reference internal" href="Rules.html#too-many-injections"><span class="std std-ref">Too Many Injections</span></a>, in lib/private/Share20/Manager.php:130.</p>
<p>Well documented Manager class. Quite a lot of injections though, it must take a long time to prepare it.</p>
<div class="highlight-php notranslate"><div class="highlight"><pre><span></span><span class="sd">/**</span>
<span class="sd">     * Manager constructor.</span>
<span class="sd">     *</span>
<span class="sd">     * @param ILogger $logger</span>
<span class="sd">     * @param IConfig $config</span>
<span class="sd">     * @param ISecureRandom $secureRandom</span>
<span class="sd">     * @param IHasher $hasher</span>
<span class="sd">     * @param IMountManager $mountManager</span>
<span class="sd">     * @param IGroupManager $groupManager</span>
<span class="sd">     * @param IL10N $l</span>
<span class="sd">     * @param IFactory $l10nFactory</span>
<span class="sd">     * @param IProviderFactory $factory</span>
<span class="sd">     * @param IUserManager $userManager</span>
<span class="sd">     * @param IRootFolder $rootFolder</span>
<span class="sd">     * @param EventDispatcher $eventDispatcher</span>
<span class="sd">     * @param IMailer $mailer</span>
<span class="sd">     * @param IURLGenerator $urlGenerator</span>
<span class="sd">     * @param \OC_Defaults $defaults</span>
<span class="sd">     */</span>
    <span class="k">public</span> <span class="k">function</span> <span class="fm">__construct</span><span class="p">(</span>
                    <span class="nx">ILogger</span> <span class="nv">$logger</span><span class="p">,</span>
                    <span class="nx">IConfig</span> <span class="nv">$config</span><span class="p">,</span>
                    <span class="nx">ISecureRandom</span> <span class="nv">$secureRandom</span><span class="p">,</span>
                    <span class="nx">IHasher</span> <span class="nv">$hasher</span><span class="p">,</span>
                    <span class="nx">IMountManager</span> <span class="nv">$mountManager</span><span class="p">,</span>
                    <span class="nx">IGroupManager</span> <span class="nv">$groupManager</span><span class="p">,</span>
                    <span class="nx">IL10N</span> <span class="nv">$l</span><span class="p">,</span>
                    <span class="nx">IFactory</span> <span class="nv">$l10nFactory</span><span class="p">,</span>
                    <span class="nx">IProviderFactory</span> <span class="nv">$factory</span><span class="p">,</span>
                    <span class="nx">IUserManager</span> <span class="nv">$userManager</span><span class="p">,</span>
                    <span class="nx">IRootFolder</span> <span class="nv">$rootFolder</span><span class="p">,</span>
                    <span class="nx">EventDispatcher</span> <span class="nv">$eventDispatcher</span><span class="p">,</span>
                    <span class="nx">IMailer</span> <span class="nv">$mailer</span><span class="p">,</span>
                    <span class="nx">IURLGenerator</span> <span class="nv">$urlGenerator</span><span class="p">,</span>
                    <span class="nx">\OC_Defaults</span> <span class="nv">$defaults</span>
    <span class="p">)</span> <span class="p">{</span>
            <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">logger</span> <span class="o">=</span> <span class="nv">$logger</span><span class="p">;</span>
            <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">config</span> <span class="o">=</span> <span class="nv">$config</span><span class="p">;</span>
            <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">secureRandom</span> <span class="o">=</span> <span class="nv">$secureRandom</span><span class="p">;</span>
            <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">hasher</span> <span class="o">=</span> <span class="nv">$hasher</span><span class="p">;</span>
            <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">mountManager</span> <span class="o">=</span> <span class="nv">$mountManager</span><span class="p">;</span>
            <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">groupManager</span> <span class="o">=</span> <span class="nv">$groupManager</span><span class="p">;</span>
            <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">l</span> <span class="o">=</span> <span class="nv">$l</span><span class="p">;</span>
            <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">l10nFactory</span> <span class="o">=</span> <span class="nv">$l10nFactory</span><span class="p">;</span>
            <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">factory</span> <span class="o">=</span> <span class="nv">$factory</span><span class="p">;</span>
            <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">userManager</span> <span class="o">=</span> <span class="nv">$userManager</span><span class="p">;</span>
            <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">rootFolder</span> <span class="o">=</span> <span class="nv">$rootFolder</span><span class="p">;</span>
            <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">eventDispatcher</span> <span class="o">=</span> <span class="nv">$eventDispatcher</span><span class="p">;</span>
            <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">sharingDisabledForUsersCache</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">CappedMemoryCache</span><span class="p">();</span>
            <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">legacyHooks</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">LegacyHooks</span><span class="p">(</span><span class="nv">$this</span><span class="o">-&gt;</span><span class="na">eventDispatcher</span><span class="p">);</span>
            <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">mailer</span> <span class="o">=</span> <span class="nv">$mailer</span><span class="p">;</span>
            <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">urlGenerator</span> <span class="o">=</span> <span class="nv">$urlGenerator</span><span class="p">;</span>
            <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">defaults</span> <span class="o">=</span> <span class="nv">$defaults</span><span class="p">;</span>
    <span class="p">}</span>
</pre></div>
</div>
</div>
<div class="section" id="case-thelia-classes-toomanyinjections">
<span id="id27"></span><h4><span class="section-number">5.2.36.2. </span>Thelia<a class="headerlink" href="#case-thelia-classes-toomanyinjections" title="Permalink to this headline">¶</a></h4>
<p><a class="reference internal" href="Rules.html#too-many-injections"><span class="std std-ref">Too Many Injections</span></a>, in core/lib/Thelia/Core/Event/Delivery/DeliveryPostageEvent.php:58.</p>
<p>Classic address class, with every details. May be even shorter than expected.</p>
<div class="highlight-php notranslate"><div class="highlight"><pre><span></span><span class="c1">//class DeliveryPostageEvent extends ActionEvent</span>
    <span class="k">public</span> <span class="k">function</span> <span class="fm">__construct</span><span class="p">(</span>
        <span class="nx">DeliveryModuleInterface</span> <span class="nv">$module</span><span class="p">,</span>
        <span class="nx">Cart</span> <span class="nv">$cart</span><span class="p">,</span>
        <span class="nx">Address</span> <span class="nv">$address</span> <span class="o">=</span> <span class="k">null</span><span class="p">,</span>
        <span class="nx">Country</span> <span class="nv">$country</span> <span class="o">=</span> <span class="k">null</span><span class="p">,</span>
        <span class="nx">State</span> <span class="nv">$state</span> <span class="o">=</span> <span class="k">null</span>
    <span class="p">)</span> <span class="p">{</span>
        <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">module</span> <span class="o">=</span> <span class="nv">$module</span><span class="p">;</span>
        <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">cart</span> <span class="o">=</span> <span class="nv">$cart</span><span class="p">;</span>
        <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">address</span> <span class="o">=</span> <span class="nv">$address</span><span class="p">;</span>
        <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">country</span> <span class="o">=</span> <span class="nv">$country</span><span class="p">;</span>
        <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">state</span> <span class="o">=</span> <span class="nv">$state</span><span class="p">;</span>
    <span class="p">}</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="wrong-access-style-to-property">
<span id="case-wrong-access-style-to-property"></span><h3><span class="section-number">5.2.37. </span>Wrong Access Style to Property<a class="headerlink" href="#wrong-access-style-to-property" title="Permalink to this headline">¶</a></h3>
<div class="section" id="humo-gen">
<span id="case-humo-gen-classes-undeclaredstaticproperty"></span><h4><span class="section-number">5.2.37.1. </span>HuMo-Gen<a class="headerlink" href="#humo-gen" title="Permalink to this headline">¶</a></h4>
<p><a class="reference internal" href="Rules.html#wrong-access-style-to-property"><span class="std std-ref">Wrong Access Style to Property</span></a>, in wp-admin/includes/misc.php:74.</p>
<p>lame_binary_path is a static property, but it is accessed as a normal property in the exception call, while it is checked with a valid syntax.</p>
<div class="highlight-php notranslate"><div class="highlight"><pre><span></span><span class="k">protected</span> <span class="k">function</span> <span class="nf">wavToMp3</span><span class="p">(</span><span class="nv">$data</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nb">file_exists</span><span class="p">(</span><span class="nx">self</span><span class="o">::</span><span class="nv">$lame_binary_path</span><span class="p">)</span> <span class="o">||</span> <span class="o">!</span><span class="nb">is_executable</span><span class="p">(</span><span class="nx">self</span><span class="o">::</span><span class="nv">$lame_binary_path</span><span class="p">))</span> <span class="p">{</span>
            <span class="k">throw</span> <span class="k">new</span> <span class="nx">Exception</span><span class="p">(</span><span class="s1">&#39;Lame binary  . $this-&gt;lame_binary_path .  does not exist or is not executable&#39;</span><span class="p">);</span>
        <span class="p">}</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="undefined-properties">
<span id="case-undefined-properties"></span><h3><span class="section-number">5.2.38. </span>Undefined Properties<a class="headerlink" href="#undefined-properties" title="Permalink to this headline">¶</a></h3>
<div class="section" id="case-wordpress-classes-undefinedproperty">
<span id="id28"></span><h4><span class="section-number">5.2.38.1. </span>WordPress<a class="headerlink" href="#case-wordpress-classes-undefinedproperty" title="Permalink to this headline">¶</a></h4>
<p><a class="reference internal" href="Rules.html#undefined-properties"><span class="std std-ref">Undefined Properties</span></a>, in wp-admin/includes/misc.php:74.</p>
<p>Properties are not defined, but they are thoroughly initialized when the XML document is parsed. All those definition should be in a property definition, for clear documentation.</p>
<div class="highlight-php notranslate"><div class="highlight"><pre><span></span><span class="nv">$this</span><span class="o">-&gt;</span><span class="na">DeliveryLine1</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span><span class="p">;</span>
        <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">DeliveryLine2</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span><span class="p">;</span>
        <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">City</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span><span class="p">;</span>
        <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">State</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span><span class="p">;</span>
        <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">ZipAddon</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span><span class="p">;</span>
</pre></div>
</div>
</div>
<div class="section" id="case-mediawiki-classes-undefinedproperty">
<span id="id29"></span><h4><span class="section-number">5.2.38.2. </span>MediaWiki<a class="headerlink" href="#case-mediawiki-classes-undefinedproperty" title="Permalink to this headline">¶</a></h4>
<p><a class="reference internal" href="Rules.html#undefined-properties"><span class="std std-ref">Undefined Properties</span></a>, in includes/logging/LogFormatter.php:561.</p>
<p>parsedParametersDeleteLog is an undefined property. Defining the property with a null default value is important here, to keep the code running.</p>
<div class="highlight-php notranslate"><div class="highlight"><pre><span></span><span class="k">protected</span> <span class="k">function</span> <span class="nf">getMessageParameters</span><span class="p">()</span> <span class="p">{</span>
            <span class="k">if</span> <span class="p">(</span> <span class="nb">isset</span><span class="p">(</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">parsedParametersDeleteLog</span> <span class="p">)</span> <span class="p">)</span> <span class="p">{</span>
                    <span class="k">return</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">parsedParametersDeleteLog</span><span class="p">;</span>
            <span class="p">}</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="undefined-static-or-self">
<span id="case-undefined-static-or-self"></span><h3><span class="section-number">5.2.39. </span>Undefined static:: Or self::<a class="headerlink" href="#undefined-static-or-self" title="Permalink to this headline">¶</a></h3>
<div class="section" id="case-xataface-classes-undefinedstaticmp">
<span id="id30"></span><h4><span class="section-number">5.2.39.1. </span>xataface<a class="headerlink" href="#case-xataface-classes-undefinedstaticmp" title="Permalink to this headline">¶</a></h4>
<p><a class="reference internal" href="Rules.html#undefined-static-or-self"><span class="std std-ref">Undefined static:: Or self::</span></a>, in actions/forgot_password.php:194.</p>
<p>This is probably a typo, since the property called      public static $EX_NO_USERS_WITH_EMAIL = 501; is defined in that class.</p>
<div class="highlight-php notranslate"><div class="highlight"><pre><span></span><span class="k">if</span> <span class="p">(</span> <span class="o">!</span><span class="nv">$user</span> <span class="p">)</span> <span class="k">throw</span> <span class="k">new</span> <span class="nx">Exception</span><span class="p">(</span><span class="nx">df_translate</span><span class="p">(</span><span class="s1">&#39;actions.forgot_password.null_user&#39;</span><span class="p">,</span><span class="s2">&quot;Cannot send email for null user&quot;</span><span class="p">),</span> <span class="nx">self</span><span class="o">::</span><span class="nv">$EX_NO_USERS_FOUND_WITH_EMAIL</span><span class="p">);</span>
</pre></div>
</div>
</div>
<div class="section" id="case-sugarcrm-classes-undefinedstaticmp">
<span id="id31"></span><h4><span class="section-number">5.2.39.2. </span>SugarCrm<a class="headerlink" href="#case-sugarcrm-classes-undefinedstaticmp" title="Permalink to this headline">¶</a></h4>
<p><a class="reference internal" href="Rules.html#undefined-static-or-self"><span class="std std-ref">Undefined static:: Or self::</span></a>, in code/SugarCE-Full-6.5.26/include/SugarDateTime.php:574.</p>
<p>self::$sugar_strptime_long_mon refers to the current class, which extends DateTime. No static property was defined at either of them, with the name ‘$sugar_strptime_long_mon’. This has been a Fatal error at execution time since PHP 5.3, at least.</p>
<div class="highlight-php notranslate"><div class="highlight"><pre><span></span><span class="k">if</span> <span class="p">(</span> <span class="nb">isset</span><span class="p">(</span><span class="nv">$regexp</span><span class="p">[</span><span class="s1">&#39;positions&#39;</span><span class="p">][</span><span class="s1">&#39;F&#39;</span><span class="p">])</span> <span class="o">&amp;&amp;</span> <span class="o">!</span><span class="k">empty</span><span class="p">(</span><span class="nv">$dateparts</span><span class="p">[</span><span class="nv">$regexp</span><span class="p">[</span><span class="s1">&#39;positions&#39;</span><span class="p">][</span><span class="s1">&#39;F&#39;</span><span class="p">]]))</span> <span class="p">{</span>
               <span class="c1">// FIXME: locale?</span>
    <span class="nv">$mon</span> <span class="o">=</span> <span class="nv">$dateparts</span><span class="p">[</span><span class="nv">$regexp</span><span class="p">[</span><span class="s1">&#39;positions&#39;</span><span class="p">][</span><span class="s1">&#39;F&#39;</span><span class="p">]];</span>
    <span class="k">if</span><span class="p">(</span><span class="nb">isset</span><span class="p">(</span><span class="nx">self</span><span class="o">::</span><span class="nv">$sugar_strptime_long_mon</span><span class="p">[</span><span class="nv">$mon</span><span class="p">]))</span> <span class="p">{</span>
        <span class="nv">$data</span><span class="p">[</span><span class="s2">&quot;tm_mon&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="nx">self</span><span class="o">::</span><span class="nv">$sugar_strptime_long_mon</span><span class="p">[</span><span class="nv">$mon</span><span class="p">];</span>
    <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
        <span class="k">return</span> <span class="k">false</span><span class="p">;</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="unitialized-properties">
<span id="case-unitialized-properties"></span><h3><span class="section-number">5.2.40. </span>Unitialized Properties<a class="headerlink" href="#unitialized-properties" title="Permalink to this headline">¶</a></h3>
<div class="section" id="spip">
<span id="case-spip-classes-unitializedproperties"></span><h4><span class="section-number">5.2.40.1. </span>SPIP<a class="headerlink" href="#spip" title="Permalink to this headline">¶</a></h4>
<p><a class="reference internal" href="Rules.html#unitialized-properties"><span class="std std-ref">Unitialized Properties</span></a>, in ecrire/public/interfaces.php:584.</p>
<p>The class Critere (Criteria) has no method at all. When using a class as an array, to capture values, one of the advantage of the class is in the default values for the properties. In particular, the last property here, called $not, should be initialized with a false.</p>
<div class="highlight-php notranslate"><div class="highlight"><pre><span></span><span class="sd">/**</span>
<span class="sd"> * Description d&#39;un critère de boucle</span>
<span class="sd"> *</span>
<span class="sd"> * Sous-noeud de Boucle</span>
<span class="sd"> *</span>
<span class="sd"> * @package SPIP\Core\Compilateur\AST</span>
<span class="sd"> **/</span>
<span class="k">class</span> <span class="nc">Critere</span> <span class="p">{</span>
    <span class="sd">/**</span>
<span class="sd">     * Type de noeud</span>
<span class="sd">     *</span>
<span class="sd">     * @var string</span>
<span class="sd">     */</span>
    <span class="k">public</span> <span class="nv">$type</span> <span class="o">=</span> <span class="s1">&#39;critere&#39;</span><span class="p">;</span>

    <span class="sd">/**</span>
<span class="sd">     * Opérateur (&gt;, &lt;, &gt;=, IN, ...)</span>
<span class="sd">     *</span>
<span class="sd">     * @var null|string</span>
<span class="sd">     */</span>
    <span class="k">public</span> <span class="nv">$op</span><span class="p">;</span>

    <span class="sd">/**</span>
<span class="sd">     * Présence d&#39;une négation (truc !op valeur)</span>
<span class="sd">     *</span>
<span class="sd">     * @var null|string</span>
<span class="sd">     */</span>
    <span class="k">public</span> <span class="nv">$not</span><span class="p">;</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="unresolved-instanceof">
<span id="case-unresolved-instanceof"></span><h3><span class="section-number">5.2.41. </span>Unresolved Instanceof<a class="headerlink" href="#unresolved-instanceof" title="Permalink to this headline">¶</a></h3>
<div class="section" id="case-wordpress-classes-unresolvedinstanceof">
<span id="id32"></span><h4><span class="section-number">5.2.41.1. </span>WordPress<a class="headerlink" href="#case-wordpress-classes-unresolvedinstanceof" title="Permalink to this headline">¶</a></h4>
<p><a class="reference internal" href="Rules.html#unresolved-instanceof"><span class="std std-ref">Unresolved Instanceof</span></a>, in wp-admin/includes/misc.php:74.</p>
<p>This code actually loads the file, join it, then split it again. file() would be sufficient.</p>
<div class="highlight-php notranslate"><div class="highlight"><pre><span></span><span class="k">private</span> <span class="k">function</span> <span class="nf">resolveTag</span><span class="p">(</span><span class="nv">$match</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="nv">$tagReflector</span> <span class="o">=</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">createLinkOrSeeTagFromRegexMatch</span><span class="p">(</span><span class="nv">$match</span><span class="p">);</span>
        <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nv">$tagReflector</span> <span class="nx">instanceof</span> <span class="nx">Tag\SeeTag</span> <span class="o">&amp;&amp;</span> <span class="o">!</span><span class="nv">$tagReflector</span> <span class="nx">instanceof</span> <span class="nx">Tag\LinkTag</span><span class="p">)</span> <span class="p">{</span>
            <span class="k">return</span> <span class="nv">$match</span><span class="p">;</span>
        <span class="p">}</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="unused-private-properties">
<span id="case-unused-private-properties"></span><h3><span class="section-number">5.2.42. </span>Unused Private Properties<a class="headerlink" href="#unused-private-properties" title="Permalink to this headline">¶</a></h3>
<div class="section" id="case-openemr-classes-unusedprivateproperty">
<span id="id33"></span><h4><span class="section-number">5.2.42.1. </span>OpenEMR<a class="headerlink" href="#case-openemr-classes-unusedprivateproperty" title="Permalink to this headline">¶</a></h4>
<p><a class="reference internal" href="Rules.html#unused-private-properties"><span class="std std-ref">Unused Private Properties</span></a>, in entities/User.php:46.</p>
<p>This class has a long list of private properties. It also has an equally long (minus one) list of accessors, and a __toString() method which exposes all of them. $oNotes is the only one never mentionned anywhere.</p>
<div class="highlight-php notranslate"><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">User</span>
<span class="p">{</span>
    <span class="sd">/**</span>
<span class="sd">     * @Column(name=id, type=integer)</span>
<span class="sd">     * @GeneratedValue(strategy=AUTO)</span>
<span class="sd">     */</span>
    <span class="k">private</span> <span class="nv">$id</span><span class="p">;</span>

    <span class="sd">/**</span>
<span class="sd">     * @OneToMany(targetEntity=ONote, mappedBy=user)</span>
<span class="sd">     */</span>
    <span class="k">private</span> <span class="nv">$oNotes</span><span class="p">;</span>
</pre></div>
</div>
</div>
<div class="section" id="phpadsnew">
<span id="case-phpadsnew-classes-unusedprivateproperty"></span><h4><span class="section-number">5.2.42.2. </span>phpadsnew<a class="headerlink" href="#phpadsnew" title="Permalink to this headline">¶</a></h4>
<p><a class="reference internal" href="Rules.html#unused-private-properties"><span class="std std-ref">Unused Private Properties</span></a>, in lib/OA/Admin/UI/component/Form.php:23.</p>
<p>$dispatcher is never used anywhere.</p>
<div class="highlight-php notranslate"><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">OA_Admin_UI_Component_Form</span>
    <span class="k">extends</span> <span class="nx">HTML_QuickForm</span>
<span class="p">{</span>
    <span class="k">private</span> <span class="nv">$dispatcher</span><span class="p">;</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="use-class-operator">
<span id="case-use-class-operator"></span><h3><span class="section-number">5.2.43. </span>Use ::Class Operator<a class="headerlink" href="#use-class-operator" title="Permalink to this headline">¶</a></h3>
<div class="section" id="case-typo3-classes-useclassoperator">
<span id="id34"></span><h4><span class="section-number">5.2.43.1. </span>Typo3<a class="headerlink" href="#case-typo3-classes-useclassoperator" title="Permalink to this headline">¶</a></h4>
<p><a class="reference internal" href="Rules.html#use-class-operator"><span class="std std-ref">Use ::Class Operator</span></a>, in typo3/sysext/install/Configuration/ExtensionScanner/Php/ConstructorArgumentMatcher.php:4.</p>
<p><code class="docutils literal notranslate"><span class="pre">TYPO3\CMS\Core\Package\PackageManager</span></code> could be <code class="docutils literal notranslate"><span class="pre">TYPO3\CMS\Core\Package\PackageManager::class</span></code>.</p>
<div class="highlight-php notranslate"><div class="highlight"><pre><span></span><span class="k">return</span> <span class="p">[</span>
    <span class="s1">&#39;TYPO3\CMS\Core\Package\PackageManager&#39;</span> <span class="o">=&gt;</span> <span class="p">[</span>
        <span class="s1">&#39;required&#39;</span> <span class="o">=&gt;</span> <span class="p">[</span>
            <span class="s1">&#39;numberOfMandatoryArguments&#39;</span> <span class="o">=&gt;</span> <span class="mi">1</span><span class="p">,</span>
            <span class="s1">&#39;maximumNumberOfArguments&#39;</span> <span class="o">=&gt;</span> <span class="mi">1</span><span class="p">,</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="use-instanceof">
<span id="case-use-instanceof"></span><h3><span class="section-number">5.2.44. </span>Use Instanceof<a class="headerlink" href="#use-instanceof" title="Permalink to this headline">¶</a></h3>
<div class="section" id="teampass">
<span id="case-teampass-classes-useinstanceof"></span><h4><span class="section-number">5.2.44.1. </span>TeamPass<a class="headerlink" href="#teampass" title="Permalink to this headline">¶</a></h4>
<p><a class="reference internal" href="Rules.html#use-instanceof"><span class="std std-ref">Use Instanceof</span></a>, in includes/libraries/Database/Meekrodb/db.class.php:506.</p>
<p>In this code, <code class="docutils literal notranslate"><span class="pre">is_object()</span></code> and <code class="docutils literal notranslate"><span class="pre">instanceof</span></code> have the same basic : they both check that $ts is an object. In fact, <code class="docutils literal notranslate"><span class="pre">instanceof</span></code> is more precise, and give more information about the variable.</p>
<div class="highlight-php notranslate"><div class="highlight"><pre><span></span><span class="k">protected</span> <span class="k">function</span> <span class="nf">parseTS</span><span class="p">(</span><span class="nv">$ts</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">if</span> <span class="p">(</span><span class="nb">is_string</span><span class="p">(</span><span class="nv">$ts</span><span class="p">))</span> <span class="k">return</span> <span class="nb">date</span><span class="p">(</span><span class="s1">&#39;Y-m-d H:i:s&#39;</span><span class="p">,</span> <span class="nb">strtotime</span><span class="p">(</span><span class="nv">$ts</span><span class="p">));</span>
    <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="nb">is_object</span><span class="p">(</span><span class="nv">$ts</span><span class="p">)</span> <span class="o">&amp;&amp;</span> <span class="p">(</span><span class="nv">$ts</span> <span class="nx">instanceof</span> <span class="nx">DateTime</span><span class="p">))</span> <span class="k">return</span> <span class="nv">$ts</span><span class="o">-&gt;</span><span class="na">format</span><span class="p">(</span><span class="s1">&#39;Y-m-d H:i:s&#39;</span><span class="p">);</span>
  <span class="p">}</span>
</pre></div>
</div>
</div>
<div class="section" id="case-zencart-classes-useinstanceof">
<span id="id35"></span><h4><span class="section-number">5.2.44.2. </span>Zencart<a class="headerlink" href="#case-zencart-classes-useinstanceof" title="Permalink to this headline">¶</a></h4>
<p><a class="reference internal" href="Rules.html#use-instanceof"><span class="std std-ref">Use Instanceof</span></a>, in includes/modules/payment/firstdata_hco.php:104.</p>
<p>In this code, <code class="docutils literal notranslate"><span class="pre">is_object()</span></code> is used to check the status of the order. Possibly, $order is false or null in case of incompatible status. Yet, when $object is an object, and in particular being a global that may be assigned anywhere else in the code, it seems that the method ‘update_status’ is magically always available. Here, using instance of to make sure that $order is an ‘paypal’ class, or a ‘storepickup’ or any of the payment class.</p>
<div class="highlight-php notranslate"><div class="highlight"><pre><span></span><span class="k">function</span> <span class="fm">__construct</span><span class="p">()</span> <span class="p">{</span>
    <span class="k">global</span> <span class="nv">$order</span><span class="p">;</span>

    <span class="c1">// more lines, no mention of $order</span>
    <span class="k">if</span> <span class="p">(</span><span class="nb">is_object</span><span class="p">(</span><span class="nv">$order</span><span class="p">))</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">update_status</span><span class="p">();</span>

    <span class="c1">// more code</span>
<span class="p">}</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="weak-typing">
<span id="case-weak-typing"></span><h3><span class="section-number">5.2.45. </span>Weak Typing<a class="headerlink" href="#weak-typing" title="Permalink to this headline">¶</a></h3>
<div class="section" id="case-teampass-classes-weaktype">
<span id="id36"></span><h4><span class="section-number">5.2.45.1. </span>TeamPass<a class="headerlink" href="#case-teampass-classes-weaktype" title="Permalink to this headline">¶</a></h4>
<p><a class="reference internal" href="Rules.html#weak-typing"><span class="std std-ref">Weak Typing</span></a>, in includes/libraries/Tree/NestedTree/NestedTree.php:100.</p>
<p>The is_null() test detects a special situation, that requires usage of default values. The ‘else’ handles every other situations, including when the $node is an object, or anything else. $this-&gt;getNode() will gain from having typehints : it may be NULL, or the results of mysqli_fetch_object() : a stdClass object. The expected properties of nleft and nright are not certain to be available.</p>
<div class="highlight-php notranslate"><div class="highlight"><pre><span></span><span class="k">public</span> <span class="k">function</span> <span class="nf">getDescendants</span><span class="p">(</span><span class="nv">$id</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="nv">$includeSelf</span> <span class="o">=</span> <span class="k">false</span><span class="p">,</span> <span class="nv">$childrenOnly</span> <span class="o">=</span> <span class="k">false</span><span class="p">,</span> <span class="nv">$unique_id_list</span> <span class="o">=</span> <span class="k">false</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="k">global</span> <span class="nv">$link</span><span class="p">;</span>
        <span class="nv">$idField</span> <span class="o">=</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">fields</span><span class="p">[</span><span class="s1">&#39;id&#39;</span><span class="p">];</span>

        <span class="nv">$node</span> <span class="o">=</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">getNode</span><span class="p">(</span><span class="nv">$id</span><span class="p">);</span>
        <span class="k">if</span> <span class="p">(</span><span class="nb">is_null</span><span class="p">(</span><span class="nv">$node</span><span class="p">))</span> <span class="p">{</span>
            <span class="nv">$nleft</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
            <span class="nv">$nright</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
            <span class="nv">$parent_id</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
            <span class="nv">$personal_folder</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
        <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
            <span class="nv">$nleft</span> <span class="o">=</span> <span class="nv">$node</span><span class="o">-&gt;</span><span class="na">nleft</span><span class="p">;</span>
            <span class="nv">$nright</span> <span class="o">=</span> <span class="nv">$node</span><span class="o">-&gt;</span><span class="na">nright</span><span class="p">;</span>
            <span class="nv">$parent_id</span> <span class="o">=</span> <span class="nv">$node</span><span class="o">-&gt;</span><span class="nv">$idField</span><span class="p">;</span>
            <span class="nv">$personal_folder</span> <span class="o">=</span> <span class="nv">$node</span><span class="o">-&gt;</span><span class="na">personal_folder</span><span class="p">;</span>
        <span class="p">}</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="wrong-class-name-case">
<span id="case-wrong-class-name-case"></span><h3><span class="section-number">5.2.46. </span>Wrong Class Name Case<a class="headerlink" href="#wrong-class-name-case" title="Permalink to this headline">¶</a></h3>
<div class="section" id="case-wordpress-classes-wrongcase">
<span id="id37"></span><h4><span class="section-number">5.2.46.1. </span>WordPress<a class="headerlink" href="#case-wordpress-classes-wrongcase" title="Permalink to this headline">¶</a></h4>
<p><a class="reference internal" href="Rules.html#wrong-class-name-case"><span class="std std-ref">Wrong Class Name Case</span></a>, in wp-admin/includes/misc.php:74.</p>
<p>This code actually loads the file, join it, then split it again. file() would be sufficient.</p>
<div class="highlight-php notranslate"><div class="highlight"><pre><span></span><span class="nv">$markerdata</span> <span class="o">=</span> <span class="nb">explode</span><span class="p">(</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">,</span> <span class="nb">implode</span><span class="p">(</span> <span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="nb">file</span><span class="p">(</span> <span class="nv">$filename</span> <span class="p">)</span> <span class="p">)</span> <span class="p">);</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="illegal-name-for-method">
<span id="case-illegal-name-for-method"></span><h3><span class="section-number">5.2.47. </span>Illegal Name For Method<a class="headerlink" href="#illegal-name-for-method" title="Permalink to this headline">¶</a></h3>
<div class="section" id="case-prestashop-classes-wrongname">
<span id="id38"></span><h4><span class="section-number">5.2.47.1. </span>PrestaShop<a class="headerlink" href="#case-prestashop-classes-wrongname" title="Permalink to this headline">¶</a></h4>
<p><a class="reference internal" href="Rules.html#illegal-name-for-method"><span class="std std-ref">Illegal Name For Method</span></a>, in admin-dev/ajaxfilemanager/inc/class.pagination.php:200.</p>
<p>__getBaseUrl and __setBaseUrl shouldn’t be named like that.</p>
<div class="highlight-php notranslate"><div class="highlight"><pre><span></span><span class="sd">/**</span>
<span class="sd">     * get base url for pagination links aftr excluded those key</span>
<span class="sd">     * identified on excluded query strings</span>
<span class="sd">     *</span>
<span class="sd">     */</span>
    <span class="k">function</span> <span class="nf">__getBaseUrl</span><span class="p">()</span>
    <span class="p">{</span>

            <span class="k">if</span><span class="p">(</span><span class="k">empty</span><span class="p">(</span><span class="nv">$this</span><span class="o">-&gt;</span><span class="na">baseUrl</span><span class="p">))</span>
            <span class="p">{</span>

                    <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">__setBaseUrl</span><span class="p">();</span>
            <span class="p">}</span>
            <span class="k">return</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">baseUrl</span><span class="p">;</span>
    <span class="p">}</span>
</pre></div>
</div>
</div>
<div class="section" id="case-magento-classes-wrongname">
<span id="id39"></span><h4><span class="section-number">5.2.47.2. </span>Magento<a class="headerlink" href="#case-magento-classes-wrongname" title="Permalink to this headline">¶</a></h4>
<p><a class="reference internal" href="Rules.html#illegal-name-for-method"><span class="std std-ref">Illegal Name For Method</span></a>, in app/code/core/Mage/Core/Block/Abstract.php:1139.</p>
<p>public method, called ‘__’. Example : $this-&gt;__();</p>
<div class="highlight-php notranslate"><div class="highlight"><pre><span></span><span class="k">public</span> <span class="k">function</span> <span class="nf">__</span><span class="p">()</span>
    <span class="p">{</span>
        <span class="nv">$args</span> <span class="o">=</span> <span class="nb">func_get_args</span><span class="p">();</span>
        <span class="nv">$expr</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Mage_Core_Model_Translate_Expr</span><span class="p">(</span><span class="nb">array_shift</span><span class="p">(</span><span class="nv">$args</span><span class="p">),</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">getModuleName</span><span class="p">());</span>
        <span class="nb">array_unshift</span><span class="p">(</span><span class="nv">$args</span><span class="p">,</span> <span class="nv">$expr</span><span class="p">);</span>
        <span class="k">return</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">_getApp</span><span class="p">()</span><span class="o">-&gt;</span><span class="na">getTranslator</span><span class="p">()</span><span class="o">-&gt;</span><span class="na">translate</span><span class="p">(</span><span class="nv">$args</span><span class="p">);</span>
    <span class="p">}</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="bad-constants-names">
<span id="case-bad-constants-names"></span><h3><span class="section-number">5.2.48. </span>Bad Constants Names<a class="headerlink" href="#bad-constants-names" title="Permalink to this headline">¶</a></h3>
<div class="section" id="case-prestashop-constants-badconstantnames">
<span id="id40"></span><h4><span class="section-number">5.2.48.1. </span>PrestaShop<a class="headerlink" href="#case-prestashop-constants-badconstantnames" title="Permalink to this headline">¶</a></h4>
<p><a class="reference internal" href="Rules.html#bad-constants-names"><span class="std std-ref">Bad Constants Names</span></a>, in src/PrestaShopBundle/Install/Upgrade.php:214.</p>
<p>INSTALL_PATH is a valid name for a constant. __PS_BASE_URI__ is not a valid name.</p>
<div class="highlight-php notranslate"><div class="highlight"><pre><span></span><span class="k">require_once</span><span class="p">(</span><span class="nx">INSTALL_PATH</span> <span class="o">.</span> <span class="s1">&#39;install_version.php&#39;</span><span class="p">);</span>
            <span class="c1">// needed for upgrade before 1.5</span>
            <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nb">defined</span><span class="p">(</span><span class="s1">&#39;__PS_BASE_URI__&#39;</span><span class="p">))</span> <span class="p">{</span>
                <span class="nb">define</span><span class="p">(</span><span class="s1">&#39;__PS_BASE_URI__&#39;</span><span class="p">,</span> <span class="nb">str_replace</span><span class="p">(</span><span class="s1">&#39;//&#39;</span><span class="p">,</span> <span class="s1">&#39;/&#39;</span><span class="p">,</span> <span class="s1">&#39;/&#39;</span><span class="o">.</span><span class="nb">trim</span><span class="p">(</span><span class="nb">preg_replace</span><span class="p">(</span><span class="s1">&#39;#/(install(-dev)?/upgrade)$#&#39;</span><span class="p">,</span> <span class="s1">&#39;/&#39;</span><span class="p">,</span> <span class="nb">str_replace</span><span class="p">(</span><span class="s1">&#39;\&#39;, &#39;</span><span class="o">/</span><span class="s1">&#39;, dirname($_SERVER[&#39;</span><span class="nx">REQUEST_URI</span><span class="s1">&#39;]))), &#39;</span><span class="o">/</span><span class="s1">&#39;).&#39;</span><span class="o">/</span><span class="err">&#39;</span><span class="p">));</span>
            <span class="p">}</span>
</pre></div>
</div>
</div>
<div class="section" id="case-zencart-constants-badconstantnames">
<span id="id41"></span><h4><span class="section-number">5.2.48.2. </span>Zencart<a class="headerlink" href="#case-zencart-constants-badconstantnames" title="Permalink to this headline">¶</a></h4>
<p><a class="reference internal" href="Rules.html#bad-constants-names"><span class="std std-ref">Bad Constants Names</span></a>, in zc_install/ajaxTestDBConnection.php:10.</p>
<p>A case where PHP needs help : if the PHP version is older than 5.3, then it is valid to compensate. Though, this __DIR__ has a fixed value, wherever it is used, while the official __DIR__ change from dir to dir.</p>
<div class="highlight-php notranslate"><div class="highlight"><pre><span></span><span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nb">defined</span><span class="p">(</span><span class="s1">&#39;__DIR__&#39;</span><span class="p">))</span> <span class="nb">define</span><span class="p">(</span><span class="s1">&#39;__DIR__&#39;</span><span class="p">,</span> <span class="nb">dirname</span><span class="p">(</span><span class="no">__FILE__</span><span class="p">));</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="use-const">
<span id="case-use-const"></span><h3><span class="section-number">5.2.49. </span>Use const<a class="headerlink" href="#use-const" title="Permalink to this headline">¶</a></h3>
<div class="section" id="case-phpmyadmin-constants-constrecommended">
<span id="id42"></span><h4><span class="section-number">5.2.49.1. </span>phpMyAdmin<a class="headerlink" href="#case-phpmyadmin-constants-constrecommended" title="Permalink to this headline">¶</a></h4>
<p><a class="reference internal" href="Rules.html#use-const"><span class="std std-ref">Use const</span></a>, in error_report.php:17.</p>
<p>This may be turned into a <cite>const</cite> call, with a static expression.</p>
<div class="highlight-php notranslate"><div class="highlight"><pre><span></span><span class="nb">define</span><span class="p">(</span><span class="s1">&#39;ROOT_PATH&#39;</span><span class="p">,</span> <span class="no">__DIR__</span> <span class="o">.</span> <span class="nx">DIRECTORY_SEPARATOR</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="section" id="case-piwigo-constants-constrecommended">
<span id="id43"></span><h4><span class="section-number">5.2.49.2. </span>Piwigo<a class="headerlink" href="#case-piwigo-constants-constrecommended" title="Permalink to this headline">¶</a></h4>
<p><a class="reference internal" href="Rules.html#use-const"><span class="std std-ref">Use const</span></a>, in include/functions_plugins.inc.php:32.</p>
<p>Const works efficiently with literal</p>
<div class="highlight-php notranslate"><div class="highlight"><pre><span></span><span class="nb">define</span><span class="p">(</span><span class="s1">&#39;EVENT_HANDLER_PRIORITY_NEUTRAL&#39;</span><span class="p">,</span> <span class="mi">50</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="invalid-constant-name">
<span id="case-invalid-constant-name"></span><h3><span class="section-number">5.2.50. </span>Invalid Constant Name<a class="headerlink" href="#invalid-constant-name" title="Permalink to this headline">¶</a></h3>
<div class="section" id="case-openemr-constants-invalidname">
<span id="id44"></span><h4><span class="section-number">5.2.50.1. </span>OpenEMR<a class="headerlink" href="#case-openemr-constants-invalidname" title="Permalink to this headline">¶</a></h4>
<p><a class="reference internal" href="Rules.html#invalid-constant-name"><span class="std std-ref">Invalid Constant Name</span></a>, in library/classes/InsuranceCompany.class.php:20.</p>
<p>Either a copy/paste, or a generated definition file : the file contains 25 constants definition. The constant is not found in the rest of the code.</p>
<div class="highlight-php notranslate"><div class="highlight"><pre><span></span><span class="nb">define</span><span class="p">(</span><span class="s2">&quot;INS_TYPE_OTHER_NON-FEDERAL_PROGRAMS&quot;</span><span class="p">,</span> <span class="mi">10</span><span class="p">);</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="multiple-constant-definition">
<span id="case-multiple-constant-definition"></span><h3><span class="section-number">5.2.51. </span>Multiple Constant Definition<a class="headerlink" href="#multiple-constant-definition" title="Permalink to this headline">¶</a></h3>
<div class="section" id="case-dolibarr-constants-multipleconstantdefinition">
<span id="id45"></span><h4><span class="section-number">5.2.51.1. </span>Dolibarr<a class="headerlink" href="#case-dolibarr-constants-multipleconstantdefinition" title="Permalink to this headline">¶</a></h4>
<p><a class="reference internal" href="Rules.html#multiple-constant-definition"><span class="std std-ref">Multiple Constant Definition</span></a>, in htdocs/main.inc.php:914.</p>
<p>All is documented here : ‘Constants used to defined number of lines in textarea’. Constants are not changing during an execution, and this allows the script to set values early in the process, and have them used later, in the templates. Yet, building constants dynamically may lead to confusion, when developpers are not aware of the change.</p>
<div class="highlight-php notranslate"><div class="highlight"><pre><span></span><span class="c1">// Constants used to defined number of lines in textarea</span>
<span class="k">if</span> <span class="p">(</span><span class="k">empty</span><span class="p">(</span><span class="nv">$conf</span><span class="o">-&gt;</span><span class="na">browser</span><span class="o">-&gt;</span><span class="na">firefox</span><span class="p">))</span>
<span class="p">{</span>
    <span class="nb">define</span><span class="p">(</span><span class="s1">&#39;ROWS_1&#39;</span><span class="p">,</span><span class="mi">1</span><span class="p">);</span>
    <span class="nb">define</span><span class="p">(</span><span class="s1">&#39;ROWS_2&#39;</span><span class="p">,</span><span class="mi">2</span><span class="p">);</span>
    <span class="nb">define</span><span class="p">(</span><span class="s1">&#39;ROWS_3&#39;</span><span class="p">,</span><span class="mi">3</span><span class="p">);</span>
    <span class="nb">define</span><span class="p">(</span><span class="s1">&#39;ROWS_4&#39;</span><span class="p">,</span><span class="mi">4</span><span class="p">);</span>
    <span class="nb">define</span><span class="p">(</span><span class="s1">&#39;ROWS_5&#39;</span><span class="p">,</span><span class="mi">5</span><span class="p">);</span>
    <span class="nb">define</span><span class="p">(</span><span class="s1">&#39;ROWS_6&#39;</span><span class="p">,</span><span class="mi">6</span><span class="p">);</span>
    <span class="nb">define</span><span class="p">(</span><span class="s1">&#39;ROWS_7&#39;</span><span class="p">,</span><span class="mi">7</span><span class="p">);</span>
    <span class="nb">define</span><span class="p">(</span><span class="s1">&#39;ROWS_8&#39;</span><span class="p">,</span><span class="mi">8</span><span class="p">);</span>
    <span class="nb">define</span><span class="p">(</span><span class="s1">&#39;ROWS_9&#39;</span><span class="p">,</span><span class="mi">9</span><span class="p">);</span>
<span class="p">}</span>
<span class="k">else</span>
<span class="p">{</span>
    <span class="nb">define</span><span class="p">(</span><span class="s1">&#39;ROWS_1&#39;</span><span class="p">,</span><span class="mi">0</span><span class="p">);</span>
    <span class="nb">define</span><span class="p">(</span><span class="s1">&#39;ROWS_2&#39;</span><span class="p">,</span><span class="mi">1</span><span class="p">);</span>
    <span class="nb">define</span><span class="p">(</span><span class="s1">&#39;ROWS_3&#39;</span><span class="p">,</span><span class="mi">2</span><span class="p">);</span>
    <span class="nb">define</span><span class="p">(</span><span class="s1">&#39;ROWS_4&#39;</span><span class="p">,</span><span class="mi">3</span><span class="p">);</span>
    <span class="nb">define</span><span class="p">(</span><span class="s1">&#39;ROWS_5&#39;</span><span class="p">,</span><span class="mi">4</span><span class="p">);</span>
    <span class="nb">define</span><span class="p">(</span><span class="s1">&#39;ROWS_6&#39;</span><span class="p">,</span><span class="mi">5</span><span class="p">);</span>
    <span class="nb">define</span><span class="p">(</span><span class="s1">&#39;ROWS_7&#39;</span><span class="p">,</span><span class="mi">6</span><span class="p">);</span>
    <span class="nb">define</span><span class="p">(</span><span class="s1">&#39;ROWS_8&#39;</span><span class="p">,</span><span class="mi">7</span><span class="p">);</span>
    <span class="nb">define</span><span class="p">(</span><span class="s1">&#39;ROWS_9&#39;</span><span class="p">,</span><span class="mi">8</span><span class="p">);</span>
<span class="p">}</span>
</pre></div>
</div>
</div>
<div class="section" id="openconf">
<span id="case-openconf-constants-multipleconstantdefinition"></span><h4><span class="section-number">5.2.51.2. </span>OpenConf<a class="headerlink" href="#openconf" title="Permalink to this headline">¶</a></h4>
<p><a class="reference internal" href="Rules.html#multiple-constant-definition"><span class="std std-ref">Multiple Constant Definition</span></a>, in modules/request.php:71.</p>
<p>The constant is build according to the situation, in the part of the script (file request.php). This hides the actual origin of the value, but keeps the rest of the code simple. Just keep in mind that this constant may have different values.</p>
<div class="highlight-php notranslate"><div class="highlight"><pre><span></span><span class="k">if</span> <span class="p">(</span><span class="nb">isset</span><span class="p">(</span><span class="nv">$_GET</span><span class="p">[</span><span class="s1">&#39;ocparams&#39;</span><span class="p">])</span> <span class="o">&amp;&amp;</span> <span class="o">!</span><span class="k">empty</span><span class="p">(</span><span class="nv">$_GET</span><span class="p">[</span><span class="s1">&#39;ocparams&#39;</span><span class="p">]))</span> <span class="p">{</span>
            <span class="nv">$params</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span><span class="p">;</span>
            <span class="k">if</span> <span class="p">(</span><span class="nb">preg_match_all</span><span class="p">(</span><span class="s2">&quot;/(\w+)--(\w+)_-/&quot;</span><span class="p">,</span> <span class="nv">$_GET</span><span class="p">[</span><span class="s1">&#39;ocparams&#39;</span><span class="p">],</span> <span class="nv">$matches</span><span class="p">))</span> <span class="p">{</span>
                    <span class="k">foreach</span> <span class="p">(</span><span class="nv">$matches</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="k">as</span> <span class="nv">$idx</span> <span class="o">=&gt;</span> <span class="nv">$m</span><span class="p">)</span> <span class="p">{</span>
                            <span class="k">if</span> <span class="p">((</span><span class="nv">$m</span> <span class="o">!=</span> <span class="s1">&#39;module&#39;</span><span class="p">)</span> <span class="o">&amp;&amp;</span> <span class="p">(</span><span class="nv">$m</span> <span class="o">!=</span> <span class="s1">&#39;action&#39;</span><span class="p">)</span> <span class="o">&amp;&amp;</span> <span class="nb">preg_match</span><span class="p">(</span><span class="s2">&quot;/^[\w-]+$/&quot;</span><span class="p">,</span> <span class="nv">$m</span><span class="p">))</span> <span class="p">{</span>
                                    <span class="nv">$params</span> <span class="o">.=</span> <span class="s1">&#39;&amp;&#39;</span> <span class="o">.</span> <span class="nv">$m</span> <span class="o">.</span> <span class="s1">&#39;=&#39;</span> <span class="o">.</span> <span class="nb">urlencode</span><span class="p">(</span><span class="nv">$matches</span><span class="p">[</span><span class="mi">2</span><span class="p">][</span><span class="nv">$idx</span><span class="p">]);</span>
                                    <span class="nv">$_GET</span><span class="p">[</span><span class="nv">$m</span><span class="p">]</span> <span class="o">=</span> <span class="nv">$matches</span><span class="p">[</span><span class="mi">2</span><span class="p">][</span><span class="nv">$idx</span><span class="p">];</span>
                            <span class="p">}</span>
                    <span class="p">}</span>
            <span class="p">}</span>
            <span class="nb">unset</span><span class="p">(</span><span class="nv">$_GET</span><span class="p">[</span><span class="s1">&#39;ocparams&#39;</span><span class="p">]);</span>
            <span class="nb">define</span><span class="p">(</span><span class="s1">&#39;OCC_SELF&#39;</span><span class="p">,</span> <span class="nv">$_SERVER</span><span class="p">[</span><span class="s1">&#39;PHP_SELF&#39;</span><span class="p">]</span> <span class="o">.</span> <span class="s1">&#39;?module=&#39;</span> <span class="o">.</span> <span class="nv">$_REQUEST</span><span class="p">[</span><span class="s1">&#39;module&#39;</span><span class="p">]</span> <span class="o">.</span> <span class="s1">&#39;&amp;action=&#39;</span> <span class="o">.</span> <span class="nv">$_GET</span><span class="p">[</span><span class="s1">&#39;action&#39;</span><span class="p">]</span> <span class="o">.</span> <span class="nv">$params</span><span class="p">);</span>
    <span class="p">}</span> <span class="k">elseif</span> <span class="p">(</span><span class="nb">isset</span><span class="p">(</span><span class="nv">$_SERVER</span><span class="p">[</span><span class="s1">&#39;REQUEST_URI&#39;</span><span class="p">])</span> <span class="o">&amp;&amp;</span> <span class="nb">strstr</span><span class="p">(</span><span class="nv">$_SERVER</span><span class="p">[</span><span class="s1">&#39;REQUEST_URI&#39;</span><span class="p">],</span> <span class="s1">&#39;?&#39;</span><span class="p">))</span> <span class="p">{</span>
            <span class="nb">define</span><span class="p">(</span><span class="s1">&#39;OCC_SELF&#39;</span><span class="p">,</span> <span class="nb">htmlspecialchars</span><span class="p">(</span><span class="nv">$_SERVER</span><span class="p">[</span><span class="s1">&#39;REQUEST_URI&#39;</span><span class="p">]));</span>
    <span class="p">}</span> <span class="k">elseif</span> <span class="p">(</span><span class="nb">isset</span><span class="p">(</span><span class="nv">$_SERVER</span><span class="p">[</span><span class="s1">&#39;QUERY_STRING&#39;</span><span class="p">])</span> <span class="o">&amp;&amp;</span> <span class="nb">strstr</span><span class="p">(</span><span class="nv">$_SERVER</span><span class="p">[</span><span class="s1">&#39;QUERY_STRING&#39;</span><span class="p">],</span> <span class="s1">&#39;&amp;&#39;</span><span class="p">))</span> <span class="p">{</span>
            <span class="nb">define</span><span class="p">(</span><span class="s1">&#39;OCC_SELF&#39;</span><span class="p">,</span> <span class="nv">$_SERVER</span><span class="p">[</span><span class="s1">&#39;PHP_SELF&#39;</span><span class="p">]</span> <span class="o">.</span> <span class="s1">&#39;?&#39;</span> <span class="o">.</span> <span class="nb">htmlspecialchars</span><span class="p">(</span><span class="nv">$_SERVER</span><span class="p">[</span><span class="s1">&#39;QUERY_STRING&#39;</span><span class="p">]));</span>
    <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
            <span class="nx">err</span><span class="p">(</span><span class="s1">&#39;This server does not support REQUEST_URI or QUERY_STRING&#39;</span><span class="p">,</span><span class="s1">&#39;Error&#39;</span><span class="p">);</span>
    <span class="p">}</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="exception-order">
<span id="case-exception-order"></span><h3><span class="section-number">5.2.52. </span>Exception Order<a class="headerlink" href="#exception-order" title="Permalink to this headline">¶</a></h3>
<div class="section" id="case-woocommerce-exceptions-alreadycaught">
<span id="id46"></span><h4><span class="section-number">5.2.52.1. </span>Woocommerce<a class="headerlink" href="#case-woocommerce-exceptions-alreadycaught" title="Permalink to this headline">¶</a></h4>
<p><a class="reference internal" href="Rules.html#exception-order"><span class="std std-ref">Exception Order</span></a>, in includes/api/v1/class-wc-rest-products-controller.php:787.</p>
<p>This try/catch expression is able to catch both WC_Data_Exception and WC_REST_Exception.</p>
<p>In another file, /includes/api/class-wc-rest-exception.php, we find that WC_REST_Exception extends WC_Data_Exception (class WC_REST_Exception extends WC_Data_Exception {}). So WC_Data_Exception is more general, and a WC_REST_Exception exception is caught with WC_Data_Exception Exception. The second catch should be put in first.</p>
<p>This code actually loads the file, join it, then split it again. file() would be sufficient.</p>
<div class="highlight-php notranslate"><div class="highlight"><pre><span></span><span class="k">try</span> <span class="p">{</span>
                    <span class="nv">$product_id</span> <span class="o">=</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">save_product</span><span class="p">(</span> <span class="nv">$request</span> <span class="p">);</span>
                    <span class="nv">$post</span>       <span class="o">=</span> <span class="nx">get_post</span><span class="p">(</span> <span class="nv">$product_id</span> <span class="p">);</span>
                    <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">update_additional_fields_for_object</span><span class="p">(</span> <span class="nv">$post</span><span class="p">,</span> <span class="nv">$request</span> <span class="p">);</span>
                    <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">update_post_meta_fields</span><span class="p">(</span> <span class="nv">$post</span><span class="p">,</span> <span class="nv">$request</span> <span class="p">);</span>

                    <span class="sd">/**</span>
<span class="sd">                     * Fires after a single item is created or updated via the REST API.</span>
<span class="sd">                     *</span>
<span class="sd">                     * @param WP_Post         $post      Post data.</span>
<span class="sd">                     * @param WP_REST_Request $request   Request object.</span>
<span class="sd">                     * @param boolean         $creating  True when creating item, false when updating.</span>
<span class="sd">                     */</span>
                    <span class="nx">do_action</span><span class="p">(</span> <span class="s1">&#39;woocommerce_rest_insert_product&#39;</span><span class="p">,</span> <span class="nv">$post</span><span class="p">,</span> <span class="nv">$request</span><span class="p">,</span> <span class="k">false</span> <span class="p">);</span>
                    <span class="nv">$request</span><span class="o">-&gt;</span><span class="na">set_param</span><span class="p">(</span> <span class="s1">&#39;context&#39;</span><span class="p">,</span> <span class="s1">&#39;edit&#39;</span> <span class="p">);</span>
                    <span class="nv">$response</span> <span class="o">=</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">prepare_item_for_response</span><span class="p">(</span> <span class="nv">$post</span><span class="p">,</span> <span class="nv">$request</span> <span class="p">);</span>

                    <span class="k">return</span> <span class="nx">rest_ensure_response</span><span class="p">(</span> <span class="nv">$response</span> <span class="p">);</span>
            <span class="p">}</span> <span class="k">catch</span> <span class="p">(</span> <span class="nx">WC_Data_Exception</span> <span class="nv">$e</span> <span class="p">)</span> <span class="p">{</span>
                    <span class="k">return</span> <span class="k">new</span> <span class="nx">WP_Error</span><span class="p">(</span> <span class="nv">$e</span><span class="o">-&gt;</span><span class="na">getErrorCode</span><span class="p">(),</span> <span class="nv">$e</span><span class="o">-&gt;</span><span class="na">getMessage</span><span class="p">(),</span> <span class="nv">$e</span><span class="o">-&gt;</span><span class="na">getErrorData</span><span class="p">()</span> <span class="p">);</span>
            <span class="p">}</span> <span class="k">catch</span> <span class="p">(</span> <span class="nx">WC_REST_Exception</span> <span class="nv">$e</span> <span class="p">)</span> <span class="p">{</span>
                    <span class="k">return</span> <span class="k">new</span> <span class="nx">WP_Error</span><span class="p">(</span> <span class="nv">$e</span><span class="o">-&gt;</span><span class="na">getErrorCode</span><span class="p">(),</span> <span class="nv">$e</span><span class="o">-&gt;</span><span class="na">getMessage</span><span class="p">(),</span> <span class="k">array</span><span class="p">(</span> <span class="s1">&#39;status&#39;</span> <span class="o">=&gt;</span> <span class="nv">$e</span><span class="o">-&gt;</span><span class="na">getCode</span><span class="p">()</span> <span class="p">)</span> <span class="p">);</span>
            <span class="p">}</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="could-use-try">
<span id="case-could-use-try"></span><h3><span class="section-number">5.2.53. </span>Could Use Try<a class="headerlink" href="#could-use-try" title="Permalink to this headline">¶</a></h3>
<div class="section" id="case-mautic-exceptions-couldusetry">
<span id="id47"></span><h4><span class="section-number">5.2.53.1. </span>Mautic<a class="headerlink" href="#case-mautic-exceptions-couldusetry" title="Permalink to this headline">¶</a></h4>
<p><a class="reference internal" href="Rules.html#could-use-try"><span class="std std-ref">Could Use Try</span></a>, in app/bundles/StageBundle/Controller/StageController.php:78.</p>
<p>$limit is read as a session variable or a default value. There are no check here that $limit is not null, before using it in a division. It is easy to imagine this is done elsewhere, yet a try/catch could help intercept unwanted situations.</p>
<div class="highlight-php notranslate"><div class="highlight"><pre><span></span><span class="c1">//set limits</span>
        <span class="nv">$limit</span> <span class="o">=</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">get</span><span class="p">(</span><span class="s1">&#39;session&#39;</span><span class="p">)</span><span class="o">-&gt;</span><span class="na">get</span><span class="p">(</span>
            <span class="s1">&#39;mautic.stage.limit&#39;</span><span class="p">,</span>
            <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">coreParametersHelper</span><span class="o">-&gt;</span><span class="na">getParameter</span><span class="p">(</span><span class="s1">&#39;default_pagelimit&#39;</span><span class="p">)</span>
        <span class="p">);</span>
<span class="o">/...</span> <span class="nx">Code</span> <span class="nx">where</span> <span class="nv">$limit</span> <span class="nx">is</span> <span class="nx">read</span> <span class="nx">but</span> <span class="k">not</span> <span class="nx">modified</span> <span class="o">/</span>
        <span class="nv">$count</span> <span class="o">=</span> <span class="nb">count</span><span class="p">(</span><span class="nv">$stages</span><span class="p">);</span>
        <span class="k">if</span> <span class="p">(</span><span class="nv">$count</span> <span class="o">&amp;&amp;</span> <span class="nv">$count</span> <span class="o">&lt;</span> <span class="p">(</span><span class="nv">$start</span> <span class="o">+</span> <span class="mi">1</span><span class="p">))</span> <span class="p">{</span>
            <span class="nv">$lastPage</span> <span class="o">=</span> <span class="p">(</span><span class="nv">$count</span> <span class="o">===</span> <span class="mi">1</span><span class="p">)</span> <span class="o">?</span> <span class="mi">1</span> <span class="o">:</span> <span class="p">(</span><span class="nb">ceil</span><span class="p">(</span><span class="nv">$count</span> <span class="o">/</span> <span class="nv">$limit</span><span class="p">))</span> <span class="o">?:</span> <span class="mi">1</span><span class="p">;</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="rethrown-exceptions">
<span id="case-rethrown-exceptions"></span><h3><span class="section-number">5.2.54. </span>Rethrown Exceptions<a class="headerlink" href="#rethrown-exceptions" title="Permalink to this headline">¶</a></h3>
<div class="section" id="case-prestashop-exceptions-rethrown">
<span id="id48"></span><h4><span class="section-number">5.2.54.1. </span>PrestaShop<a class="headerlink" href="#case-prestashop-exceptions-rethrown" title="Permalink to this headline">¶</a></h4>
<p><a class="reference internal" href="Rules.html#rethrown-exceptions"><span class="std std-ref">Rethrown Exceptions</span></a>, in classes/webservice/WebserviceOutputBuilder.php:731.</p>
<p>The setSpecificField method catches a WebserviceException, representing an issue with the call to the webservice. However, that piece of information is lost, and the exception is rethrown immediately, without any action.</p>
<div class="highlight-php notranslate"><div class="highlight"><pre><span></span><span class="k">public</span> <span class="k">function</span> <span class="nf">setSpecificField</span><span class="p">(</span><span class="nv">$object</span><span class="p">,</span> <span class="nv">$method</span><span class="p">,</span> <span class="nv">$field_name</span><span class="p">,</span> <span class="nv">$entity_name</span><span class="p">)</span>
    <span class="p">{</span>
            <span class="k">try</span> <span class="p">{</span>
                    <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">validateObjectAndMethod</span><span class="p">(</span><span class="nv">$object</span><span class="p">,</span> <span class="nv">$method</span><span class="p">);</span>
            <span class="p">}</span> <span class="k">catch</span> <span class="p">(</span><span class="nx">WebserviceException</span> <span class="nv">$e</span><span class="p">)</span> <span class="p">{</span>
                    <span class="k">throw</span> <span class="nv">$e</span><span class="p">;</span>
            <span class="p">}</span>

            <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">specificFields</span><span class="p">[</span><span class="nv">$field_name</span><span class="p">]</span> <span class="o">=</span> <span class="k">array</span><span class="p">(</span><span class="s1">&#39;entity&#39;</span><span class="o">=&gt;</span><span class="nv">$entity_name</span><span class="p">,</span> <span class="s1">&#39;object&#39;</span> <span class="o">=&gt;</span> <span class="nv">$object</span><span class="p">,</span> <span class="s1">&#39;method&#39;</span> <span class="o">=&gt;</span> <span class="nv">$method</span><span class="p">,</span> <span class="s1">&#39;type&#39;</span> <span class="o">=&gt;</span> <span class="nb">gettype</span><span class="p">(</span><span class="nv">$object</span><span class="p">));</span>
            <span class="k">return</span> <span class="nv">$this</span><span class="p">;</span>
    <span class="p">}</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="throw-functioncall">
<span id="case-throw-functioncall"></span><h3><span class="section-number">5.2.55. </span>Throw Functioncall<a class="headerlink" href="#throw-functioncall" title="Permalink to this headline">¶</a></h3>
<div class="section" id="case-sugarcrm-exceptions-throwfunctioncall">
<span id="id49"></span><h4><span class="section-number">5.2.55.1. </span>SugarCrm<a class="headerlink" href="#case-sugarcrm-exceptions-throwfunctioncall" title="Permalink to this headline">¶</a></h4>
<p><a class="reference internal" href="Rules.html#throw-functioncall"><span class="std std-ref">Throw Functioncall</span></a>, in include/externalAPI/cmis_repository_wrapper.php:918.</p>
<p>SugarCRM uses exceptions to fill work in progress. Here, we recognize a forgotten ‘new’ that makes throw call a function named ‘Exception’. This fails with a Fatal Error, and doesn’t issue the right messsage. The same error had propgated in the code by copy and paste : it is available 17 times in that same file.</p>
<div class="highlight-php notranslate"><div class="highlight"><pre><span></span><span class="k">function</span> <span class="nf">getContentChanges</span><span class="p">()</span>
    <span class="p">{</span>
        <span class="k">throw</span> <span class="nx">Exception</span><span class="p">(</span><span class="s2">&quot;Not Implemented&quot;</span><span class="p">);</span>
    <span class="p">}</span>
</pre></div>
</div>
</div>
<div class="section" id="case-zurmo-exceptions-throwfunctioncall">
<span id="id50"></span><h4><span class="section-number">5.2.55.2. </span>Zurmo<a class="headerlink" href="#case-zurmo-exceptions-throwfunctioncall" title="Permalink to this headline">¶</a></h4>
<p><a class="reference internal" href="Rules.html#throw-functioncall"><span class="std std-ref">Throw Functioncall</span></a>, in app/protected/modules/gamification/rules/collections/GameCollectionRules.php:66.</p>
<p>Other part of the code actually instantiate the exception before throwing it.</p>
<div class="highlight-php notranslate"><div class="highlight"><pre><span></span><span class="k">abstract</span> <span class="k">class</span> <span class="nc">GameCollectionRules</span>
    <span class="p">{</span>
        <span class="sd">/**</span>
<span class="sd">         * @return string</span>
<span class="sd">         * @throws NotImplementedException - Implement in children classes</span>
<span class="sd">         */</span>
        <span class="k">public</span> <span class="k">static</span> <span class="k">function</span> <span class="nf">getType</span><span class="p">()</span>
        <span class="p">{</span>
            <span class="k">throw</span> <span class="nx">NotImplementedException</span><span class="p">();</span>
        <span class="p">}</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="useless-catch">
<span id="case-useless-catch"></span><h3><span class="section-number">5.2.56. </span>Useless Catch<a class="headerlink" href="#useless-catch" title="Permalink to this headline">¶</a></h3>
<div class="section" id="case-zurmo-exceptions-uselesscatch">
<span id="id51"></span><h4><span class="section-number">5.2.56.1. </span>Zurmo<a class="headerlink" href="#case-zurmo-exceptions-uselesscatch" title="Permalink to this headline">¶</a></h4>
<p><a class="reference internal" href="Rules.html#useless-catch"><span class="std std-ref">Useless Catch</span></a>, in app/protected/modules/workflows/forms/attributes/ExplicitReadWriteModelPermissionsWorkflowActionAttributeForm.php:99.</p>
<p>Catch the exception, then return. At least, the comment is honest.</p>
<div class="highlight-php notranslate"><div class="highlight"><pre><span></span><span class="k">try</span>
                <span class="p">{</span>
                    <span class="nv">$group</span> <span class="o">=</span> <span class="nx">Group</span><span class="o">::</span><span class="na">getById</span><span class="p">((</span><span class="nx">int</span><span class="p">)</span><span class="nv">$this</span><span class="o">-&gt;</span><span class="na">type</span><span class="p">);</span>
                    <span class="nv">$explicitReadWriteModelPermissions</span><span class="o">-&gt;</span><span class="na">addReadWritePermitable</span><span class="p">(</span><span class="nv">$group</span><span class="p">);</span>
                <span class="p">}</span>
                <span class="k">catch</span> <span class="p">(</span><span class="nx">NotFoundException</span> <span class="nv">$e</span><span class="p">)</span>
                <span class="p">{</span>
                    <span class="c1">//todo: handle exception better</span>
                    <span class="k">return</span><span class="p">;</span>
                <span class="p">}</span>
</pre></div>
</div>
</div>
<div class="section" id="case-prestashop-exceptions-uselesscatch">
<span id="id52"></span><h4><span class="section-number">5.2.56.2. </span>PrestaShop<a class="headerlink" href="#case-prestashop-exceptions-uselesscatch" title="Permalink to this headline">¶</a></h4>
<p><a class="reference internal" href="Rules.html#useless-catch"><span class="std std-ref">Useless Catch</span></a>, in src/Core/Addon/Module/ModuleManagerBuilder.php:170.</p>
<p>Here, the catch clause will intercept a IO problem while writing element on the disk, and will return false. Since this is a constructor, the returned value will be ignored and the object will be left in a wrong state, since it was not totally inited.</p>
<div class="highlight-php notranslate"><div class="highlight"><pre><span></span><span class="k">private</span> <span class="k">function</span> <span class="fm">__construct</span><span class="p">()</span>
    <span class="p">{</span>
    <span class="c1">// More code......</span>
            <span class="k">try</span> <span class="p">{</span>
                <span class="nv">$filesystem</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Filesystem</span><span class="p">();</span>
                <span class="nv">$filesystem</span><span class="o">-&gt;</span><span class="na">dumpFile</span><span class="p">(</span><span class="nv">$phpConfigFile</span><span class="p">,</span> <span class="s1">&#39;&lt;?php return &#39;</span> <span class="o">.</span> <span class="nb">var_export</span><span class="p">(</span><span class="nv">$config</span><span class="p">,</span> <span class="k">true</span><span class="p">)</span> <span class="o">.</span> <span class="s1">&#39;;&#39;</span> <span class="o">.</span> <span class="nx">\n</span><span class="p">);</span>
            <span class="p">}</span> <span class="k">catch</span> <span class="p">(</span><span class="nx">IOException</span> <span class="nv">$e</span><span class="p">)</span> <span class="p">{</span>
                <span class="k">return</span> <span class="k">false</span><span class="p">;</span>
            <span class="p">}</span>
        <span class="p">}</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="add-default-value">
<span id="case-add-default-value"></span><h3><span class="section-number">5.2.57. </span>Add Default Value<a class="headerlink" href="#add-default-value" title="Permalink to this headline">¶</a></h3>
<div class="section" id="case-zurmo-functions-adddefaultvalue">
<span id="id53"></span><h4><span class="section-number">5.2.57.1. </span>Zurmo<a class="headerlink" href="#case-zurmo-functions-adddefaultvalue" title="Permalink to this headline">¶</a></h4>
<p><a class="reference internal" href="Rules.html#add-default-value"><span class="std std-ref">Add Default Value</span></a>, in wp-admin/includes/misc.php:74.</p>
<p>Default values may be a literal (1, ‘abc’, …), or a constant : global or class. Here, MissionsListConfigurationForm::LIST_TYPE_AVAILABLE may be used directly in the signature of the method</p>
<div class="highlight-php notranslate"><div class="highlight"><pre><span></span><span class="k">public</span> <span class="k">function</span> <span class="nf">getMetadataFilteredByOption</span><span class="p">(</span><span class="nv">$option</span><span class="p">)</span>
        <span class="p">{</span>
            <span class="k">if</span> <span class="p">(</span><span class="nv">$option</span> <span class="o">==</span> <span class="k">null</span><span class="p">)</span>
            <span class="p">{</span>
                <span class="nv">$option</span> <span class="o">=</span> <span class="nx">MissionsListConfigurationForm</span><span class="o">::</span><span class="na">LIST_TYPE_AVAILABLE</span><span class="p">;</span>
            <span class="p">}</span>
</pre></div>
</div>
</div>
<div class="section" id="case-typo3-functions-adddefaultvalue">
<span id="id54"></span><h4><span class="section-number">5.2.57.2. </span>Typo3<a class="headerlink" href="#case-typo3-functions-adddefaultvalue" title="Permalink to this headline">¶</a></h4>
<p><a class="reference internal" href="Rules.html#add-default-value"><span class="std std-ref">Add Default Value</span></a>, in typo3/sysext/indexed_search/Classes/FileContentParser.php:821.</p>
<p>$extension could get a default value to handle default situations : for example, a file is htm format by default, unless better known. Also, the if/then structure could get a ‘else’ clause, to handle unknown situations : those are situations where the extension is provided but not known, in particular when the icon is missing in the storage folder.</p>
<div class="highlight-php notranslate"><div class="highlight"><pre><span></span><span class="k">public</span> <span class="k">function</span> <span class="nf">getIcon</span><span class="p">(</span><span class="nv">$extension</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="k">if</span> <span class="p">(</span><span class="nv">$extension</span> <span class="o">===</span> <span class="s1">&#39;htm&#39;</span><span class="p">)</span> <span class="p">{</span>
            <span class="nv">$extension</span> <span class="o">=</span> <span class="s1">&#39;html&#39;</span><span class="p">;</span>
        <span class="p">}</span> <span class="k">elseif</span> <span class="p">(</span><span class="nv">$extension</span> <span class="o">===</span> <span class="s1">&#39;jpeg&#39;</span><span class="p">)</span> <span class="p">{</span>
            <span class="nv">$extension</span> <span class="o">=</span> <span class="s1">&#39;jpg&#39;</span><span class="p">;</span>
        <span class="p">}</span>
        <span class="k">return</span> <span class="s1">&#39;EXT:indexed_search/Resources/Public/Icons/FileTypes/&#39;</span> <span class="o">.</span> <span class="nv">$extension</span> <span class="o">.</span> <span class="s1">&#39;.gif&#39;</span><span class="p">;</span>
    <span class="p">}</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="aliases-usage">
<span id="case-aliases-usage"></span><h3><span class="section-number">5.2.58. </span>Aliases Usage<a class="headerlink" href="#aliases-usage" title="Permalink to this headline">¶</a></h3>
<div class="section" id="cleverstyle">
<span id="case-cleverstyle-functions-aliasesusage"></span><h4><span class="section-number">5.2.58.1. </span>Cleverstyle<a class="headerlink" href="#cleverstyle" title="Permalink to this headline">¶</a></h4>
<p><a class="reference internal" href="Rules.html#aliases-usage"><span class="std std-ref">Aliases Usage</span></a>, in modules/HybridAuth/Hybrid/thirdparty/Vimeo/Vimeo.php:422.</p>
<p>is_writeable() should be written is_writable(). No extra ‘e’.</p>
<div class="highlight-php notranslate"><div class="highlight"><pre><span></span><span class="nb">is_writeable</span><span class="p">(</span><span class="nv">$chunk_temp_dir</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="section" id="case-phpmyadmin-functions-aliasesusage">
<span id="id55"></span><h4><span class="section-number">5.2.58.2. </span>phpMyAdmin<a class="headerlink" href="#case-phpmyadmin-functions-aliasesusage" title="Permalink to this headline">¶</a></h4>
<p><a class="reference internal" href="Rules.html#aliases-usage"><span class="std std-ref">Aliases Usage</span></a>, in libraries/classes/Server/Privileges.php:5064.</p>
<p>join() should be written implode()</p>
<div class="highlight-php notranslate"><div class="highlight"><pre><span></span><span class="nb">join</span><span class="p">(</span><span class="s1">&#39;`, `&#39;</span><span class="p">,</span> <span class="nv">$tmp_privs2</span><span class="p">[</span><span class="s1">&#39;Update&#39;</span><span class="p">])</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="use-named-boolean-in-argument-definition">
<span id="case-use-named-boolean-in-argument-definition"></span><h3><span class="section-number">5.2.59. </span>Use Named Boolean In Argument Definition<a class="headerlink" href="#use-named-boolean-in-argument-definition" title="Permalink to this headline">¶</a></h3>
<div class="section" id="case-phpmyadmin-functions-avoidbooleanargument">
<span id="id56"></span><h4><span class="section-number">5.2.59.1. </span>phpMyAdmin<a class="headerlink" href="#case-phpmyadmin-functions-avoidbooleanargument" title="Permalink to this headline">¶</a></h4>
<p><a class="reference internal" href="Rules.html#use-named-boolean-in-argument-definition"><span class="std std-ref">Use Named Boolean In Argument Definition</span></a>, in /libraries/classes/Util.php:1929.</p>
<p>$request is an option to <cite>checkParameters</cite>, although it is not visibile with is its actual role.</p>
<div class="highlight-php notranslate"><div class="highlight"><pre><span></span><span class="k">public</span> <span class="k">static</span> <span class="k">function</span> <span class="nf">checkParameters</span><span class="p">(</span><span class="nv">$params</span><span class="p">,</span> <span class="nv">$request</span> <span class="o">=</span> <span class="k">false</span><span class="p">)</span> <span class="p">{</span>
    <span class="cm">/**/</span>
<span class="p">}</span>
</pre></div>
</div>
</div>
<div class="section" id="case-cleverstyle-functions-avoidbooleanargument">
<span id="id57"></span><h4><span class="section-number">5.2.59.2. </span>Cleverstyle<a class="headerlink" href="#case-cleverstyle-functions-avoidbooleanargument" title="Permalink to this headline">¶</a></h4>
<p><a class="reference internal" href="Rules.html#use-named-boolean-in-argument-definition"><span class="std std-ref">Use Named Boolean In Argument Definition</span></a>, in /core/classes/Response.php:129.</p>
<p>$httponly is an option to <cite>cookie</cite>, and true/false makes it readable. There may be other situations, like fallback, or forcedd usage, so the boolean may be misleading. Note also the <cite>$expire = 0</cite>, which may be a date, or a special value. We need to read the documentation to understand this.</p>
<div class="highlight-php notranslate"><div class="highlight"><pre><span></span><span class="k">public</span> <span class="k">function</span> <span class="nf">cookie</span><span class="p">(</span><span class="nv">$name</span><span class="p">,</span> <span class="nv">$value</span><span class="p">,</span> <span class="nv">$expire</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="nv">$httponly</span> <span class="o">=</span> <span class="k">false</span><span class="p">)</span> <span class="p">{</span> <span class="cm">/**/</span> <span class="p">}</span>       <span class="p">{</span>
    <span class="cm">/**/</span>
<span class="p">}</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="callback-function-needs-return">
<span id="case-callback-function-needs-return"></span><h3><span class="section-number">5.2.60. </span>Callback Function Needs Return<a class="headerlink" href="#callback-function-needs-return" title="Permalink to this headline">¶</a></h3>
<div class="section" id="case-contao-functions-callbackneedsreturn">
<span id="id58"></span><h4><span class="section-number">5.2.60.1. </span>Contao<a class="headerlink" href="#case-contao-functions-callbackneedsreturn" title="Permalink to this headline">¶</a></h4>
<p><a class="reference internal" href="Rules.html#callback-function-needs-return"><span class="std std-ref">Callback Function Needs Return</span></a>, in core-bundle/src/Resources/contao/modules/ModuleQuicklink.php:91.</p>
<p>The empty closure returns <cite>null</cite>. The array_flip() array has now all its values set to null, and reset, as intended. A better alternative is to use the array_fill_keys() function, which set a default value to every element of an array, once provided with the expected keys.</p>
<div class="highlight-php notranslate"><div class="highlight"><pre><span></span><span class="nv">$arrPages</span> <span class="o">=</span> <span class="nb">array_map</span><span class="p">(</span><span class="k">function</span> <span class="p">()</span> <span class="p">{},</span> <span class="nb">array_flip</span><span class="p">(</span><span class="nv">$tmp</span><span class="p">));</span>
</pre></div>
</div>
</div>
<div class="section" id="phpdocumentor">
<span id="case-phpdocumentor-functions-callbackneedsreturn"></span><h4><span class="section-number">5.2.60.2. </span>Phpdocumentor<a class="headerlink" href="#phpdocumentor" title="Permalink to this headline">¶</a></h4>
<p><a class="reference internal" href="Rules.html#callback-function-needs-return"><span class="std std-ref">Callback Function Needs Return</span></a>, in src/phpDocumentor/Plugin/ServiceProvider.php:24.</p>
<p>The array_walk() function is called on the plugin’s list. Each element is registered with the application, but is not used directly : this is for later. The error mechanism is to throw an exception : this is the only expected feedback. As such, no return is expected. May be a ‘foreach’ loop would be more appropriate here, but this is syntactic sugar.</p>
<div class="highlight-php notranslate"><div class="highlight"><pre><span></span><span class="nb">array_walk</span><span class="p">(</span>
            <span class="nv">$plugins</span><span class="p">,</span>
            <span class="k">function</span> <span class="p">(</span><span class="nv">$plugin</span><span class="p">)</span> <span class="k">use</span> <span class="p">(</span><span class="nv">$app</span><span class="p">)</span> <span class="p">{</span>
                <span class="sd">/** @var Plugin $plugin */</span>
                <span class="nv">$provider</span> <span class="o">=</span> <span class="p">(</span><span class="nb">strpos</span><span class="p">(</span><span class="nv">$plugin</span><span class="o">-&gt;</span><span class="na">getClassName</span><span class="p">(),</span> <span class="s1">&#39;\&#39;) === false)</span>
<span class="s1">                    ? sprintf(&#39;</span><span class="nx">phpDocumentor\Plugin\</span><span class="o">%</span><span class="nx">s\ServiceProvider</span><span class="s1">&#39;, $plugin-&gt;getClassName())</span>
<span class="s1">                    : $plugin-&gt;getClassName();</span>
<span class="s1">                if (!class_exists($provider)) {</span>
<span class="s1">                    throw new \RuntimeException(&#39;</span><span class="nx">Loading</span> <span class="nx">Service</span> <span class="nx">Provider</span> <span class="k">for</span> <span class="s1">&#39; . $provider . &#39;</span> <span class="nx">failed</span><span class="o">.</span><span class="err">&#39;</span><span class="p">);</span>
                <span class="p">}</span>

                <span class="k">try</span> <span class="p">{</span>
                    <span class="nv">$app</span><span class="o">-&gt;</span><span class="na">register</span><span class="p">(</span><span class="k">new</span> <span class="nv">$provider</span><span class="p">(</span><span class="nv">$plugin</span><span class="p">));</span>
                <span class="p">}</span> <span class="k">catch</span> <span class="p">(</span><span class="nx">\InvalidArgumentException</span> <span class="nv">$e</span><span class="p">)</span> <span class="p">{</span>
                    <span class="k">throw</span> <span class="k">new</span> <span class="nx">\RuntimeException</span><span class="p">(</span><span class="nv">$e</span><span class="o">-&gt;</span><span class="na">getMessage</span><span class="p">());</span>
                <span class="p">}</span>
            <span class="p">}</span>
        <span class="p">);</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="closure-could-be-a-callback">
<span id="case-closure-could-be-a-callback"></span><h3><span class="section-number">5.2.61. </span>Closure Could Be A Callback<a class="headerlink" href="#closure-could-be-a-callback" title="Permalink to this headline">¶</a></h3>
<div class="section" id="tine20">
<span id="case-tine20-functions-closure2string"></span><h4><span class="section-number">5.2.61.1. </span>Tine20<a class="headerlink" href="#tine20" title="Permalink to this headline">¶</a></h4>
<p><a class="reference internal" href="Rules.html#closure-could-be-a-callback"><span class="std std-ref">Closure Could Be A Callback</span></a>, in tine20/Tinebase/Convert/Json.php:318.</p>
<p>is_scalar() is sufficient here.</p>
<div class="highlight-php notranslate"><div class="highlight"><pre><span></span><span class="nv">$value</span> <span class="o">=</span> <span class="nb">array_filter</span><span class="p">(</span><span class="nv">$value</span><span class="p">,</span> <span class="k">function</span> <span class="p">(</span><span class="nv">$val</span><span class="p">)</span> <span class="p">{</span> <span class="k">return</span> <span class="nb">is_scalar</span><span class="p">(</span><span class="nv">$val</span><span class="p">);</span> <span class="p">});</span>
</pre></div>
</div>
</div>
<div class="section" id="case-nextcloud-functions-closure2string">
<span id="id59"></span><h4><span class="section-number">5.2.61.2. </span>NextCloud<a class="headerlink" href="#case-nextcloud-functions-closure2string" title="Permalink to this headline">¶</a></h4>
<p><a class="reference internal" href="Rules.html#closure-could-be-a-callback"><span class="std std-ref">Closure Could Be A Callback</span></a>, in apps/files_sharing/lib/ShareBackend/Folder.php:114.</p>
<p>$qb is the object for the methodcall, passed via use. The closure may have been replaced with array($qb, ‘createNamedParameter’).</p>
<div class="highlight-php notranslate"><div class="highlight"><pre><span></span><span class="nv">$parents</span> <span class="o">=</span> <span class="nb">array_map</span><span class="p">(</span><span class="k">function</span><span class="p">(</span><span class="nv">$parent</span><span class="p">)</span> <span class="k">use</span> <span class="p">(</span><span class="nv">$qb</span><span class="p">)</span> <span class="p">{</span>
                            <span class="k">return</span> <span class="nv">$qb</span><span class="o">-&gt;</span><span class="na">createNamedParameter</span><span class="p">(</span><span class="nv">$parent</span><span class="p">);</span>
                    <span class="p">},</span> <span class="nv">$parents</span><span class="p">);</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="could-be-typehinted-callable">
<span id="case-could-be-typehinted-callable"></span><h3><span class="section-number">5.2.62. </span>Could Be Typehinted Callable<a class="headerlink" href="#could-be-typehinted-callable" title="Permalink to this headline">¶</a></h3>
<div class="section" id="case-magento-functions-couldbecallable">
<span id="id60"></span><h4><span class="section-number">5.2.62.1. </span>Magento<a class="headerlink" href="#case-magento-functions-couldbecallable" title="Permalink to this headline">¶</a></h4>
<p><a class="reference internal" href="Rules.html#could-be-typehinted-callable"><span class="std std-ref">Could Be Typehinted Callable</span></a>, in wp-admin/includes/misc.php:74.</p>
<p>$objMethod argument is used to call a function, a method or a localmethod. The typehint would save the middle condition, and make a better job than ‘is_array’ to check if $objMethod is callable. Yet, the final ‘else’ means that $objMethod is also the name of a method, and PHP won’t validate this, unless there is a function with the same name. Here, callable is not an option.</p>
<div class="highlight-php notranslate"><div class="highlight"><pre><span></span><span class="k">public</span> <span class="k">function</span> <span class="nf">each</span><span class="p">(</span><span class="nv">$objMethod</span><span class="p">,</span> <span class="nv">$args</span> <span class="o">=</span> <span class="p">[])</span>
    <span class="p">{</span>
        <span class="k">if</span> <span class="p">(</span><span class="nv">$objMethod</span> <span class="nx">instanceof</span> <span class="nx">\Closure</span><span class="p">)</span> <span class="p">{</span>
            <span class="k">foreach</span> <span class="p">(</span><span class="nv">$this</span><span class="o">-&gt;</span><span class="na">getItems</span><span class="p">()</span> <span class="k">as</span> <span class="nv">$item</span><span class="p">)</span> <span class="p">{</span>
                <span class="nv">$objMethod</span><span class="p">(</span><span class="nv">$item</span><span class="p">,</span> <span class="o">...</span><span class="nv">$args</span><span class="p">);</span>
            <span class="p">}</span>
        <span class="p">}</span> <span class="k">elseif</span> <span class="p">(</span><span class="nb">is_array</span><span class="p">(</span><span class="nv">$objMethod</span><span class="p">))</span> <span class="p">{</span>
            <span class="k">foreach</span> <span class="p">(</span><span class="nv">$this</span><span class="o">-&gt;</span><span class="na">getItems</span><span class="p">()</span> <span class="k">as</span> <span class="nv">$item</span><span class="p">)</span> <span class="p">{</span>
                <span class="nb">call_user_func</span><span class="p">(</span><span class="nv">$objMethod</span><span class="p">,</span> <span class="nv">$item</span><span class="p">,</span> <span class="o">...</span><span class="nv">$args</span><span class="p">);</span>
            <span class="p">}</span>
        <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
            <span class="k">foreach</span> <span class="p">(</span><span class="nv">$this</span><span class="o">-&gt;</span><span class="na">getItems</span><span class="p">()</span> <span class="k">as</span> <span class="nv">$item</span><span class="p">)</span> <span class="p">{</span>
                <span class="nv">$item</span><span class="o">-&gt;</span><span class="nv">$objMethod</span><span class="p">(</span><span class="o">...</span><span class="nv">$args</span><span class="p">);</span>
            <span class="p">}</span>
        <span class="p">}</span>
    <span class="p">}</span>
</pre></div>
</div>
</div>
<div class="section" id="case-prestashop-functions-couldbecallable">
<span id="id61"></span><h4><span class="section-number">5.2.62.2. </span>PrestaShop<a class="headerlink" href="#case-prestashop-functions-couldbecallable" title="Permalink to this headline">¶</a></h4>
<p><a class="reference internal" href="Rules.html#could-be-typehinted-callable"><span class="std std-ref">Could Be Typehinted Callable</span></a>, in controllers/admin/AdminImportController.php:1147.</p>
<p>$funcname is tested with is_callable() before being used as a method. Typehint callable would reduce the size of the code.</p>
<div class="highlight-php notranslate"><div class="highlight"><pre><span></span><span class="k">public</span> <span class="k">static</span> <span class="k">function</span> <span class="nf">arrayWalk</span><span class="p">(</span><span class="o">&amp;</span><span class="nv">$array</span><span class="p">,</span> <span class="nv">$funcname</span><span class="p">,</span> <span class="o">&amp;</span><span class="nv">$user_data</span> <span class="o">=</span> <span class="k">false</span><span class="p">)</span>
    <span class="p">{</span>
            <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nb">is_callable</span><span class="p">(</span><span class="nv">$funcname</span><span class="p">))</span> <span class="k">return</span> <span class="k">false</span><span class="p">;</span>

            <span class="k">foreach</span> <span class="p">(</span><span class="nv">$array</span> <span class="k">as</span> <span class="nv">$k</span> <span class="o">=&gt;</span> <span class="nv">$row</span><span class="p">)</span>
                    <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nb">call_user_func_array</span><span class="p">(</span><span class="nv">$funcname</span><span class="p">,</span> <span class="k">array</span><span class="p">(</span><span class="nv">$row</span><span class="p">,</span> <span class="nv">$k</span><span class="p">,</span> <span class="nv">$user_data</span><span class="p">)))</span>
                            <span class="k">return</span> <span class="k">false</span><span class="p">;</span>
            <span class="k">return</span> <span class="k">true</span><span class="p">;</span>
    <span class="p">}</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="could-be-static-closure">
<span id="case-could-be-static-closure"></span><h3><span class="section-number">5.2.63. </span>Could Be Static Closure<a class="headerlink" href="#could-be-static-closure" title="Permalink to this headline">¶</a></h3>
<div class="section" id="case-piwigo-functions-couldbestaticclosure">
<span id="id62"></span><h4><span class="section-number">5.2.63.1. </span>Piwigo<a class="headerlink" href="#case-piwigo-functions-couldbestaticclosure" title="Permalink to this headline">¶</a></h4>
<p><a class="reference internal" href="Rules.html#could-be-static-closure"><span class="std std-ref">Could Be Static Closure</span></a>, in include/ws_core.inc.php:620.</p>
<p>The closure function($m) makes no usage of the current object : using static prevents $this to be forwarded with the closure.</p>
<div class="highlight-php notranslate"><div class="highlight"><pre><span></span><span class="sd">/**</span>
<span class="sd">   * WS reflection method implementation: lists all available methods</span>
<span class="sd">   */</span>
  <span class="k">static</span> <span class="k">function</span> <span class="nf">ws_getMethodList</span><span class="p">(</span><span class="nv">$params</span><span class="p">,</span> <span class="o">&amp;</span><span class="nv">$service</span><span class="p">)</span>
  <span class="p">{</span>
    <span class="nv">$methods</span> <span class="o">=</span> <span class="nb">array_filter</span><span class="p">(</span><span class="nv">$service</span><span class="o">-&gt;</span><span class="na">_methods</span><span class="p">,</span>
      <span class="k">function</span><span class="p">(</span><span class="nv">$m</span><span class="p">)</span> <span class="p">{</span> <span class="k">return</span> <span class="k">empty</span><span class="p">(</span><span class="nv">$m</span><span class="p">[</span><span class="s2">&quot;options&quot;</span><span class="p">][</span><span class="s2">&quot;hidden&quot;</span><span class="p">])</span> <span class="o">||</span> <span class="o">!</span><span class="nv">$m</span><span class="p">[</span><span class="s2">&quot;options&quot;</span><span class="p">][</span><span class="s2">&quot;hidden&quot;</span><span class="p">];}</span> <span class="p">);</span>
    <span class="k">return</span> <span class="k">array</span><span class="p">(</span><span class="s1">&#39;methods&#39;</span> <span class="o">=&gt;</span> <span class="k">new</span> <span class="nx">PwgNamedArray</span><span class="p">(</span> <span class="nb">array_keys</span><span class="p">(</span><span class="nv">$methods</span><span class="p">),</span><span class="s1">&#39;method&#39;</span> <span class="p">)</span> <span class="p">);</span>
  <span class="p">}</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="deep-definitions">
<span id="case-deep-definitions"></span><h3><span class="section-number">5.2.64. </span>Deep Definitions<a class="headerlink" href="#deep-definitions" title="Permalink to this headline">¶</a></h3>
<div class="section" id="case-dolphin-functions-deepdefinitions">
<span id="id63"></span><h4><span class="section-number">5.2.64.1. </span>Dolphin<a class="headerlink" href="#case-dolphin-functions-deepdefinitions" title="Permalink to this headline">¶</a></h4>
<p><a class="reference internal" href="Rules.html#deep-definitions"><span class="std std-ref">Deep Definitions</span></a>, in wp-admin/includes/misc.php:74.</p>
<p>The ConstructHiddenValues function builds the ConstructHiddenSubValues function. Thus, ConstructHiddenValues can only be called once.</p>
<div class="highlight-php notranslate"><div class="highlight"><pre><span></span><span class="k">function</span> <span class="nf">ConstructHiddenValues</span><span class="p">(</span><span class="nv">$Values</span><span class="p">)</span>
<span class="p">{</span>
    <span class="sd">/**</span>
<span class="sd">     *    Recursive function, processes multidimensional arrays</span>
<span class="sd">     *</span>
<span class="sd">     * @param string $Name  Full name of array, including all subarrays&#39; names</span>
<span class="sd">     *</span>
<span class="sd">     * @param array  $Value Array of values, can be multidimensional</span>
<span class="sd">     *</span>
<span class="sd">     * @return string    Properly consctructed &lt;input type=&quot;hidden&quot;...&gt; tags</span>
<span class="sd">     */</span>
    <span class="k">function</span> <span class="nf">ConstructHiddenSubValues</span><span class="p">(</span><span class="nv">$Name</span><span class="p">,</span> <span class="nv">$Value</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="k">if</span> <span class="p">(</span><span class="nb">is_array</span><span class="p">(</span><span class="nv">$Value</span><span class="p">))</span> <span class="p">{</span>
            <span class="nv">$Result</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span><span class="p">;</span>
            <span class="k">foreach</span> <span class="p">(</span><span class="nv">$Value</span> <span class="k">as</span> <span class="nv">$KeyName</span> <span class="o">=&gt;</span> <span class="nv">$SubValue</span><span class="p">)</span> <span class="p">{</span>
                <span class="nv">$Result</span> <span class="o">.=</span> <span class="nx">ConstructHiddenSubValues</span><span class="p">(</span><span class="s2">&quot;</span><span class="si">{</span><span class="nv">$Name</span><span class="si">}</span><span class="s2">[</span><span class="si">{</span><span class="nv">$KeyName</span><span class="si">}</span><span class="s2">]&quot;</span><span class="p">,</span> <span class="nv">$SubValue</span><span class="p">);</span>
            <span class="p">}</span>
        <span class="p">}</span> <span class="k">else</span> <span class="c1">// Exit recurse</span>
        <span class="p">{</span>
            <span class="nv">$Result</span> <span class="o">=</span> <span class="s2">&quot;&lt;input type=&quot;</span><span class="nx">hidden</span><span class="s2">&quot; name=</span><span class="se">\\</span><span class="s2"> . htmlspecialchars(</span><span class="si">$Name</span><span class="s2">) . &quot;</span><span class="nx">\</span><span class="s2">&quot; value=</span><span class="se">\&quot;</span><span class="s2">&quot;</span> <span class="o">.</span> <span class="nb">htmlspecialchars</span><span class="p">(</span><span class="nv">$Value</span><span class="p">)</span> <span class="o">.</span> <span class="s2">&quot;\/&gt;</span><span class="se">\n</span><span class="s2">\;</span>
<span class="s2">        }</span>

<span class="s2">        return </span><span class="si">$Result</span><span class="s2">;</span>
<span class="s2">    }</span>

<span class="s2">    /* End of ConstructHiddenSubValues function */</span>

<span class="s2">    </span><span class="si">$Result</span><span class="s2"> = &#39;&#39;;</span>
<span class="s2">    if (is_array(</span><span class="si">$Values</span><span class="s2">)) {</span>
<span class="s2">        foreach (</span><span class="si">$Values</span><span class="s2"> as </span><span class="si">$KeyName</span><span class="s2"> =&gt; </span><span class="si">$Value</span><span class="s2">) {</span>
<span class="s2">            </span><span class="si">$Result</span><span class="s2"> .= ConstructHiddenSubValues(</span><span class="si">$KeyName</span><span class="s2">, </span><span class="si">$Value</span><span class="s2">);</span>
<span class="s2">        }</span>
<span class="s2">    }</span>

<span class="s2">    return </span><span class="si">$Result</span><span class="s2">;</span>
<span class="s2">}</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="empty-function">
<span id="case-empty-function"></span><h3><span class="section-number">5.2.65. </span>Empty Function<a class="headerlink" href="#empty-function" title="Permalink to this headline">¶</a></h3>
<div class="section" id="case-contao-functions-emptyfunction">
<span id="id64"></span><h4><span class="section-number">5.2.65.1. </span>Contao<a class="headerlink" href="#case-contao-functions-emptyfunction" title="Permalink to this headline">¶</a></h4>
<p><a class="reference internal" href="Rules.html#empty-function"><span class="std std-ref">Empty Function</span></a>, in core-bundle/src/Resources/contao/modules/ModuleQuicklink.php:91.</p>
<p>The closure used with array_map() is empty : this means that the keys are all set to the returned value of the empty closure, which is null. The actual effect is to reset the values to NULL. A better solution, without using the empty closure, is to rely on array_fill_keys() to create an array with default values.</p>
<div class="highlight-php notranslate"><div class="highlight"><pre><span></span><span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="k">empty</span><span class="p">(</span><span class="nv">$tmp</span><span class="p">)</span> <span class="o">&amp;&amp;</span> <span class="nx">\is_array</span><span class="p">(</span><span class="nv">$tmp</span><span class="p">))</span>
                    <span class="p">{</span>
                            <span class="nv">$arrPages</span> <span class="o">=</span> <span class="nb">array_map</span><span class="p">(</span><span class="k">function</span> <span class="p">()</span> <span class="p">{},</span> <span class="nb">array_flip</span><span class="p">(</span><span class="nv">$tmp</span><span class="p">));</span>
                    <span class="p">}</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="mismatched-default-arguments">
<span id="case-mismatched-default-arguments"></span><h3><span class="section-number">5.2.66. </span>Mismatched Default Arguments<a class="headerlink" href="#mismatched-default-arguments" title="Permalink to this headline">¶</a></h3>
<div class="section" id="case-spip-functions-mismatcheddefaultarguments">
<span id="id65"></span><h4><span class="section-number">5.2.66.1. </span>SPIP<a class="headerlink" href="#case-spip-functions-mismatcheddefaultarguments" title="Permalink to this headline">¶</a></h4>
<p><a class="reference internal" href="Rules.html#mismatched-default-arguments"><span class="std std-ref">Mismatched Default Arguments</span></a>, in ecrire/inc/lien.php:160.</p>
<p>generer_url_entite() takes $connect in, with a default value of empty string. Later, generer_url_entite() receives that value, but uses null as a default value. This forces the ternary test on $connect, to turn it into a null before shipping it to the next function, and having it processed accordingly.</p>
<div class="highlight-php notranslate"><div class="highlight"><pre><span></span><span class="c1">// http://code.spip.net/@traiter_lien_implicite</span>
<span class="k">function</span> <span class="nf">traiter_lien_implicite</span><span class="p">(</span><span class="nv">$ref</span><span class="p">,</span> <span class="nv">$texte</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="nv">$pour</span> <span class="o">=</span> <span class="s1">&#39;url&#39;</span><span class="p">,</span> <span class="nv">$connect</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span><span class="p">)</span> <span class="p">{</span>

    <span class="c1">// some code was edited here</span>

    <span class="k">if</span> <span class="p">(</span><span class="nb">is_array</span><span class="p">(</span><span class="nv">$url</span><span class="p">))</span> <span class="p">{</span>
            <span class="o">@</span><span class="k">list</span><span class="p">(</span><span class="nv">$type</span><span class="p">,</span> <span class="nv">$id</span><span class="p">)</span> <span class="o">=</span> <span class="nv">$url</span><span class="p">;</span>
            <span class="nv">$url</span> <span class="o">=</span> <span class="nx">generer_url_entite</span><span class="p">(</span><span class="nv">$id</span><span class="p">,</span> <span class="nv">$type</span><span class="p">,</span> <span class="nv">$args</span><span class="p">,</span> <span class="nv">$ancre</span><span class="p">,</span> <span class="nv">$connect</span> <span class="o">?</span> <span class="nv">$connect</span> <span class="o">:</span> <span class="k">null</span><span class="p">);</span>
    <span class="p">}</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="mismatched-typehint">
<span id="case-mismatched-typehint"></span><h3><span class="section-number">5.2.67. </span>Mismatched Typehint<a class="headerlink" href="#mismatched-typehint" title="Permalink to this headline">¶</a></h3>
<div class="section" id="case-wordpress-functions-mismatchedtypehint">
<span id="id66"></span><h4><span class="section-number">5.2.67.1. </span>WordPress<a class="headerlink" href="#case-wordpress-functions-mismatchedtypehint" title="Permalink to this headline">¶</a></h4>
<p><a class="reference internal" href="Rules.html#mismatched-typehint"><span class="std std-ref">Mismatched Typehint</span></a>, in wp-admin/includes/misc.php:74.</p>
<p>This code actually loads the file, join it, then split it again. file() would be sufficient.</p>
<div class="highlight-php notranslate"><div class="highlight"><pre><span></span><span class="nv">$markerdata</span> <span class="o">=</span> <span class="nb">explode</span><span class="p">(</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">,</span> <span class="nb">implode</span><span class="p">(</span> <span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="nb">file</span><span class="p">(</span> <span class="nv">$filename</span> <span class="p">)</span> <span class="p">)</span> <span class="p">);</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="never-called-parameter">
<span id="case-never-called-parameter"></span><h3><span class="section-number">5.2.68. </span>Never Called Parameter<a class="headerlink" href="#never-called-parameter" title="Permalink to this headline">¶</a></h3>
<div class="section" id="case-piwigo-functions-neverusedparameter">
<span id="id67"></span><h4><span class="section-number">5.2.68.1. </span>Piwigo<a class="headerlink" href="#case-piwigo-functions-neverusedparameter" title="Permalink to this headline">¶</a></h4>
<p><a class="reference internal" href="Rules.html#never-called-parameter"><span class="std std-ref">Never Called Parameter</span></a>, in include/functions_html.inc.php:329.</p>
<p>$alternate_url is never explicitely passed to bad_request() : this doesn’t show in this extract. It could be dropped from this code.</p>
<div class="highlight-php notranslate"><div class="highlight"><pre><span></span><span class="k">function</span> <span class="nf">bad_request</span><span class="p">(</span><span class="nv">$msg</span><span class="p">,</span> <span class="nv">$alternate_url</span><span class="o">=</span><span class="k">null</span><span class="p">)</span>
<span class="p">{</span>
  <span class="nx">set_status_header</span><span class="p">(</span><span class="mi">400</span><span class="p">);</span>
  <span class="k">if</span> <span class="p">(</span><span class="nv">$alternate_url</span><span class="o">==</span><span class="k">null</span><span class="p">)</span>
    <span class="nv">$alternate_url</span> <span class="o">=</span> <span class="nx">make_index_url</span><span class="p">();</span>
  <span class="nx">redirect_html</span><span class="p">(</span> <span class="nv">$alternate_url</span><span class="p">,</span>
    <span class="s1">&#39;&lt;div style=&quot;text-align:left; margin-left:5em;margin-bottom:5em;&quot;&gt;</span>
<span class="s1">&lt;h1 style=&quot;text-align:left; font-size:36px;&quot;&gt;&#39;</span><span class="o">.</span><span class="nx">l10n</span><span class="p">(</span><span class="s1">&#39;Bad request&#39;</span><span class="p">)</span><span class="o">.</span><span class="s1">&#39;&lt;/h1&gt;&lt;br&gt;&#39;</span>
<span class="o">.</span><span class="nv">$msg</span><span class="o">.</span><span class="s1">&#39;&lt;/div&gt;&#39;</span><span class="p">,</span>
    <span class="mi">5</span> <span class="p">);</span>
<span class="p">}</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="no-boolean-as-default">
<span id="case-no-boolean-as-default"></span><h3><span class="section-number">5.2.69. </span>No Boolean As Default<a class="headerlink" href="#no-boolean-as-default" title="Permalink to this headline">¶</a></h3>
<div class="section" id="case-openconf-functions-nobooleanasdefault">
<span id="id68"></span><h4><span class="section-number">5.2.69.1. </span>OpenConf<a class="headerlink" href="#case-openconf-functions-nobooleanasdefault" title="Permalink to this headline">¶</a></h4>
<p><a class="reference internal" href="Rules.html#no-boolean-as-default"><span class="std std-ref">No Boolean As Default</span></a>, in openconf/include.php:1264.</p>
<p>Why do we need a <cite>chair</cite> when printing a cell’s file ?</p>
<div class="highlight-php notranslate"><div class="highlight"><pre><span></span><span class="k">function</span> <span class="nf">oc_printFileCells</span><span class="p">(</span><span class="o">&amp;</span><span class="nv">$sub</span><span class="p">,</span> <span class="nv">$chair</span> <span class="o">=</span> <span class="k">false</span><span class="p">)</span> <span class="p">{</span> <span class="cm">/**/</span> <span class="p">}</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="no-class-as-typehint">
<span id="case-no-class-as-typehint"></span><h3><span class="section-number">5.2.70. </span>No Class As Typehint<a class="headerlink" href="#no-class-as-typehint" title="Permalink to this headline">¶</a></h3>
<div class="section" id="case-vanilla-functions-noclassastypehint">
<span id="id69"></span><h4><span class="section-number">5.2.70.1. </span>Vanilla<a class="headerlink" href="#case-vanilla-functions-noclassastypehint" title="Permalink to this headline">¶</a></h4>
<p><a class="reference internal" href="Rules.html#no-class-as-typehint"><span class="std std-ref">No Class As Typehint</span></a>, in library/Vanilla/Formatting/Formats/RichFormat.php:51.</p>
<p>All three typehints are based on classes. When Parser or Renderer are changed, for testing, versioning or moduling reasons, they must subclass the original class.</p>
<div class="highlight-php notranslate"><div class="highlight"><pre><span></span><span class="k">public</span> <span class="k">function</span> <span class="fm">__construct</span><span class="p">(</span><span class="nx">Quill\Parser</span> <span class="nv">$parser</span><span class="p">,</span> <span class="nx">Quill\Renderer</span> <span class="nv">$renderer</span><span class="p">,</span> <span class="nx">Quill\Filterer</span> <span class="nv">$filterer</span><span class="p">)</span> <span class="p">{</span>
        <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">parser</span> <span class="o">=</span> <span class="nv">$parser</span><span class="p">;</span>
        <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">renderer</span> <span class="o">=</span> <span class="nv">$renderer</span><span class="p">;</span>
        <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">filterer</span> <span class="o">=</span> <span class="nv">$filterer</span><span class="p">;</span>
    <span class="p">}</span>
</pre></div>
</div>
</div>
<div class="section" id="case-phpmyadmin-functions-noclassastypehint">
<span id="id70"></span><h4><span class="section-number">5.2.70.2. </span>phpMyAdmin<a class="headerlink" href="#case-phpmyadmin-functions-noclassastypehint" title="Permalink to this headline">¶</a></h4>
<p><a class="reference internal" href="Rules.html#no-class-as-typehint"><span class="std std-ref">No Class As Typehint</span></a>, in libraries/classes/CreateAddField.php:29.</p>
<p>Although the class is named ‘DatabaseInterface’, it is a class.</p>
<div class="highlight-php notranslate"><div class="highlight"><pre><span></span><span class="k">public</span> <span class="k">function</span> <span class="fm">__construct</span><span class="p">(</span><span class="nx">DatabaseInterface</span> <span class="nv">$dbi</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">dbi</span> <span class="o">=</span> <span class="nv">$dbi</span><span class="p">;</span>
    <span class="p">}</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="no-return-used">
<span id="case-no-return-used"></span><h3><span class="section-number">5.2.71. </span>No Return Used<a class="headerlink" href="#no-return-used" title="Permalink to this headline">¶</a></h3>
<div class="section" id="case-spip-functions-noreturnused">
<span id="id71"></span><h4><span class="section-number">5.2.71.1. </span>SPIP<a class="headerlink" href="#case-spip-functions-noreturnused" title="Permalink to this headline">¶</a></h4>
<p><a class="reference internal" href="Rules.html#no-return-used"><span class="std std-ref">No Return Used</span></a>, in ecrire/inc/utils.php:1067.</p>
<p>job_queue_remove() is called as an administration order, and the result is not checked. It is considered as a fire-and-forget command.</p>
<div class="highlight-php notranslate"><div class="highlight"><pre><span></span><span class="k">function</span> <span class="nf">job_queue_remove</span><span class="p">(</span><span class="nv">$id_job</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">include_spip</span><span class="p">(</span><span class="s1">&#39;inc/queue&#39;</span><span class="p">);</span>

    <span class="k">return</span> <span class="nx">queue_remove_job</span><span class="p">(</span><span class="nv">$id_job</span><span class="p">);</span>
<span class="p">}</span>
</pre></div>
</div>
</div>
<div class="section" id="case-livezilla-functions-noreturnused">
<span id="id72"></span><h4><span class="section-number">5.2.71.2. </span>LiveZilla<a class="headerlink" href="#case-livezilla-functions-noreturnused" title="Permalink to this headline">¶</a></h4>
<p><a class="reference internal" href="Rules.html#no-return-used"><span class="std std-ref">No Return Used</span></a>, in livezilla/_lib/trdp/Zend/Loader.php:114.</p>
<p>The loadFile method tries to load a file, aka as include. If the inclusion fails, a PHP error is emitted (an exception would do the same), and there is not error management. Hence, the ‘return true;’, which is not tested later. It may be dropped.</p>
<div class="highlight-php notranslate"><div class="highlight"><pre><span></span><span class="k">public</span> <span class="k">static</span> <span class="k">function</span> <span class="nf">loadFile</span><span class="p">(</span><span class="nv">$filename</span><span class="p">,</span> <span class="nv">$dirs</span> <span class="o">=</span> <span class="k">null</span><span class="p">,</span> <span class="nv">$once</span> <span class="o">=</span> <span class="k">false</span><span class="p">)</span>
    <span class="p">{</span>
<span class="c1">// A lot of code to check and include files</span>

        <span class="k">return</span> <span class="k">true</span><span class="p">;</span>
    <span class="p">}</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="one-letter-functions">
<span id="case-one-letter-functions"></span><h3><span class="section-number">5.2.72. </span>One Letter Functions<a class="headerlink" href="#one-letter-functions" title="Permalink to this headline">¶</a></h3>
<div class="section" id="thinkphp">
<span id="case-thinkphp-functions-oneletterfunctions"></span><h4><span class="section-number">5.2.72.1. </span>ThinkPHP<a class="headerlink" href="#thinkphp" title="Permalink to this headline">¶</a></h4>
<p><a class="reference internal" href="Rules.html#one-letter-functions"><span class="std std-ref">One Letter Functions</span></a>, in ThinkPHP/Mode/Api/functions.php:859.</p>
<p>There are also the functions C, E, G… The applications is written in a foreign language, which may be a base for non-significant function names.</p>
<div class="highlight-php notranslate"><div class="highlight"><pre><span></span><span class="k">function</span> <span class="nf">F</span><span class="p">(</span><span class="nv">$name</span><span class="p">,</span> <span class="nv">$value</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="nv">$path</span> <span class="o">=</span> <span class="nx">DATA_PATH</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="section" id="case-cleverstyle-functions-oneletterfunctions">
<span id="id73"></span><h4><span class="section-number">5.2.72.2. </span>Cleverstyle<a class="headerlink" href="#case-cleverstyle-functions-oneletterfunctions" title="Permalink to this headline">¶</a></h4>
<p><a class="reference internal" href="Rules.html#one-letter-functions"><span class="std std-ref">One Letter Functions</span></a>, in core/drivers/DB/PostgreSQL.php:71.</p>
<p>There is also function f(). Those are actually overwritten methods. From the documentation, q() is for query, and f() is for fetch. Those are short names for frequently used functions.</p>
<div class="highlight-php notranslate"><div class="highlight"><pre><span></span><span class="k">public</span> <span class="k">function</span> <span class="nf">q</span> <span class="p">(</span><span class="nv">$query</span><span class="p">,</span> <span class="o">...</span><span class="nv">$params</span><span class="p">)</span> <span class="p">{</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="only-variable-passed-by-reference">
<span id="case-only-variable-passed-by-reference"></span><h3><span class="section-number">5.2.73. </span>Only Variable Passed By Reference<a class="headerlink" href="#only-variable-passed-by-reference" title="Permalink to this headline">¶</a></h3>
<div class="section" id="case-dolphin-functions-onlyvariablepassedbyreference">
<span id="id74"></span><h4><span class="section-number">5.2.73.1. </span>Dolphin<a class="headerlink" href="#case-dolphin-functions-onlyvariablepassedbyreference" title="Permalink to this headline">¶</a></h4>
<p><a class="reference internal" href="Rules.html#only-variable-passed-by-reference"><span class="std std-ref">Only Variable Passed By Reference</span></a>, in administration/charts.json.php:89.</p>
<p>This is not possible, as array_slice() returns a new array, and not a reference. Minimally, the intermediate result must be saved in a variable, then popped. Actually, this code extracts the element at key 1 in the $aData array, although this also works with hash (non-numeric keys).</p>
<div class="highlight-php notranslate"><div class="highlight"><pre><span></span><span class="nb">array_pop</span><span class="p">(</span><span class="nb">array_slice</span><span class="p">(</span><span class="nv">$aData</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">))</span>
</pre></div>
</div>
</div>
<div class="section" id="phpipam">
<span id="case-phpipam-functions-onlyvariablepassedbyreference"></span><h4><span class="section-number">5.2.73.2. </span>PhpIPAM<a class="headerlink" href="#phpipam" title="Permalink to this headline">¶</a></h4>
<p><a class="reference internal" href="Rules.html#only-variable-passed-by-reference"><span class="std std-ref">Only Variable Passed By Reference</span></a>, in functions/classes/class.Thread.php:243.</p>
<p>This is sneaky bug : the assignation $status = 0 returns a value, and not a variable. This leads PHP to mistake the initialized 0 with the variable $status and fails. It is not possible to initialize variable AND use them as argument.</p>
<div class="highlight-php notranslate"><div class="highlight"><pre><span></span><span class="nb">pcntl_waitpid</span><span class="p">(</span><span class="nv">$this</span><span class="o">-&gt;</span><span class="na">pid</span><span class="p">,</span> <span class="nv">$status</span> <span class="o">=</span> <span class="mi">0</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="relay-function">
<span id="case-relay-function"></span><h3><span class="section-number">5.2.74. </span>Relay Function<a class="headerlink" href="#relay-function" title="Permalink to this headline">¶</a></h3>
<div class="section" id="case-teampass-functions-relayfunction">
<span id="id75"></span><h4><span class="section-number">5.2.74.1. </span>TeamPass<a class="headerlink" href="#case-teampass-functions-relayfunction" title="Permalink to this headline">¶</a></h4>
<p><a class="reference internal" href="Rules.html#relay-function"><span class="std std-ref">Relay Function</span></a>, in includes/libraries/Goodby/CSV/Import/Standard/Interpreter.php:88.</p>
<p>This example puts actually a name on the events : this method ‘delegate’ and it does it in the smallest amount of possible work, being given all the arguments.</p>
<div class="highlight-php notranslate"><div class="highlight"><pre><span></span><span class="sd">/**</span>
<span class="sd">     * delegate to observer</span>
<span class="sd">     *</span>
<span class="sd">     * @param $observer</span>
<span class="sd">     * @param $line</span>
<span class="sd">     */</span>
    <span class="k">private</span> <span class="k">function</span> <span class="nf">delegate</span><span class="p">(</span><span class="nv">$observer</span><span class="p">,</span> <span class="nv">$line</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="nb">call_user_func</span><span class="p">(</span><span class="nv">$observer</span><span class="p">,</span> <span class="nv">$line</span><span class="p">);</span>
    <span class="p">}</span>
</pre></div>
</div>
</div>
<div class="section" id="case-spip-functions-relayfunction">
<span id="id76"></span><h4><span class="section-number">5.2.74.2. </span>SPIP<a class="headerlink" href="#case-spip-functions-relayfunction" title="Permalink to this headline">¶</a></h4>
<p><a class="reference internal" href="Rules.html#relay-function"><span class="std std-ref">Relay Function</span></a>, in ecrire/inc/json.php:73.</p>
<p>var2js() acts as an alternative for json_encode(). Yet, it used to be directly called by the framework’s code and difficult to change. With the advent of json_encode, the native function has been used, and even, a compatibility tool was set up. Thus, the relay function.</p>
<div class="highlight-php notranslate"><div class="highlight"><pre><span></span><span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nb">function_exists</span><span class="p">(</span><span class="s1">&#39;json_encode&#39;</span><span class="p">))</span> <span class="p">{</span>
    <span class="k">function</span> <span class="nf">json_encode</span><span class="p">(</span><span class="nv">$v</span><span class="p">)</span> <span class="p">{</span>
            <span class="k">return</span> <span class="nx">var2js</span><span class="p">(</span><span class="nv">$v</span><span class="p">);</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="argument-should-be-typehinted">
<span id="case-argument-should-be-typehinted"></span><h3><span class="section-number">5.2.75. </span>Argument Should Be Typehinted<a class="headerlink" href="#argument-should-be-typehinted" title="Permalink to this headline">¶</a></h3>
<div class="section" id="case-dolphin-functions-shouldbetypehinted">
<span id="id77"></span><h4><span class="section-number">5.2.75.1. </span>Dolphin<a class="headerlink" href="#case-dolphin-functions-shouldbetypehinted" title="Permalink to this headline">¶</a></h4>
<p><a class="reference internal" href="Rules.html#argument-should-be-typehinted"><span class="std std-ref">Argument Should Be Typehinted</span></a>, in Dolphin-v.7.3.5/plugins/intervention-image/Intervention/Image/Gd/Commands/WidenCommand.php:20.</p>
<p>This closures make immediate use of the $constraint argument, and calls its method aspectRatio. No check is made on this argument, and it may easily be mistaken with another class, or a null. Adding a typehint here will ensure a more verbose development error and help detect misuse of the closure.</p>
<div class="highlight-php notranslate"><div class="highlight"><pre><span></span><span class="nv">$this</span><span class="o">-&gt;</span><span class="na">arguments</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">=</span> <span class="k">function</span> <span class="p">(</span><span class="nv">$constraint</span><span class="p">)</span> <span class="k">use</span> <span class="p">(</span><span class="nv">$additionalConstraints</span><span class="p">)</span> <span class="p">{</span>
            <span class="nv">$constraint</span><span class="o">-&gt;</span><span class="na">aspectRatio</span><span class="p">();</span>
            <span class="k">if</span><span class="p">(</span><span class="nb">is_callable</span><span class="p">(</span><span class="nv">$additionalConstraints</span><span class="p">))</span>
                <span class="nv">$additionalConstraints</span><span class="p">(</span><span class="nv">$constraint</span><span class="p">);</span>
        <span class="p">};</span>
</pre></div>
</div>
</div>
<div class="section" id="case-mautic-functions-shouldbetypehinted">
<span id="id78"></span><h4><span class="section-number">5.2.75.2. </span>Mautic<a class="headerlink" href="#case-mautic-functions-shouldbetypehinted" title="Permalink to this headline">¶</a></h4>
<p><a class="reference internal" href="Rules.html#argument-should-be-typehinted"><span class="std std-ref">Argument Should Be Typehinted</span></a>, in app/bundles/PluginBundle/Helper/IntegrationHelper.php:374.</p>
<p>This piece of code inside a 275 lines method. Besides, there are 11 classes that offer a ‘getPriority’ method, although $returnServices could help to semantically reduce the number of possible classes. Here, typehints on $a and $b help using the wrong kind of object.</p>
<div class="highlight-php notranslate"><div class="highlight"><pre><span></span><span class="k">if</span> <span class="p">(</span><span class="k">empty</span><span class="p">(</span><span class="nv">$alphabetical</span><span class="p">))</span> <span class="p">{</span>
            <span class="c1">// Sort by priority</span>
            <span class="nb">uasort</span><span class="p">(</span><span class="nv">$returnServices</span><span class="p">,</span> <span class="k">function</span> <span class="p">(</span><span class="nv">$a</span><span class="p">,</span> <span class="nv">$b</span><span class="p">)</span> <span class="p">{</span>
                <span class="nv">$aP</span> <span class="o">=</span> <span class="p">(</span><span class="nx">int</span><span class="p">)</span> <span class="nv">$a</span><span class="o">-&gt;</span><span class="na">getPriority</span><span class="p">();</span>
                <span class="nv">$bP</span> <span class="o">=</span> <span class="p">(</span><span class="nx">int</span><span class="p">)</span> <span class="nv">$b</span><span class="o">-&gt;</span><span class="na">getPriority</span><span class="p">();</span>

                <span class="k">if</span> <span class="p">(</span><span class="nv">$aP</span> <span class="o">===</span> <span class="nv">$bP</span><span class="p">)</span> <span class="p">{</span>
                    <span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
                <span class="p">}</span>

                <span class="k">return</span> <span class="p">(</span><span class="nv">$aP</span> <span class="o">&lt;</span> <span class="nv">$bP</span><span class="p">)</span> <span class="o">?</span> <span class="o">-</span><span class="mi">1</span> <span class="o">:</span> <span class="mi">1</span><span class="p">;</span>
            <span class="p">});</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="should-use-constants">
<span id="case-should-use-constants"></span><h3><span class="section-number">5.2.76. </span>Should Use Constants<a class="headerlink" href="#should-use-constants" title="Permalink to this headline">¶</a></h3>
<div class="section" id="case-tine20-functions-shoulduseconstants">
<span id="id79"></span><h4><span class="section-number">5.2.76.1. </span>Tine20<a class="headerlink" href="#case-tine20-functions-shoulduseconstants" title="Permalink to this headline">¶</a></h4>
<p><a class="reference internal" href="Rules.html#should-use-constants"><span class="std std-ref">Should Use Constants</span></a>, in tine20/Sales/Controller/Invoice.php:560.</p>
<p>True should be replaced by COUNT_RECURSIVE. The default one is COUNT_NORMAL.</p>
<div class="highlight-php notranslate"><div class="highlight"><pre><span></span><span class="nb">count</span><span class="p">(</span><span class="nv">$billables</span><span class="p">,</span> <span class="k">true</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="too-many-local-variables">
<span id="case-too-many-local-variables"></span><h3><span class="section-number">5.2.77. </span>Too Many Local Variables<a class="headerlink" href="#too-many-local-variables" title="Permalink to this headline">¶</a></h3>
<div class="section" id="case-humo-gen-functions-toomanylocalvariables">
<span id="id80"></span><h4><span class="section-number">5.2.77.1. </span>HuMo-Gen<a class="headerlink" href="#case-humo-gen-functions-toomanylocalvariables" title="Permalink to this headline">¶</a></h4>
<p><a class="reference internal" href="Rules.html#too-many-local-variables"><span class="std std-ref">Too Many Local Variables</span></a>, in relations.php:813.</p>
<p>15 local variables pieces of code are hard to find in a compact form. This function shows one classic trait of such issue : a large ifthen is at the core of the function, and each time, it collects some values and build a larger string. This should probably be split between different methods in a class.</p>
<div class="highlight-php notranslate"><div class="highlight"><pre><span></span><span class="k">function</span> <span class="nf">calculate_nephews</span><span class="p">(</span><span class="nv">$generX</span><span class="p">)</span> <span class="p">{</span> <span class="c1">// handed generations x is removed from common ancestor</span>
<span class="k">global</span> <span class="nv">$db_functions</span><span class="p">,</span> <span class="nv">$reltext</span><span class="p">,</span> <span class="nv">$sexe</span><span class="p">,</span> <span class="nv">$sexe2</span><span class="p">,</span> <span class="nv">$language</span><span class="p">,</span> <span class="nv">$spantext</span><span class="p">,</span> <span class="nv">$selected_language</span><span class="p">,</span> <span class="nv">$foundX_nr</span><span class="p">,</span> <span class="nv">$rel_arrayX</span><span class="p">,</span> <span class="nv">$rel_arrayspouseX</span><span class="p">,</span> <span class="nv">$spouse</span><span class="p">;</span>
<span class="k">global</span> <span class="nv">$reltext_nor</span><span class="p">,</span> <span class="nv">$reltext_nor2</span><span class="p">;</span> <span class="c1">// for Norwegian and Danish</span>

    <span class="k">if</span><span class="p">(</span><span class="nv">$selected_language</span><span class="o">==</span><span class="s2">&quot;es&quot;</span><span class="p">){</span>
            <span class="k">if</span><span class="p">(</span><span class="nv">$sexe</span><span class="o">==</span><span class="s2">&quot;m&quot;</span><span class="p">)</span> <span class="p">{</span> <span class="nv">$neph</span><span class="o">=</span><span class="nx">__</span><span class="p">(</span><span class="s1">&#39;nephew&#39;</span><span class="p">);</span> <span class="nv">$span_postfix</span><span class="o">=</span><span class="s2">&quot;o &quot;</span><span class="p">;</span> <span class="nv">$grson</span><span class="o">=</span><span class="s1">&#39;nieto&#39;</span><span class="p">;</span> <span class="p">}</span>
            <span class="k">else</span> <span class="p">{</span> <span class="nv">$neph</span><span class="o">=</span><span class="nx">__</span><span class="p">(</span><span class="s1">&#39;niece&#39;</span><span class="p">);</span> <span class="nv">$span_postfix</span><span class="o">=</span><span class="s2">&quot;a &quot;</span><span class="p">;</span> <span class="nv">$grson</span><span class="o">=</span><span class="s1">&#39;nieta&#39;</span><span class="p">;</span> <span class="p">}</span>
            <span class="c1">//$gendiff = abs($generX - $generY); // FOUT</span>
            <span class="nv">$gendiff</span> <span class="o">=</span> <span class="nb">abs</span><span class="p">(</span><span class="nv">$generX</span> <span class="o">-</span> <span class="nv">$generY</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span><span class="p">;</span>
            <span class="nv">$gennr</span><span class="o">=</span><span class="nv">$gendiff</span><span class="o">-</span><span class="mi">1</span><span class="p">;</span>
            <span class="nv">$degree</span><span class="o">=</span><span class="nv">$grson</span><span class="o">.</span><span class="s2">&quot; &quot;</span><span class="o">.</span><span class="nv">$gennr</span><span class="o">.</span><span class="nv">$span_postfix</span><span class="p">;</span>
            <span class="k">if</span><span class="p">(</span><span class="nv">$gendiff</span> <span class="o">==</span><span class="mi">1</span><span class="p">)</span> <span class="p">{</span> <span class="nv">$reltext</span><span class="o">=</span><span class="nv">$neph</span><span class="o">.</span><span class="nx">__</span><span class="p">(</span><span class="s1">&#39; of &#39;</span><span class="p">);}</span>
            <span class="k">elseif</span><span class="p">(</span><span class="nv">$gendiff</span> <span class="o">&gt;</span> <span class="mi">1</span> <span class="k">AND</span> <span class="nv">$gendiff</span> <span class="o">&lt;</span> <span class="mi">27</span><span class="p">)</span> <span class="p">{</span>
                    <span class="nx">spanish_degrees</span><span class="p">(</span><span class="nv">$gendiff</span><span class="p">,</span><span class="nv">$grson</span><span class="p">);</span>
                    <span class="nv">$reltext</span><span class="o">=</span><span class="nv">$neph</span><span class="o">.</span><span class="s2">&quot; &quot;</span><span class="o">.</span><span class="nv">$spantext</span><span class="o">.</span><span class="nx">__</span><span class="p">(</span><span class="s1">&#39; of &#39;</span><span class="p">);</span>
            <span class="p">}</span>
            <span class="k">else</span> <span class="p">{</span> <span class="nv">$reltext</span><span class="o">=</span><span class="nv">$neph</span><span class="o">.</span><span class="s2">&quot; &quot;</span><span class="o">.</span><span class="nv">$degree</span><span class="p">;</span> <span class="p">}</span>
    <span class="p">}</span> <span class="k">elseif</span> <span class="p">(</span><span class="nv">$selected_language</span><span class="o">==</span><span class="nx">he</span><span class="p">){</span>
            <span class="k">if</span><span class="p">(</span><span class="nv">$sexe</span><span class="o">==</span><span class="s1">&#39;m&#39;</span><span class="p">)</span> <span class="p">{</span> <span class="nv">$nephniece</span> <span class="o">=</span> <span class="nx">__</span><span class="p">(</span><span class="s1">&#39;nephew&#39;</span><span class="p">);</span> <span class="p">}</span>
<span class="c1">///............</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="too-many-parameters">
<span id="case-too-many-parameters"></span><h3><span class="section-number">5.2.78. </span>Too Many Parameters<a class="headerlink" href="#too-many-parameters" title="Permalink to this headline">¶</a></h3>
<div class="section" id="case-wordpress-functions-toomanyparameters">
<span id="id81"></span><h4><span class="section-number">5.2.78.1. </span>WordPress<a class="headerlink" href="#case-wordpress-functions-toomanyparameters" title="Permalink to this headline">¶</a></h4>
<p><a class="reference internal" href="Rules.html#too-many-parameters"><span class="std std-ref">Too Many Parameters</span></a>, in wp-admin/includes/misc.php:74.</p>
<p>11 parameters is a lot for a function. Note that it is more than the default configuration, and reported there. This may be configured.</p>
<div class="highlight-php notranslate"><div class="highlight"><pre><span></span><span class="sd">/**</span>
<span class="sd"> * [identifyUserRights description]</span>
<span class="sd"> * @param  string $groupesVisiblesUser  [description]</span>
<span class="sd"> * @param  string $groupesInterditsUser [description]</span>
<span class="sd"> * @param  string $isAdmin              [description]</span>
<span class="sd"> * @param  string $idFonctions          [description]</span>
<span class="sd"> * @return string                       [description]</span>
<span class="sd"> */</span>
<span class="k">function</span> <span class="nf">identifyUserRights</span><span class="p">(</span>
    <span class="nv">$groupesVisiblesUser</span><span class="p">,</span>
    <span class="nv">$groupesInterditsUser</span><span class="p">,</span>
    <span class="nv">$isAdmin</span><span class="p">,</span>
    <span class="nv">$idFonctions</span><span class="p">,</span>
    <span class="nv">$server</span><span class="p">,</span>
    <span class="nv">$user</span><span class="p">,</span>
    <span class="nv">$pass</span><span class="p">,</span>
    <span class="nv">$database</span><span class="p">,</span>
    <span class="nv">$port</span><span class="p">,</span>
    <span class="nv">$encoding</span><span class="p">,</span>
    <span class="nv">$SETTINGS</span>
<span class="p">)</span> <span class="p">{</span>
</pre></div>
</div>
</div>
<div class="section" id="case-churchcrm-functions-toomanyparameters">
<span id="id82"></span><h4><span class="section-number">5.2.78.2. </span>ChurchCRM<a class="headerlink" href="#case-churchcrm-functions-toomanyparameters" title="Permalink to this headline">¶</a></h4>
<p><a class="reference internal" href="Rules.html#too-many-parameters"><span class="std std-ref">Too Many Parameters</span></a>, in src/Reports/ReminderReport.php:192.</p>
<p>10 parameters is a lot for a function. Here, we may also identify a family (ID, Name), and a full address (Address1, Address2, State, Zip, Country), which may be turned into an object.</p>
<div class="highlight-php notranslate"><div class="highlight"><pre><span></span><span class="k">public</span> <span class="k">function</span> <span class="nf">StartNewPage</span><span class="p">(</span><span class="nv">$fam_ID</span><span class="p">,</span> <span class="nv">$fam_Name</span><span class="p">,</span> <span class="nv">$fam_Address1</span><span class="p">,</span> <span class="nv">$fam_Address2</span><span class="p">,</span> <span class="nv">$fam_City</span><span class="p">,</span> <span class="nv">$fam_State</span><span class="p">,</span> <span class="nv">$fam_Zip</span><span class="p">,</span> <span class="nv">$fam_Country</span><span class="p">,</span> <span class="nv">$fundOnlyString</span><span class="p">,</span> <span class="nv">$iFYID</span><span class="p">)</span>
<span class="p">{</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="unused-arguments">
<span id="case-unused-arguments"></span><h3><span class="section-number">5.2.79. </span>Unused Arguments<a class="headerlink" href="#unused-arguments" title="Permalink to this headline">¶</a></h3>
<div class="section" id="case-thinkphp-functions-unusedarguments">
<span id="id83"></span><h4><span class="section-number">5.2.79.1. </span>ThinkPHP<a class="headerlink" href="#case-thinkphp-functions-unusedarguments" title="Permalink to this headline">¶</a></h4>
<p><a class="reference internal" href="Rules.html#unused-arguments"><span class="std std-ref">Unused Arguments</span></a>, in ThinkPHP/Library/Behavior/AgentCheckBehavior.class.php:18.</p>
<p>$params are requested, but never used. The method is not overloading another one, as the class doesn’t extends anything. $params is unused.</p>
<div class="highlight-php notranslate"><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">AgentCheckBehavior</span>
<span class="p">{</span>
    <span class="k">public</span> <span class="k">function</span> <span class="nf">run</span><span class="p">(</span><span class="o">&amp;</span><span class="nv">$params</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="c1">// 代理访问检测</span>
        <span class="nv">$limitProxyVisit</span> <span class="o">=</span> <span class="nx">C</span><span class="p">(</span><span class="s1">&#39;LIMIT_PROXY_VISIT&#39;</span><span class="p">,</span> <span class="k">null</span><span class="p">,</span> <span class="k">true</span><span class="p">);</span>
        <span class="k">if</span> <span class="p">(</span><span class="nv">$limitProxyVisit</span> <span class="o">&amp;&amp;</span> <span class="p">(</span><span class="nv">$_SERVER</span><span class="p">[</span><span class="s1">&#39;HTTP_X_FORWARDED_FOR&#39;</span><span class="p">]</span> <span class="o">||</span> <span class="nv">$_SERVER</span><span class="p">[</span><span class="s1">&#39;HTTP_VIA&#39;</span><span class="p">]</span> <span class="o">||</span> <span class="nv">$_SERVER</span><span class="p">[</span><span class="s1">&#39;HTTP_PROXY_CONNECTION&#39;</span><span class="p">]</span> <span class="o">||</span> <span class="nv">$_SERVER</span><span class="p">[</span><span class="s1">&#39;HTTP_USER_AGENT_VIA&#39;</span><span class="p">]))</span> <span class="p">{</span>
            <span class="c1">// 禁止代理访问</span>
            <span class="k">exit</span><span class="p">(</span><span class="s1">&#39;Access Denied&#39;</span><span class="p">);</span>
        <span class="p">}</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
</div>
<div class="section" id="case-phpmyadmin-functions-unusedarguments">
<span id="id84"></span><h4><span class="section-number">5.2.79.2. </span>phpMyAdmin<a class="headerlink" href="#case-phpmyadmin-functions-unusedarguments" title="Permalink to this headline">¶</a></h4>
<p><a class="reference internal" href="Rules.html#unused-arguments"><span class="std std-ref">Unused Arguments</span></a>, in libraries/classes/Display/Results.php:1985.</p>
<p>Although $column_index is documented, it is not found in the rest of the (long) body of the function. It might have been refactored into $sorted_column_index.</p>
<div class="highlight-php notranslate"><div class="highlight"><pre><span></span><span class="sd">/**</span>
<span class="sd">     * Prepare parameters and html for sorted table header fields</span>
<span class="sd">     *</span>
<span class="sd">     * @param array    $sort_expression             sort expression</span>
<span class="sd">     * @param array    $sort_expression_nodirection sort expression without direction</span>
<span class="sd">     * @param string   $sort_tbl                    The name of the table to which</span>
<span class="sd">     *                                             the current column belongs to</span>
<span class="sd">     * @param string   $name_to_use_in_sort         The current column under</span>
<span class="sd">     *                                             consideration</span>
<span class="sd">     * @param array    $sort_direction              sort direction</span>
<span class="sd">     * @param stdClass $fields_meta                 set of field properties</span>
<span class="sd">     * @param integer  $column_index                The index number to current column</span>
<span class="sd">     *</span>
<span class="sd">     * @return  array   3 element array - $single_sort_order, $sort_order, $order_img</span>
<span class="sd">     *</span>
<span class="sd">     * @access  private</span>
<span class="sd">     *</span>
<span class="sd">     * @see     _getOrderLinkAndSortedHeaderHtml()</span>
<span class="sd">     */</span>
    <span class="k">private</span> <span class="k">function</span> <span class="nf">_getSingleAndMultiSortUrls</span><span class="p">(</span>
        <span class="k">array</span> <span class="nv">$sort_expression</span><span class="p">,</span>
        <span class="k">array</span> <span class="nv">$sort_expression_nodirection</span><span class="p">,</span>
        <span class="nv">$sort_tbl</span><span class="p">,</span>
        <span class="nv">$name_to_use_in_sort</span><span class="p">,</span>
        <span class="k">array</span> <span class="nv">$sort_direction</span><span class="p">,</span>
        <span class="nv">$fields_meta</span><span class="p">,</span>
        <span class="nv">$column_index</span>
    <span class="p">)</span> <span class="p">{</span>
    <span class="cm">/**/</span>
        <span class="c1">// find the sorted column index in row result</span>
        <span class="c1">// (this might be a multi-table query)</span>
        <span class="nv">$sorted_column_index</span> <span class="o">=</span> <span class="k">false</span><span class="p">;</span>
    <span class="cm">/**/</span>
    <span class="p">}</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="unused-functions">
<span id="case-unused-functions"></span><h3><span class="section-number">5.2.80. </span>Unused Functions<a class="headerlink" href="#unused-functions" title="Permalink to this headline">¶</a></h3>
<div class="section" id="case-woocommerce-functions-unusedfunctions">
<span id="id85"></span><h4><span class="section-number">5.2.80.1. </span>Woocommerce<a class="headerlink" href="#case-woocommerce-functions-unusedfunctions" title="Permalink to this headline">¶</a></h4>
<p><a class="reference internal" href="Rules.html#unused-functions"><span class="std std-ref">Unused Functions</span></a>, in includes/wc-core-functions.php:2124.</p>
<p>wc_is_external_resource() is unused. This is not obvious immediately, since there is a call from wc_get_relative_url(). Yet since wc_get_relative_url() itself is never used, then it is a dead function. As such, since wc_is_external_resource() is only called by this first function, it also dies, even though it is called in the code.</p>
<div class="highlight-php notranslate"><div class="highlight"><pre><span></span><span class="sd">/**</span>
<span class="sd"> * Make a URL relative, if possible.</span>
<span class="sd"> *</span>
<span class="sd"> * @since 3.2.0</span>
<span class="sd"> * @param string $url URL to make relative.</span>
<span class="sd"> * @return string</span>
<span class="sd"> */</span>
<span class="k">function</span> <span class="nf">wc_get_relative_url</span><span class="p">(</span> <span class="nv">$url</span> <span class="p">)</span> <span class="p">{</span>
    <span class="k">return</span> <span class="nx">wc_is_external_resource</span><span class="p">(</span> <span class="nv">$url</span> <span class="p">)</span> <span class="o">?</span> <span class="nv">$url</span> <span class="o">:</span> <span class="nb">str_replace</span><span class="p">(</span> <span class="k">array</span><span class="p">(</span> <span class="s1">&#39;http://&#39;</span><span class="p">,</span> <span class="s1">&#39;https://&#39;</span> <span class="p">),</span> <span class="s1">&#39;//&#39;</span><span class="p">,</span> <span class="nv">$url</span> <span class="p">);</span>
<span class="p">}</span>

<span class="sd">/**</span>
<span class="sd"> * See if a resource is remote.</span>
<span class="sd"> *</span>
<span class="sd"> * @since 3.2.0</span>
<span class="sd"> * @param string $url URL to check.</span>
<span class="sd"> * @return bool</span>
<span class="sd"> */</span>
<span class="k">function</span> <span class="nf">wc_is_external_resource</span><span class="p">(</span> <span class="nv">$url</span> <span class="p">)</span> <span class="p">{</span>
    <span class="nv">$wp_base</span> <span class="o">=</span> <span class="nb">str_replace</span><span class="p">(</span> <span class="k">array</span><span class="p">(</span> <span class="s1">&#39;http://&#39;</span><span class="p">,</span> <span class="s1">&#39;https://&#39;</span> <span class="p">),</span> <span class="s1">&#39;//&#39;</span><span class="p">,</span> <span class="nx">get_home_url</span><span class="p">(</span> <span class="k">null</span><span class="p">,</span> <span class="s1">&#39;/&#39;</span><span class="p">,</span> <span class="s1">&#39;http&#39;</span> <span class="p">)</span> <span class="p">);</span>

    <span class="k">return</span> <span class="nb">strstr</span><span class="p">(</span> <span class="nv">$url</span><span class="p">,</span> <span class="s1">&#39;://&#39;</span> <span class="p">)</span> <span class="o">&amp;&amp;</span> <span class="o">!</span> <span class="nb">strstr</span><span class="p">(</span> <span class="nv">$url</span><span class="p">,</span> <span class="nv">$wp_base</span> <span class="p">);</span>
<span class="p">}</span>
</pre></div>
</div>
</div>
<div class="section" id="case-piwigo-functions-unusedfunctions">
<span id="id86"></span><h4><span class="section-number">5.2.80.2. </span>Piwigo<a class="headerlink" href="#case-piwigo-functions-unusedfunctions" title="Permalink to this headline">¶</a></h4>
<p><a class="reference internal" href="Rules.html#unused-functions"><span class="std std-ref">Unused Functions</span></a>, in admin/include/functions.php:2167.</p>
<p>get_user_access_level_html_options() is unused and can’t be find in the code.</p>
<div class="highlight-php notranslate"><div class="highlight"><pre><span></span><span class="sd">/**</span>
<span class="sd"> * Returns access levels as array used on template with html_options functions.</span>
<span class="sd"> *</span>
<span class="sd"> * @param int $MinLevelAccess</span>
<span class="sd"> * @param int $MaxLevelAccess</span>
<span class="sd"> * @return array</span>
<span class="sd"> */</span>
<span class="k">function</span> <span class="nf">get_user_access_level_html_options</span><span class="p">(</span><span class="nv">$MinLevelAccess</span> <span class="o">=</span> <span class="nx">ACCESS_FREE</span><span class="p">,</span> <span class="nv">$MaxLevelAccess</span> <span class="o">=</span> <span class="nx">ACCESS_CLOSED</span><span class="p">)</span>
<span class="p">{</span>
  <span class="nv">$tpl_options</span> <span class="o">=</span> <span class="k">array</span><span class="p">();</span>
  <span class="k">for</span> <span class="p">(</span><span class="nv">$level</span> <span class="o">=</span> <span class="nv">$MinLevelAccess</span><span class="p">;</span> <span class="nv">$level</span> <span class="o">&lt;=</span> <span class="nv">$MaxLevelAccess</span><span class="p">;</span> <span class="nv">$level</span><span class="o">++</span><span class="p">)</span>
  <span class="p">{</span>
    <span class="nv">$tpl_options</span><span class="p">[</span><span class="nv">$level</span><span class="p">]</span> <span class="o">=</span> <span class="nx">l10n</span><span class="p">(</span><span class="nb">sprintf</span><span class="p">(</span><span class="s1">&#39;ACCESS_%d&#39;</span><span class="p">,</span> <span class="nv">$level</span><span class="p">));</span>
  <span class="p">}</span>
  <span class="k">return</span> <span class="nv">$tpl_options</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="unused-inherited-variable-in-closure">
<span id="case-unused-inherited-variable-in-closure"></span><h3><span class="section-number">5.2.81. </span>Unused Inherited Variable In Closure<a class="headerlink" href="#unused-inherited-variable-in-closure" title="Permalink to this headline">¶</a></h3>
<div class="section" id="case-shopware-functions-unusedinheritedvariable">
<span id="id87"></span><h4><span class="section-number">5.2.81.1. </span>shopware<a class="headerlink" href="#case-shopware-functions-unusedinheritedvariable" title="Permalink to this headline">¶</a></h4>
<p><a class="reference internal" href="Rules.html#unused-inherited-variable-in-closure"><span class="std std-ref">Unused Inherited Variable In Closure</span></a>, in recovery/update/src/app.php:129.</p>
<p>In the first closuree, $containere is used as the root for the method calls, but $app is not used. It may be dropped. In fact, some of the following calls to $app-&gt;map() only request one inherited, $container.</p>
<div class="highlight-php notranslate"><div class="highlight"><pre><span></span><span class="nv">$app</span><span class="o">-&gt;</span><span class="na">map</span><span class="p">(</span><span class="s1">&#39;/applyMigrations&#39;</span><span class="p">,</span> <span class="k">function</span> <span class="p">()</span> <span class="k">use</span> <span class="p">(</span><span class="nv">$app</span><span class="p">,</span> <span class="nv">$container</span><span class="p">)</span> <span class="p">{</span>
    <span class="nv">$container</span><span class="o">-&gt;</span><span class="na">get</span><span class="p">(</span><span class="s1">&#39;controller.batch&#39;</span><span class="p">)</span><span class="o">-&gt;</span><span class="na">applyMigrations</span><span class="p">();</span>
<span class="p">})</span><span class="o">-&gt;</span><span class="na">via</span><span class="p">(</span><span class="s1">&#39;GET&#39;</span><span class="p">,</span> <span class="s1">&#39;POST&#39;</span><span class="p">)</span><span class="o">-&gt;</span><span class="na">name</span><span class="p">(</span><span class="s1">&#39;applyMigrations&#39;</span><span class="p">);</span>

<span class="nv">$app</span><span class="o">-&gt;</span><span class="na">map</span><span class="p">(</span><span class="s1">&#39;/importSnippets&#39;</span><span class="p">,</span> <span class="k">function</span> <span class="p">()</span> <span class="k">use</span> <span class="p">(</span><span class="nv">$container</span><span class="p">)</span> <span class="p">{</span>
    <span class="nv">$container</span><span class="o">-&gt;</span><span class="na">get</span><span class="p">(</span><span class="s1">&#39;controller.batch&#39;</span><span class="p">)</span><span class="o">-&gt;</span><span class="na">importSnippets</span><span class="p">();</span>
<span class="p">})</span><span class="o">-&gt;</span><span class="na">via</span><span class="p">(</span><span class="s1">&#39;GET&#39;</span><span class="p">,</span> <span class="s1">&#39;POST&#39;</span><span class="p">)</span><span class="o">-&gt;</span><span class="na">name</span><span class="p">(</span><span class="s1">&#39;importSnippets&#39;</span><span class="p">);</span>
</pre></div>
</div>
</div>
<div class="section" id="case-mautic-functions-unusedinheritedvariable">
<span id="id88"></span><h4><span class="section-number">5.2.81.2. </span>Mautic<a class="headerlink" href="#case-mautic-functions-unusedinheritedvariable" title="Permalink to this headline">¶</a></h4>
<p><a class="reference internal" href="Rules.html#unused-inherited-variable-in-closure"><span class="std std-ref">Unused Inherited Variable In Closure</span></a>, in MauticCrmBundle/Tests/Integration/SalesforceIntegrationTest.php:1202.</p>
<p>$max is relayed to getLeadsToCreate(), while $restart is omitted. It may be dropped, along with its reference.</p>
<div class="highlight-php notranslate"><div class="highlight"><pre><span></span><span class="k">function</span> <span class="p">()</span> <span class="k">use</span> <span class="p">(</span><span class="o">&amp;</span><span class="nv">$restart</span><span class="p">,</span> <span class="nv">$max</span><span class="p">)</span> <span class="p">{</span>
                    <span class="nv">$args</span> <span class="o">=</span> <span class="nb">func_get_args</span><span class="p">();</span>

                    <span class="k">if</span> <span class="p">(</span><span class="k">false</span> <span class="o">===</span> <span class="nv">$args</span><span class="p">[</span><span class="mi">2</span><span class="p">])</span> <span class="p">{</span>
                        <span class="k">return</span> <span class="nv">$max</span><span class="p">;</span>
                    <span class="p">}</span>

                    <span class="nv">$createLeads</span> <span class="o">=</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">getLeadsToCreate</span><span class="p">(</span><span class="nv">$args</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span> <span class="nv">$max</span><span class="p">);</span>

                    <span class="c1">// determine whether to return a count or records</span>
                    <span class="k">if</span> <span class="p">(</span><span class="k">false</span> <span class="o">===</span> <span class="nv">$args</span><span class="p">[</span><span class="mi">2</span><span class="p">])</span> <span class="p">{</span>
                        <span class="k">return</span> <span class="nb">count</span><span class="p">(</span><span class="nv">$createLeads</span><span class="p">);</span>
                    <span class="p">}</span>

                    <span class="k">return</span> <span class="nv">$createLeads</span><span class="p">;</span>
                <span class="p">}</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="use-constant-as-arguments">
<span id="case-use-constant-as-arguments"></span><h3><span class="section-number">5.2.82. </span>Use Constant As Arguments<a class="headerlink" href="#use-constant-as-arguments" title="Permalink to this headline">¶</a></h3>
<div class="section" id="tikiwiki">
<span id="case-tikiwiki-functions-useconstantasarguments"></span><h4><span class="section-number">5.2.82.1. </span>Tikiwiki<a class="headerlink" href="#tikiwiki" title="Permalink to this headline">¶</a></h4>
<p><a class="reference internal" href="Rules.html#use-constant-as-arguments"><span class="std std-ref">Use Constant As Arguments</span></a>, in lib/language/Language.php:112.</p>
<p>E_WARNING is a valid value, but PHP documentation for trigger_error() explains that E_USER constants should be used.</p>
<div class="highlight-php notranslate"><div class="highlight"><pre><span></span><span class="nb">trigger_error</span><span class="p">(</span><span class="s2">&quot;Octal or hexadecimal string &#39;&quot;</span> <span class="o">.</span> <span class="nv">$match</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">.</span> <span class="s2">&quot;&#39; not supported&quot;</span><span class="p">,</span> <span class="k">E_WARNING</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="section" id="case-shopware-functions-useconstantasarguments">
<span id="id89"></span><h4><span class="section-number">5.2.82.2. </span>shopware<a class="headerlink" href="#case-shopware-functions-useconstantasarguments" title="Permalink to this headline">¶</a></h4>
<p><a class="reference internal" href="Rules.html#use-constant-as-arguments"><span class="std std-ref">Use Constant As Arguments</span></a>, in engine/Shopware/Plugins/Default/Core/Debug/Components/EventCollector.php:106.</p>
<p>One example where code review reports errors where unit tests don’t : array_multisort actually requires sort order first (SORT_ASC or SORT_DESC), then sort flags (such as SORT_NUMERIC). Here, with SORT_DESC = 3 and SORT_NUMERIC = 1, PHP understands it as the coders expects it. The same error is repeated six times in the code.</p>
<div class="highlight-php notranslate"><div class="highlight"><pre><span></span><span class="nb">array_multisort</span><span class="p">(</span><span class="nv">$order</span><span class="p">,</span> <span class="nx">SORT_NUMERIC</span><span class="p">,</span> <span class="nx">SORT_DESC</span><span class="p">,</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">results</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="useless-referenced-argument">
<span id="case-useless-referenced-argument"></span><h3><span class="section-number">5.2.83. </span>Useless Referenced Argument<a class="headerlink" href="#useless-referenced-argument" title="Permalink to this headline">¶</a></h3>
<div class="section" id="case-woocommerce-functions-uselessreferenceargument">
<span id="id90"></span><h4><span class="section-number">5.2.83.1. </span>Woocommerce<a class="headerlink" href="#case-woocommerce-functions-uselessreferenceargument" title="Permalink to this headline">¶</a></h4>
<p><a class="reference internal" href="Rules.html#useless-referenced-argument"><span class="std std-ref">Useless Referenced Argument</span></a>, in includes/data-stores/class-wc-product-variation-data-store-cpt.php:414.</p>
<p>$product is defined with a reference in the method signature, but it is also used as an object with a dynamical property. As such, the reference in the argument definition is too much.</p>
<div class="highlight-php notranslate"><div class="highlight"><pre><span></span><span class="k">public</span> <span class="k">function</span> <span class="nf">update_post_meta</span><span class="p">(</span> <span class="o">&amp;</span><span class="nv">$product</span><span class="p">,</span> <span class="nv">$force</span> <span class="o">=</span> <span class="k">false</span> <span class="p">)</span> <span class="p">{</span>
            <span class="nv">$meta_key_to_props</span> <span class="o">=</span> <span class="k">array</span><span class="p">(</span>
                    <span class="s1">&#39;_variation_description&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;description&#39;</span><span class="p">,</span>
            <span class="p">);</span>

            <span class="nv">$props_to_update</span> <span class="o">=</span> <span class="nv">$force</span> <span class="o">?</span> <span class="nv">$meta_key_to_props</span> <span class="o">:</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">get_props_to_update</span><span class="p">(</span> <span class="nv">$product</span><span class="p">,</span> <span class="nv">$meta_key_to_props</span> <span class="p">);</span>

            <span class="k">foreach</span> <span class="p">(</span> <span class="nv">$props_to_update</span> <span class="k">as</span> <span class="nv">$meta_key</span> <span class="o">=&gt;</span> <span class="nv">$prop</span> <span class="p">)</span> <span class="p">{</span>
                                    <span class="nv">$value</span>   <span class="o">=</span> <span class="nv">$product</span><span class="o">-&gt;</span><span class="p">{</span><span class="nx">get_</span><span class="nv">$prop</span><span class="p">}(</span> <span class="s1">&#39;edit&#39;</span> <span class="p">);</span>
                                    <span class="nv">$updated</span> <span class="o">=</span> <span class="nx">update_post_meta</span><span class="p">(</span> <span class="nv">$product</span><span class="o">-&gt;</span><span class="na">get_id</span><span class="p">(),</span> <span class="nv">$meta_key</span><span class="p">,</span> <span class="nv">$value</span> <span class="p">);</span>
                    <span class="k">if</span> <span class="p">(</span> <span class="nv">$updated</span> <span class="p">)</span> <span class="p">{</span>
                            <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">updated_props</span><span class="p">[]</span> <span class="o">=</span> <span class="nv">$prop</span><span class="p">;</span>
                    <span class="p">}</span>
            <span class="p">}</span>

            <span class="k">parent</span><span class="o">::</span><span class="na">update_post_meta</span><span class="p">(</span> <span class="nv">$product</span><span class="p">,</span> <span class="nv">$force</span> <span class="p">);</span>
</pre></div>
</div>
</div>
<div class="section" id="case-magento-functions-uselessreferenceargument">
<span id="id91"></span><h4><span class="section-number">5.2.83.2. </span>Magento<a class="headerlink" href="#case-magento-functions-uselessreferenceargument" title="Permalink to this headline">¶</a></h4>
<p><a class="reference internal" href="Rules.html#useless-referenced-argument"><span class="std std-ref">Useless Referenced Argument</span></a>, in setup/src/Magento/Setup/Module/Di/Compiler/Config/Chain/PreferencesResolving.php:63.</p>
<p>$value is defined with a reference. In the following code, it is only read and never written : for index search, or by itself. In fact, $preferences is also only read, and never written. As such, both could be removed.</p>
<div class="highlight-php notranslate"><div class="highlight"><pre><span></span><span class="k">private</span> <span class="k">function</span> <span class="nf">resolvePreferenceRecursive</span><span class="p">(</span><span class="o">&amp;</span><span class="nv">$value</span><span class="p">,</span> <span class="o">&amp;</span><span class="nv">$preferences</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="k">return</span> <span class="nb">isset</span><span class="p">(</span><span class="nv">$preferences</span><span class="p">[</span><span class="nv">$value</span><span class="p">])</span>
            <span class="o">?</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">resolvePreferenceRecursive</span><span class="p">(</span><span class="nv">$preferences</span><span class="p">[</span><span class="nv">$value</span><span class="p">],</span> <span class="nv">$preferences</span><span class="p">)</span>
            <span class="o">:</span> <span class="nv">$value</span><span class="p">;</span>
    <span class="p">}</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="useless-return">
<span id="case-useless-return"></span><h3><span class="section-number">5.2.84. </span>Useless Return<a class="headerlink" href="#useless-return" title="Permalink to this headline">¶</a></h3>
<div class="section" id="case-thinkphp-functions-uselessreturn">
<span id="id92"></span><h4><span class="section-number">5.2.84.1. </span>ThinkPHP<a class="headerlink" href="#case-thinkphp-functions-uselessreturn" title="Permalink to this headline">¶</a></h4>
<p><a class="reference internal" href="Rules.html#useless-return"><span class="std std-ref">Useless Return</span></a>, in library/think/Request.php:2121.</p>
<p>__set() doesn’t need a return, unlike __get().</p>
<div class="highlight-php notranslate"><div class="highlight"><pre><span></span><span class="k">public</span> <span class="k">function</span> <span class="fm">__set</span><span class="p">(</span><span class="nv">$name</span><span class="p">,</span> <span class="nv">$value</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="k">return</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">param</span><span class="p">[</span><span class="nv">$name</span><span class="p">]</span> <span class="o">=</span> <span class="nv">$value</span><span class="p">;</span>
    <span class="p">}</span>
</pre></div>
</div>
</div>
<div class="section" id="case-vanilla-functions-uselessreturn">
<span id="id93"></span><h4><span class="section-number">5.2.84.2. </span>Vanilla<a class="headerlink" href="#case-vanilla-functions-uselessreturn" title="Permalink to this headline">¶</a></h4>
<p><a class="reference internal" href="Rules.html#useless-return"><span class="std std-ref">Useless Return</span></a>, in applications/dashboard/views/attachments/attachment.php:14.</p>
<p>The final ‘return’ is useless : return void (here, return without argument), is the same as returning null, unless the ‘void’ return type is used. The other return, is in the two conditions, is important to skip the end of the functioncall.</p>
<div class="highlight-php notranslate"><div class="highlight"><pre><span></span><span class="k">function</span> <span class="nf">writeAttachment</span><span class="p">(</span><span class="nv">$attachment</span><span class="p">)</span> <span class="p">{</span>

        <span class="nv">$customMethod</span> <span class="o">=</span> <span class="nx">AttachmentModel</span><span class="o">::</span><span class="na">getWriteAttachmentMethodName</span><span class="p">(</span><span class="nv">$attachment</span><span class="p">[</span><span class="s1">&#39;Type&#39;</span><span class="p">]);</span>
        <span class="k">if</span> <span class="p">(</span><span class="nb">function_exists</span><span class="p">(</span><span class="nv">$customMethod</span><span class="p">))</span> <span class="p">{</span>
            <span class="k">if</span> <span class="p">(</span><span class="nx">val</span><span class="p">(</span><span class="s1">&#39;Error&#39;</span><span class="p">,</span> <span class="nv">$attachment</span><span class="p">))</span> <span class="p">{</span>
                <span class="nx">writeErrorAttachment</span><span class="p">(</span><span class="nv">$attachment</span><span class="p">);</span>
                <span class="k">return</span><span class="p">;</span>
            <span class="p">}</span>
            <span class="nv">$customMethod</span><span class="p">(</span><span class="nv">$attachment</span><span class="p">);</span>
        <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
            <span class="nx">trace</span><span class="p">(</span><span class="nv">$customMethod</span><span class="p">,</span> <span class="s1">&#39;Write Attachment method not found&#39;</span><span class="p">);</span>
            <span class="nx">trace</span><span class="p">(</span><span class="nv">$attachment</span><span class="p">,</span> <span class="s1">&#39;Attachment&#39;</span><span class="p">);</span>
        <span class="p">}</span>
        <span class="k">return</span><span class="p">;</span>
    <span class="p">}</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="wrong-number-of-arguments">
<span id="case-wrong-number-of-arguments"></span><h3><span class="section-number">5.2.85. </span>Wrong Number Of Arguments<a class="headerlink" href="#wrong-number-of-arguments" title="Permalink to this headline">¶</a></h3>
<div class="section" id="case-xataface-functions-wrongnumberofarguments">
<span id="id94"></span><h4><span class="section-number">5.2.85.1. </span>xataface<a class="headerlink" href="#case-xataface-functions-wrongnumberofarguments" title="Permalink to this headline">¶</a></h4>
<p><a class="reference internal" href="Rules.html#wrong-number-of-arguments"><span class="std std-ref">Wrong Number Of Arguments</span></a>, in actions/existing_related_record.php:130.</p>
<p>df_display() actually requires only 2 arguments, while three are provided. The last argument is completely ignored. df_display() is called in a total of 9 places : this now looks like an API change that left many calls untouched.</p>
<div class="highlight-php notranslate"><div class="highlight"><pre><span></span><span class="nx">df_display</span><span class="p">(</span><span class="nv">$context</span><span class="p">,</span> <span class="nv">$template</span><span class="p">,</span> <span class="k">true</span><span class="p">);</span>

<span class="c1">// in public-api.php :</span>
<span class="k">function</span> <span class="nf">df_display</span><span class="p">(</span><span class="nv">$context</span><span class="p">,</span> <span class="nv">$template_name</span><span class="p">){</span>
    <span class="nx">import</span><span class="p">(</span> <span class="s1">&#39;Dataface/SkinTool.php&#39;</span><span class="p">);</span>
    <span class="nv">$st</span> <span class="o">=</span> <span class="nx">Dataface_SkinTool</span><span class="o">::</span><span class="na">getInstance</span><span class="p">();</span>

    <span class="k">return</span> <span class="nv">$st</span><span class="o">-&gt;</span><span class="na">display</span><span class="p">(</span><span class="nv">$context</span><span class="p">,</span> <span class="nv">$template_name</span><span class="p">);</span>
<span class="p">}</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="wrong-optional-parameter">
<span id="case-wrong-optional-parameter"></span><h3><span class="section-number">5.2.86. </span>Wrong Optional Parameter<a class="headerlink" href="#wrong-optional-parameter" title="Permalink to this headline">¶</a></h3>
<div class="section" id="case-fuelcms-functions-wrongoptionalparameter">
<span id="id95"></span><h4><span class="section-number">5.2.86.1. </span>FuelCMS<a class="headerlink" href="#case-fuelcms-functions-wrongoptionalparameter" title="Permalink to this headline">¶</a></h4>
<p><a class="reference internal" href="Rules.html#wrong-optional-parameter"><span class="std std-ref">Wrong Optional Parameter</span></a>, in fuel/modules/fuel/helpers/validator_helper.php:78.</p>
<p>The $regex parameter should really be first, as it is compulsory. Though, if this is a legacy function, it may be better to give regex a default value, such as empty string or null, and test it before using it.</p>
<div class="highlight-php notranslate"><div class="highlight"><pre><span></span><span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nb">function_exists</span><span class="p">(</span><span class="s1">&#39;regex&#39;</span><span class="p">))</span>
<span class="p">{</span>
    <span class="k">function</span> <span class="nf">regex</span><span class="p">(</span><span class="nv">$var</span> <span class="o">=</span> <span class="k">null</span><span class="p">,</span> <span class="nv">$regex</span><span class="p">)</span>
    <span class="p">{</span>
            <span class="k">return</span> <span class="nb">preg_match</span><span class="p">(</span><span class="s1">&#39;#&#39;</span><span class="o">.</span><span class="nv">$regex</span><span class="o">.</span><span class="s1">&#39;#&#39;</span><span class="p">,</span> <span class="nv">$var</span><span class="p">);</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
</div>
<div class="section" id="case-vanilla-functions-wrongoptionalparameter">
<span id="id96"></span><h4><span class="section-number">5.2.86.2. </span>Vanilla<a class="headerlink" href="#case-vanilla-functions-wrongoptionalparameter" title="Permalink to this headline">¶</a></h4>
<p><a class="reference internal" href="Rules.html#wrong-optional-parameter"><span class="std std-ref">Wrong Optional Parameter</span></a>, in applications/dashboard/modules/class.navmodule.php:99.</p>
<p>Note the second parameter, $dropdown, which has no default value. It is relayed to the addDropdown method, which as no default value too. Since both methods are documented, we can see that they should be an addDropdown : null is probably a good idea, coupled with an explicit check on the actual value.</p>
<div class="highlight-php notranslate"><div class="highlight"><pre><span></span><span class="sd">/**</span>
<span class="sd">     * Add a dropdown to the items array if it satisfies the $isAllowed condition.</span>
<span class="sd">     *</span>
<span class="sd">     * @param bool|string|array $isAllowed Either a boolean to indicate whether to actually add the item</span>
<span class="sd">     * or a permission string or array of permission strings (full match) to check.</span>
<span class="sd">     * @param DropdownModule $dropdown The dropdown menu to add.</span>
<span class="sd">     * @param string $key The item&#39;s key (for sorting and CSS targeting).</span>
<span class="sd">     * @param string $cssClass The dropdown wrapper&#39;s CSS class.</span>
<span class="sd">     * @param array|int $sort Either a numeric sort position or and array in the style: array(&#39;before|after&#39;, &#39;key&#39;).</span>
<span class="sd">     * @return NavModule $this The calling object.</span>
<span class="sd">     */</span>
    <span class="k">public</span> <span class="k">function</span> <span class="nf">addDropdownIf</span><span class="p">(</span><span class="nv">$isAllowed</span> <span class="o">=</span> <span class="k">true</span><span class="p">,</span> <span class="nv">$dropdown</span><span class="p">,</span> <span class="nv">$key</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="nv">$cssClass</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="nv">$sort</span> <span class="o">=</span> <span class="p">[])</span> <span class="p">{</span>
        <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nv">$this</span><span class="o">-&gt;</span><span class="na">isAllowed</span><span class="p">(</span><span class="nv">$isAllowed</span><span class="p">))</span> <span class="p">{</span>
            <span class="k">return</span> <span class="nv">$this</span><span class="p">;</span>
        <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
            <span class="k">return</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">addDropdown</span><span class="p">(</span><span class="nv">$dropdown</span><span class="p">,</span> <span class="nv">$key</span><span class="p">,</span> <span class="nv">$cssClass</span><span class="p">,</span> <span class="nv">$sort</span><span class="p">);</span>
        <span class="p">}</span>
    <span class="p">}</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="already-parents-interface">
<span id="case-already-parents-interface"></span><h3><span class="section-number">5.2.87. </span>Already Parents Interface<a class="headerlink" href="#already-parents-interface" title="Permalink to this headline">¶</a></h3>
<div class="section" id="case-wordpress-interfaces-alreadyparentsinterface">
<span id="id97"></span><h4><span class="section-number">5.2.87.1. </span>WordPress<a class="headerlink" href="#case-wordpress-interfaces-alreadyparentsinterface" title="Permalink to this headline">¶</a></h4>
<p><a class="reference internal" href="Rules.html#already-parents-interface"><span class="std std-ref">Already Parents Interface</span></a>, in src/Phinx/Db/Adapter/AbstractAdapter.php:41.</p>
<p>SqlServerAdapter extends PdoAdapter, PdoAdapter extends AbstractAdapter. The first and the last both implements AdapterInterface. Only one is needed.</p>
<div class="highlight-php notranslate"><div class="highlight"><pre><span></span><span class="sd">/**</span>
<span class="sd"> * Base Abstract Database Adapter.</span>
<span class="sd"> */</span>
<span class="k">abstract</span> <span class="k">class</span> <span class="nc">AbstractAdapter</span> <span class="k">implements</span> <span class="nx">AdapterInterface</span>
<span class="p">{</span>

<span class="c1">/// In the src/src/Phinx/Db/Adapter/SqlServerAdapter.php, line 45</span>
<span class="sd">/**</span>
<span class="sd"> * Phinx SqlServer Adapter.</span>
<span class="sd"> *</span>
<span class="sd"> */</span>
<span class="k">class</span> <span class="nc">SqlServerAdapter</span> <span class="k">extends</span> <span class="nx">PdoAdapter</span> <span class="k">implements</span> <span class="nx">AdapterInterface</span>
<span class="p">{</span>
</pre></div>
</div>
</div>
<div class="section" id="case-thelia-interfaces-alreadyparentsinterface">
<span id="id98"></span><h4><span class="section-number">5.2.87.2. </span>Thelia<a class="headerlink" href="#case-thelia-interfaces-alreadyparentsinterface" title="Permalink to this headline">¶</a></h4>
<p><a class="reference internal" href="Rules.html#already-parents-interface"><span class="std std-ref">Already Parents Interface</span></a>, in core/lib/Thelia/Core/Template/Loop/BaseSpecificModule.php:35.</p>
<p>PropelSearchLoopInterface is implemented by both BaseSpecificModule and Payment</p>
<div class="highlight-php notranslate"><div class="highlight"><pre><span></span><span class="k">abstract</span> <span class="k">class</span> <span class="nc">BaseSpecificModule</span> <span class="k">extends</span> <span class="nx">BaseI18nLoop</span> <span class="k">implements</span> <span class="nx">PropelSearchLoopInterface</span>

<span class="cm">/* in file  core/lib/Thelia/Core/Template/Loop/Payment.php, line 28 */</span>

<span class="k">class</span> <span class="nc">Payment</span> <span class="k">extends</span> <span class="nx">BaseSpecificModule</span> <span class="k">implements</span> <span class="nx">PropelSearchLoopInterface</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="undefined-interfaces">
<span id="case-undefined-interfaces"></span><h3><span class="section-number">5.2.88. </span>Undefined Interfaces<a class="headerlink" href="#undefined-interfaces" title="Permalink to this headline">¶</a></h3>
<div class="section" id="case-xataface-interfaces-undefinedinterfaces">
<span id="id99"></span><h4><span class="section-number">5.2.88.1. </span>xataface<a class="headerlink" href="#case-xataface-interfaces-undefinedinterfaces" title="Permalink to this headline">¶</a></h4>
<p><a class="reference internal" href="Rules.html#undefined-interfaces"><span class="std std-ref">Undefined Interfaces</span></a>, in Dataface/Error.php:112.</p>
<p>Exception seems to be a typo, and leads to an always-true expression.</p>
<div class="highlight-php notranslate"><div class="highlight"><pre><span></span><span class="k">public</span> <span class="k">static</span> <span class="k">function</span> <span class="nf">isError</span><span class="p">(</span><span class="nv">$obj</span><span class="p">){</span>
            <span class="k">if</span> <span class="p">(</span> <span class="o">!</span><span class="nx">PEAR</span><span class="o">::</span><span class="na">isError</span><span class="p">(</span><span class="nv">$obj</span><span class="p">)</span> <span class="k">and</span> <span class="o">!</span><span class="p">(</span><span class="nv">$obj</span> <span class="nx">instanceof</span> <span class="nx">Exception_</span><span class="p">)</span> <span class="p">)</span> <span class="k">return</span> <span class="k">false</span><span class="p">;</span>
            <span class="k">return</span> <span class="p">(</span><span class="nv">$obj</span><span class="o">-&gt;</span><span class="na">getCode</span><span class="p">()</span> <span class="o">&gt;=</span> <span class="nx">DATAFACE_E_ERROR</span><span class="p">);</span>
    <span class="p">}</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="unused-interfaces">
<span id="case-unused-interfaces"></span><h3><span class="section-number">5.2.89. </span>Unused Interfaces<a class="headerlink" href="#unused-interfaces" title="Permalink to this headline">¶</a></h3>
<div class="section" id="case-tine20-interfaces-unusedinterfaces">
<span id="id100"></span><h4><span class="section-number">5.2.89.1. </span>Tine20<a class="headerlink" href="#case-tine20-interfaces-unusedinterfaces" title="Permalink to this headline">¶</a></h4>
<p><a class="reference internal" href="Rules.html#unused-interfaces"><span class="std std-ref">Unused Interfaces</span></a>, in tine20/Tinebase/User/LdapPlugin/Interface.php:20.</p>
<p>Tinebase_User_LdapPlugin_Interface is mentioned as a type for a property, in a php doc document. Typehinted properties are available since PHP 7.4</p>
<div class="highlight-php notranslate"><div class="highlight"><pre><span></span><span class="k">interface</span> <span class="nx">Tinebase_User_LdapPlugin_Interface</span> <span class="p">{</span>

<span class="c1">//----------</span>
<span class="c1">// in tine20/Tinebase/User/ActiveDirectory.php</span>
<span class="sd">/** @var Tinebase_User_LdapPlugin_Interface $plugin */</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="useless-interfaces">
<span id="case-useless-interfaces"></span><h3><span class="section-number">5.2.90. </span>Useless Interfaces<a class="headerlink" href="#useless-interfaces" title="Permalink to this headline">¶</a></h3>
<div class="section" id="case-woocommerce-interfaces-uselessinterfaces">
<span id="id101"></span><h4><span class="section-number">5.2.90.1. </span>Woocommerce<a class="headerlink" href="#case-woocommerce-interfaces-uselessinterfaces" title="Permalink to this headline">¶</a></h4>
<p><a class="reference internal" href="Rules.html#useless-interfaces"><span class="std std-ref">Useless Interfaces</span></a>, in includes/interfaces/class-wc-order-item-data-store-interface.php:20.</p>
<p>WC_Order_Item_Data_Store_Interface is used to structure the class WC_Order_Item_Data_Store. It is not used anywhere else.</p>
<div class="highlight-php notranslate"><div class="highlight"><pre><span></span><span class="k">interface</span> <span class="nx">WC_Order_Item_Data_Store_Interface</span> <span class="p">{</span>


<span class="c1">////////</span>
<span class="c1">//includes/data-stores/class-wc-order-item-data-store.php</span>

<span class="k">class</span> <span class="nc">WC_Order_Item_Data_Store</span> <span class="k">implements</span> <span class="nx">WC_Order_Item_Data_Store_Interface</span> <span class="p">{</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="hidden-use-expression">
<span id="case-hidden-use-expression"></span><h3><span class="section-number">5.2.91. </span>Hidden Use Expression<a class="headerlink" href="#hidden-use-expression" title="Permalink to this headline">¶</a></h3>
<div class="section" id="case-tikiwiki-namespaces-hiddenuse">
<span id="id102"></span><h4><span class="section-number">5.2.91.1. </span>Tikiwiki<a class="headerlink" href="#case-tikiwiki-namespaces-hiddenuse" title="Permalink to this headline">¶</a></h4>
<p><a class="reference internal" href="Rules.html#hidden-use-expression"><span class="std std-ref">Hidden Use Expression</span></a>, in lib/core/Tiki/Command/DailyReportSendCommand.php:17.</p>
<p>Sneaky error_reporting, hidden among the use calls.</p>
<div class="highlight-php notranslate"><div class="highlight"><pre><span></span><span class="k">namespace</span> <span class="nx">Tiki\Command</span><span class="p">;</span>

<span class="k">use</span> <span class="nx">Symfony\Component\Console\Command\Command</span><span class="p">;</span>
<span class="k">use</span> <span class="nx">Symfony\Component\Console\Input\InputArgument</span><span class="p">;</span>
<span class="k">use</span> <span class="nx">Symfony\Component\Console\Input\InputInterface</span><span class="p">;</span>
<span class="k">use</span> <span class="nx">Symfony\Component\Console\Input\InputOption</span><span class="p">;</span>
<span class="k">use</span> <span class="nx">Symfony\Component\Console\Output\OutputInterface</span><span class="p">;</span>
<span class="nb">error_reporting</span><span class="p">(</span><span class="k">E_ALL</span><span class="p">);</span>
<span class="k">use</span> <span class="nx">TikiLib</span><span class="p">;</span>
<span class="k">use</span> <span class="nx">Reports_Factory</span><span class="p">;</span>
</pre></div>
</div>
</div>
<div class="section" id="case-openemr-namespaces-hiddenuse">
<span id="id103"></span><h4><span class="section-number">5.2.91.2. </span>OpenEMR<a class="headerlink" href="#case-openemr-namespaces-hiddenuse" title="Permalink to this headline">¶</a></h4>
<p><a class="reference internal" href="Rules.html#hidden-use-expression"><span class="std std-ref">Hidden Use Expression</span></a>, in interface/patient_file/summary/browse.php:23.</p>
<p>Use expression is only reached when the csrf token is checked. This probably save some CPU when no csrf is available, but it breaks the readability of the file.</p>
<div class="highlight-php notranslate"><div class="highlight"><pre><span></span><span class="o">&lt;?</span><span class="nx">php</span>
<span class="sd">/**</span>
<span class="sd"> * Patient selector for insurance gui</span>
<span class="sd"> *</span>
<span class="sd"> * @package   OpenEMR</span>
<span class="sd"> * @link      http://www.open-emr.org</span>
<span class="sd"> * @author    Brady Miller &lt;brady.g.miller@gmail.com&gt;</span>
<span class="sd"> * @copyright Copyright (c) 2018 Brady Miller &lt;brady.g.miller@gmail.com&gt;</span>
<span class="sd"> * @license   https://github.com/openemr/openemr/blob/master/LICENSE GNU General Public License 3</span>
<span class="sd"> */</span>


<span class="k">require_once</span><span class="p">(</span><span class="o">../../</span><span class="nx">globals</span><span class="o">.</span><span class="nx">php</span><span class="p">);</span>
<span class="k">require_once</span><span class="p">(</span><span class="nv">$srcdir</span><span class="o">/</span><span class="nx">patient</span><span class="o">.</span><span class="nx">inc</span><span class="p">);</span>
<span class="k">require_once</span><span class="p">(</span><span class="nv">$srcdir</span><span class="o">/</span><span class="nx">options</span><span class="o">.</span><span class="nx">inc</span><span class="o">.</span><span class="nx">php</span><span class="p">);</span>

<span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="k">empty</span><span class="p">(</span><span class="nv">$_POST</span><span class="p">))</span> <span class="p">{</span>
    <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nx">verifyCsrfToken</span><span class="p">(</span><span class="nv">$_POST</span><span class="p">[</span><span class="nx">csrf_token_form</span><span class="p">]))</span> <span class="p">{</span>
        <span class="nx">csrfNotVerified</span><span class="p">();</span>
    <span class="p">}</span>
<span class="p">}</span>

<span class="k">use</span> <span class="nx">OpenEMR\Core\Header</span><span class="p">;</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="multiple-alias-definitions">
<span id="case-multiple-alias-definitions"></span><h3><span class="section-number">5.2.92. </span>Multiple Alias Definitions<a class="headerlink" href="#multiple-alias-definitions" title="Permalink to this headline">¶</a></h3>
<div class="section" id="case-churchcrm-namespaces-multiplealiasdefinitions">
<span id="id104"></span><h4><span class="section-number">5.2.92.1. </span>ChurchCRM<a class="headerlink" href="#case-churchcrm-namespaces-multiplealiasdefinitions" title="Permalink to this headline">¶</a></h4>
<p><a class="reference internal" href="Rules.html#multiple-alias-definitions"><span class="std std-ref">Multiple Alias Definitions</span></a>, in Various files:–.</p>
<p>It is actually surprising to find FamilyQuery defined as ChurchCRMBaseFamilyQuery only once, while all other reference are for ChurchCRMFamilyQuery. That lone use is actually useful in the code, so it is not a forgotten refactorisation.</p>
<div class="highlight-php notranslate"><div class="highlight"><pre><span></span><span class="k">use</span> <span class="nx">ChurchCRM\Base\FamilyQuery</span>      <span class="c1">// in /src/MapUsingGoogle.php:7</span>

<span class="k">use</span> <span class="nx">ChurchCRM\FamilyQuery</span>   <span class="c1">// in /src/ChurchCRM/Dashboard/EventsDashboardItem.php:8</span>
                            <span class="c1">// and 29 other files</span>
</pre></div>
</div>
</div>
<div class="section" id="case-phinx-namespaces-multiplealiasdefinitions">
<span id="id105"></span><h4><span class="section-number">5.2.92.2. </span>Phinx<a class="headerlink" href="#case-phinx-namespaces-multiplealiasdefinitions" title="Permalink to this headline">¶</a></h4>
<p><a class="reference internal" href="Rules.html#multiple-alias-definitions"><span class="std std-ref">Multiple Alias Definitions</span></a>, in Various files too:–.</p>
<p>One ‘Command’ is refering to a local Command class, while the other is refering to an imported class. They are all in a similar name space ConsoleCommand.</p>
<div class="highlight-php notranslate"><div class="highlight"><pre><span></span><span class="k">use</span> <span class="nx">Phinx\Console\Command</span>                       <span class="c1">//in file /src/Phinx/Console/PhinxApplication.php:34</span>
<span class="k">use</span> <span class="nx">Symfony\Component\Console\Command\Command</span>       <span class="c1">//in file /src/Phinx/Console/Command/Init.php:31</span>
<span class="k">use</span> <span class="nx">Symfony\Component\Console\Command\Command</span>       <span class="c1">//in file /src/Phinx/Console/Command/AbstractCommand.php:32</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="no-array-merge-in-loops">
<span id="case-no-array-merge-in-loops"></span><h3><span class="section-number">5.2.93. </span>No array_merge() In Loops<a class="headerlink" href="#no-array-merge-in-loops" title="Permalink to this headline">¶</a></h3>
<div class="section" id="case-tine20-performances-arraymergeinloops">
<span id="id106"></span><h4><span class="section-number">5.2.93.1. </span>Tine20<a class="headerlink" href="#case-tine20-performances-arraymergeinloops" title="Permalink to this headline">¶</a></h4>
<p><a class="reference internal" href="Rules.html#no-array-merge-in-loops"><span class="std std-ref">No array_merge() In Loops</span></a>, in tine20/Tinebase/User/Ldap.php:670.</p>
<p>Classic example of array_merge() in loop : here, the attributures should be collected in a local variable, and then merged in one operation, at the end. That includes the attributes provided before the loop, and the array provided after the loop.
Note that the order of merge will be the same when merging than when collecting the arrays.</p>
<div class="highlight-php notranslate"><div class="highlight"><pre><span></span><span class="nv">$attributes</span> <span class="o">=</span> <span class="nb">array_values</span><span class="p">(</span><span class="nv">$this</span><span class="o">-&gt;</span><span class="na">_rowNameMapping</span><span class="p">);</span>
        <span class="k">foreach</span> <span class="p">(</span><span class="nv">$this</span><span class="o">-&gt;</span><span class="na">_ldapPlugins</span> <span class="k">as</span> <span class="nv">$plugin</span><span class="p">)</span> <span class="p">{</span>
            <span class="nv">$attributes</span> <span class="o">=</span> <span class="nb">array_merge</span><span class="p">(</span><span class="nv">$attributes</span><span class="p">,</span> <span class="nv">$plugin</span><span class="o">-&gt;</span><span class="na">getSupportedAttributes</span><span class="p">());</span>
        <span class="p">}</span>

        <span class="nv">$attributes</span> <span class="o">=</span> <span class="nb">array_merge</span><span class="p">(</span><span class="nv">$attributes</span><span class="p">,</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">_additionalLdapAttributesToFetch</span><span class="p">);</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="double-array-flip">
<span id="case-double-array-flip"></span><h3><span class="section-number">5.2.94. </span>Double array_flip()<a class="headerlink" href="#double-array-flip" title="Permalink to this headline">¶</a></h3>
<div class="section" id="case-nextcloud-performances-doublearrayflip">
<span id="id107"></span><h4><span class="section-number">5.2.94.1. </span>NextCloud<a class="headerlink" href="#case-nextcloud-performances-doublearrayflip" title="Permalink to this headline">¶</a></h4>
<p><a class="reference internal" href="Rules.html#double-array-flip"><span class="std std-ref">Double array_flip()</span></a>, in lib/public/AppFramework/Http/EmptyContentSecurityPolicy.php:372.</p>
<p>The array $allowedScriptDomains is flipped, to unset ‘self’, then, unflipped (or flipped again), to restore its initial state. Using array_keys() or array_search() would yield the needed keys for unsetting, at a lower cost.</p>
<div class="highlight-php notranslate"><div class="highlight"><pre><span></span><span class="k">if</span><span class="p">(</span><span class="nb">is_string</span><span class="p">(</span><span class="nv">$this</span><span class="o">-&gt;</span><span class="na">useJsNonce</span><span class="p">))</span> <span class="p">{</span>
                            <span class="nv">$policy</span> <span class="o">.=</span> <span class="s1">&#39;\&#39;nonce-&#39;</span><span class="o">.</span><span class="nb">base64_encode</span><span class="p">(</span><span class="nv">$this</span><span class="o">-&gt;</span><span class="na">useJsNonce</span><span class="p">)</span><span class="o">.</span><span class="s1">&#39;\&#39;&#39;</span><span class="p">;</span>
                            <span class="nv">$allowedScriptDomains</span> <span class="o">=</span> <span class="nb">array_flip</span><span class="p">(</span><span class="nv">$this</span><span class="o">-&gt;</span><span class="na">allowedScriptDomains</span><span class="p">);</span>
                            <span class="nb">unset</span><span class="p">(</span><span class="nv">$allowedScriptDomains</span><span class="p">[</span><span class="s1">&#39;\&#39;self\&#39;&#39;</span><span class="p">]);</span>
                            <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">allowedScriptDomains</span> <span class="o">=</span> <span class="nb">array_flip</span><span class="p">(</span><span class="nv">$allowedScriptDomains</span><span class="p">);</span>
                            <span class="k">if</span><span class="p">(</span><span class="nb">count</span><span class="p">(</span><span class="nv">$allowedScriptDomains</span><span class="p">)</span> <span class="o">!==</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
                                    <span class="nv">$policy</span> <span class="o">.=</span> <span class="s1">&#39; &#39;</span><span class="p">;</span>
                            <span class="p">}</span>
                    <span class="p">}</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="isset-on-the-whole-array">
<span id="case-isset-on-the-whole-array"></span><h3><span class="section-number">5.2.95. </span>Isset() On The Whole Array<a class="headerlink" href="#isset-on-the-whole-array" title="Permalink to this headline">¶</a></h3>
<div class="section" id="case-tine20-performances-issetwholearray">
<span id="id108"></span><h4><span class="section-number">5.2.95.1. </span>Tine20<a class="headerlink" href="#case-tine20-performances-issetwholearray" title="Permalink to this headline">¶</a></h4>
<p><a class="reference internal" href="Rules.html#isset-on-the-whole-array"><span class="std std-ref">Isset() On The Whole Array</span></a>, in tine20/Crm/Model/Lead.php:208.</p>
<p>Only the second call is necessary : it also includes the first one.</p>
<div class="highlight-php notranslate"><div class="highlight"><pre><span></span><span class="nb">isset</span><span class="p">(</span><span class="nv">$relation</span><span class="p">[</span><span class="s1">&#39;related_record&#39;</span><span class="p">])</span> <span class="o">&amp;&amp;</span> <span class="nb">isset</span><span class="p">(</span><span class="nv">$relation</span><span class="p">[</span><span class="s1">&#39;related_record&#39;</span><span class="p">][</span><span class="s1">&#39;n_fileas&#39;</span><span class="p">])</span>
</pre></div>
</div>
</div>
<div class="section" id="case-expressionengine-performances-issetwholearray">
<span id="id109"></span><h4><span class="section-number">5.2.95.2. </span>ExpressionEngine<a class="headerlink" href="#case-expressionengine-performances-issetwholearray" title="Permalink to this headline">¶</a></h4>
<p><a class="reference internal" href="Rules.html#isset-on-the-whole-array"><span class="std std-ref">Isset() On The Whole Array</span></a>, in system/ee/legacy/libraries/Form_validation.php:1487.</p>
<p>This is equivalent to <cite>isset($this-&gt;_field_data[$field], $this-&gt;_field_data[$field][‘postdata’])</cite>, and the second call may be skipped.</p>
<div class="highlight-php notranslate"><div class="highlight"><pre><span></span><span class="o">!</span><span class="nb">isset</span><span class="p">(</span><span class="nv">$this</span><span class="o">-&gt;</span><span class="na">_field_data</span><span class="p">[</span><span class="nv">$field</span><span class="p">])</span> <span class="k">OR</span> <span class="o">!</span><span class="nb">isset</span><span class="p">(</span><span class="nv">$this</span><span class="o">-&gt;</span><span class="na">_field_data</span><span class="p">[</span><span class="nv">$field</span><span class="p">][</span><span class="s1">&#39;postdata&#39;</span><span class="p">])</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="joining-file">
<span id="case-joining-file"></span><h3><span class="section-number">5.2.96. </span>Joining file()<a class="headerlink" href="#joining-file" title="Permalink to this headline">¶</a></h3>
<div class="section" id="case-wordpress-performances-joinfile">
<span id="id110"></span><h4><span class="section-number">5.2.96.1. </span>WordPress<a class="headerlink" href="#case-wordpress-performances-joinfile" title="Permalink to this headline">¶</a></h4>
<p><a class="reference internal" href="Rules.html#joining-file"><span class="std std-ref">Joining file()</span></a>, in wp-admin/includes/misc.php:74.</p>
<p>This code actually loads the file, join it, then split it again. file() would be sufficient.</p>
<div class="highlight-php notranslate"><div class="highlight"><pre><span></span><span class="nv">$markerdata</span> <span class="o">=</span> <span class="nb">explode</span><span class="p">(</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">,</span> <span class="nb">implode</span><span class="p">(</span> <span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="nb">file</span><span class="p">(</span> <span class="nv">$filename</span> <span class="p">)</span> <span class="p">)</span> <span class="p">);</span>
</pre></div>
</div>
</div>
<div class="section" id="case-spip-performances-joinfile">
<span id="id111"></span><h4><span class="section-number">5.2.96.2. </span>SPIP<a class="headerlink" href="#case-spip-performances-joinfile" title="Permalink to this headline">¶</a></h4>
<p><a class="reference internal" href="Rules.html#joining-file"><span class="std std-ref">Joining file()</span></a>, in ecrire/inc/install.php:109.</p>
<p>When the file is not accessible, file() returns null, and can’t be processed by join().</p>
<div class="highlight-php notranslate"><div class="highlight"><pre><span></span><span class="nv">$s</span> <span class="o">=</span> <span class="o">@</span><span class="nb">join</span><span class="p">(</span><span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="nb">file</span><span class="p">(</span><span class="nv">$file</span><span class="p">));</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="logical-to-in-array">
<span id="case-logical-to-in-array"></span><h3><span class="section-number">5.2.97. </span>Logical To in_array<a class="headerlink" href="#logical-to-in-array" title="Permalink to this headline">¶</a></h3>
<div class="section" id="case-zencart-performances-logicaltoinarray">
<span id="id112"></span><h4><span class="section-number">5.2.97.1. </span>Zencart<a class="headerlink" href="#case-zencart-performances-logicaltoinarray" title="Permalink to this headline">¶</a></h4>
<p><a class="reference internal" href="Rules.html#logical-to-in-array"><span class="std std-ref">Logical To in_array</span></a>, in admin/users.php:32.</p>
<p>Long list of == are harder to read. Using an in_array() call gathers all the strings together, in an array. In turn, this helps readability and possibility, reusability by making that list an constant.</p>
<div class="highlight-php notranslate"><div class="highlight"><pre><span></span><span class="c1">// if needed, check that a valid user id has been passed</span>
<span class="k">if</span> <span class="p">((</span><span class="nv">$action</span> <span class="o">==</span> <span class="s1">&#39;update&#39;</span> <span class="o">||</span> <span class="nv">$action</span> <span class="o">==</span> <span class="s1">&#39;reset&#39;</span><span class="p">)</span> <span class="o">&amp;&amp;</span> <span class="nb">isset</span><span class="p">(</span><span class="nv">$_POST</span><span class="p">[</span><span class="s1">&#39;user&#39;</span><span class="p">]))</span>
<span class="p">{</span>
  <span class="nv">$user</span> <span class="o">=</span> <span class="nv">$_POST</span><span class="p">[</span><span class="s1">&#39;user&#39;</span><span class="p">];</span>
<span class="p">}</span>
<span class="k">elseif</span> <span class="p">((</span><span class="nv">$action</span> <span class="o">==</span> <span class="s1">&#39;edit&#39;</span> <span class="o">||</span> <span class="nv">$action</span> <span class="o">==</span> <span class="s1">&#39;password&#39;</span> <span class="o">||</span> <span class="nv">$action</span> <span class="o">==</span> <span class="s1">&#39;delete&#39;</span> <span class="o">||</span> <span class="nv">$action</span> <span class="o">==</span> <span class="s1">&#39;delete_confirm&#39;</span><span class="p">)</span> <span class="o">&amp;&amp;</span> <span class="nv">$_GET</span><span class="p">[</span><span class="s1">&#39;user&#39;</span><span class="p">])</span>
<span class="p">{</span>
  <span class="nv">$user</span> <span class="o">=</span> <span class="nv">$_GET</span><span class="p">[</span><span class="s1">&#39;user&#39;</span><span class="p">];</span>
<span class="p">}</span>
<span class="k">elseif</span><span class="p">((</span><span class="nv">$action</span><span class="o">==</span><span class="s1">&#39;delete&#39;</span> <span class="o">||</span> <span class="nv">$action</span><span class="o">==</span><span class="s1">&#39;delete_confirm&#39;</span><span class="p">)</span> <span class="o">&amp;&amp;</span> <span class="nb">isset</span><span class="p">(</span><span class="nv">$_POST</span><span class="p">[</span><span class="s1">&#39;user&#39;</span><span class="p">]))</span>
<span class="p">{</span>
  <span class="nv">$user</span> <span class="o">=</span> <span class="nv">$_POST</span><span class="p">[</span><span class="s1">&#39;user&#39;</span><span class="p">];</span>
<span class="p">}</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="make-one-call-with-array">
<span id="case-make-one-call-with-array"></span><h3><span class="section-number">5.2.98. </span>Make One Call With Array<a class="headerlink" href="#make-one-call-with-array" title="Permalink to this headline">¶</a></h3>
<div class="section" id="case-humo-gen-performances-makeonecall">
<span id="id113"></span><h4><span class="section-number">5.2.98.1. </span>HuMo-Gen<a class="headerlink" href="#case-humo-gen-performances-makeonecall" title="Permalink to this headline">¶</a></h4>
<p><a class="reference internal" href="Rules.html#make-one-call-with-array"><span class="std std-ref">Make One Call With Array</span></a>, in admin/include/kcfinder/lib/helper_text.php:47.</p>
<p>The three calls to str_replace() could be replaced by one, using array arguments. Nesting the calls doesn’t reduce the number of calls.</p>
<div class="highlight-php notranslate"><div class="highlight"><pre><span></span><span class="k">static</span> <span class="k">function</span> <span class="nf">jsValue</span><span class="p">(</span><span class="nv">$string</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">return</span>
            <span class="nb">preg_replace</span><span class="p">(</span><span class="s1">&#39;/\r?\n/&#39;</span><span class="p">,</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">,</span>
            <span class="nb">str_replace</span><span class="p">(</span><span class="s1">&#39;&quot;&#39;</span><span class="p">,</span> <span class="s2">&quot;</span><span class="se">\\</span><span class="s2">\,</span>
<span class="s2">            str_replace(&quot;</span><span class="err">&#39;</span><span class="s2">&quot;, &quot;</span><span class="nx">\</span><span class="err">&#39;</span><span class="s2">&quot;,</span>
<span class="s2">            str_replace(&quot;</span><span class="nx">\</span><span class="s2">&quot;, &quot;</span><span class="nx">\\</span><span class="s2">&quot;,</span>
<span class="s2">        </span><span class="si">$string</span><span class="s2">))));</span>
<span class="s2">    }</span>
</pre></div>
</div>
</div>
<div class="section" id="case-edusoho-performances-makeonecall">
<span id="id114"></span><h4><span class="section-number">5.2.98.2. </span>Edusoho<a class="headerlink" href="#case-edusoho-performances-makeonecall" title="Permalink to this headline">¶</a></h4>
<p><a class="reference internal" href="Rules.html#make-one-call-with-array"><span class="std std-ref">Make One Call With Array</span></a>, in src/AppBundle/Common/StringToolkit.php:55.</p>
<p>Since str_replace is already using an array, the second argument must also be an array, with repeated empty strings. That syntax allows adding the ‘&amp;nbsp;’ and ‘ ‘ to those arrays. Note also that trim() should be be called early, but since some of the replacing may generate terminal spaces, it should be kept as is.</p>
<div class="highlight-php notranslate"><div class="highlight"><pre><span></span><span class="nv">$text</span> <span class="o">=</span> <span class="nb">strip_tags</span><span class="p">(</span><span class="nv">$text</span><span class="p">);</span>

        <span class="nv">$text</span> <span class="o">=</span> <span class="nb">str_replace</span><span class="p">(</span><span class="k">array</span><span class="p">(</span><span class="nx">\n</span><span class="p">,</span> <span class="nx">\r</span><span class="p">,</span> <span class="nx">\t</span><span class="p">),</span> <span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="nv">$text</span><span class="p">);</span>
        <span class="nv">$text</span> <span class="o">=</span> <span class="nb">str_replace</span><span class="p">(</span><span class="s1">&#39;&amp;nbsp;&#39;</span><span class="p">,</span> <span class="s1">&#39; &#39;</span><span class="p">,</span> <span class="nv">$text</span><span class="p">);</span>
        <span class="nv">$text</span> <span class="o">=</span> <span class="nb">trim</span><span class="p">(</span><span class="nv">$text</span><span class="p">);</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="avoid-concat-in-loop">
<span id="case-avoid-concat-in-loop"></span><h3><span class="section-number">5.2.99. </span>Avoid Concat In Loop<a class="headerlink" href="#avoid-concat-in-loop" title="Permalink to this headline">¶</a></h3>
<div class="section" id="case-suitecrm-performances-noconcatinloop">
<span id="id115"></span><h4><span class="section-number">5.2.99.1. </span>SuiteCrm<a class="headerlink" href="#case-suitecrm-performances-noconcatinloop" title="Permalink to this headline">¶</a></h4>
<p><a class="reference internal" href="Rules.html#avoid-concat-in-loop"><span class="std std-ref">Avoid Concat In Loop</span></a>, in include/export_utils.php:433.</p>
<p>$line is build in several steps, then then final version is added to $content. It would be much faster to make $content an array, and implode it once after the loop.</p>
<div class="highlight-php notranslate"><div class="highlight"><pre><span></span><span class="k">foreach</span><span class="p">(</span><span class="nv">$records</span> <span class="k">as</span> <span class="nv">$record</span><span class="p">)</span>
        <span class="p">{</span>
            <span class="nv">$line</span> <span class="o">=</span> <span class="nb">implode</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\\</span><span class="s2"> . getDelimiter() . &quot;</span><span class="nx">\\</span><span class="p">,</span> <span class="nv">$record</span><span class="p">);</span>
            <span class="nv">$line</span> <span class="o">=</span> <span class="s2">&quot;</span><span class="se">\\</span><span class="s2"> . </span><span class="si">$line</span><span class="s2">;</span>
<span class="s2">            </span><span class="si">$line</span><span class="s2"> .= &quot;</span><span class="nx">\\r\n\</span><span class="p">;</span>
            <span class="nv">$line</span> <span class="o">=</span> <span class="nx">parseRelateFields</span><span class="p">(</span><span class="nv">$line</span><span class="p">,</span> <span class="nv">$record</span><span class="p">,</span> <span class="nv">$customRelateFields</span><span class="p">);</span>
            <span class="nv">$content</span> <span class="o">.=</span> <span class="nv">$line</span><span class="p">;</span>
        <span class="p">}</span>
</pre></div>
</div>
</div>
<div class="section" id="case-thinkphp-performances-noconcatinloop">
<span id="id116"></span><h4><span class="section-number">5.2.99.2. </span>ThinkPHP<a class="headerlink" href="#case-thinkphp-performances-noconcatinloop" title="Permalink to this headline">¶</a></h4>
<p><a class="reference internal" href="Rules.html#avoid-concat-in-loop"><span class="std std-ref">Avoid Concat In Loop</span></a>, in ThinkPHP/Common/functions.php:720.</p>
<p>The foreach loop appends the $name and builds a fully qualified name.</p>
<div class="highlight-php notranslate"><div class="highlight"><pre><span></span><span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nx">C</span><span class="p">(</span><span class="s1">&#39;APP_USE_NAMESPACE&#39;</span><span class="p">))</span> <span class="p">{</span>
        <span class="nv">$class</span> <span class="o">=</span> <span class="nx">parse_name</span><span class="p">(</span><span class="nv">$name</span><span class="p">,</span> <span class="mi">1</span><span class="p">);</span>
        <span class="nx">import</span><span class="p">(</span><span class="nv">$module</span> <span class="o">.</span> <span class="s1">&#39;/&#39;</span> <span class="o">.</span> <span class="nv">$layer</span> <span class="o">.</span> <span class="s1">&#39;/&#39;</span> <span class="o">.</span> <span class="nv">$class</span> <span class="o">.</span> <span class="nv">$layer</span><span class="p">);</span>
    <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
        <span class="nv">$class</span> <span class="o">=</span> <span class="nv">$module</span> <span class="o">.</span> <span class="s1">&#39;\&#39; . $layer;</span>
<span class="s1">        foreach ($array as $name) {</span>
<span class="s1">            $class .= &#39;</span><span class="nx">\</span><span class="s1">&#39; . parse_name($name, 1);</span>
<span class="s1">        }</span>
<span class="s1">        // 导入资源类库</span>
<span class="s1">        if ($extend) {</span>
<span class="s1">            // 扩展资源</span>
<span class="s1">            $class = $extend . &#39;</span><span class="nx">\</span><span class="err">&#39;</span> <span class="o">.</span> <span class="nv">$class</span><span class="p">;</span>
        <span class="p">}</span>
    <span class="p">}</span>
    <span class="k">return</span> <span class="nv">$class</span> <span class="o">.</span> <span class="nv">$layer</span><span class="p">;</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="avoid-glob-usage">
<span id="case-avoid-glob-usage"></span><h3><span class="section-number">5.2.100. </span>Avoid glob() Usage<a class="headerlink" href="#avoid-glob-usage" title="Permalink to this headline">¶</a></h3>
<div class="section" id="case-phinx-performances-noglob">
<span id="id117"></span><h4><span class="section-number">5.2.100.1. </span>Phinx<a class="headerlink" href="#case-phinx-performances-noglob" title="Permalink to this headline">¶</a></h4>
<p><a class="reference internal" href="Rules.html#avoid-glob-usage"><span class="std std-ref">Avoid glob() Usage</span></a>, in src/Phinx/Migration/Manager.php:362.</p>
<p>glob() searches for a list of files in the migration folder. Those files are not known, but they have a format, as checked later with the regex : a combinaison of <code class="docutils literal notranslate"><span class="pre">FilesystemIterator</span></code> and <code class="docutils literal notranslate"><span class="pre">RegexIterator</span></code> would do the trick too.</p>
<div class="highlight-php notranslate"><div class="highlight"><pre><span></span><span class="nv">$phpFiles</span> <span class="o">=</span> <span class="nb">glob</span><span class="p">(</span><span class="nv">$config</span><span class="o">-&gt;</span><span class="na">getMigrationPath</span><span class="p">()</span> <span class="o">.</span> <span class="nx">DIRECTORY_SEPARATOR</span> <span class="o">.</span> <span class="s1">&#39;*.php&#39;</span><span class="p">);</span>

            <span class="c1">// filter the files to only get the ones that match our naming scheme</span>
            <span class="nv">$fileNames</span> <span class="o">=</span> <span class="k">array</span><span class="p">();</span>
            <span class="sd">/** @var AbstractMigration[] $versions */</span>
            <span class="nv">$versions</span> <span class="o">=</span> <span class="k">array</span><span class="p">();</span>

            <span class="k">foreach</span> <span class="p">(</span><span class="nv">$phpFiles</span> <span class="k">as</span> <span class="nv">$filePath</span><span class="p">)</span> <span class="p">{</span>
                <span class="k">if</span> <span class="p">(</span><span class="nb">preg_match</span><span class="p">(</span><span class="s1">&#39;/([0-9]+)_([_a-z0-9]*).php/&#39;</span><span class="p">,</span> <span class="nb">basename</span><span class="p">(</span><span class="nv">$filePath</span><span class="p">)))</span> <span class="p">{</span>
</pre></div>
</div>
</div>
<div class="section" id="case-nextcloud-performances-noglob">
<span id="id118"></span><h4><span class="section-number">5.2.100.2. </span>NextCloud<a class="headerlink" href="#case-nextcloud-performances-noglob" title="Permalink to this headline">¶</a></h4>
<p><a class="reference internal" href="Rules.html#avoid-glob-usage"><span class="std std-ref">Avoid glob() Usage</span></a>, in lib/private/legacy/helper.php:185.</p>
<p>Recursive copy of folders, based on scandir(). <code class="docutils literal notranslate"><span class="pre">DirectoryIterator</span></code> and <code class="docutils literal notranslate"><span class="pre">FilesystemIterator</span></code> would do the same without the recursion.</p>
<div class="highlight-php notranslate"><div class="highlight"><pre><span></span><span class="k">static</span> <span class="k">function</span> <span class="nf">copyr</span><span class="p">(</span><span class="nv">$src</span><span class="p">,</span> <span class="nv">$dest</span><span class="p">)</span> <span class="p">{</span>
            <span class="k">if</span> <span class="p">(</span><span class="nb">is_dir</span><span class="p">(</span><span class="nv">$src</span><span class="p">))</span> <span class="p">{</span>
                    <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nb">is_dir</span><span class="p">(</span><span class="nv">$dest</span><span class="p">))</span> <span class="p">{</span>
                            <span class="nb">mkdir</span><span class="p">(</span><span class="nv">$dest</span><span class="p">);</span>
                    <span class="p">}</span>
                    <span class="nv">$files</span> <span class="o">=</span> <span class="nb">scandir</span><span class="p">(</span><span class="nv">$src</span><span class="p">);</span>
                    <span class="k">foreach</span> <span class="p">(</span><span class="nv">$files</span> <span class="k">as</span> <span class="nv">$file</span><span class="p">)</span> <span class="p">{</span>
                            <span class="k">if</span> <span class="p">(</span><span class="nv">$file</span> <span class="o">!=</span> <span class="s2">&quot;.&quot;</span> <span class="o">&amp;&amp;</span> <span class="nv">$file</span> <span class="o">!=</span> <span class="s2">&quot;..&quot;</span><span class="p">)</span> <span class="p">{</span>
                                    <span class="nx">self</span><span class="o">::</span><span class="na">copyr</span><span class="p">(</span><span class="s2">&quot;</span><span class="si">$src</span><span class="s2">/</span><span class="si">$file</span><span class="s2">&quot;</span><span class="p">,</span> <span class="s2">&quot;</span><span class="si">$dest</span><span class="s2">/</span><span class="si">$file</span><span class="s2">&quot;</span><span class="p">);</span>
                            <span class="p">}</span>
                    <span class="p">}</span>
            <span class="p">}</span> <span class="k">elseif</span> <span class="p">(</span><span class="nb">file_exists</span><span class="p">(</span><span class="nv">$src</span><span class="p">)</span> <span class="o">&amp;&amp;</span> <span class="o">!</span><span class="nx">\OC\Files\Filesystem</span><span class="o">::</span><span class="na">isFileBlacklisted</span><span class="p">(</span><span class="nv">$src</span><span class="p">))</span> <span class="p">{</span>
                    <span class="nb">copy</span><span class="p">(</span><span class="nv">$src</span><span class="p">,</span> <span class="nv">$dest</span><span class="p">);</span>
            <span class="p">}</span>
    <span class="p">}</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="no-count-with-0">
<span id="case-no-count-with-0"></span><h3><span class="section-number">5.2.101. </span>No Count With 0<a class="headerlink" href="#no-count-with-0" title="Permalink to this headline">¶</a></h3>
<div class="section" id="case-contao-performances-notcountnull">
<span id="id119"></span><h4><span class="section-number">5.2.101.1. </span>Contao<a class="headerlink" href="#case-contao-performances-notcountnull" title="Permalink to this headline">¶</a></h4>
<p><a class="reference internal" href="Rules.html#no-count-with-0"><span class="std std-ref">No Count With 0</span></a>, in system/modules/repository/classes/RepositoryManager.php:1148.</p>
<p>If $elist contains at least one element, then it is not empty().</p>
<div class="highlight-php notranslate"><div class="highlight"><pre><span></span><span class="nv">$ext</span><span class="o">-&gt;</span><span class="na">found</span> <span class="o">=</span> <span class="nb">count</span><span class="p">(</span><span class="nv">$elist</span><span class="p">)</span><span class="o">&gt;</span><span class="mi">0</span><span class="p">;</span>
</pre></div>
</div>
</div>
<div class="section" id="case-wordpress-performances-notcountnull">
<span id="id120"></span><h4><span class="section-number">5.2.101.2. </span>WordPress<a class="headerlink" href="#case-wordpress-performances-notcountnull" title="Permalink to this headline">¶</a></h4>
<p><a class="reference internal" href="Rules.html#no-count-with-0"><span class="std std-ref">No Count With 0</span></a>, in wp-admin/includes/misc.php:74.</p>
<p>$build or $signature are empty at that point, no need to calculate their respective length.</p>
<div class="highlight-php notranslate"><div class="highlight"><pre><span></span><span class="c1">// Check for zero length, although unlikely here</span>
    <span class="k">if</span> <span class="p">(</span><span class="nb">strlen</span><span class="p">(</span><span class="nv">$built</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span> <span class="o">||</span> <span class="nb">strlen</span><span class="p">(</span><span class="nv">$signature</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
      <span class="k">return</span> <span class="k">false</span><span class="p">;</span>
    <span class="p">}</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="pre-increment">
<span id="case-pre-increment"></span><h3><span class="section-number">5.2.102. </span>Pre-increment<a class="headerlink" href="#pre-increment" title="Permalink to this headline">¶</a></h3>
<div class="section" id="case-expressionengine-performances-prepostincrement">
<span id="id121"></span><h4><span class="section-number">5.2.102.1. </span>ExpressionEngine<a class="headerlink" href="#case-expressionengine-performances-prepostincrement" title="Permalink to this headline">¶</a></h4>
<p><a class="reference internal" href="Rules.html#pre-increment"><span class="std std-ref">Pre-increment</span></a>, in system/ee/EllisLab/ExpressionEngine/Controller/Utilities/Communicate.php:650.</p>
<p>Using preincrement in for() loops is safe and straightforward.</p>
<div class="highlight-php notranslate"><div class="highlight"><pre><span></span><span class="k">for</span> <span class="p">(</span><span class="nv">$x</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="nv">$x</span> <span class="o">&lt;</span> <span class="nv">$number_to_send</span><span class="p">;</span> <span class="nv">$x</span><span class="o">++</span><span class="p">)</span>
            <span class="p">{</span>
                    <span class="nv">$email_address</span> <span class="o">=</span> <span class="nb">array_shift</span><span class="p">(</span><span class="nv">$recipient_array</span><span class="p">);</span>

                    <span class="k">if</span> <span class="p">(</span> <span class="o">!</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">deliverEmail</span><span class="p">(</span><span class="nv">$email</span><span class="p">,</span> <span class="nv">$email_address</span><span class="p">))</span>
                    <span class="p">{</span>
                            <span class="nv">$email</span><span class="o">-&gt;</span><span class="na">delete</span><span class="p">();</span>

                            <span class="nv">$debug_msg</span> <span class="o">=</span> <span class="nx">ee</span><span class="p">()</span><span class="o">-&gt;</span><span class="na">email</span><span class="o">-&gt;</span><span class="na">print_debugger</span><span class="p">(</span><span class="k">array</span><span class="p">());</span>

                            <span class="nx">show_error</span><span class="p">(</span><span class="nx">lang</span><span class="p">(</span><span class="s1">&#39;error_sending_email&#39;</span><span class="p">)</span><span class="o">.</span><span class="nx">BR</span><span class="o">.</span><span class="nx">BR</span><span class="o">.</span><span class="nv">$debug_msg</span><span class="p">);</span>
                    <span class="p">}</span>
                    <span class="nv">$email</span><span class="o">-&gt;</span><span class="na">total_sent</span><span class="o">++</span><span class="p">;</span>
            <span class="p">}</span>
</pre></div>
</div>
</div>
<div class="section" id="traq">
<span id="case-traq-performances-prepostincrement"></span><h4><span class="section-number">5.2.102.2. </span>Traq<a class="headerlink" href="#traq" title="Permalink to this headline">¶</a></h4>
<p><a class="reference internal" href="Rules.html#pre-increment"><span class="std std-ref">Pre-increment</span></a>, in src/Controllers/Tickets.php:84.</p>
<p>$this-&gt;currentProject-&gt;next_ticket_id value is ignored by the code. It may be turned into a preincrement.</p>
<div class="highlight-php notranslate"><div class="highlight"><pre><span></span><span class="nx">TimelineModel</span><span class="o">::</span><span class="na">newTicketEvent</span><span class="p">(</span><span class="nv">$this</span><span class="o">-&gt;</span><span class="na">currentUser</span><span class="p">,</span> <span class="nv">$ticket</span><span class="p">)</span><span class="o">-&gt;</span><span class="na">save</span><span class="p">();</span>

            <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">currentProject</span><span class="o">-&gt;</span><span class="na">next_ticket_id</span><span class="o">++</span><span class="p">;</span>
            <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">currentProject</span><span class="o">-&gt;</span><span class="na">save</span><span class="p">();</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="slow-functions">
<span id="case-slow-functions"></span><h3><span class="section-number">5.2.103. </span>Slow Functions<a class="headerlink" href="#slow-functions" title="Permalink to this headline">¶</a></h3>
<div class="section" id="case-churchcrm-performances-slowfunctions">
<span id="id122"></span><h4><span class="section-number">5.2.103.1. </span>ChurchCRM<a class="headerlink" href="#case-churchcrm-performances-slowfunctions" title="Permalink to this headline">¶</a></h4>
<p><a class="reference internal" href="Rules.html#slow-functions"><span class="std std-ref">Slow Functions</span></a>, in src/Reports/PrintDeposit.php:35.</p>
<p>You may replace this with a isset() : $_POST can’t contain a NULL value, unless it was set by the script itself.</p>
<div class="highlight-php notranslate"><div class="highlight"><pre><span></span><span class="nb">array_key_exists</span><span class="p">(</span><span class="s2">&quot;report_type&quot;</span><span class="p">,</span> <span class="nv">$_POST</span><span class="p">);</span>
</pre></div>
</div>
</div>
<div class="section" id="case-suitecrm-performances-slowfunctions">
<span id="id123"></span><h4><span class="section-number">5.2.103.2. </span>SuiteCrm<a class="headerlink" href="#case-suitecrm-performances-slowfunctions" title="Permalink to this headline">¶</a></h4>
<p><a class="reference internal" href="Rules.html#slow-functions"><span class="std std-ref">Slow Functions</span></a>, in include/json_config.php:242.</p>
<p>This is a equivalent for nl2br()</p>
<div class="highlight-php notranslate"><div class="highlight"><pre><span></span><span class="nb">preg_replace</span><span class="p">(</span><span class="s2">&quot;/</span><span class="se">\r\n</span><span class="s2">/&quot;</span><span class="p">,</span> <span class="s2">&quot;&lt;BR&gt;&quot;</span><span class="p">,</span> <span class="nv">$focus</span><span class="o">-&gt;</span><span class="nv">$field</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="strpos-too-much">
<span id="case-strpos-too-much"></span><h3><span class="section-number">5.2.104. </span>strpos() Too Much<a class="headerlink" href="#strpos-too-much" title="Permalink to this headline">¶</a></h3>
<div class="section" id="case-wordpress-performances-strpostoomuch">
<span id="id124"></span><h4><span class="section-number">5.2.104.1. </span>WordPress<a class="headerlink" href="#case-wordpress-performances-strpostoomuch" title="Permalink to this headline">¶</a></h4>
<p><a class="reference internal" href="Rules.html#strpos-too-much"><span class="std std-ref">strpos() Too Much</span></a>, in core/traits/Request/Server.php:127.</p>
<p>Instead of searching for <code class="docutils literal notranslate"><span class="pre">HTTP_</span></code>, it is faster to compare the first 5 chars to the literal <code class="docutils literal notranslate"><span class="pre">HTTP_</span></code>. In case of absence, this solution returns faster.</p>
<div class="highlight-php notranslate"><div class="highlight"><pre><span></span><span class="k">if</span> <span class="p">(</span><span class="nb">strpos</span><span class="p">(</span><span class="nv">$header</span><span class="p">,</span> <span class="s1">&#39;HTTP_&#39;</span><span class="p">)</span> <span class="o">===</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
                            <span class="nv">$header</span> <span class="o">=</span> <span class="nb">substr</span><span class="p">(</span><span class="nv">$header</span><span class="p">,</span> <span class="mi">5</span><span class="p">);</span>
                    <span class="p">}</span> <span class="k">elseif</span> <span class="p">(</span><span class="nb">strpos</span><span class="p">(</span><span class="nv">$header</span><span class="p">,</span> <span class="s1">&#39;CONTENT_&#39;</span><span class="p">)</span> <span class="o">!==</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
                            <span class="k">continue</span><span class="p">;</span>
                    <span class="p">}</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="substring-first">
<span id="case-substring-first"></span><h3><span class="section-number">5.2.105. </span>Substring First<a class="headerlink" href="#substring-first" title="Permalink to this headline">¶</a></h3>
<div class="section" id="case-spip-performances-substrfirst">
<span id="id125"></span><h4><span class="section-number">5.2.105.1. </span>SPIP<a class="headerlink" href="#case-spip-performances-substrfirst" title="Permalink to this headline">¶</a></h4>
<p><a class="reference internal" href="Rules.html#substring-first"><span class="std std-ref">Substring First</span></a>, in ecrire/inc/filtres.php:1694.</p>
<p>The code first makes everything uppercase, including the leading and trailing spaces, and then, removes them : it would be best to swap those operations. Note that spip_substr() is not considered in this analysis, but with SPIP knowledge, it could be moved inside the calls.</p>
<div class="highlight-php notranslate"><div class="highlight"><pre><span></span><span class="k">function</span> <span class="nf">filtre_initiale</span><span class="p">(</span><span class="nv">$nom</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">return</span> <span class="nx">spip_substr</span><span class="p">(</span><span class="nb">trim</span><span class="p">(</span><span class="nb">strtoupper</span><span class="p">(</span><span class="nx">extraire_multi</span><span class="p">(</span><span class="nv">$nom</span><span class="p">))),</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">);</span>
<span class="p">}</span>
</pre></div>
</div>
</div>
<div class="section" id="case-prestashop-performances-substrfirst">
<span id="id126"></span><h4><span class="section-number">5.2.105.2. </span>PrestaShop<a class="headerlink" href="#case-prestashop-performances-substrfirst" title="Permalink to this headline">¶</a></h4>
<p><a class="reference internal" href="Rules.html#substring-first"><span class="std std-ref">Substring First</span></a>, in admin-dev/filemanager/include/utils.php:197.</p>
<p>dirname() reduces the string (or at least, keeps it the same size), so it more efficient to have it first.</p>
<div class="highlight-php notranslate"><div class="highlight"><pre><span></span><span class="nb">dirname</span><span class="p">(</span><span class="nb">str_replace</span><span class="p">(</span><span class="s1">&#39; &#39;</span><span class="p">,</span> <span class="s1">&#39;~&#39;</span><span class="p">,</span> <span class="nv">$str</span><span class="p">))</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="time-vs-strtotime">
<span id="case-time-vs-strtotime"></span><h3><span class="section-number">5.2.106. </span>time() Vs strtotime()<a class="headerlink" href="#time-vs-strtotime" title="Permalink to this headline">¶</a></h3>
<div class="section" id="case-woocommerce-performances-timevsstrtotime">
<span id="id127"></span><h4><span class="section-number">5.2.106.1. </span>Woocommerce<a class="headerlink" href="#case-woocommerce-performances-timevsstrtotime" title="Permalink to this headline">¶</a></h4>
<p><a class="reference internal" href="Rules.html#time-vs-strtotime"><span class="std std-ref">time() Vs strtotime()</span></a>, in includes/class-wc-webhook.php:384.</p>
<p>time() would be faster here, as an entropy generator. Yet, it would still be better to use an actual secure entropy generator, like random_byte or random_int. In case of older version, microtime() would yield better entropy.</p>
<div class="highlight-php notranslate"><div class="highlight"><pre><span></span><span class="k">public</span> <span class="k">function</span> <span class="nf">get_new_delivery_id</span><span class="p">()</span> <span class="p">{</span>
            <span class="c1">// Since we no longer use comments to store delivery logs, we generate a unique hash instead based on current time and webhook ID.</span>
            <span class="k">return</span> <span class="nx">wp_hash</span><span class="p">(</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">get_id</span><span class="p">()</span> <span class="o">.</span> <span class="nb">strtotime</span><span class="p">(</span> <span class="s1">&#39;now&#39;</span> <span class="p">)</span> <span class="p">);</span>
    <span class="p">}</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="assign-with-and-precedence">
<span id="case-assign-with-and-precedence"></span><h3><span class="section-number">5.2.107. </span>Assign With And Precedence<a class="headerlink" href="#assign-with-and-precedence" title="Permalink to this headline">¶</a></h3>
<div class="section" id="case-xataface-php-assignand">
<span id="id128"></span><h4><span class="section-number">5.2.107.1. </span>xataface<a class="headerlink" href="#case-xataface-php-assignand" title="Permalink to this headline">¶</a></h4>
<p><a class="reference internal" href="Rules.html#assign-with-and-precedence"><span class="std std-ref">Assign With And Precedence</span></a>, in Dataface/LanguageTool.php:265.</p>
<p>The usage of ‘and’ here is a workaround for PHP version that have no support for the coalesce. $autosubmit receives the value of $params[‘autosubmit’] only if the latter is set. Yet, with = having higher precedence over ‘and’, $autosubmit is mistaken with the existence of $params[‘autosubmit’] : its value is actually omitted.</p>
<div class="highlight-php notranslate"><div class="highlight"><pre><span></span><span class="nv">$autosubmit</span> <span class="o">=</span> <span class="nb">isset</span><span class="p">(</span><span class="nv">$params</span><span class="p">[</span><span class="s1">&#39;autosubmit&#39;</span><span class="p">])</span> <span class="k">and</span> <span class="nv">$params</span><span class="p">[</span><span class="s1">&#39;autosubmit&#39;</span><span class="p">];</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="avoid-set-error-handler-context-argument">
<span id="case-avoid-set-error-handler-context-argument"></span><h3><span class="section-number">5.2.108. </span>Avoid set_error_handler $context Argument<a class="headerlink" href="#avoid-set-error-handler-context-argument" title="Permalink to this headline">¶</a></h3>
<div class="section" id="case-shopware-php-avoidseterrorhandlercontextarg">
<span id="id129"></span><h4><span class="section-number">5.2.108.1. </span>shopware<a class="headerlink" href="#case-shopware-php-avoidseterrorhandlercontextarg" title="Permalink to this headline">¶</a></h4>
<p><a class="reference internal" href="Rules.html#avoid-set-error-handler-context-argument"><span class="std std-ref">Avoid set_error_handler $context Argument</span></a>, in engine/Shopware/Plugins/Default/Core/ErrorHandler/Bootstrap.php:162.</p>
<p>The registered handler is a local method, called <code class="docutils literal notranslate"><span class="pre">errorHandler</span></code>, which has 6 arguments, and relays those 6 arguments to set_error_handler().</p>
<div class="highlight-php notranslate"><div class="highlight"><pre><span></span><span class="k">public</span> <span class="k">function</span> <span class="nf">registerErrorHandler</span><span class="p">(</span><span class="nv">$errorLevel</span> <span class="o">=</span> <span class="k">E_ALL</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="c1">// Only register once.  Avoids loop issues if it gets registered twice.</span>
        <span class="k">if</span> <span class="p">(</span><span class="nx">self</span><span class="o">::</span><span class="nv">$_registeredErrorHandler</span><span class="p">)</span> <span class="p">{</span>
            <span class="nb">set_error_handler</span><span class="p">([</span><span class="nv">$this</span><span class="p">,</span> <span class="s1">&#39;errorHandler&#39;</span><span class="p">],</span> <span class="nv">$errorLevel</span><span class="p">);</span>

            <span class="k">return</span> <span class="nv">$this</span><span class="p">;</span>
        <span class="p">}</span>

        <span class="nx">self</span><span class="o">::</span><span class="nv">$_origErrorHandler</span> <span class="o">=</span> <span class="nb">set_error_handler</span><span class="p">([</span><span class="nv">$this</span><span class="p">,</span> <span class="s1">&#39;errorHandler&#39;</span><span class="p">],</span> <span class="nv">$errorLevel</span><span class="p">);</span>
        <span class="nx">self</span><span class="o">::</span><span class="nv">$_registeredErrorHandler</span> <span class="o">=</span> <span class="k">true</span><span class="p">;</span>

        <span class="k">return</span> <span class="nv">$this</span><span class="p">;</span>
    <span class="p">}</span>
</pre></div>
</div>
</div>
<div class="section" id="case-vanilla-php-avoidseterrorhandlercontextarg">
<span id="id130"></span><h4><span class="section-number">5.2.108.2. </span>Vanilla<a class="headerlink" href="#case-vanilla-php-avoidseterrorhandlercontextarg" title="Permalink to this headline">¶</a></h4>
<p><a class="reference internal" href="Rules.html#avoid-set-error-handler-context-argument"><span class="std std-ref">Avoid set_error_handler $context Argument</span></a>, in library/core/functions.error.php:747.</p>
<p>Gdn_ErrorHandler is a function that requires 6 arguments.</p>
<div class="highlight-php notranslate"><div class="highlight"><pre><span></span><span class="nb">set_error_handler</span><span class="p">(</span><span class="s1">&#39;Gdn_ErrorHandler&#39;</span><span class="p">,</span> <span class="k">E_ALL</span> <span class="o">&amp;</span> <span class="o">~</span><span class="nx">E_STRICT</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="use-random-int">
<span id="case-use-random-int"></span><h3><span class="section-number">5.2.109. </span>Use random_int()<a class="headerlink" href="#use-random-int" title="Permalink to this headline">¶</a></h3>
<div class="section" id="case-thelia-php-betterrand">
<span id="id131"></span><h4><span class="section-number">5.2.109.1. </span>Thelia<a class="headerlink" href="#case-thelia-php-betterrand" title="Permalink to this headline">¶</a></h4>
<p><a class="reference internal" href="Rules.html#use-random-int"><span class="std std-ref">Use random_int()</span></a>, in core/lib/Thelia/Tools/TokenProvider.php:151.</p>
<p>The whole function may be replaced by random_int(), as it generates random tokens. This needs an extra layer of hashing, to get a long and string results.</p>
<div class="highlight-php notranslate"><div class="highlight"><pre><span></span><span class="sd">/**</span>
<span class="sd">     * @return string</span>
<span class="sd">     */</span>
    <span class="k">protected</span> <span class="k">static</span> <span class="k">function</span> <span class="nf">getComplexRandom</span><span class="p">()</span>
    <span class="p">{</span>
        <span class="nv">$firstValue</span> <span class="o">=</span> <span class="p">(</span><span class="nx">float</span><span class="p">)</span> <span class="p">(</span><span class="nb">mt_rand</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mh">0xFFFF</span><span class="p">)</span> <span class="o">*</span> <span class="nb">rand</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mh">0x10001</span><span class="p">));</span>
        <span class="nv">$secondValues</span> <span class="o">=</span> <span class="p">(</span><span class="nx">float</span><span class="p">)</span> <span class="p">(</span><span class="nb">rand</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mh">0xFFFF</span><span class="p">)</span> <span class="o">*</span> <span class="nb">mt_rand</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mh">0x10001</span><span class="p">));</span>

        <span class="k">return</span> <span class="nb">microtime</span><span class="p">()</span> <span class="o">.</span> <span class="nb">ceil</span><span class="p">(</span><span class="nv">$firstValue</span> <span class="o">/</span> <span class="nv">$secondValues</span><span class="p">)</span> <span class="o">.</span> <span class="nb">uniqid</span><span class="p">();</span>
    <span class="p">}</span>
</pre></div>
</div>
</div>
<div class="section" id="case-fuelcms-php-betterrand">
<span id="id132"></span><h4><span class="section-number">5.2.109.2. </span>FuelCMS<a class="headerlink" href="#case-fuelcms-php-betterrand" title="Permalink to this headline">¶</a></h4>
<p><a class="reference internal" href="Rules.html#use-random-int"><span class="std std-ref">Use random_int()</span></a>, in fuel/modules/fuel/libraries/Fuel.php:235.</p>
<p>Security tokens should be build with a CSPRNG source. uniqid() is based on time, and though it changes anytime (sic), it is easy to guess. Those days, it looks like ‘5b1262e74dbb9’;</p>
<div class="highlight-php notranslate"><div class="highlight"><pre><span></span><span class="nv">$this</span><span class="o">-&gt;</span><span class="na">installer</span><span class="o">-&gt;</span><span class="na">change_config</span><span class="p">(</span><span class="s1">&#39;config&#39;</span><span class="p">,</span> <span class="s1">&#39;$config[\&#39;encryption_key\&#39;] = \&#39;\&#39;;&#39;</span><span class="p">,</span> <span class="s1">&#39;$config[\&#39;encryption_key\&#39;] = \&#39;&#39;</span><span class="o">.</span><span class="nb">md5</span><span class="p">(</span><span class="nb">uniqid</span><span class="p">())</span><span class="o">.</span><span class="s1">&#39;\&#39;;&#39;</span><span class="p">);</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="deprecated-php-functions">
<span id="case-deprecated-php-functions"></span><h3><span class="section-number">5.2.110. </span>Deprecated PHP Functions<a class="headerlink" href="#deprecated-php-functions" title="Permalink to this headline">¶</a></h3>
<div class="section" id="case-dolphin-php-deprecated">
<span id="id133"></span><h4><span class="section-number">5.2.110.1. </span>Dolphin<a class="headerlink" href="#case-dolphin-php-deprecated" title="Permalink to this headline">¶</a></h4>
<p><a class="reference internal" href="Rules.html#deprecated-php-functions"><span class="std std-ref">Deprecated PHP Functions</span></a>, in Dolphin-v.7.3.5/inc/classes/BxDolAdminSettings.php:270.</p>
<p>Split() was abandonned in PHP 7.0</p>
<div class="highlight-php notranslate"><div class="highlight"><pre><span></span><span class="nb">split</span><span class="p">(</span><span class="s1">&#39;,&#39;</span><span class="p">,</span> <span class="nv">$aItem</span><span class="p">[</span><span class="s1">&#39;extra&#39;</span><span class="p">]);</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="wrong-fopen-mode">
<span id="case-wrong-fopen-mode"></span><h3><span class="section-number">5.2.111. </span>Wrong fopen() Mode<a class="headerlink" href="#wrong-fopen-mode" title="Permalink to this headline">¶</a></h3>
<div class="section" id="case-tikiwiki-php-fopenmode">
<span id="id134"></span><h4><span class="section-number">5.2.111.1. </span>Tikiwiki<a class="headerlink" href="#case-tikiwiki-php-fopenmode" title="Permalink to this headline">¶</a></h4>
<p><a class="reference internal" href="Rules.html#wrong-fopen-mode"><span class="std std-ref">Wrong fopen() Mode</span></a>, in lib/tikilib.php:6777.</p>
<p>This fopen() mode doesn’t exists. Use ‘w’ instead.</p>
<div class="highlight-php notranslate"><div class="highlight"><pre><span></span><span class="nb">fopen</span><span class="p">(</span><span class="s1">&#39;php://temp&#39;</span><span class="p">,</span> <span class="s1">&#39;rw&#39;</span><span class="p">);</span>
</pre></div>
</div>
</div>
<div class="section" id="case-humo-gen-php-fopenmode">
<span id="id135"></span><h4><span class="section-number">5.2.111.2. </span>HuMo-Gen<a class="headerlink" href="#case-humo-gen-php-fopenmode" title="Permalink to this headline">¶</a></h4>
<p><a class="reference internal" href="Rules.html#wrong-fopen-mode"><span class="std std-ref">Wrong fopen() Mode</span></a>, in include/phprtflite/lib/PHPRtfLite/StreamOutput.php:77.</p>
<p>This fopen() mode doesn’t exists. Use ‘w’ instead.</p>
<div class="highlight-php notranslate"><div class="highlight"><pre><span></span><span class="nb">fopen</span><span class="p">(</span><span class="nv">$this</span><span class="o">-&gt;</span><span class="na">_filename</span><span class="p">,</span> <span class="s1">&#39;wr&#39;</span><span class="p">,</span> <span class="k">false</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="incompilable-files">
<span id="case-incompilable-files"></span><h3><span class="section-number">5.2.112. </span>Incompilable Files<a class="headerlink" href="#incompilable-files" title="Permalink to this headline">¶</a></h3>
<div class="section" id="case-xataface-php-incompilable">
<span id="id136"></span><h4><span class="section-number">5.2.112.1. </span>xataface<a class="headerlink" href="#case-xataface-php-incompilable" title="Permalink to this headline">¶</a></h4>
<p><a class="reference internal" href="Rules.html#incompilable-files"><span class="std std-ref">Incompilable Files</span></a>, in lib/XML/Tree.php:289.</p>
<p>Compilation error with PHP 7.2 version.</p>
<div class="highlight-php notranslate"><div class="highlight"><pre><span></span><span class="nx">syntax</span> <span class="nx">error</span><span class="p">,</span> <span class="nx">unexpected</span> <span class="s1">&#39;new&#39;</span> <span class="p">(</span><span class="nx">T_NEW</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="wrong-parameter-type">
<span id="case-wrong-parameter-type"></span><h3><span class="section-number">5.2.113. </span>Wrong Parameter Type<a class="headerlink" href="#wrong-parameter-type" title="Permalink to this headline">¶</a></h3>
<div class="section" id="case-zencart-php-internalparametertype">
<span id="id137"></span><h4><span class="section-number">5.2.113.1. </span>Zencart<a class="headerlink" href="#case-zencart-php-internalparametertype" title="Permalink to this headline">¶</a></h4>
<p><a class="reference internal" href="Rules.html#wrong-parameter-type"><span class="std std-ref">Wrong Parameter Type</span></a>, in admin/includes/header.php:180.</p>
<p>setlocale() may be called with null or ‘’ (empty string), and will set values from the environment. When called with “0” (the string), it only reports the current setting. Using an integer is probably undocumented behavior, and falls back to the zero string.</p>
<div class="highlight-php notranslate"><div class="highlight"><pre><span></span><span class="nv">$loc</span> <span class="o">=</span> <span class="nb">setlocale</span><span class="p">(</span><span class="nx">LC_TIME</span><span class="p">,</span> <span class="mi">0</span><span class="p">);</span>
        <span class="k">if</span> <span class="p">(</span><span class="nv">$loc</span> <span class="o">!==</span> <span class="k">FALSE</span><span class="p">)</span> <span class="k">echo</span> <span class="s1">&#39; - &#39;</span> <span class="o">.</span> <span class="nv">$loc</span><span class="p">;</span> <span class="c1">//what is the locale in use?</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="isset-multiple-arguments">
<span id="case-isset-multiple-arguments"></span><h3><span class="section-number">5.2.114. </span>Isset Multiple Arguments<a class="headerlink" href="#isset-multiple-arguments" title="Permalink to this headline">¶</a></h3>
<div class="section" id="case-thinkphp-php-issetmultipleargs">
<span id="id138"></span><h4><span class="section-number">5.2.114.1. </span>ThinkPHP<a class="headerlink" href="#case-thinkphp-php-issetmultipleargs" title="Permalink to this headline">¶</a></h4>
<p><a class="reference internal" href="Rules.html#isset-multiple-arguments"><span class="std std-ref">Isset Multiple Arguments</span></a>, in library/think/Request.php:1187.</p>
<p>This may be shortened with isset($sub), $array[$name][$sub])</p>
<div class="highlight-php notranslate"><div class="highlight"><pre><span></span><span class="nb">isset</span><span class="p">(</span><span class="nv">$sub</span><span class="p">)</span> <span class="o">&amp;&amp;</span> <span class="nb">isset</span><span class="p">(</span><span class="nv">$array</span><span class="p">[</span><span class="nv">$name</span><span class="p">][</span><span class="nv">$sub</span><span class="p">])</span>
</pre></div>
</div>
</div>
<div class="section" id="case-livezilla-php-issetmultipleargs">
<span id="id139"></span><h4><span class="section-number">5.2.114.2. </span>LiveZilla<a class="headerlink" href="#case-livezilla-php-issetmultipleargs" title="Permalink to this headline">¶</a></h4>
<p><a class="reference internal" href="Rules.html#isset-multiple-arguments"><span class="std std-ref">Isset Multiple Arguments</span></a>, in livezilla/_lib/trdp/pchart/class/pDraw.class.php:3852.</p>
<p>This is the equivalent of !(isset($Data[“Series”][$SerieA][“Data”]) &amp;&amp; isset($Data[“Series”][$SerieB][“Data”])), and then, !(isset($Data[“Series”][$SerieA][“Data”], $Data[“Series”][$SerieB][“Data”]))</p>
<div class="highlight-php notranslate"><div class="highlight"><pre><span></span><span class="o">!</span><span class="nb">isset</span><span class="p">(</span><span class="nv">$Data</span><span class="p">[</span><span class="s2">&quot;Series&quot;</span><span class="p">][</span><span class="nv">$SerieA</span><span class="p">][</span><span class="s2">&quot;Data&quot;</span><span class="p">])</span> <span class="o">||</span> <span class="o">!</span><span class="nb">isset</span><span class="p">(</span><span class="nv">$Data</span><span class="p">[</span><span class="s2">&quot;Series&quot;</span><span class="p">][</span><span class="nv">$SerieB</span><span class="p">][</span><span class="s2">&quot;Data&quot;</span><span class="p">])</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="logical-should-use-symbolic-operators">
<span id="case-logical-should-use-symbolic-operators"></span><h3><span class="section-number">5.2.115. </span>Logical Should Use Symbolic Operators<a class="headerlink" href="#logical-should-use-symbolic-operators" title="Permalink to this headline">¶</a></h3>
<div class="section" id="case-cleverstyle-php-logicalinletters">
<span id="id140"></span><h4><span class="section-number">5.2.115.1. </span>Cleverstyle<a class="headerlink" href="#case-cleverstyle-php-logicalinletters" title="Permalink to this headline">¶</a></h4>
<p><a class="reference internal" href="Rules.html#logical-should-use-symbolic-operators"><span class="std std-ref">Logical Should Use Symbolic Operators</span></a>, in modules/Uploader/Mime/Mime.php:171.</p>
<p>$extension is assigned with the results of pathinfo($reference_name, PATHINFO_EXTENSION) and ignores static::hasExtension($extension). The same expression, placed in a condition (like an if), would assign a value to $extension and use another for the condition itself. Here, this code is only an expression in the flow.</p>
<div class="highlight-php notranslate"><div class="highlight"><pre><span></span><span class="nv">$extension</span> <span class="o">=</span> <span class="nb">pathinfo</span><span class="p">(</span><span class="nv">$reference_name</span><span class="p">,</span> <span class="nx">PATHINFO_EXTENSION</span><span class="p">)</span> <span class="k">and</span> <span class="k">static</span><span class="o">::</span><span class="na">hasExtension</span><span class="p">(</span><span class="nv">$extension</span><span class="p">);</span>
</pre></div>
</div>
</div>
<div class="section" id="case-openconf-php-logicalinletters">
<span id="id141"></span><h4><span class="section-number">5.2.115.2. </span>OpenConf<a class="headerlink" href="#case-openconf-php-logicalinletters" title="Permalink to this headline">¶</a></h4>
<p><a class="reference internal" href="Rules.html#logical-should-use-symbolic-operators"><span class="std std-ref">Logical Should Use Symbolic Operators</span></a>, in chair/export.inc:143.</p>
<p>In this context, the priority of execution is used on purpose; $coreFile only collect the temporary name of the export file, and when this name is empty, then the second operand of OR is executed, though never collected. Since this second argument is a ‘die’, its return value is lost, but the initial assignation is never used anyway.</p>
<div class="highlight-php notranslate"><div class="highlight"><pre><span></span><span class="nv">$coreFile</span> <span class="o">=</span> <span class="nb">tempnam</span><span class="p">(</span><span class="s1">&#39;/tmp/&#39;</span><span class="p">,</span> <span class="s1">&#39;ocexport&#39;</span><span class="p">)</span> <span class="k">or</span> <span class="k">die</span><span class="p">(</span><span class="s1">&#39;could not generate Excel file (6)&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="possible-missing-subpattern">
<span id="case-possible-missing-subpattern"></span><h3><span class="section-number">5.2.116. </span>Possible Missing Subpattern<a class="headerlink" href="#possible-missing-subpattern" title="Permalink to this headline">¶</a></h3>
<div class="section" id="case-phpmyadmin-php-missingsubpattern">
<span id="id142"></span><h4><span class="section-number">5.2.116.1. </span>phpMyAdmin<a class="headerlink" href="#case-phpmyadmin-php-missingsubpattern" title="Permalink to this headline">¶</a></h4>
<p><a class="reference internal" href="Rules.html#possible-missing-subpattern"><span class="std std-ref">Possible Missing Subpattern</span></a>, in libraries/classes/Advisor.php:557.</p>
<p>The last capturing subpattern is <code class="docutils literal notranslate"><span class="pre">(</span> <span class="pre">\[(.*)\])?</span></code> and it is optional. Indeed, when the pattern succeed, the captured values are stored in <code class="docutils literal notranslate"><span class="pre">$match</span></code>. Yet, the code checks for the existence of <code class="docutils literal notranslate"><span class="pre">$match[3]</span></code> before using it.</p>
<div class="highlight-php notranslate"><div class="highlight"><pre><span></span><span class="k">if</span> <span class="p">(</span><span class="nb">preg_match</span><span class="p">(</span><span class="s2">&quot;/rule\s&#39;(.*)&#39;( \[(.*)\])?$/&quot;</span><span class="p">,</span> <span class="nv">$line</span><span class="p">,</span> <span class="nv">$match</span><span class="p">))</span> <span class="p">{</span>
                    <span class="nv">$ruleLine</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>
                    <span class="nv">$ruleNo</span><span class="o">++</span><span class="p">;</span>
                    <span class="nv">$rules</span><span class="p">[</span><span class="nv">$ruleNo</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;name&#39;</span> <span class="o">=&gt;</span> <span class="nv">$match</span><span class="p">[</span><span class="mi">1</span><span class="p">]];</span>
                    <span class="nv">$lines</span><span class="p">[</span><span class="nv">$ruleNo</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;name&#39;</span> <span class="o">=&gt;</span> <span class="nv">$i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">];</span>
                    <span class="k">if</span> <span class="p">(</span><span class="nb">isset</span><span class="p">(</span><span class="nv">$match</span><span class="p">[</span><span class="mi">3</span><span class="p">]))</span> <span class="p">{</span>
                        <span class="nv">$rules</span><span class="p">[</span><span class="nv">$ruleNo</span><span class="p">][</span><span class="s1">&#39;precondition&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="nv">$match</span><span class="p">[</span><span class="mi">3</span><span class="p">];</span>
                        <span class="nv">$lines</span><span class="p">[</span><span class="nv">$ruleNo</span><span class="p">][</span><span class="s1">&#39;precondition&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="nv">$i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">;</span>
                    <span class="p">}</span>
</pre></div>
</div>
</div>
<div class="section" id="case-spip-php-missingsubpattern">
<span id="id143"></span><h4><span class="section-number">5.2.116.2. </span>SPIP<a class="headerlink" href="#case-spip-php-missingsubpattern" title="Permalink to this headline">¶</a></h4>
<p><a class="reference internal" href="Rules.html#possible-missing-subpattern"><span class="std std-ref">Possible Missing Subpattern</span></a>, in ecrire/inc/filtres_dates.php:73.</p>
<p>This code avoid the PHP notice by padding the resulting array (see comment in French : eviter === avoid)</p>
<div class="highlight-php notranslate"><div class="highlight"><pre><span></span><span class="k">if</span> <span class="p">(</span><span class="nb">preg_match</span><span class="p">(</span><span class="s2">&quot;#^([12][0-9]{3}[-/][01]?[0-9])([-/]00)?( [-0-9:]+)?$#&quot;</span><span class="p">,</span> <span class="nv">$date</span><span class="p">,</span> <span class="nv">$regs</span><span class="p">))</span> <span class="p">{</span>
                            <span class="nv">$regs</span> <span class="o">=</span> <span class="nb">array_pad</span><span class="p">(</span><span class="nv">$regs</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="k">null</span><span class="p">);</span> <span class="c1">// eviter notice php</span>
                            <span class="nv">$date</span> <span class="o">=</span> <span class="nb">preg_replace</span><span class="p">(</span><span class="s2">&quot;@/@&quot;</span><span class="p">,</span> <span class="s2">&quot;-&quot;</span><span class="p">,</span> <span class="nv">$regs</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span> <span class="o">.</span> <span class="s2">&quot;-00&quot;</span> <span class="o">.</span> <span class="nv">$regs</span><span class="p">[</span><span class="mi">3</span><span class="p">];</span>
                    <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
                            <span class="nv">$date</span> <span class="o">=</span> <span class="nb">date</span><span class="p">(</span><span class="s2">&quot;Y-m-d H:i:s&quot;</span><span class="p">,</span> <span class="nb">strtotime</span><span class="p">(</span><span class="nv">$date</span><span class="p">));</span>
                    <span class="p">}</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="for-exponent">
<span id="case-for-exponent"></span><h3><span class="section-number">5.2.117. </span>** For Exponent<a class="headerlink" href="#for-exponent" title="Permalink to this headline">¶</a></h3>
<div class="section" id="case-traq-php-newexponent">
<span id="id144"></span><h4><span class="section-number">5.2.117.1. </span>Traq<a class="headerlink" href="#case-traq-php-newexponent" title="Permalink to this headline">¶</a></h4>
<p><a class="reference internal" href="Rules.html#for-exponent"><span class="std std-ref">** For Exponent</span></a>, in src/views/layouts/_footer.phtm:5.</p>
<p>pow(1024, 2) could be (1023 ** 2), to convert bytes into Mb.</p>
<div class="highlight-php notranslate"><div class="highlight"><pre><span></span><span class="o">&lt;?=</span><span class="nb">round</span><span class="p">((</span><span class="nb">microtime</span><span class="p">(</span><span class="k">true</span><span class="p">)</span> <span class="o">-</span> <span class="nx">START_TIME</span><span class="p">),</span> <span class="mi">2</span><span class="p">);</span> <span class="cp">?&gt;</span><span class="x">s, </span><span class="cp">&lt;?php</span> <span class="k">echo</span> <span class="nb">round</span><span class="p">((</span><span class="nb">memory_get_peak_usage</span><span class="p">()</span> <span class="o">-</span> <span class="nx">START_MEM</span><span class="p">)</span> <span class="o">/</span> <span class="nb">pow</span><span class="p">(</span><span class="mi">1024</span><span class="p">,</span> <span class="mi">2</span><span class="p">),</span> <span class="mi">3</span><span class="p">)</span><span class="cp">?&gt;</span><span class="x">mb</span>
</pre></div>
</div>
</div>
<div class="section" id="case-teampass-php-newexponent">
<span id="id145"></span><h4><span class="section-number">5.2.117.2. </span>TeamPass<a class="headerlink" href="#case-teampass-php-newexponent" title="Permalink to this headline">¶</a></h4>
<p><a class="reference internal" href="Rules.html#for-exponent"><span class="std std-ref">** For Exponent</span></a>, in includes/libraries/Authentication/phpseclib/Math/BigInteger.php:286.</p>
<p>pow(2, 62) could also be hard coded with 0x4000000000000000.</p>
<div class="highlight-php notranslate"><div class="highlight"><pre><span></span><span class="nb">pow</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">62</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="no-class-in-global">
<span id="case-no-class-in-global"></span><h3><span class="section-number">5.2.118. </span>No Class In Global<a class="headerlink" href="#no-class-in-global" title="Permalink to this headline">¶</a></h3>
<div class="section" id="case-dolphin-php-noclassinglobal">
<span id="id146"></span><h4><span class="section-number">5.2.118.1. </span>Dolphin<a class="headerlink" href="#case-dolphin-php-noclassinglobal" title="Permalink to this headline">¶</a></h4>
<p><a class="reference internal" href="Rules.html#no-class-in-global"><span class="std std-ref">No Class In Global</span></a>, in Dolphin-v.7.3.5/inc/classes/BxDolXml.php:10.</p>
<p>This class should be put away in a ‘dolphin’ or ‘boonex’ namespace.</p>
<div class="highlight-php notranslate"><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">BxDolXml</span> <span class="p">{</span>
    <span class="cm">/* class BxDolXML code */</span>
<span class="p">}</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="no-reference-for-ternary">
<span id="case-no-reference-for-ternary"></span><h3><span class="section-number">5.2.119. </span>No Reference For Ternary<a class="headerlink" href="#no-reference-for-ternary" title="Permalink to this headline">¶</a></h3>
<div class="section" id="case-phpadsnew-php-noreferenceforternary">
<span id="id147"></span><h4><span class="section-number">5.2.119.1. </span>phpadsnew<a class="headerlink" href="#case-phpadsnew-php-noreferenceforternary" title="Permalink to this headline">¶</a></h4>
<p><a class="reference internal" href="Rules.html#no-reference-for-ternary"><span class="std std-ref">No Reference For Ternary</span></a>, in lib/OA/Admin/Menu/Section.php334:334.</p>
<p>The reference should be removed from the function definition. Either this method returns null, which is never a reference, or it returns $this, which is always a reference, or the results of a methodcall. The latter may or may not be a reference, but the Ternary operator will drop it and return by value.</p>
<div class="highlight-php notranslate"><div class="highlight"><pre><span></span><span class="k">function</span> <span class="o">&amp;</span><span class="nf">getParentOrSelf</span><span class="p">(</span><span class="nv">$type</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="k">if</span> <span class="p">(</span><span class="nv">$this</span><span class="o">-&gt;</span><span class="na">type</span> <span class="o">==</span> <span class="nv">$type</span><span class="p">)</span> <span class="p">{</span>
            <span class="k">return</span> <span class="nv">$this</span><span class="p">;</span>
        <span class="p">}</span>
        <span class="k">else</span> <span class="p">{</span>
            <span class="k">return</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">parentSection</span> <span class="o">!=</span> <span class="k">null</span> <span class="o">?</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">parentSection</span><span class="o">-&gt;</span><span class="na">getParentOrSelf</span><span class="p">(</span><span class="nv">$type</span><span class="p">)</span> <span class="o">:</span> <span class="k">null</span><span class="p">;</span>
        <span class="p">}</span>
    <span class="p">}</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="pathinfo-returns-may-vary">
<span id="case-pathinfo-returns-may-vary"></span><h3><span class="section-number">5.2.120. </span>Pathinfo() Returns May Vary<a class="headerlink" href="#pathinfo-returns-may-vary" title="Permalink to this headline">¶</a></h3>
<div class="section" id="case-nextcloud-php-pathinforeturns">
<span id="id148"></span><h4><span class="section-number">5.2.120.1. </span>NextCloud<a class="headerlink" href="#case-nextcloud-php-pathinforeturns" title="Permalink to this headline">¶</a></h4>
<p><a class="reference internal" href="Rules.html#pathinfo-returns-may-vary"><span class="std std-ref">Pathinfo() Returns May Vary</span></a>, in lib/private/Preview/Office.php:56.</p>
<p>$absPath is build with the toTmpFile() method, which may return a boolean (false) in case of error. Error situations include the inability to create the temporary file.</p>
<div class="highlight-php notranslate"><div class="highlight"><pre><span></span><span class="nv">$absPath</span> <span class="o">=</span> <span class="nv">$fileview</span><span class="o">-&gt;</span><span class="na">toTmpFile</span><span class="p">(</span><span class="nv">$path</span><span class="p">);</span>

<span class="c1">// More code</span>

                    <span class="k">list</span><span class="p">(</span><span class="nv">$dirname</span><span class="p">,</span> <span class="p">,</span> <span class="p">,</span> <span class="nv">$filename</span><span class="p">)</span> <span class="o">=</span> <span class="nb">array_values</span><span class="p">(</span><span class="nb">pathinfo</span><span class="p">(</span><span class="nv">$absPath</span><span class="p">));</span>
                    <span class="nv">$pngPreview</span> <span class="o">=</span> <span class="nv">$dirname</span> <span class="o">.</span> <span class="s1">&#39;/&#39;</span> <span class="o">.</span> <span class="nv">$filename</span> <span class="o">.</span> <span class="s1">&#39;.png&#39;</span><span class="p">;</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="preg-match-all-flag">
<span id="case-preg-match-all-flag"></span><h3><span class="section-number">5.2.121. </span>preg_match_all() Flag<a class="headerlink" href="#preg-match-all-flag" title="Permalink to this headline">¶</a></h3>
<div class="section" id="case-fuelcms-php-pregmatchallflag">
<span id="id149"></span><h4><span class="section-number">5.2.121.1. </span>FuelCMS<a class="headerlink" href="#case-fuelcms-php-pregmatchallflag" title="Permalink to this headline">¶</a></h4>
<p><a class="reference internal" href="Rules.html#preg-match-all-flag"><span class="std std-ref">preg_match_all() Flag</span></a>, in fuel/modules/fuel/helpers/MY_array_helper.php:205.</p>
<p>Using PREG_SET_ORDER will remove the usage of the <a href="#id150"><span class="problematic" id="id151">``</span></a>$key``variable.</p>
<div class="highlight-php notranslate"><div class="highlight"><pre><span></span><span class="k">function</span> <span class="nf">parse_string_to_array</span><span class="p">(</span><span class="nv">$str</span><span class="p">)</span>
    <span class="p">{</span>
            <span class="nb">preg_match_all</span><span class="p">(</span><span class="s1">&#39;#(\w+)=([\&#39;&quot;])(.*)\2#U&#39;</span><span class="p">,</span> <span class="nv">$str</span><span class="p">,</span> <span class="nv">$matches</span><span class="p">);</span>
            <span class="nv">$params</span> <span class="o">=</span> <span class="k">array</span><span class="p">();</span>
            <span class="k">foreach</span><span class="p">(</span><span class="nv">$matches</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="k">as</span> <span class="nv">$key</span> <span class="o">=&gt;</span> <span class="nv">$val</span><span class="p">)</span>
            <span class="p">{</span>
                    <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="k">empty</span><span class="p">(</span><span class="nv">$matches</span><span class="p">[</span><span class="mi">3</span><span class="p">]))</span>
                    <span class="p">{</span>
                            <span class="nv">$params</span><span class="p">[</span><span class="nv">$val</span><span class="p">]</span> <span class="o">=</span> <span class="nv">$matches</span><span class="p">[</span><span class="mi">3</span><span class="p">][</span><span class="nv">$key</span><span class="p">];</span>
                    <span class="p">}</span>
            <span class="p">}</span>
            <span class="k">return</span> <span class="nv">$params</span><span class="p">;</span>
    <span class="p">}</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="php-keywords-as-names">
<span id="case-php-keywords-as-names"></span><h3><span class="section-number">5.2.122. </span>PHP Keywords As Names<a class="headerlink" href="#php-keywords-as-names" title="Permalink to this headline">¶</a></h3>
<div class="section" id="case-churchcrm-php-reservednames">
<span id="id152"></span><h4><span class="section-number">5.2.122.1. </span>ChurchCRM<a class="headerlink" href="#case-churchcrm-php-reservednames" title="Permalink to this headline">¶</a></h4>
<p><a class="reference internal" href="Rules.html#php-keywords-as-names"><span class="std std-ref">PHP Keywords As Names</span></a>, in src/kiosk/index.php:42.</p>
<p>$false may be true or false (or else…). In fact, the variable is not even defined in this file, and the file do a lot of inclusion.</p>
<div class="highlight-php notranslate"><div class="highlight"><pre><span></span><span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nb">isset</span><span class="p">(</span><span class="nv">$_COOKIE</span><span class="p">[</span><span class="s1">&#39;kioskCookie&#39;</span><span class="p">]))</span> <span class="p">{</span>
    <span class="k">if</span> <span class="p">(</span><span class="nv">$windowOpen</span><span class="p">)</span> <span class="p">{</span>
        <span class="nv">$guid</span> <span class="o">=</span> <span class="nb">uniqid</span><span class="p">();</span>
        <span class="nb">setcookie</span><span class="p">(</span><span class="s2">&quot;kioskCookie&quot;</span><span class="p">,</span> <span class="nv">$guid</span><span class="p">,</span> <span class="mi">2147483647</span><span class="p">);</span>
        <span class="nv">$Kiosk</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">\ChurchCRM\KioskDevice</span><span class="p">();</span>
        <span class="nv">$Kiosk</span><span class="o">-&gt;</span><span class="na">setGUIDHash</span><span class="p">(</span><span class="nb">hash</span><span class="p">(</span><span class="s1">&#39;sha256&#39;</span><span class="p">,</span> <span class="nv">$guid</span><span class="p">));</span>
        <span class="nv">$Kiosk</span><span class="o">-&gt;</span><span class="na">setAccepted</span><span class="p">(</span><span class="nv">$false</span><span class="p">);</span>
        <span class="nv">$Kiosk</span><span class="o">-&gt;</span><span class="na">save</span><span class="p">();</span>
    <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
        <span class="nb">header</span><span class="p">(</span><span class="s2">&quot;HTTP/1.1 401 Unauthorized&quot;</span><span class="p">);</span>
        <span class="k">exit</span><span class="p">;</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
</div>
<div class="section" id="case-xataface-php-reservednames">
<span id="id153"></span><h4><span class="section-number">5.2.122.2. </span>xataface<a class="headerlink" href="#case-xataface-php-reservednames" title="Permalink to this headline">¶</a></h4>
<p><a class="reference internal" href="Rules.html#php-keywords-as-names"><span class="std std-ref">PHP Keywords As Names</span></a>, in Dataface/Record.php:1278.</p>
<p>This one is documented, and in the end, makes a lot of sense.</p>
<div class="highlight-php notranslate"><div class="highlight"><pre><span></span><span class="k">function</span> <span class="o">&amp;</span><span class="nf">getRelatedRecord</span><span class="p">(</span><span class="nv">$relationshipName</span><span class="p">,</span> <span class="nv">$index</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="nv">$where</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="nv">$sort</span><span class="o">=</span><span class="mi">0</span><span class="p">){</span>
            <span class="k">if</span> <span class="p">(</span> <span class="nb">isset</span><span class="p">(</span><span class="nv">$this</span><span class="o">-&gt;</span><span class="na">cache</span><span class="p">[</span><span class="no">__FUNCTION__</span><span class="p">][</span><span class="nv">$relationshipName</span><span class="p">][</span><span class="nv">$index</span><span class="p">][</span><span class="nv">$where</span><span class="p">][</span><span class="nv">$sort</span><span class="p">])</span> <span class="p">){</span>
                    <span class="k">return</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">cache</span><span class="p">[</span><span class="no">__FUNCTION__</span><span class="p">][</span><span class="nv">$relationshipName</span><span class="p">][</span><span class="nv">$index</span><span class="p">][</span><span class="nv">$where</span><span class="p">][</span><span class="nv">$sort</span><span class="p">];</span>
            <span class="p">}</span>
            <span class="nv">$it</span> <span class="o">=</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">getRelationshipIterator</span><span class="p">(</span><span class="nv">$relationshipName</span><span class="p">,</span> <span class="nv">$index</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="nv">$where</span><span class="p">,</span> <span class="nv">$sort</span><span class="p">);</span>
            <span class="k">if</span> <span class="p">(</span> <span class="nv">$it</span><span class="o">-&gt;</span><span class="na">hasNext</span><span class="p">()</span> <span class="p">){</span>
                    <span class="nv">$rec</span> <span class="o">=&amp;</span> <span class="nv">$it</span><span class="o">-&gt;</span><span class="na">next</span><span class="p">();</span>
                    <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">cache</span><span class="p">[</span><span class="no">__FUNCTION__</span><span class="p">][</span><span class="nv">$relationshipName</span><span class="p">][</span><span class="nv">$index</span><span class="p">][</span><span class="nv">$where</span><span class="p">][</span><span class="nv">$sort</span><span class="p">]</span> <span class="o">=&amp;</span> <span class="nv">$rec</span><span class="p">;</span>
                    <span class="k">return</span> <span class="nv">$rec</span><span class="p">;</span>
            <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
                    <span class="nv">$null</span> <span class="o">=</span> <span class="k">null</span><span class="p">;</span>   <span class="c1">// stupid hack because literal &#39;null&#39; can&#39;t be returned by ref.</span>
                    <span class="k">return</span> <span class="nv">$null</span><span class="p">;</span>
            <span class="p">}</span>
    <span class="p">}</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="should-preprocess-chr">
<span id="case-should-preprocess-chr"></span><h3><span class="section-number">5.2.123. </span>Should Preprocess Chr()<a class="headerlink" href="#should-preprocess-chr" title="Permalink to this headline">¶</a></h3>
<div class="section" id="case-phpadsnew-php-shouldpreprocess">
<span id="id154"></span><h4><span class="section-number">5.2.123.1. </span>phpadsnew<a class="headerlink" href="#case-phpadsnew-php-shouldpreprocess" title="Permalink to this headline">¶</a></h4>
<p><a class="reference internal" href="Rules.html#should-preprocess-chr"><span class="std std-ref">Should Preprocess Chr()</span></a>, in phpAdsNew-2.0/adview.php:302.</p>
<p>Each call to chr() may be done before. First, chr() may be replace with the hexadecimal sequence “0x3B”; Secondly, 0x3b is a rather long replacement for a simple semi-colon. The whole pragraph could be stored in a separate file, for easier modifications.</p>
<div class="highlight-php notranslate"><div class="highlight"><pre><span></span><span class="k">echo</span> <span class="nb">chr</span><span class="p">(</span><span class="mh">0x47</span><span class="p">)</span><span class="o">.</span><span class="nb">chr</span><span class="p">(</span><span class="mh">0x49</span><span class="p">)</span><span class="o">.</span><span class="nb">chr</span><span class="p">(</span><span class="mh">0x46</span><span class="p">)</span><span class="o">.</span><span class="nb">chr</span><span class="p">(</span><span class="mh">0x38</span><span class="p">)</span><span class="o">.</span><span class="nb">chr</span><span class="p">(</span><span class="mh">0x39</span><span class="p">)</span><span class="o">.</span><span class="nb">chr</span><span class="p">(</span><span class="mh">0x61</span><span class="p">)</span><span class="o">.</span><span class="nb">chr</span><span class="p">(</span><span class="mh">0x01</span><span class="p">)</span><span class="o">.</span><span class="nb">chr</span><span class="p">(</span><span class="mh">0x00</span><span class="p">)</span><span class="o">.</span>
                 <span class="nb">chr</span><span class="p">(</span><span class="mh">0x01</span><span class="p">)</span><span class="o">.</span><span class="nb">chr</span><span class="p">(</span><span class="mh">0x00</span><span class="p">)</span><span class="o">.</span><span class="nb">chr</span><span class="p">(</span><span class="mh">0x80</span><span class="p">)</span><span class="o">.</span><span class="nb">chr</span><span class="p">(</span><span class="mh">0x00</span><span class="p">)</span><span class="o">.</span><span class="nb">chr</span><span class="p">(</span><span class="mh">0x00</span><span class="p">)</span><span class="o">.</span><span class="nb">chr</span><span class="p">(</span><span class="mh">0x04</span><span class="p">)</span><span class="o">.</span><span class="nb">chr</span><span class="p">(</span><span class="mh">0x02</span><span class="p">)</span><span class="o">.</span><span class="nb">chr</span><span class="p">(</span><span class="mh">0x04</span><span class="p">)</span><span class="o">.</span>
                     <span class="nb">chr</span><span class="p">(</span><span class="mh">0x00</span><span class="p">)</span><span class="o">.</span><span class="nb">chr</span><span class="p">(</span><span class="mh">0x00</span><span class="p">)</span><span class="o">.</span><span class="nb">chr</span><span class="p">(</span><span class="mh">0x00</span><span class="p">)</span><span class="o">.</span><span class="nb">chr</span><span class="p">(</span><span class="mh">0x21</span><span class="p">)</span><span class="o">.</span><span class="nb">chr</span><span class="p">(</span><span class="mh">0xF9</span><span class="p">)</span><span class="o">.</span><span class="nb">chr</span><span class="p">(</span><span class="mh">0x04</span><span class="p">)</span><span class="o">.</span><span class="nb">chr</span><span class="p">(</span><span class="mh">0x01</span><span class="p">)</span><span class="o">.</span><span class="nb">chr</span><span class="p">(</span><span class="mh">0x00</span><span class="p">)</span><span class="o">.</span>
                 <span class="nb">chr</span><span class="p">(</span><span class="mh">0x00</span><span class="p">)</span><span class="o">.</span><span class="nb">chr</span><span class="p">(</span><span class="mh">0x00</span><span class="p">)</span><span class="o">.</span><span class="nb">chr</span><span class="p">(</span><span class="mh">0x00</span><span class="p">)</span><span class="o">.</span><span class="nb">chr</span><span class="p">(</span><span class="mh">0x2C</span><span class="p">)</span><span class="o">.</span><span class="nb">chr</span><span class="p">(</span><span class="mh">0x00</span><span class="p">)</span><span class="o">.</span><span class="nb">chr</span><span class="p">(</span><span class="mh">0x00</span><span class="p">)</span><span class="o">.</span><span class="nb">chr</span><span class="p">(</span><span class="mh">0x00</span><span class="p">)</span><span class="o">.</span><span class="nb">chr</span><span class="p">(</span><span class="mh">0x00</span><span class="p">)</span><span class="o">.</span>
                 <span class="nb">chr</span><span class="p">(</span><span class="mh">0x01</span><span class="p">)</span><span class="o">.</span><span class="nb">chr</span><span class="p">(</span><span class="mh">0x00</span><span class="p">)</span><span class="o">.</span><span class="nb">chr</span><span class="p">(</span><span class="mh">0x01</span><span class="p">)</span><span class="o">.</span><span class="nb">chr</span><span class="p">(</span><span class="mh">0x00</span><span class="p">)</span><span class="o">.</span><span class="nb">chr</span><span class="p">(</span><span class="mh">0x00</span><span class="p">)</span><span class="o">.</span><span class="nb">chr</span><span class="p">(</span><span class="mh">0x02</span><span class="p">)</span><span class="o">.</span><span class="nb">chr</span><span class="p">(</span><span class="mh">0x02</span><span class="p">)</span><span class="o">.</span><span class="nb">chr</span><span class="p">(</span><span class="mh">0x44</span><span class="p">)</span><span class="o">.</span>
                 <span class="nb">chr</span><span class="p">(</span><span class="mh">0x01</span><span class="p">)</span><span class="o">.</span><span class="nb">chr</span><span class="p">(</span><span class="mh">0x00</span><span class="p">)</span><span class="o">.</span><span class="nb">chr</span><span class="p">(</span><span class="mh">0x3B</span><span class="p">);</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="should-use-array-filter">
<span id="case-should-use-array-filter"></span><h3><span class="section-number">5.2.124. </span>Should Use array_filter()<a class="headerlink" href="#should-use-array-filter" title="Permalink to this headline">¶</a></h3>
<div class="section" id="case-xataface-php-shouldusearrayfilter">
<span id="id155"></span><h4><span class="section-number">5.2.124.1. </span>xataface<a class="headerlink" href="#case-xataface-php-shouldusearrayfilter" title="Permalink to this headline">¶</a></h4>
<p><a class="reference internal" href="Rules.html#should-use-array-filter"><span class="std std-ref">Should Use array_filter()</span></a>, in actions/manage_build_index.php:38.</p>
<p>This selection process has three tests : the two first are exclusive, and the third is inclusive. They could fit in one or several closures.</p>
<div class="highlight-php notranslate"><div class="highlight"><pre><span></span><span class="nv">$indexable</span> <span class="o">=</span> <span class="k">array</span><span class="p">();</span>
            <span class="k">foreach</span> <span class="p">(</span> <span class="nv">$tables</span> <span class="k">as</span> <span class="nv">$key</span><span class="o">=&gt;</span><span class="nv">$table</span> <span class="p">){</span>
                    <span class="k">if</span> <span class="p">(</span> <span class="nb">preg_match</span><span class="p">(</span><span class="s1">&#39;/^dataface__/&#39;</span><span class="p">,</span> <span class="nv">$table</span><span class="p">)</span> <span class="p">){</span>
                            <span class="k">continue</span><span class="p">;</span>
                    <span class="p">}</span>
                    <span class="k">if</span> <span class="p">(</span> <span class="nb">preg_match</span><span class="p">(</span><span class="s1">&#39;/^_/&#39;</span><span class="p">,</span> <span class="nv">$table</span><span class="p">)</span> <span class="p">){</span>
                            <span class="k">continue</span><span class="p">;</span>
                    <span class="p">}</span>

                    <span class="k">if</span> <span class="p">(</span> <span class="nv">$index</span><span class="o">-&gt;</span><span class="na">isTableIndexable</span><span class="p">(</span><span class="nv">$table</span><span class="p">)</span> <span class="p">){</span>
                            <span class="nv">$indexable</span><span class="p">[]</span> <span class="o">=</span> <span class="nv">$table</span><span class="p">;</span>
                            <span class="c1">//unset($tables[$key]);</span>
                    <span class="p">}</span>

            <span class="p">}</span>
</pre></div>
</div>
</div>
<div class="section" id="case-shopware-php-shouldusearrayfilter">
<span id="id156"></span><h4><span class="section-number">5.2.124.2. </span>shopware<a class="headerlink" href="#case-shopware-php-shouldusearrayfilter" title="Permalink to this headline">¶</a></h4>
<p><a class="reference internal" href="Rules.html#should-use-array-filter"><span class="std std-ref">Should Use array_filter()</span></a>, in engine/Shopware/Bundle/StoreFrontBundle/Service/Core/VariantCoverService.php:71.</p>
<p>Closure would be the best here, since $covers has to be injected in the array_filter callback.</p>
<div class="highlight-php notranslate"><div class="highlight"><pre><span></span><span class="nv">$covers</span> <span class="o">=</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">variantMediaGateway</span><span class="o">-&gt;</span><span class="na">getCovers</span><span class="p">(</span>
            <span class="nv">$products</span><span class="p">,</span>
            <span class="nv">$context</span>
        <span class="p">);</span>

        <span class="nv">$fallback</span> <span class="o">=</span> <span class="p">[];</span>
        <span class="k">foreach</span> <span class="p">(</span><span class="nv">$products</span> <span class="k">as</span> <span class="nv">$product</span><span class="p">)</span> <span class="p">{</span>
            <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nb">array_key_exists</span><span class="p">(</span><span class="nv">$product</span><span class="o">-&gt;</span><span class="na">getNumber</span><span class="p">(),</span> <span class="nv">$covers</span><span class="p">))</span> <span class="p">{</span>
                <span class="nv">$fallback</span><span class="p">[]</span> <span class="o">=</span> <span class="nv">$product</span><span class="p">;</span>
            <span class="p">}</span>
        <span class="p">}</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="should-use-coalesce">
<span id="case-should-use-coalesce"></span><h3><span class="section-number">5.2.125. </span>Should Use Coalesce<a class="headerlink" href="#should-use-coalesce" title="Permalink to this headline">¶</a></h3>
<div class="section" id="case-churchcrm-php-shouldusecoalesce">
<span id="id157"></span><h4><span class="section-number">5.2.125.1. </span>ChurchCRM<a class="headerlink" href="#case-churchcrm-php-shouldusecoalesce" title="Permalink to this headline">¶</a></h4>
<p><a class="reference internal" href="Rules.html#should-use-coalesce"><span class="std std-ref">Should Use Coalesce</span></a>, in src/ChurchCRM/Service/FinancialService.php:597.</p>
<p>ChurchCRM features 5 old style ternary operators, which are all in this SQL query. ChurchCRM requires PHP 7.0, so a simple code review could remove them all.</p>
<div class="highlight-php notranslate"><div class="highlight"><pre><span></span><span class="nv">$sSQL</span> <span class="o">=</span> <span class="s2">&quot;INSERT INTO pledge_plg</span>
<span class="s2">                    (plg_famID,</span>
<span class="s2">                    plg_FYID,</span>
<span class="s2">                    plg_date,</span>
<span class="s2">                    plg_amount,</span>
<span class="s2">                    plg_schedule,</span>
<span class="s2">                    plg_method,</span>
<span class="s2">                    plg_comment,</span>
<span class="s2">                    plg_DateLastEdited,</span>
<span class="s2">                    plg_EditedBy,</span>
<span class="s2">                    plg_PledgeOrPayment,</span>
<span class="s2">                    plg_fundID,</span>
<span class="s2">                    plg_depID,</span>
<span class="s2">                    plg_CheckNo,</span>
<span class="s2">                    plg_scanString,</span>
<span class="s2">                    plg_aut_ID,</span>
<span class="s2">                    plg_NonDeductible,</span>
<span class="s2">                    plg_GroupKey)</span>
<span class="s2">                    VALUES (&#39;&quot;</span><span class="o">.</span>
          <span class="nv">$payment</span><span class="o">-&gt;</span><span class="na">FamilyID</span><span class="o">.</span><span class="s2">&quot;&#39;,&#39;&quot;</span><span class="o">.</span>
          <span class="nv">$payment</span><span class="o">-&gt;</span><span class="na">FYID</span><span class="o">.</span><span class="s2">&quot;&#39;,&#39;&quot;</span><span class="o">.</span>
          <span class="nv">$payment</span><span class="o">-&gt;</span><span class="na">Date</span><span class="o">.</span><span class="s2">&quot;&#39;,&#39;&quot;</span><span class="o">.</span>
          <span class="nv">$Fund</span><span class="o">-&gt;</span><span class="na">Amount</span><span class="o">.</span><span class="s2">&quot;&#39;,&#39;&quot;</span><span class="o">.</span>
          <span class="p">(</span><span class="nb">isset</span><span class="p">(</span><span class="nv">$payment</span><span class="o">-&gt;</span><span class="na">schedule</span><span class="p">)</span> <span class="o">?</span> <span class="nv">$payment</span><span class="o">-&gt;</span><span class="na">schedule</span> <span class="o">:</span> <span class="s1">&#39;NULL&#39;</span><span class="p">)</span><span class="o">.</span><span class="s2">&quot;&#39;,&#39;&quot;</span><span class="o">.</span>
          <span class="nv">$payment</span><span class="o">-&gt;</span><span class="na">iMethod</span><span class="o">.</span><span class="s2">&quot;&#39;,&#39;&quot;</span><span class="o">.</span>
          <span class="nv">$Fund</span><span class="o">-&gt;</span><span class="na">Comment</span><span class="o">.</span><span class="s2">&quot;&#39;,&#39;&quot;</span><span class="o">.</span>
          <span class="nb">date</span><span class="p">(</span><span class="s1">&#39;YmdHis&#39;</span><span class="p">)</span><span class="o">.</span><span class="s2">&quot;&#39;,&quot;</span><span class="o">.</span>
          <span class="nv">$_SESSION</span><span class="p">[</span><span class="s1">&#39;user&#39;</span><span class="p">]</span><span class="o">-&gt;</span><span class="na">getId</span><span class="p">()</span><span class="o">.</span><span class="s2">&quot;,&#39;&quot;</span><span class="o">.</span>
          <span class="nv">$payment</span><span class="o">-&gt;</span><span class="na">type</span><span class="o">.</span><span class="s2">&quot;&#39;,&quot;</span><span class="o">.</span>
          <span class="nv">$Fund</span><span class="o">-&gt;</span><span class="na">FundID</span><span class="o">.</span><span class="s1">&#39;,&#39;</span><span class="o">.</span>
          <span class="nv">$payment</span><span class="o">-&gt;</span><span class="na">DepositID</span><span class="o">.</span><span class="s1">&#39;,&#39;</span><span class="o">.</span>
          <span class="p">(</span><span class="nb">isset</span><span class="p">(</span><span class="nv">$payment</span><span class="o">-&gt;</span><span class="na">iCheckNo</span><span class="p">)</span> <span class="o">?</span> <span class="nv">$payment</span><span class="o">-&gt;</span><span class="na">iCheckNo</span> <span class="o">:</span> <span class="s1">&#39;NULL&#39;</span><span class="p">)</span><span class="o">.</span><span class="s2">&quot;,&#39;&quot;</span><span class="o">.</span>
          <span class="p">(</span><span class="nb">isset</span><span class="p">(</span><span class="nv">$payment</span><span class="o">-&gt;</span><span class="na">tScanString</span><span class="p">)</span> <span class="o">?</span> <span class="nv">$payment</span><span class="o">-&gt;</span><span class="na">tScanString</span> <span class="o">:</span> <span class="s1">&#39;NULL&#39;</span><span class="p">)</span><span class="o">.</span><span class="s2">&quot;&#39;,&#39;&quot;</span><span class="o">.</span>
          <span class="p">(</span><span class="nb">isset</span><span class="p">(</span><span class="nv">$payment</span><span class="o">-&gt;</span><span class="na">iAutID</span><span class="p">)</span> <span class="o">?</span> <span class="nv">$payment</span><span class="o">-&gt;</span><span class="na">iAutID</span> <span class="o">:</span> <span class="s1">&#39;NULL&#39;</span><span class="p">)</span><span class="o">.</span><span class="s2">&quot;&#39;,&#39;&quot;</span><span class="o">.</span>
          <span class="p">(</span><span class="nb">isset</span><span class="p">(</span><span class="nv">$Fund</span><span class="o">-&gt;</span><span class="na">NonDeductible</span><span class="p">)</span> <span class="o">?</span> <span class="nv">$Fund</span><span class="o">-&gt;</span><span class="na">NonDeductible</span> <span class="o">:</span> <span class="s1">&#39;NULL&#39;</span><span class="p">)</span><span class="o">.</span><span class="s2">&quot;&#39;,&#39;&quot;</span><span class="o">.</span>
          <span class="nv">$sGroupKey</span><span class="o">.</span><span class="s2">&quot;&#39;)&quot;</span><span class="p">;</span>
</pre></div>
</div>
</div>
<div class="section" id="case-cleverstyle-php-shouldusecoalesce">
<span id="id158"></span><h4><span class="section-number">5.2.125.2. </span>Cleverstyle<a class="headerlink" href="#case-cleverstyle-php-shouldusecoalesce" title="Permalink to this headline">¶</a></h4>
<p><a class="reference internal" href="Rules.html#should-use-coalesce"><span class="std std-ref">Should Use Coalesce</span></a>, in modules/Feedback/index.php:37.</p>
<p>Cleverstyle nests ternary operators when selecting default values. Here, moving some of them to ?? will reduce the code complexity and make it more readable. Cleverstyle requires PHP 7.0 or more recent.</p>
<div class="highlight-php notranslate"><div class="highlight"><pre><span></span><span class="nv">$Page</span><span class="o">-&gt;</span><span class="na">content</span><span class="p">(</span>
    <span class="nx">h</span><span class="o">::</span><span class="p">{</span><span class="s1">&#39;cs-form form&#39;</span><span class="p">}(</span>
            <span class="nx">h</span><span class="o">::</span><span class="p">{</span><span class="s1">&#39;section.cs-feedback-form article&#39;</span><span class="p">}(</span>
                    <span class="nx">h</span><span class="o">::</span><span class="p">{</span><span class="s1">&#39;header h2.cs-text-center&#39;</span><span class="p">}(</span><span class="nv">$L</span><span class="o">-&gt;</span><span class="na">Feedback</span><span class="p">)</span><span class="o">.</span>
                    <span class="nx">h</span><span class="o">::</span><span class="p">{</span><span class="s1">&#39;table.cs-table[center] tr| td&#39;</span><span class="p">}(</span>
                            <span class="p">[</span>
                                    <span class="nx">h</span><span class="o">::</span><span class="p">{</span><span class="s1">&#39;cs-input-text input[name=name][required]&#39;</span><span class="p">}(</span>
                                            <span class="p">[</span>
                                                    <span class="s1">&#39;placeholder&#39;</span> <span class="o">=&gt;</span> <span class="nv">$L</span><span class="o">-&gt;</span><span class="na">feedback_name</span><span class="p">,</span>
                                                    <span class="s1">&#39;value&#39;</span>       <span class="o">=&gt;</span> <span class="nv">$User</span><span class="o">-&gt;</span><span class="na">user</span><span class="p">()</span> <span class="o">?</span> <span class="nv">$User</span><span class="o">-&gt;</span><span class="na">username</span><span class="p">()</span> <span class="o">:</span> <span class="p">(</span><span class="nb">isset</span><span class="p">(</span><span class="nv">$_POST</span><span class="p">[</span><span class="s1">&#39;name&#39;</span><span class="p">])</span> <span class="o">?</span> <span class="nv">$_POST</span><span class="p">[</span><span class="s1">&#39;name&#39;</span><span class="p">]</span> <span class="o">:</span> <span class="s1">&#39;&#39;</span><span class="p">)</span>
                                            <span class="p">]</span>
                                    <span class="p">),</span>
                                    <span class="nx">h</span><span class="o">::</span><span class="p">{</span><span class="s1">&#39;cs-input-text input[type=email][name=email][required]&#39;</span><span class="p">}(</span>
                                            <span class="p">[</span>
                                                    <span class="s1">&#39;placeholder&#39;</span> <span class="o">=&gt;</span> <span class="nv">$L</span><span class="o">-&gt;</span><span class="na">feedback_email</span><span class="p">,</span>
                                                    <span class="s1">&#39;value&#39;</span>       <span class="o">=&gt;</span> <span class="nv">$User</span><span class="o">-&gt;</span><span class="na">user</span><span class="p">()</span> <span class="o">?</span> <span class="nv">$User</span><span class="o">-&gt;</span><span class="na">email</span> <span class="o">:</span> <span class="p">(</span><span class="nb">isset</span><span class="p">(</span><span class="nv">$_POST</span><span class="p">[</span><span class="s1">&#39;email&#39;</span><span class="p">])</span> <span class="o">?</span> <span class="nv">$_POST</span><span class="p">[</span><span class="s1">&#39;email&#39;</span><span class="p">]</span> <span class="o">:</span> <span class="s1">&#39;&#39;</span><span class="p">)</span>
                                            <span class="p">]</span>
                                    <span class="p">),</span>
                                    <span class="nx">h</span><span class="o">::</span><span class="p">{</span><span class="s1">&#39;cs-textarea[autosize] textarea[name=text][required]&#39;</span><span class="p">}(</span>
                                            <span class="p">[</span>
                                                    <span class="s1">&#39;placeholder&#39;</span> <span class="o">=&gt;</span> <span class="nv">$L</span><span class="o">-&gt;</span><span class="na">feedback_text</span><span class="p">,</span>
                                                    <span class="s1">&#39;value&#39;</span>       <span class="o">=&gt;</span> <span class="nb">isset</span><span class="p">(</span><span class="nv">$_POST</span><span class="p">[</span><span class="s1">&#39;text&#39;</span><span class="p">])</span> <span class="o">?</span> <span class="nv">$_POST</span><span class="p">[</span><span class="s1">&#39;text&#39;</span><span class="p">]</span> <span class="o">:</span> <span class="s1">&#39;&#39;</span>
                                            <span class="p">]</span>
                                    <span class="p">),</span>
                                    <span class="nx">h</span><span class="o">::</span><span class="p">{</span><span class="s1">&#39;cs-button button[type=submit]&#39;</span><span class="p">}(</span><span class="nv">$L</span><span class="o">-&gt;</span><span class="na">feedback_send</span><span class="p">)</span>
                            <span class="p">]</span>
                    <span class="p">)</span>
            <span class="p">)</span>
    <span class="p">)</span>
<span class="p">);</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="strtr-arguments">
<span id="case-strtr-arguments"></span><h3><span class="section-number">5.2.126. </span>Strtr Arguments<a class="headerlink" href="#strtr-arguments" title="Permalink to this headline">¶</a></h3>
<div class="section" id="case-suitecrm-php-strtrarguments">
<span id="id159"></span><h4><span class="section-number">5.2.126.1. </span>SuiteCrm<a class="headerlink" href="#case-suitecrm-php-strtrarguments" title="Permalink to this headline">¶</a></h4>
<p><a class="reference internal" href="Rules.html#strtr-arguments"><span class="std std-ref">Strtr Arguments</span></a>, in includes/vCard.php:221.</p>
<p>This code prepares incoming ‘$values’ for extraction. The keys are cleaned then split with explode(). The ‘=’ sign would stay, as strtr() can’t remove it. This means that such keys won’t be recognized later in the code, and gets omitted.</p>
<div class="highlight-php notranslate"><div class="highlight"><pre><span></span><span class="nv">$values</span> <span class="o">=</span> <span class="nb">explode</span><span class="p">(</span><span class="s1">&#39;;&#39;</span><span class="p">,</span> <span class="nv">$value</span><span class="p">);</span>
                    <span class="nv">$key</span> <span class="o">=</span> <span class="nb">strtoupper</span><span class="p">(</span><span class="nv">$keyvalue</span><span class="p">[</span><span class="mi">0</span><span class="p">]);</span>
                    <span class="nv">$key</span> <span class="o">=</span> <span class="nb">strtr</span><span class="p">(</span><span class="nv">$key</span><span class="p">,</span> <span class="s1">&#39;=&#39;</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">);</span>
                    <span class="nv">$key</span> <span class="o">=</span> <span class="nb">strtr</span><span class="p">(</span><span class="nv">$key</span><span class="p">,</span> <span class="s1">&#39;,&#39;</span><span class="p">,</span> <span class="s1">&#39;;&#39;</span><span class="p">);</span>
                    <span class="nv">$keys</span> <span class="o">=</span> <span class="nb">explode</span><span class="p">(</span><span class="s1">&#39;;&#39;</span><span class="p">,</span> <span class="nv">$key</span><span class="p">);</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="too-many-native-calls">
<span id="case-too-many-native-calls"></span><h3><span class="section-number">5.2.127. </span>Too Many Native Calls<a class="headerlink" href="#too-many-native-calls" title="Permalink to this headline">¶</a></h3>
<div class="section" id="case-spip-php-toomanynativecalls">
<span id="id160"></span><h4><span class="section-number">5.2.127.1. </span>SPIP<a class="headerlink" href="#case-spip-php-toomanynativecalls" title="Permalink to this headline">¶</a></h4>
<p><a class="reference internal" href="Rules.html#too-many-native-calls"><span class="std std-ref">Too Many Native Calls</span></a>, in /ecrire/xml/analyser_dtd.php:58.</p>
<p>This expression counts 4 usages of count(), which is more than the default level of 3 PHP calls in one expression.</p>
<div class="highlight-php notranslate"><div class="highlight"><pre><span></span><span class="nx">spip_log</span><span class="p">(</span><span class="s2">&quot;Analyser DTD </span><span class="si">$avail</span><span class="s2"> </span><span class="si">$grammaire</span><span class="s2"> (&quot;</span> <span class="o">.</span> <span class="nx">spip_timer</span><span class="p">(</span><span class="s1">&#39;dtd&#39;</span><span class="p">)</span> <span class="o">.</span> <span class="s2">&quot;) &quot;</span> <span class="o">.</span> <span class="nb">count</span><span class="p">(</span><span class="nv">$dtc</span><span class="o">-&gt;</span><span class="na">macros</span><span class="p">)</span> <span class="o">.</span> <span class="s1">&#39; macros, &#39;</span> <span class="o">.</span> <span class="nb">count</span><span class="p">(</span><span class="nv">$dtc</span><span class="o">-&gt;</span><span class="na">elements</span><span class="p">)</span> <span class="o">.</span> <span class="s1">&#39; elements, &#39;</span> <span class="o">.</span> <span class="nb">count</span><span class="p">(</span><span class="nv">$dtc</span><span class="o">-&gt;</span><span class="na">attributs</span><span class="p">)</span> <span class="o">.</span> <span class="s2">&quot; listes d&#39;attributs, &quot;</span> <span class="o">.</span> <span class="nb">count</span><span class="p">(</span><span class="nv">$dtc</span><span class="o">-&gt;</span><span class="na">entites</span><span class="p">)</span> <span class="o">.</span> <span class="s2">&quot; entites&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="use-php-object-api">
<span id="case-use-php-object-api"></span><h3><span class="section-number">5.2.128. </span>Use PHP Object API<a class="headerlink" href="#use-php-object-api" title="Permalink to this headline">¶</a></h3>
<div class="section" id="case-wordpress-php-useobjectapi">
<span id="id161"></span><h4><span class="section-number">5.2.128.1. </span>WordPress<a class="headerlink" href="#case-wordpress-php-useobjectapi" title="Permalink to this headline">¶</a></h4>
<p><a class="reference internal" href="Rules.html#use-php-object-api"><span class="std std-ref">Use PHP Object API</span></a>, in wp-includes/functions.php:2558.</p>
<p>Finfo has also a class, with the same name.</p>
<div class="highlight-php notranslate"><div class="highlight"><pre><span></span><span class="nb">finfo_open</span><span class="p">(</span><span class="nx">FILEINFO_MIME_TYPE</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="section" id="case-prestashop-php-useobjectapi">
<span id="id162"></span><h4><span class="section-number">5.2.128.2. </span>PrestaShop<a class="headerlink" href="#case-prestashop-php-useobjectapi" title="Permalink to this headline">¶</a></h4>
<p><a class="reference internal" href="Rules.html#use-php-object-api"><span class="std std-ref">Use PHP Object API</span></a>, in admin-dev/filemanager/include/utils.php:174.</p>
<p>transliterator_transliterate() has also a class named Transliterator</p>
<div class="highlight-php notranslate"><div class="highlight"><pre><span></span><span class="nx">transliterator_transliterate</span><span class="p">(</span><span class="s1">&#39;Accents-Any&#39;</span><span class="p">,</span> <span class="nv">$str</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="use-pathinfo">
<span id="case-use-pathinfo"></span><h3><span class="section-number">5.2.129. </span>Use Pathinfo<a class="headerlink" href="#use-pathinfo" title="Permalink to this headline">¶</a></h3>
<div class="section" id="case-suitecrm-php-usepathinfo">
<span id="id163"></span><h4><span class="section-number">5.2.129.1. </span>SuiteCrm<a class="headerlink" href="#case-suitecrm-php-usepathinfo" title="Permalink to this headline">¶</a></h4>
<p><a class="reference internal" href="Rules.html#use-pathinfo"><span class="std std-ref">Use Pathinfo</span></a>, in include/utils/file_utils.php:441.</p>
<p>Looking for the extension ? Use pathinfo() and PATHINFO_EXTENSION</p>
<div class="highlight-php notranslate"><div class="highlight"><pre><span></span><span class="nv">$exp</span> <span class="o">=</span> <span class="nb">explode</span><span class="p">(</span><span class="s1">&#39;.&#39;</span><span class="p">,</span> <span class="nv">$filename</span><span class="p">);</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="use-pathinfo-arguments">
<span id="case-use-pathinfo-arguments"></span><h3><span class="section-number">5.2.130. </span>Use pathinfo() Arguments<a class="headerlink" href="#use-pathinfo-arguments" title="Permalink to this headline">¶</a></h3>
<div class="section" id="zend-config">
<span id="case-zend-config-php-usepathinfoargs"></span><h4><span class="section-number">5.2.130.1. </span>Zend-Config<a class="headerlink" href="#zend-config" title="Permalink to this headline">¶</a></h4>
<p><a class="reference internal" href="Rules.html#use-pathinfo-arguments"><span class="std std-ref">Use pathinfo() Arguments</span></a>, in src/Factory.php:74:90.</p>
<p>The <cite>$filepath</cite> is broken into pieces, and then, only the ‘extension’ part is used. With the PATHINFO_EXTENSION constant used as a second argument, only this value could be returned.</p>
<div class="highlight-php notranslate"><div class="highlight"><pre><span></span><span class="nv">$pathinfo</span> <span class="o">=</span> <span class="nb">pathinfo</span><span class="p">(</span><span class="nv">$filepath</span><span class="p">);</span>

        <span class="k">if</span> <span class="p">(</span><span class="o">!</span> <span class="nb">isset</span><span class="p">(</span><span class="nv">$pathinfo</span><span class="p">[</span><span class="s1">&#39;extension&#39;</span><span class="p">]))</span> <span class="p">{</span>
            <span class="k">throw</span> <span class="k">new</span> <span class="nx">Exception\RuntimeException</span><span class="p">(</span><span class="nb">sprintf</span><span class="p">(</span>
                <span class="s1">&#39;Filename &quot;%s&quot; is missing an extension and cannot be auto-detected&#39;</span><span class="p">,</span>
                <span class="nv">$filename</span>
            <span class="p">));</span>
        <span class="p">}</span>

        <span class="nv">$extension</span> <span class="o">=</span> <span class="nb">strtolower</span><span class="p">(</span><span class="nv">$pathinfo</span><span class="p">[</span><span class="s1">&#39;extension&#39;</span><span class="p">]);</span>
        <span class="c1">// Only $extension is used beyond that point</span>
</pre></div>
</div>
</div>
<div class="section" id="case-thinkphp-php-usepathinfoargs">
<span id="id164"></span><h4><span class="section-number">5.2.130.2. </span>ThinkPHP<a class="headerlink" href="#case-thinkphp-php-usepathinfoargs" title="Permalink to this headline">¶</a></h4>
<p><a class="reference internal" href="Rules.html#use-pathinfo-arguments"><span class="std std-ref">Use pathinfo() Arguments</span></a>, in ThinkPHP/Extend/Library/ORG/Net/UploadFile.class.php:508.</p>
<p>Without any other check, pathinfo() could be used with PATHINFO_EXTENSION.</p>
<div class="highlight-php notranslate"><div class="highlight"><pre><span></span><span class="k">private</span> <span class="k">function</span> <span class="nf">getExt</span><span class="p">(</span><span class="nv">$filename</span><span class="p">)</span> <span class="p">{</span>
        <span class="nv">$pathinfo</span> <span class="o">=</span> <span class="nb">pathinfo</span><span class="p">(</span><span class="nv">$filename</span><span class="p">);</span>
        <span class="k">return</span> <span class="nv">$pathinfo</span><span class="p">[</span><span class="s1">&#39;extension&#39;</span><span class="p">];</span>
    <span class="p">}</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="use-session-start-options">
<span id="case-use-session-start-options"></span><h3><span class="section-number">5.2.131. </span>Use session_start() Options<a class="headerlink" href="#use-session-start-options" title="Permalink to this headline">¶</a></h3>
<div class="section" id="case-wordpress-php-usesessionstartoptions">
<span id="id165"></span><h4><span class="section-number">5.2.131.1. </span>WordPress<a class="headerlink" href="#case-wordpress-php-usesessionstartoptions" title="Permalink to this headline">¶</a></h4>
<p><a class="reference internal" href="Rules.html#use-session-start-options"><span class="std std-ref">Use session_start() Options</span></a>, in wp-admin/includes/misc.php:74.</p>
<p>This code actually loads the file, join it, then split it again. file() would be sufficient.</p>
<div class="highlight-php notranslate"><div class="highlight"><pre><span></span><span class="nv">$markerdata</span> <span class="o">=</span> <span class="nb">explode</span><span class="p">(</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">,</span> <span class="nb">implode</span><span class="p">(</span> <span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="nb">file</span><span class="p">(</span> <span class="nv">$filename</span> <span class="p">)</span> <span class="p">)</span> <span class="p">);</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="debuginfo-usage">
<span id="case-debuginfo-usage"></span><h3><span class="section-number">5.2.132. </span>__debugInfo() Usage<a class="headerlink" href="#debuginfo-usage" title="Permalink to this headline">¶</a></h3>
<div class="section" id="case-dolibarr-php-debuginfousage">
<span id="id166"></span><h4><span class="section-number">5.2.132.1. </span>Dolibarr<a class="headerlink" href="#case-dolibarr-php-debuginfousage" title="Permalink to this headline">¶</a></h4>
<p><a class="reference internal" href="Rules.html#debuginfo-usage"><span class="std std-ref">__debugInfo() Usage</span></a>, in htdocs/includes/stripe/lib/StripeObject.php:108.</p>
<p>_values is a private property from the Stripe Class. The class contains other objects, but only _values are displayed with var_dump.</p>
<div class="highlight-php notranslate"><div class="highlight"><pre><span></span><span class="c1">// Magic method for var_dump output. Only works with PHP &gt;= 5.6</span>
    <span class="k">public</span> <span class="k">function</span> <span class="fm">__debugInfo</span><span class="p">()</span>
    <span class="p">{</span>
        <span class="k">return</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">_values</span><span class="p">;</span>
    <span class="p">}</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="old-style-autoload">
<span id="case-old-style-autoload"></span><h3><span class="section-number">5.2.133. </span>Old Style __autoload()<a class="headerlink" href="#old-style-autoload" title="Permalink to this headline">¶</a></h3>
<div class="section" id="case-piwigo-php-oldautoloadusage">
<span id="id167"></span><h4><span class="section-number">5.2.133.1. </span>Piwigo<a class="headerlink" href="#case-piwigo-php-oldautoloadusage" title="Permalink to this headline">¶</a></h4>
<p><a class="reference internal" href="Rules.html#old-style-autoload"><span class="std std-ref">Old Style __autoload()</span></a>, in include/phpmailer/PHPMailerAutoload.php:45.</p>
<p>This code handles situations for PHP after 5.1.0 and older. Rare are the applications that are still using those versions in 2019.</p>
<div class="highlight-php notranslate"><div class="highlight"><pre><span></span><span class="k">if</span> <span class="p">(</span><span class="nb">version_compare</span><span class="p">(</span><span class="k">PHP_VERSION</span><span class="p">,</span> <span class="s1">&#39;5.1.2&#39;</span><span class="p">,</span> <span class="s1">&#39;&gt;=&#39;</span><span class="p">))</span> <span class="p">{</span>
    <span class="c1">//SPL autoloading was introduced in PHP 5.1.2</span>
    <span class="k">if</span> <span class="p">(</span><span class="nb">version_compare</span><span class="p">(</span><span class="k">PHP_VERSION</span><span class="p">,</span> <span class="s1">&#39;5.3.0&#39;</span><span class="p">,</span> <span class="s1">&#39;&gt;=&#39;</span><span class="p">))</span> <span class="p">{</span>
        <span class="nb">spl_autoload_register</span><span class="p">(</span><span class="s1">&#39;PHPMailerAutoload&#39;</span><span class="p">,</span> <span class="k">true</span><span class="p">,</span> <span class="k">true</span><span class="p">);</span>
    <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
        <span class="nb">spl_autoload_register</span><span class="p">(</span><span class="s1">&#39;PHPMailerAutoload&#39;</span><span class="p">);</span>
    <span class="p">}</span>
<span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
    <span class="sd">/**</span>
<span class="sd">     * Fall back to traditional autoload for old PHP versions</span>
<span class="sd">     * @param string $classname The name of the class to load</span>
<span class="sd">     */</span>
    <span class="k">function</span> <span class="nf">__autoload</span><span class="p">(</span><span class="nv">$classname</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="nx">PHPMailerAutoload</span><span class="p">(</span><span class="nv">$classname</span><span class="p">);</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="compare-hash">
<span id="case-compare-hash"></span><h3><span class="section-number">5.2.134. </span>Compare Hash<a class="headerlink" href="#compare-hash" title="Permalink to this headline">¶</a></h3>
<div class="section" id="case-traq-security-comparehash">
<span id="id168"></span><h4><span class="section-number">5.2.134.1. </span>Traq<a class="headerlink" href="#case-traq-security-comparehash" title="Permalink to this headline">¶</a></h4>
<p><a class="reference internal" href="Rules.html#compare-hash"><span class="std std-ref">Compare Hash</span></a>, in src/Models/User.php:105.</p>
<p>This code should also avoid using SHA1.</p>
<div class="highlight-php notranslate"><div class="highlight"><pre><span></span><span class="nb">sha1</span><span class="p">(</span><span class="nv">$password</span><span class="p">)</span> <span class="o">==</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">password</span>
</pre></div>
</div>
</div>
<div class="section" id="case-livezilla-security-comparehash">
<span id="id169"></span><h4><span class="section-number">5.2.134.2. </span>LiveZilla<a class="headerlink" href="#case-livezilla-security-comparehash" title="Permalink to this headline">¶</a></h4>
<p><a class="reference internal" href="Rules.html#compare-hash"><span class="std std-ref">Compare Hash</span></a>, in livezilla/_lib/objects.global.users.inc.php:1391.</p>
<p>This code is using the stronger SHA256 but compares it to another string. $_token may be non-empty, and still be comparable to 0.</p>
<div class="highlight-php notranslate"><div class="highlight"><pre><span></span><span class="k">function</span> <span class="nf">IsValidToken</span><span class="p">(</span><span class="nv">$_token</span><span class="p">)</span>
<span class="p">{</span>
    <span class="k">if</span><span class="p">(</span><span class="o">!</span><span class="k">empty</span><span class="p">(</span><span class="nv">$_token</span><span class="p">))</span>
        <span class="k">if</span><span class="p">(</span><span class="nb">hash</span><span class="p">(</span><span class="s2">&quot;sha256&quot;</span><span class="p">,</span><span class="nv">$this</span><span class="o">-&gt;</span><span class="na">Token</span><span class="p">)</span> <span class="o">==</span> <span class="nv">$_token</span><span class="p">)</span>
            <span class="k">return</span> <span class="k">true</span><span class="p">;</span>
    <span class="k">return</span> <span class="k">false</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="configure-extract">
<span id="case-configure-extract"></span><h3><span class="section-number">5.2.135. </span>Configure Extract<a class="headerlink" href="#configure-extract" title="Permalink to this headline">¶</a></h3>
<div class="section" id="case-zurmo-security-configureextract">
<span id="id170"></span><h4><span class="section-number">5.2.135.1. </span>Zurmo<a class="headerlink" href="#case-zurmo-security-configureextract" title="Permalink to this headline">¶</a></h4>
<p><a class="reference internal" href="Rules.html#configure-extract"><span class="std std-ref">Configure Extract</span></a>, in app/protected/modules/marketing/utils/GlobalMarketingFooterUtil.php:127.</p>
<p>This code intent to overwrite <cite>$hash</cite> and <cite>$preview</cite> : it is even literally in the code. The overwrite is intended too, and could even skip the initialisation of the variables. Although the compact()/extract() combinaison is safe as now, it could be safer to only relay the array index, instead of extracting the variables here.</p>
<div class="highlight-php notranslate"><div class="highlight"><pre><span></span><span class="k">public</span> <span class="k">static</span> <span class="k">function</span> <span class="nf">resolveManageSubscriptionsUrlByArray</span><span class="p">(</span><span class="k">array</span> <span class="nv">$queryStringArray</span><span class="p">,</span> <span class="nv">$preview</span> <span class="o">=</span> <span class="k">false</span><span class="p">)</span>
        <span class="p">{</span>
            <span class="nv">$hash</span> <span class="o">=</span> <span class="nv">$preview</span> <span class="o">=</span> <span class="k">null</span><span class="p">;</span>
            <span class="nb">extract</span><span class="p">(</span><span class="k">static</span><span class="o">::</span><span class="na">resolvePreviewAndHashFromArray</span><span class="p">(</span><span class="nv">$queryStringArray</span><span class="p">));</span>
            <span class="k">return</span> <span class="k">static</span><span class="o">::</span><span class="na">resolveManageSubscriptionsUrl</span><span class="p">(</span><span class="nv">$hash</span><span class="p">,</span> <span class="nv">$preview</span><span class="p">);</span>
        <span class="p">}</span>

<span class="c1">// Also with :</span>
        <span class="k">protected</span> <span class="k">static</span> <span class="k">function</span> <span class="nf">resolvePreviewAndHashFromArray</span><span class="p">(</span><span class="k">array</span> <span class="nv">$queryStringArray</span><span class="p">)</span>
        <span class="p">{</span>
            <span class="nv">$preview</span>    <span class="o">=</span> <span class="k">static</span><span class="o">::</span><span class="na">resolvePreviewFromArray</span><span class="p">(</span><span class="nv">$queryStringArray</span><span class="p">);</span>
            <span class="nv">$hash</span>       <span class="o">=</span> <span class="k">static</span><span class="o">::</span><span class="na">resolveHashByArray</span><span class="p">(</span><span class="nv">$queryStringArray</span><span class="p">);</span>
            <span class="k">return</span> <span class="nb">compact</span><span class="p">(</span><span class="s1">&#39;hash&#39;</span><span class="p">,</span> <span class="s1">&#39;preview&#39;</span><span class="p">);</span>
        <span class="p">}</span>
</pre></div>
</div>
</div>
<div class="section" id="case-dolibarr-security-configureextract">
<span id="id171"></span><h4><span class="section-number">5.2.135.2. </span>Dolibarr<a class="headerlink" href="#case-dolibarr-security-configureextract" title="Permalink to this headline">¶</a></h4>
<p><a class="reference internal" href="Rules.html#configure-extract"><span class="std std-ref">Configure Extract</span></a>, in htdocs/includes/restler/framework/Luracast/Restler/Format/HtmlFormat.php:224.</p>
<p>The extract() has been cleverly set in a closure, with a limited scope. The potential overwrite may impact existing variables, such as <cite>$_</cite>, <cite>$nav</cite>, <cite>$form</cite>, and <cite>$data</cite> itself. This may impact the following including. Using EXTR_SKIP would give existing variables priority, and avoid interference.</p>
<div class="highlight-php notranslate"><div class="highlight"><pre><span></span><span class="nv">$template</span> <span class="o">=</span> <span class="k">function</span> <span class="p">(</span><span class="nv">$view</span><span class="p">)</span> <span class="k">use</span> <span class="p">(</span><span class="nv">$data</span><span class="p">,</span> <span class="nv">$path</span><span class="p">)</span> <span class="p">{</span>
            <span class="nv">$form</span> <span class="o">=</span> <span class="k">function</span> <span class="p">()</span> <span class="p">{</span>
                <span class="k">return</span> <span class="nb">call_user_func_array</span><span class="p">(</span>
                    <span class="s1">&#39;Luracast\Restler\UI\Forms::get&#39;</span><span class="p">,</span>
                    <span class="nb">func_get_args</span><span class="p">()</span>
                <span class="p">);</span>
            <span class="p">};</span>
            <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nb">isset</span><span class="p">(</span><span class="nv">$data</span><span class="p">[</span><span class="s1">&#39;form&#39;</span><span class="p">]))</span>
                <span class="nv">$data</span><span class="p">[</span><span class="s1">&#39;form&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="nv">$form</span><span class="p">;</span>
            <span class="nv">$nav</span> <span class="o">=</span> <span class="k">function</span> <span class="p">()</span> <span class="p">{</span>
                <span class="k">return</span> <span class="nb">call_user_func_array</span><span class="p">(</span>
                    <span class="s1">&#39;Luracast\Restler\UI\Nav::get&#39;</span><span class="p">,</span>
                    <span class="nb">func_get_args</span><span class="p">()</span>
                <span class="p">);</span>
            <span class="p">};</span>
            <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nb">isset</span><span class="p">(</span><span class="nv">$data</span><span class="p">[</span><span class="s1">&#39;nav&#39;</span><span class="p">]))</span>
                <span class="nv">$data</span><span class="p">[</span><span class="s1">&#39;nav&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="nv">$nav</span><span class="p">;</span>

            <span class="nv">$_</span> <span class="o">=</span> <span class="k">function</span> <span class="p">()</span> <span class="k">use</span> <span class="p">(</span><span class="nv">$data</span><span class="p">,</span> <span class="nv">$path</span><span class="p">)</span> <span class="p">{</span>
                <span class="nb">extract</span><span class="p">(</span><span class="nv">$data</span><span class="p">);</span>
                <span class="nv">$args</span> <span class="o">=</span> <span class="nb">func_get_args</span><span class="p">();</span>
                <span class="nv">$task</span> <span class="o">=</span> <span class="nb">array_shift</span><span class="p">(</span><span class="nv">$args</span><span class="p">);</span>
                <span class="k">switch</span> <span class="p">(</span><span class="nv">$task</span><span class="p">)</span> <span class="p">{</span>
                    <span class="k">case</span> <span class="s1">&#39;require&#39;</span><span class="o">:</span>
                    <span class="k">case</span> <span class="s1">&#39;include&#39;</span><span class="o">:</span>
                        <span class="nv">$file</span> <span class="o">=</span> <span class="nv">$path</span> <span class="o">.</span> <span class="nv">$args</span><span class="p">[</span><span class="mi">0</span><span class="p">];</span>
                        <span class="k">if</span> <span class="p">(</span><span class="nb">is_readable</span><span class="p">(</span><span class="nv">$file</span><span class="p">))</span> <span class="p">{</span>
                            <span class="k">if</span> <span class="p">(</span>
                                <span class="nb">isset</span><span class="p">(</span><span class="nv">$args</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span> <span class="o">&amp;&amp;</span>
                                <span class="p">(</span><span class="nv">$arrays</span> <span class="o">=</span> <span class="nx">Util</span><span class="o">::</span><span class="na">nestedValue</span><span class="p">(</span><span class="nv">$data</span><span class="p">,</span> <span class="nv">$args</span><span class="p">[</span><span class="mi">1</span><span class="p">]))</span>
                            <span class="p">)</span> <span class="p">{</span>
                                <span class="nv">$str</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span><span class="p">;</span>
                                <span class="k">foreach</span> <span class="p">(</span><span class="nv">$arrays</span> <span class="k">as</span> <span class="nv">$arr</span><span class="p">)</span> <span class="p">{</span>
                                    <span class="nb">extract</span><span class="p">(</span><span class="nv">$arr</span><span class="p">);</span>
                                    <span class="nv">$str</span> <span class="o">.=</span> <span class="k">include</span> <span class="nv">$file</span><span class="p">;</span>
                                <span class="p">}</span>
                                <span class="k">return</span> <span class="nv">$str</span><span class="p">;</span>
                            <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
                                <span class="k">return</span> <span class="k">include</span> <span class="nv">$file</span><span class="p">;</span>
                            <span class="p">}</span>
                        <span class="p">}</span>
                        <span class="k">break</span><span class="p">;</span>
                    <span class="k">case</span> <span class="s1">&#39;if&#39;</span><span class="o">:</span>
                        <span class="k">if</span> <span class="p">(</span><span class="nb">count</span><span class="p">(</span><span class="nv">$args</span><span class="p">)</span> <span class="o">&lt;</span> <span class="mi">2</span><span class="p">)</span>
                            <span class="nv">$args</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span><span class="p">;</span>
                        <span class="k">if</span> <span class="p">(</span><span class="nb">count</span><span class="p">(</span><span class="nv">$args</span><span class="p">)</span> <span class="o">&lt;</span> <span class="mi">3</span><span class="p">)</span>
                            <span class="nv">$args</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span><span class="p">;</span>
                        <span class="k">return</span> <span class="nv">$args</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">?</span> <span class="nv">$args</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">:</span> <span class="nv">$args</span><span class="p">[</span><span class="mi">2</span><span class="p">];</span>
                        <span class="k">break</span><span class="p">;</span>
                    <span class="k">default</span><span class="o">:</span>
                        <span class="k">if</span> <span class="p">(</span><span class="nb">isset</span><span class="p">(</span><span class="nv">$data</span><span class="p">[</span><span class="nv">$task</span><span class="p">])</span> <span class="o">&amp;&amp;</span> <span class="nb">is_callable</span><span class="p">(</span><span class="nv">$data</span><span class="p">[</span><span class="nv">$task</span><span class="p">]))</span>
                            <span class="k">return</span> <span class="nb">call_user_func_array</span><span class="p">(</span><span class="nv">$data</span><span class="p">[</span><span class="nv">$task</span><span class="p">],</span> <span class="nv">$args</span><span class="p">);</span>
                <span class="p">}</span>
                <span class="k">return</span> <span class="s1">&#39;&#39;</span><span class="p">;</span>
            <span class="p">};</span>
            <span class="nb">extract</span><span class="p">(</span><span class="nv">$data</span><span class="p">);</span>
            <span class="k">return</span> <span class="o">@</span><span class="k">include</span> <span class="nv">$view</span><span class="p">;</span>
        <span class="p">};</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="safe-curl-options">
<span id="case-safe-curl-options"></span><h3><span class="section-number">5.2.136. </span>Safe Curl Options<a class="headerlink" href="#safe-curl-options" title="Permalink to this headline">¶</a></h3>
<div class="section" id="case-openconf-security-curloptions">
<span id="id172"></span><h4><span class="section-number">5.2.136.1. </span>OpenConf<a class="headerlink" href="#case-openconf-security-curloptions" title="Permalink to this headline">¶</a></h4>
<p><a class="reference internal" href="Rules.html#safe-curl-options"><span class="std std-ref">Safe Curl Options</span></a>, in openconf/include.php:703.</p>
<p>The function that holds that code is only used to call openconf.com, over http, while openconf.com is hosted on https, nowadays. This may be a sign of hard to access certificates.</p>
<div class="highlight-php notranslate"><div class="highlight"><pre><span></span><span class="nv">$ch</span> <span class="o">=</span> <span class="nb">curl_init</span><span class="p">();</span>
                    <span class="nb">curl_setopt</span><span class="p">(</span><span class="nv">$ch</span><span class="p">,</span> <span class="nx">CURLOPT_URL</span><span class="p">,</span> <span class="nv">$f</span><span class="p">);</span>
                    <span class="nb">curl_setopt</span><span class="p">(</span><span class="nv">$ch</span><span class="p">,</span> <span class="nx">CURLOPT_RETURNTRANSFER</span><span class="p">,</span> <span class="k">true</span><span class="p">);</span>
                    <span class="nb">curl_setopt</span><span class="p">(</span><span class="nv">$ch</span><span class="p">,</span> <span class="nx">CURLOPT_FOLLOWLOCATION</span><span class="p">,</span> <span class="k">true</span><span class="p">);</span>
                    <span class="nb">curl_setopt</span><span class="p">(</span><span class="nv">$ch</span><span class="p">,</span> <span class="nx">CURLOPT_AUTOREFERER</span><span class="p">,</span> <span class="k">true</span><span class="p">);</span>
                    <span class="nb">curl_setopt</span><span class="p">(</span><span class="nv">$ch</span><span class="p">,</span> <span class="nx">CURLOPT_SSL_VERIFYPEER</span><span class="p">,</span> <span class="k">false</span><span class="p">);</span>
                    <span class="nb">curl_setopt</span><span class="p">(</span><span class="nv">$ch</span><span class="p">,</span> <span class="nx">CURLOPT_MAXREDIRS</span><span class="p">,</span> <span class="mi">5</span><span class="p">);</span>
                    <span class="nb">curl_setopt</span><span class="p">(</span><span class="nv">$ch</span><span class="p">,</span> <span class="nx">CURLOPT_HEADER</span><span class="p">,</span> <span class="k">false</span><span class="p">);</span>
                    <span class="nv">$s</span> <span class="o">=</span> <span class="nb">curl_exec</span><span class="p">(</span><span class="nv">$ch</span><span class="p">);</span>
                    <span class="nb">curl_close</span><span class="p">(</span><span class="nv">$ch</span><span class="p">);</span>
                    <span class="k">return</span><span class="p">(</span><span class="nv">$s</span><span class="p">);</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="don-t-echo-error">
<span id="case-don-t-echo-error"></span><h3><span class="section-number">5.2.137. </span>Don’t Echo Error<a class="headerlink" href="#don-t-echo-error" title="Permalink to this headline">¶</a></h3>
<div class="section" id="case-churchcrm-security-dontechoerror">
<span id="id173"></span><h4><span class="section-number">5.2.137.1. </span>ChurchCRM<a class="headerlink" href="#case-churchcrm-security-dontechoerror" title="Permalink to this headline">¶</a></h4>
<p><a class="reference internal" href="Rules.html#don-t-echo-error"><span class="std std-ref">Don’t Echo Error</span></a>, in wp-admin/includes/misc.php:74.</p>
<p>This is classic debugging code that should never reach production. mysqli_error() and mysqli_errno() provide valuable information is case of an error, and may be exploited by intruders.</p>
<div class="highlight-php notranslate"><div class="highlight"><pre><span></span><span class="k">if</span> <span class="p">(</span><span class="nx">mysqli_error</span><span class="p">(</span><span class="nv">$cnInfoCentral</span><span class="p">)</span> <span class="o">!=</span> <span class="s1">&#39;&#39;</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">echo</span> <span class="nb">gettext</span><span class="p">(</span><span class="s1">&#39;An error occured: &#39;</span><span class="p">)</span><span class="o">.</span><span class="nx">mysqli_errno</span><span class="p">(</span><span class="nv">$cnInfoCentral</span><span class="p">)</span><span class="o">.</span><span class="s1">&#39;--&#39;</span><span class="o">.</span><span class="nx">mysqli_error</span><span class="p">(</span><span class="nv">$cnInfoCentral</span><span class="p">);</span>
    <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
</pre></div>
</div>
</div>
<div class="section" id="case-phpdocumentor-security-dontechoerror">
<span id="id174"></span><h4><span class="section-number">5.2.137.2. </span>Phpdocumentor<a class="headerlink" href="#case-phpdocumentor-security-dontechoerror" title="Permalink to this headline">¶</a></h4>
<p><a class="reference internal" href="Rules.html#don-t-echo-error"><span class="std std-ref">Don’t Echo Error</span></a>, in src/phpDocumentor/Plugin/Graphs/Writer/Graph.php:77.</p>
<p>Default development behavior : display the caught exception. Production behavior should not display that message, but log it for later review. Also, the return in the catch should be moved to the main code sequence.</p>
<div class="highlight-php notranslate"><div class="highlight"><pre><span></span><span class="k">public</span> <span class="k">function</span> <span class="nf">processClass</span><span class="p">(</span><span class="nx">ProjectDescriptor</span> <span class="nv">$project</span><span class="p">,</span> <span class="nx">Transformation</span> <span class="nv">$transformation</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="k">try</span> <span class="p">{</span>
            <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">checkIfGraphVizIsInstalled</span><span class="p">();</span>
        <span class="p">}</span> <span class="k">catch</span> <span class="p">(</span><span class="nx">\Exception</span> <span class="nv">$e</span><span class="p">)</span> <span class="p">{</span>
            <span class="k">echo</span> <span class="nv">$e</span><span class="o">-&gt;</span><span class="na">getMessage</span><span class="p">();</span>

            <span class="k">return</span><span class="p">;</span>
        <span class="p">}</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="encoded-simple-letters">
<span id="case-encoded-simple-letters"></span><h3><span class="section-number">5.2.138. </span>Encoded Simple Letters<a class="headerlink" href="#encoded-simple-letters" title="Permalink to this headline">¶</a></h3>
<div class="section" id="case-zurmo-security-encodedletters">
<span id="id175"></span><h4><span class="section-number">5.2.138.1. </span>Zurmo<a class="headerlink" href="#case-zurmo-security-encodedletters" title="Permalink to this headline">¶</a></h4>
<p><a class="reference internal" href="Rules.html#encoded-simple-letters"><span class="std std-ref">Encoded Simple Letters</span></a>, in yii/framework/web/CClientScript.php:783.</p>
<p>This actually decodes into a copyright notice.</p>
<dl class="simple">
<dt>‘function cleanAndSanitizeScriptHeader(&amp; $output)</dt><dd><dl class="simple">
<dt>{</dt><dd><p>$requiredOne = &lt;span&gt;Copyright &amp;#169; Zurmo Inc., 2013. All rights reserved.;….’</p>
</dd>
</dl>
</dd>
</dl>
<div class="highlight-php notranslate"><div class="highlight"><pre><span></span><span class="k">eval</span><span class="p">(</span><span class="nx">\x66\x75\x6e\x63\x74\x69\x6f\x6e\x20\x63\x6c\x65\x61\x6e\x41\x6e\x64\x53\x61\x6e\x69\x74\x69\x7a\x65\x53\x63\x72</span> <span class="o">.</span>
     <span class="nx">\x69\x70\x74\x48\x65\x61\x64\x65\x72\x28\x26\x20\x24\x6f\x75\x74\x70\x75\x74\x29\x0d\x0a\x20\x20\x20\x20\x20\x20</span> <span class="o">.</span>
     <span class="nx">\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x7b\x0d\x0a\x20\x20\x20\x20\x20\x20\x20</span> <span class="o">.</span>
     <span class="nx">\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x24\x72\x65\x71\x75\x69\x72</span> <span class="o">.</span>
     <span class="c1">// several more lines like that</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="mkdir-default">
<span id="case-mkdir-default"></span><h3><span class="section-number">5.2.139. </span>Mkdir Default<a class="headerlink" href="#mkdir-default" title="Permalink to this headline">¶</a></h3>
<div class="section" id="case-mautic-security-mkdirdefault">
<span id="id176"></span><h4><span class="section-number">5.2.139.1. </span>Mautic<a class="headerlink" href="#case-mautic-security-mkdirdefault" title="Permalink to this headline">¶</a></h4>
<p><a class="reference internal" href="Rules.html#mkdir-default"><span class="std std-ref">Mkdir Default</span></a>, in app/bundles/CoreBundle/Helper/AssetGenerationHelper.php:120.</p>
<p>This code is creating some directories for Javascript or CSS (from the directories names) : those require universal reading access, but probably no execution nor writing access. 0711 would be sufficient in this case.</p>
<div class="highlight-php notranslate"><div class="highlight"><pre><span></span><span class="c1">//combine the files into their corresponding name and put in the root media folder</span>
                <span class="k">if</span> <span class="p">(</span><span class="nv">$env</span> <span class="o">==</span> <span class="s1">&#39;prod&#39;</span><span class="p">)</span> <span class="p">{</span>
                    <span class="nv">$checkPaths</span> <span class="o">=</span> <span class="p">[</span>
                        <span class="nv">$assetsFullPath</span><span class="p">,</span>
                        <span class="nv">$assetsFullPath</span><span class="o">/</span><span class="nx">css</span><span class="p">,</span>
                        <span class="nv">$assetsFullPath</span><span class="o">/</span><span class="nx">js</span><span class="p">,</span>
                    <span class="p">];</span>
                    <span class="nb">array_walk</span><span class="p">(</span><span class="nv">$checkPaths</span><span class="p">,</span> <span class="k">function</span> <span class="p">(</span><span class="nv">$path</span><span class="p">)</span> <span class="p">{</span>
                        <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nb">file_exists</span><span class="p">(</span><span class="nv">$path</span><span class="p">))</span> <span class="p">{</span>
                            <span class="nb">mkdir</span><span class="p">(</span><span class="nv">$path</span><span class="p">);</span>
                        <span class="p">}</span>
                    <span class="p">});</span>
</pre></div>
</div>
</div>
<div class="section" id="case-openemr-security-mkdirdefault">
<span id="id177"></span><h4><span class="section-number">5.2.139.2. </span>OpenEMR<a class="headerlink" href="#case-openemr-security-mkdirdefault" title="Permalink to this headline">¶</a></h4>
<p><a class="reference internal" href="Rules.html#mkdir-default"><span class="std std-ref">Mkdir Default</span></a>, in interface/main/backuplog.php:27.</p>
<p>If $BACKUP_EVENTLOG_DIR is a backup for an event log, this should be stored out of the web server reach, with low rights, beside the current user. This is part of a CLI PHP script.</p>
<div class="highlight-php notranslate"><div class="highlight"><pre><span></span><span class="nb">mkdir</span><span class="p">(</span><span class="nv">$BACKUP_EVENTLOG_DIR</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="register-globals">
<span id="case-register-globals"></span><h3><span class="section-number">5.2.140. </span>Register Globals<a class="headerlink" href="#register-globals" title="Permalink to this headline">¶</a></h3>
<div class="section" id="case-teampass-security-registerglobals">
<span id="id178"></span><h4><span class="section-number">5.2.140.1. </span>TeamPass<a class="headerlink" href="#case-teampass-security-registerglobals" title="Permalink to this headline">¶</a></h4>
<p><a class="reference internal" href="Rules.html#register-globals"><span class="std std-ref">Register Globals</span></a>, in api/index.php:25.</p>
<p>The API starts with security features, such as the whitelist(). The whitelist applies to IP addresses, so the query string is not sanitized. Then, the QUERY_STRING is parsed, and creates a lot of new global variables.</p>
<div class="highlight-php notranslate"><div class="highlight"><pre><span></span><span class="nx">teampass_whitelist</span><span class="p">();</span>

<span class="nb">parse_str</span><span class="p">(</span><span class="nv">$_SERVER</span><span class="p">[</span><span class="s1">&#39;QUERY_STRING&#39;</span><span class="p">]);</span>
<span class="nv">$method</span> <span class="o">=</span> <span class="nv">$_SERVER</span><span class="p">[</span><span class="s1">&#39;REQUEST_METHOD&#39;</span><span class="p">];</span>
<span class="nv">$request</span> <span class="o">=</span> <span class="nb">explode</span><span class="p">(</span><span class="s2">&quot;/&quot;</span><span class="p">,</span> <span class="nb">substr</span><span class="p">(</span><span class="o">@</span><span class="nv">$_SERVER</span><span class="p">[</span><span class="s1">&#39;PATH_INFO&#39;</span><span class="p">],</span> <span class="mi">1</span><span class="p">));</span>
</pre></div>
</div>
</div>
<div class="section" id="xoops">
<span id="case-xoops-security-registerglobals"></span><h4><span class="section-number">5.2.140.2. </span>XOOPS<a class="headerlink" href="#xoops" title="Permalink to this headline">¶</a></h4>
<p><a class="reference internal" href="Rules.html#register-globals"><span class="std std-ref">Register Globals</span></a>, in htdocs/modules/system/admin/images/main.php:33:33.</p>
<p>This code only exports the POST variables as globals. And it does clean incoming variables, but not all of them.</p>
<div class="highlight-php notranslate"><div class="highlight"><pre><span></span><span class="c1">// Check users rights</span>
<span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nb">is_object</span><span class="p">(</span><span class="nv">$xoopsUser</span><span class="p">)</span> <span class="o">||</span> <span class="o">!</span><span class="nb">is_object</span><span class="p">(</span><span class="nv">$xoopsModule</span><span class="p">)</span> <span class="o">||</span> <span class="o">!</span><span class="nv">$xoopsUser</span><span class="o">-&gt;</span><span class="na">isAdmin</span><span class="p">(</span><span class="nv">$xoopsModule</span><span class="o">-&gt;</span><span class="na">mid</span><span class="p">()))</span> <span class="p">{</span>
    <span class="k">exit</span><span class="p">(</span><span class="nx">_NOPERM</span><span class="p">);</span>
<span class="p">}</span>

<span class="c1">//  Check is active</span>
<span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nx">xoops_getModuleOption</span><span class="p">(</span><span class="s1">&#39;active_images&#39;</span><span class="p">,</span> <span class="s1">&#39;system&#39;</span><span class="p">))</span> <span class="p">{</span>
    <span class="nx">redirect_header</span><span class="p">(</span><span class="s1">&#39;admin.php&#39;</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="nx">_AM_SYSTEM_NOTACTIVE</span><span class="p">);</span>
<span class="p">}</span>

<span class="k">if</span> <span class="p">(</span><span class="nb">isset</span><span class="p">(</span><span class="nv">$_POST</span><span class="p">))</span> <span class="p">{</span>
    <span class="k">foreach</span> <span class="p">(</span><span class="nv">$_POST</span> <span class="k">as</span> <span class="nv">$k</span> <span class="o">=&gt;</span> <span class="nv">$v</span><span class="p">)</span> <span class="p">{</span>
        <span class="nv">${$k}</span> <span class="o">=</span> <span class="nv">$v</span><span class="p">;</span>
    <span class="p">}</span>
<span class="p">}</span>

<span class="c1">// Get Action type</span>
<span class="nv">$op</span> <span class="o">=</span> <span class="nx">system_CleanVars</span><span class="p">(</span><span class="nv">$_REQUEST</span><span class="p">,</span> <span class="s1">&#39;op&#39;</span><span class="p">,</span> <span class="s1">&#39;list&#39;</span><span class="p">,</span> <span class="s1">&#39;string&#39;</span><span class="p">);</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="should-use-prepared-statement">
<span id="case-should-use-prepared-statement"></span><h3><span class="section-number">5.2.141. </span>Should Use Prepared Statement<a class="headerlink" href="#should-use-prepared-statement" title="Permalink to this headline">¶</a></h3>
<div class="section" id="case-dolibarr-security-shouldusepreparedstatement">
<span id="id179"></span><h4><span class="section-number">5.2.141.1. </span>Dolibarr<a class="headerlink" href="#case-dolibarr-security-shouldusepreparedstatement" title="Permalink to this headline">¶</a></h4>
<p><a class="reference internal" href="Rules.html#should-use-prepared-statement"><span class="std std-ref">Should Use Prepared Statement</span></a>, in htdocs/product/admin/price_rules.php:76.</p>
<p>This code is well escaped, as the integer type cast will prevent any special chars to be used. Here, a prepared statement would apply a modern approach to securing this query.</p>
<div class="highlight-php notranslate"><div class="highlight"><pre><span></span><span class="nv">$db</span><span class="o">-&gt;</span><span class="na">query</span><span class="p">(</span><span class="s2">&quot;DELETE FROM &quot;</span> <span class="o">.</span> <span class="nx">MAIN_DB_PREFIX</span> <span class="o">.</span> <span class="s2">&quot;product_pricerules WHERE level = &quot;</span> <span class="o">.</span> <span class="p">(</span><span class="nx">int</span><span class="p">)</span> <span class="nv">$i</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="unserialize-second-arg">
<span id="case-unserialize-second-arg"></span><h3><span class="section-number">5.2.142. </span>Unserialize Second Arg<a class="headerlink" href="#unserialize-second-arg" title="Permalink to this headline">¶</a></h3>
<div class="section" id="case-piwigo-security-unserializesecondarg">
<span id="id180"></span><h4><span class="section-number">5.2.142.1. </span>Piwigo<a class="headerlink" href="#case-piwigo-security-unserializesecondarg" title="Permalink to this headline">¶</a></h4>
<p><a class="reference internal" href="Rules.html#unserialize-second-arg"><span class="std std-ref">Unserialize Second Arg</span></a>, in admin/configuration.php:491.</p>
<p>unserialize() extracts information from the $conf variable : this variable is read from a configuration file. It is later tested to be an array, whose index may not be all set (&#64;$disabled[$type];). It would be safer to make $disabled an object, add the class to unserialize, and set default values to the needed properties/index.</p>
<div class="highlight-php notranslate"><div class="highlight"><pre><span></span><span class="nv">$disabled</span> <span class="o">=</span> <span class="o">@</span><span class="nb">unserialize</span><span class="p">(</span><span class="o">@</span><span class="nv">$conf</span><span class="p">[</span><span class="s1">&#39;disabled_derivatives&#39;</span><span class="p">]);</span>
</pre></div>
</div>
</div>
<div class="section" id="case-livezilla-security-unserializesecondarg">
<span id="id181"></span><h4><span class="section-number">5.2.142.2. </span>LiveZilla<a class="headerlink" href="#case-livezilla-security-unserializesecondarg" title="Permalink to this headline">¶</a></h4>
<p><a class="reference internal" href="Rules.html#unserialize-second-arg"><span class="std std-ref">Unserialize Second Arg</span></a>, in livezilla/_lib/objects.global.inc.php:2600.</p>
<p>unserialize() only extract a non-empty value here. But its content is not checked. It is later used as an array, with multiple index.</p>
<div class="highlight-php notranslate"><div class="highlight"><pre><span></span><span class="nv">$this</span><span class="o">-&gt;</span><span class="na">Customs</span> <span class="o">=</span> <span class="p">(</span><span class="o">!</span><span class="k">empty</span><span class="p">(</span><span class="nv">$_row</span><span class="p">[</span><span class="s2">&quot;customs&quot;</span><span class="p">]))</span> <span class="o">?</span> <span class="o">@</span><span class="nb">unserialize</span><span class="p">(</span><span class="nv">$_row</span><span class="p">[</span><span class="s2">&quot;customs&quot;</span><span class="p">])</span> <span class="o">:</span> <span class="k">array</span><span class="p">();</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="adding-zero">
<span id="case-adding-zero"></span><h3><span class="section-number">5.2.143. </span>Adding Zero<a class="headerlink" href="#adding-zero" title="Permalink to this headline">¶</a></h3>
<div class="section" id="case-thelia-structures-addzero">
<span id="id182"></span><h4><span class="section-number">5.2.143.1. </span>Thelia<a class="headerlink" href="#case-thelia-structures-addzero" title="Permalink to this headline">¶</a></h4>
<p><a class="reference internal" href="Rules.html#adding-zero"><span class="std std-ref">Adding Zero</span></a>, in core/lib/Thelia/Model/Map/ProfileResourceTableMap.php:250.</p>
<p>This return statement is doing quite a lot, including a buried ‘0 + $offset’. This call is probably an echo to ‘1 + $offset’, which is a little later in the expression.</p>
<div class="highlight-php notranslate"><div class="highlight"><pre><span></span><span class="k">return</span> <span class="nb">serialize</span><span class="p">(</span><span class="k">array</span><span class="p">((</span><span class="nx">string</span><span class="p">)</span> <span class="nv">$row</span><span class="p">[</span><span class="nx">TableMap</span><span class="o">::</span><span class="na">TYPE_NUM</span> <span class="o">==</span> <span class="nv">$indexType</span> <span class="o">?</span> <span class="mi">0</span> <span class="o">+</span> <span class="nv">$offset</span> <span class="o">:</span> <span class="k">static</span><span class="o">::</span><span class="na">translateFieldName</span><span class="p">(</span><span class="s1">&#39;ProfileId&#39;</span><span class="p">,</span> <span class="nx">TableMap</span><span class="o">::</span><span class="na">TYPE_PHPNAME</span><span class="p">,</span> <span class="nv">$indexType</span><span class="p">)],</span> <span class="p">(</span><span class="nx">string</span><span class="p">)</span> <span class="nv">$row</span><span class="p">[</span><span class="nx">TableMap</span><span class="o">::</span><span class="na">TYPE_NUM</span> <span class="o">==</span> <span class="nv">$indexType</span> <span class="o">?</span> <span class="mi">1</span> <span class="o">+</span> <span class="nv">$offset</span> <span class="o">:</span> <span class="k">static</span><span class="o">::</span><span class="na">translateFieldName</span><span class="p">(</span><span class="s1">&#39;ResourceId&#39;</span><span class="p">,</span> <span class="nx">TableMap</span><span class="o">::</span><span class="na">TYPE_PHPNAME</span><span class="p">,</span> <span class="nv">$indexType</span><span class="p">)]));</span>
</pre></div>
</div>
</div>
<div class="section" id="case-openemr-structures-addzero">
<span id="id183"></span><h4><span class="section-number">5.2.143.2. </span>OpenEMR<a class="headerlink" href="#case-openemr-structures-addzero" title="Permalink to this headline">¶</a></h4>
<p><a class="reference internal" href="Rules.html#adding-zero"><span class="std std-ref">Adding Zero</span></a>, in interface/forms/fee_sheet/new.php:466:534.</p>
<p>$main_provid is filtered as an integer. $main_supid is then filtered twice : one with the sufficent (int) and then, added with 0.</p>
<div class="highlight-php notranslate"><div class="highlight"><pre><span></span><span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nv">$alertmsg</span> <span class="o">&amp;&amp;</span> <span class="p">(</span><span class="nv">$_POST</span><span class="p">[</span><span class="s1">&#39;bn_save&#39;</span><span class="p">]</span> <span class="o">||</span> <span class="nv">$_POST</span><span class="p">[</span><span class="s1">&#39;bn_save_close&#39;</span><span class="p">]</span> <span class="o">||</span> <span class="nv">$_POST</span><span class="p">[</span><span class="s1">&#39;bn_save_stay&#39;</span><span class="p">]))</span> <span class="p">{</span>
    <span class="nv">$main_provid</span> <span class="o">=</span> <span class="mi">0</span> <span class="o">+</span> <span class="nv">$_POST</span><span class="p">[</span><span class="s1">&#39;ProviderID&#39;</span><span class="p">];</span>
    <span class="nv">$main_supid</span>  <span class="o">=</span> <span class="mi">0</span> <span class="o">+</span> <span class="p">(</span><span class="nx">int</span><span class="p">)</span><span class="nv">$_POST</span><span class="p">[</span><span class="s1">&#39;SupervisorID&#39;</span><span class="p">];</span>
    <span class="c1">//.....</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="altering-foreach-without-reference">
<span id="case-altering-foreach-without-reference"></span><h3><span class="section-number">5.2.144. </span>Altering Foreach Without Reference<a class="headerlink" href="#altering-foreach-without-reference" title="Permalink to this headline">¶</a></h3>
<div class="section" id="case-contao-structures-alteringforeachwithoutreference">
<span id="id184"></span><h4><span class="section-number">5.2.144.1. </span>Contao<a class="headerlink" href="#case-contao-structures-alteringforeachwithoutreference" title="Permalink to this headline">¶</a></h4>
<p><a class="reference internal" href="Rules.html#altering-foreach-without-reference"><span class="std std-ref">Altering Foreach Without Reference</span></a>, in core-bundle/src/Resources/contao/classes/Theme.php:613.</p>
<p>$tmp[$kk] is &amp;$vv.</p>
<div class="highlight-php notranslate"><div class="highlight"><pre><span></span><span class="k">foreach</span> <span class="p">(</span><span class="nv">$tmp</span> <span class="k">as</span> <span class="nv">$kk</span><span class="o">=&gt;</span><span class="nv">$vv</span><span class="p">)</span>
                                                            <span class="p">{</span>
                                                                    <span class="c1">// Do not use the FilesModel here – tables are locked!</span>
                                                                    <span class="nv">$objFile</span> <span class="o">=</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">Database</span><span class="o">-&gt;</span><span class="na">prepare</span><span class="p">(</span><span class="nx">SELECT</span> <span class="nx">uuid</span> <span class="nx">FROM</span> <span class="nx">tl_files</span> <span class="nx">WHERE</span> <span class="nx">path</span><span class="o">=?</span><span class="p">)</span>
                                                                                                                      <span class="o">-&gt;</span><span class="na">limit</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
                                                                                                                      <span class="o">-&gt;</span><span class="na">execute</span><span class="p">(</span><span class="nv">$this</span><span class="o">-&gt;</span><span class="na">customizeUploadPath</span><span class="p">(</span><span class="nv">$vv</span><span class="p">));</span>

                                                                    <span class="nv">$tmp</span><span class="p">[</span><span class="nv">$kk</span><span class="p">]</span> <span class="o">=</span> <span class="nv">$objFile</span><span class="o">-&gt;</span><span class="na">uuid</span><span class="p">;</span>
                                                            <span class="p">}</span>
</pre></div>
</div>
</div>
<div class="section" id="case-wordpress-structures-alteringforeachwithoutreference">
<span id="id185"></span><h4><span class="section-number">5.2.144.2. </span>WordPress<a class="headerlink" href="#case-wordpress-structures-alteringforeachwithoutreference" title="Permalink to this headline">¶</a></h4>
<p><a class="reference internal" href="Rules.html#altering-foreach-without-reference"><span class="std std-ref">Altering Foreach Without Reference</span></a>, in wp-admin/includes/misc.php:74.</p>
<p>$ids[$index] is &amp;$rrid.</p>
<div class="highlight-php notranslate"><div class="highlight"><pre><span></span><span class="k">foreach</span><span class="p">(</span><span class="nv">$ids</span> <span class="k">as</span> <span class="nv">$index</span> <span class="o">=&gt;</span> <span class="nv">$rrid</span><span class="p">)</span>
                <span class="p">{</span>
                    <span class="k">if</span><span class="p">(</span><span class="nv">$rrid</span> <span class="o">==</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">Id</span><span class="p">)</span>
                    <span class="p">{</span>
                        <span class="nv">$ids</span><span class="p">[</span><span class="nv">$index</span><span class="p">]</span> <span class="o">=</span> <span class="nv">$_id</span><span class="p">;</span>
                        <span class="nv">$write</span> <span class="o">=</span> <span class="k">true</span><span class="p">;</span>
                        <span class="k">break</span><span class="p">;</span>
                    <span class="p">}</span>
                <span class="p">}</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="bail-out-early">
<span id="case-bail-out-early"></span><h3><span class="section-number">5.2.145. </span>Bail Out Early<a class="headerlink" href="#bail-out-early" title="Permalink to this headline">¶</a></h3>
<div class="section" id="case-openemr-structures-bailoutearly">
<span id="id186"></span><h4><span class="section-number">5.2.145.1. </span>OpenEMR<a class="headerlink" href="#case-openemr-structures-bailoutearly" title="Permalink to this headline">¶</a></h4>
<p><a class="reference internal" href="Rules.html#bail-out-early"><span class="std std-ref">Bail Out Early</span></a>, in interface/modules/zend_modules/module/Carecoordination/src/Carecoordination/Controller/EncounterccdadispatchController.php:69.</p>
<p>This is a typical example of a function mostly controlled by one condition. It could be rewrite as ‘if($validResult != ‘existingpatient’)’ then return. The ‘else’ clause is not used anymore, and the whole block of code is now the main sequence of the method.</p>
<div class="highlight-php notranslate"><div class="highlight"><pre><span></span><span class="k">public</span> <span class="k">function</span> <span class="nf">ccdaFetching</span><span class="p">(</span><span class="nv">$parameterArray</span> <span class="o">=</span> <span class="k">array</span><span class="p">())</span>
    <span class="p">{</span>
        <span class="nv">$validResult</span> <span class="o">=</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">getEncounterccdadispatchTable</span><span class="p">()</span><span class="o">-&gt;</span><span class="na">valid</span><span class="p">(</span><span class="nv">$parameterArray</span><span class="p">[</span><span class="mi">0</span><span class="p">]);</span>
        <span class="c1">// validate credentials</span>
        <span class="k">if</span> <span class="p">(</span><span class="nv">$validResult</span> <span class="o">==</span> <span class="s1">&#39;existingpatient&#39;</span><span class="p">)</span> <span class="p">{</span>
<span class="c1">/// Long bloc of code</span>
        <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
            <span class="k">return</span> <span class="s1">&#39;&lt;?xml version=1.0 encoding=UTF-8?&gt;</span>
<span class="s1">                    &lt;!-- Edited by XMLSpy --&gt;</span>
<span class="s1">                    &lt;note&gt;</span>

<span class="s1">                            &lt;heading&gt;Authetication Failure&lt;/heading&gt;</span>
<span class="s1">                            &lt;body&gt;&lt;/body&gt;</span>
<span class="s1">                    &lt;/note&gt;</span>
<span class="s1">                    &#39;</span><span class="p">;</span>
        <span class="p">}</span>
</pre></div>
</div>
</div>
<div class="section" id="opencfp">
<span id="case-opencfp-structures-bailoutearly"></span><h4><span class="section-number">5.2.145.2. </span>opencfp<a class="headerlink" href="#opencfp" title="Permalink to this headline">¶</a></h4>
<p><a class="reference internal" href="Rules.html#bail-out-early"><span class="std std-ref">Bail Out Early</span></a>, in chair/assign_auto_reviewers_weighted_topic_match.inc:105.</p>
<p>This long example illustrates two aspects : first, the shortcut to the end of the method may be the ‘then’ clause, not necessarily the ‘else’. ‘!in_array($pid.’-‘.$rid, $conflictAR)’ leads to return, and the ‘else’ should be removed, while keeping its content. Secondly, we can see 3 conditions that all lead to a premature end to the method. After refactoring all of them, the method would end up with 1 level of indentation, instead of 3.</p>
<div class="highlight-php notranslate"><div class="highlight"><pre><span></span><span class="k">function</span> <span class="nf">oc_inConflict</span><span class="p">(</span><span class="o">&amp;</span><span class="nv">$conflictAR</span><span class="p">,</span> <span class="nv">$pid</span><span class="p">,</span> <span class="nv">$rid</span><span class="o">=</span><span class="k">null</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">if</span> <span class="p">(</span><span class="nv">$rid</span> <span class="o">==</span> <span class="k">null</span><span class="p">)</span> <span class="p">{</span>
            <span class="nv">$rid</span> <span class="o">=</span> <span class="nv">$_SESSION</span><span class="p">[</span><span class="nx">OCC_SESSION_VAR_NAME</span><span class="p">][</span><span class="s1">&#39;acreviewerid&#39;</span><span class="p">];</span>
    <span class="p">}</span>
    <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nb">in_array</span><span class="p">(</span><span class="nv">$pid</span><span class="o">.</span><span class="s1">&#39;-&#39;</span><span class="o">.</span><span class="nv">$rid</span><span class="p">,</span> <span class="nv">$conflictAR</span><span class="p">))</span> <span class="p">{</span>
            <span class="k">return</span> <span class="k">false</span><span class="p">;</span> <span class="c1">// not in conflict</span>
    <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
            <span class="nv">$tempr</span> <span class="o">=</span> <span class="nx">ocsql_query</span><span class="p">(</span><span class="s2">&quot;SELECT COUNT(*) AS `count` FROM `&quot;</span> <span class="o">.</span> <span class="nx">OCC_TABLE_PAPERREVIEWER</span> <span class="o">.</span> <span class="s2">&quot;` WHERE `paperid`=&#39;&quot;</span> <span class="o">.</span> <span class="nx">safeSQLstr</span><span class="p">(</span><span class="nv">$pid</span><span class="p">)</span> <span class="o">.</span> <span class="s2">&quot;&#39; AND `reviewerid`=&#39;&quot;</span> <span class="o">.</span> <span class="nx">safeSQLstr</span><span class="p">(</span><span class="nv">$rid</span><span class="p">)</span> <span class="o">.</span> <span class="s2">&quot;&#39;&quot;</span><span class="p">);</span>
            <span class="k">if</span> <span class="p">((</span><span class="nx">ocsql_num_rows</span><span class="p">(</span><span class="nv">$tempr</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span><span class="p">)</span>
                    <span class="o">&amp;&amp;</span> <span class="p">(</span><span class="nv">$templ</span> <span class="o">=</span> <span class="nx">ocsql_fetch_assoc</span><span class="p">(</span><span class="nv">$tempr</span><span class="p">))</span>
                    <span class="o">&amp;&amp;</span> <span class="p">(</span><span class="nv">$templ</span><span class="p">[</span><span class="s1">&#39;count&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="mi">1</span><span class="p">)</span>
            <span class="p">)</span> <span class="p">{</span>
                    <span class="k">return</span> <span class="k">false</span><span class="p">;</span> <span class="c1">// assigned as reviewer</span>
            <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
                    <span class="nv">$tempr</span> <span class="o">=</span> <span class="nx">ocsql_query</span><span class="p">(</span><span class="s2">&quot;SELECT COUNT(*) AS `count` FROM `&quot;</span> <span class="o">.</span> <span class="nx">OCC_TABLE_PAPERADVOCATE</span> <span class="o">.</span> <span class="s2">&quot;` WHERE `paperid`=&#39;&quot;</span> <span class="o">.</span> <span class="nx">safeSQLstr</span><span class="p">(</span><span class="nv">$pid</span><span class="p">)</span> <span class="o">.</span> <span class="s2">&quot;&#39; AND `advocateid`=&#39;&quot;</span> <span class="o">.</span> <span class="nx">safeSQLstr</span><span class="p">(</span><span class="nv">$rid</span><span class="p">)</span> <span class="o">.</span> <span class="s2">&quot;&#39;&quot;</span><span class="p">);</span>
                    <span class="k">if</span> <span class="p">((</span><span class="nx">ocsql_num_rows</span><span class="p">(</span><span class="nv">$tempr</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span><span class="p">)</span>
                            <span class="o">&amp;&amp;</span> <span class="p">(</span><span class="nv">$templ</span> <span class="o">=</span> <span class="nx">ocsql_fetch_assoc</span><span class="p">(</span><span class="nv">$tempr</span><span class="p">))</span>
                            <span class="o">&amp;&amp;</span> <span class="p">(</span><span class="nv">$templ</span><span class="p">[</span><span class="s1">&#39;count&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="mi">1</span><span class="p">)</span>
                    <span class="p">)</span> <span class="p">{</span>
                            <span class="k">return</span> <span class="k">false</span><span class="p">;</span> <span class="c1">// assigned as advocate</span>
                    <span class="p">}</span>
            <span class="p">}</span>
    <span class="p">}</span>
    <span class="k">return</span> <span class="k">true</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="use-basename-suffix">
<span id="case-use-basename-suffix"></span><h3><span class="section-number">5.2.146. </span>Use Basename Suffix<a class="headerlink" href="#use-basename-suffix" title="Permalink to this headline">¶</a></h3>
<div class="section" id="case-nextcloud-structures-basenamesuffix">
<span id="id187"></span><h4><span class="section-number">5.2.146.1. </span>NextCloud<a class="headerlink" href="#case-nextcloud-structures-basenamesuffix" title="Permalink to this headline">¶</a></h4>
<p><a class="reference internal" href="Rules.html#use-basename-suffix"><span class="std std-ref">Use Basename Suffix</span></a>, in lib/private/URLGenerator.php:176.</p>
<p>This code removes the 4 last letters from the images. It may be ‘png’, ‘jpg’ or ‘txt’.</p>
<div class="highlight-php notranslate"><div class="highlight"><pre><span></span><span class="nb">substr</span><span class="p">(</span><span class="nb">basename</span><span class="p">(</span><span class="nv">$image</span><span class="p">),</span> <span class="mi">0</span><span class="p">,</span> <span class="o">-</span><span class="mi">4</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="section" id="case-dolibarr-structures-basenamesuffix">
<span id="id188"></span><h4><span class="section-number">5.2.146.2. </span>Dolibarr<a class="headerlink" href="#case-dolibarr-structures-basenamesuffix" title="Permalink to this headline">¶</a></h4>
<p><a class="reference internal" href="Rules.html#use-basename-suffix"><span class="std std-ref">Use Basename Suffix</span></a>, in htdocs/core/website.inc.php:42.</p>
<p>The extension ‘.tpl.php’ is dropped from the file name, unless it appears somewhere else in the $websitepagefile variable.</p>
<div class="highlight-php notranslate"><div class="highlight"><pre><span></span><span class="nb">str_replace</span><span class="p">(</span><span class="k">array</span><span class="p">(</span><span class="s1">&#39;.tpl.php&#39;</span><span class="p">,</span> <span class="s1">&#39;page&#39;</span><span class="p">),</span> <span class="k">array</span><span class="p">(</span><span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">),</span> <span class="nb">basename</span><span class="p">(</span><span class="nv">$websitepagefile</span><span class="p">))</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="strict-comparison-with-booleans">
<span id="case-strict-comparison-with-booleans"></span><h3><span class="section-number">5.2.147. </span>Strict Comparison With Booleans<a class="headerlink" href="#strict-comparison-with-booleans" title="Permalink to this headline">¶</a></h3>
<div class="section" id="case-phinx-structures-booleanstrictcomparison">
<span id="id189"></span><h4><span class="section-number">5.2.147.1. </span>Phinx<a class="headerlink" href="#case-phinx-structures-booleanstrictcomparison" title="Permalink to this headline">¶</a></h4>
<p><a class="reference internal" href="Rules.html#strict-comparison-with-booleans"><span class="std std-ref">Strict Comparison With Booleans</span></a>, in src/Phinx/Db/Adapter/MysqlAdapter.php:1131.</p>
<p><cite>ìsNull( )`</cite> always returns a boolean : it may be only be <code class="docutils literal notranslate"><span class="pre">true</span></code> or <code class="docutils literal notranslate"><span class="pre">false</span></code>. Until typehinted properties or return typehint are used, isNull() may return anything else.</p>
<div class="highlight-php notranslate"><div class="highlight"><pre><span></span><span class="nv">$column</span><span class="o">-&gt;</span><span class="na">isNull</span><span class="p">(</span> <span class="p">)</span> <span class="o">==</span> <span class="k">false</span>
</pre></div>
</div>
</div>
<div class="section" id="case-typo3-structures-booleanstrictcomparison">
<span id="id190"></span><h4><span class="section-number">5.2.147.2. </span>Typo3<a class="headerlink" href="#case-typo3-structures-booleanstrictcomparison" title="Permalink to this headline">¶</a></h4>
<p><a class="reference internal" href="Rules.html#strict-comparison-with-booleans"><span class="std std-ref">Strict Comparison With Booleans</span></a>, in typo3/sysext/lowlevel/Classes/Command/FilesWithMultipleReferencesCommand.php:90.</p>
<p>When <code class="docutils literal notranslate"><span class="pre">dry-run</span></code> is not defined, the getOption() method actually returns a <code class="docutils literal notranslate"><span class="pre">null</span></code> value. So, comparing the result of getOption() to false is actually wrong : using a constant to prevent values to be inconsistent is recommended here.</p>
<div class="highlight-php notranslate"><div class="highlight"><pre><span></span><span class="nv">$input</span><span class="o">-&gt;</span><span class="na">getOption</span><span class="p">(</span><span class="s1">&#39;dry-run&#39;</span><span class="p">)</span> <span class="o">!=</span> <span class="k">false</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="buried-assignation">
<span id="case-buried-assignation"></span><h3><span class="section-number">5.2.148. </span>Buried Assignation<a class="headerlink" href="#buried-assignation" title="Permalink to this headline">¶</a></h3>
<div class="section" id="case-xoops-structures-buriedassignation">
<span id="id191"></span><h4><span class="section-number">5.2.148.1. </span>XOOPS<a class="headerlink" href="#case-xoops-structures-buriedassignation" title="Permalink to this headline">¶</a></h4>
<p><a class="reference internal" href="Rules.html#buried-assignation"><span class="std std-ref">Buried Assignation</span></a>, in htdocs/image.php:170.</p>
<p>Classic iffectation : the condition also collects the needed value to process the drawing. This is very common in PHP, and the Yoda condition, with its constant on the left, shows that extra steps were taken to strengthen that piece of code.</p>
<div class="highlight-php notranslate"><div class="highlight"><pre><span></span><span class="k">if</span> <span class="p">(</span><span class="mi">0</span> <span class="o">&lt;</span> <span class="p">(</span><span class="nv">$radius</span> <span class="o">=</span> <span class="nv">$radii</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">*</span> <span class="nv">$q</span><span class="p">))</span> <span class="p">{</span> <span class="c1">// left bottom</span>
        <span class="nb">imagearc</span><span class="p">(</span><span class="nv">$workingImage</span><span class="p">,</span> <span class="nv">$radius</span> <span class="o">-</span> <span class="mi">1</span><span class="p">,</span> <span class="nv">$workingHeight</span> <span class="o">-</span> <span class="nv">$radius</span><span class="p">,</span> <span class="nv">$radius</span> <span class="o">*</span> <span class="mi">2</span><span class="p">,</span> <span class="nv">$radius</span> <span class="o">*</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">90</span><span class="p">,</span> <span class="mi">180</span><span class="p">,</span> <span class="nv">$alphaColor</span><span class="p">);</span>
        <span class="nb">imagefilltoborder</span><span class="p">(</span><span class="nv">$workingImage</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="nv">$workingHeight</span> <span class="o">-</span> <span class="mi">1</span><span class="p">,</span> <span class="nv">$alphaColor</span><span class="p">,</span> <span class="nv">$alphaColor</span><span class="p">);</span>
    <span class="p">}</span>
</pre></div>
</div>
</div>
<div class="section" id="case-mautic-structures-buriedassignation">
<span id="id192"></span><h4><span class="section-number">5.2.148.2. </span>Mautic<a class="headerlink" href="#case-mautic-structures-buriedassignation" title="Permalink to this headline">¶</a></h4>
<p><a class="reference internal" href="Rules.html#buried-assignation"><span class="std std-ref">Buried Assignation</span></a>, in app/bundles/CoreBundle/Controller/ThemeController.php:47.</p>
<p>The setting of the variable $cancelled is fairly hidden here, with its extra operator !. The operator is here for the condition, as $cancelled needs the ‘cancellation’ state, while the condition needs the contrary. Note also that isset() could be moved out of this condition, and made the result easier to read.</p>
<div class="highlight-php notranslate"><div class="highlight"><pre><span></span><span class="nv">$form</span>        <span class="o">=</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">get</span><span class="p">(</span><span class="s1">&#39;form.factory&#39;</span><span class="p">)</span><span class="o">-&gt;</span><span class="na">create</span><span class="p">(</span><span class="s1">&#39;theme_upload&#39;</span><span class="p">,</span> <span class="p">[],</span> <span class="p">[</span><span class="s1">&#39;action&#39;</span> <span class="o">=&gt;</span> <span class="nv">$action</span><span class="p">]);</span>

        <span class="k">if</span> <span class="p">(</span><span class="nv">$this</span><span class="o">-&gt;</span><span class="na">request</span><span class="o">-&gt;</span><span class="na">getMethod</span><span class="p">()</span> <span class="o">==</span> <span class="s1">&#39;POST&#39;</span><span class="p">)</span> <span class="p">{</span>
            <span class="k">if</span> <span class="p">(</span><span class="nb">isset</span><span class="p">(</span><span class="nv">$form</span><span class="p">)</span> <span class="o">&amp;&amp;</span> <span class="o">!</span><span class="nv">$cancelled</span> <span class="o">=</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">isFormCancelled</span><span class="p">(</span><span class="nv">$form</span><span class="p">))</span> <span class="p">{</span>
                <span class="k">if</span> <span class="p">(</span><span class="nv">$this</span><span class="o">-&gt;</span><span class="na">isFormValid</span><span class="p">(</span><span class="nv">$form</span><span class="p">))</span> <span class="p">{</span>
                    <span class="nv">$fileData</span> <span class="o">=</span> <span class="nv">$form</span><span class="p">[</span><span class="s1">&#39;file&#39;</span><span class="p">]</span><span class="o">-&gt;</span><span class="na">getData</span><span class="p">();</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="cast-to-boolean">
<span id="case-cast-to-boolean"></span><h3><span class="section-number">5.2.149. </span>Cast To Boolean<a class="headerlink" href="#cast-to-boolean" title="Permalink to this headline">¶</a></h3>
<div class="section" id="case-mediawiki-structures-casttoboolean">
<span id="id193"></span><h4><span class="section-number">5.2.149.1. </span>MediaWiki<a class="headerlink" href="#case-mediawiki-structures-casttoboolean" title="Permalink to this headline">¶</a></h4>
<p><a class="reference internal" href="Rules.html#cast-to-boolean"><span class="std std-ref">Cast To Boolean</span></a>, in includes/page/WikiPage.php:2274.</p>
<p>$options[‘changed’] and $options[‘created’] are documented and used as boolean. Yet, SiteStatsUpdate may require integers, for correct storage in the database, hence the type casting. <code class="docutils literal notranslate"><span class="pre">(int)</span> <span class="pre">(bool)</span></code> may be an alternative here.</p>
<div class="highlight-php notranslate"><div class="highlight"><pre><span></span><span class="nv">$edits</span> <span class="o">=</span> <span class="nv">$options</span><span class="p">[</span><span class="s1">&#39;changed&#39;</span><span class="p">]</span> <span class="o">?</span> <span class="mi">1</span> <span class="o">:</span> <span class="mi">0</span><span class="p">;</span>
            <span class="nv">$pages</span> <span class="o">=</span> <span class="nv">$options</span><span class="p">[</span><span class="s1">&#39;created&#39;</span><span class="p">]</span> <span class="o">?</span> <span class="mi">1</span> <span class="o">:</span> <span class="mi">0</span><span class="p">;</span>


            <span class="nx">DeferredUpdates</span><span class="o">::</span><span class="na">addUpdate</span><span class="p">(</span> <span class="nx">SiteStatsUpdate</span><span class="o">::</span><span class="na">factory</span><span class="p">(</span>
                    <span class="p">[</span> <span class="s1">&#39;edits&#39;</span> <span class="o">=&gt;</span> <span class="nv">$edits</span><span class="p">,</span> <span class="s1">&#39;articles&#39;</span> <span class="o">=&gt;</span> <span class="nv">$good</span><span class="p">,</span> <span class="s1">&#39;pages&#39;</span> <span class="o">=&gt;</span> <span class="nv">$pages</span> <span class="p">]</span>
            <span class="p">)</span> <span class="p">);</span>
</pre></div>
</div>
</div>
<div class="section" id="case-dolibarr-structures-casttoboolean">
<span id="id194"></span><h4><span class="section-number">5.2.149.2. </span>Dolibarr<a class="headerlink" href="#case-dolibarr-structures-casttoboolean" title="Permalink to this headline">¶</a></h4>
<p><a class="reference internal" href="Rules.html#cast-to-boolean"><span class="std std-ref">Cast To Boolean</span></a>, in htdocs/societe/class/societe.class.php:2777.</p>
<p>Several cases are built on the same pattern there. Each of the expression may be replaced by a cast to <code class="docutils literal notranslate"><span class="pre">(bool)</span></code>.</p>
<div class="highlight-php notranslate"><div class="highlight"><pre><span></span><span class="k">case</span> <span class="mi">3</span><span class="o">:</span>
                            <span class="nv">$ret</span><span class="o">=</span><span class="p">(</span><span class="o">!</span><span class="nv">$conf</span><span class="o">-&gt;</span><span class="na">global</span><span class="o">-&gt;</span><span class="na">SOCIETE_IDPROF3_UNIQUE</span><span class="o">?</span><span class="k">false</span><span class="o">:</span><span class="k">true</span><span class="p">);</span>
                            <span class="k">break</span><span class="p">;</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="catch-overwrite-variable">
<span id="case-catch-overwrite-variable"></span><h3><span class="section-number">5.2.150. </span>Catch Overwrite Variable<a class="headerlink" href="#catch-overwrite-variable" title="Permalink to this headline">¶</a></h3>
<div class="section" id="case-phpipam-structures-catchshadowsvariable">
<span id="id195"></span><h4><span class="section-number">5.2.150.1. </span>PhpIPAM<a class="headerlink" href="#case-phpipam-structures-catchshadowsvariable" title="Permalink to this headline">¶</a></h4>
<p><a class="reference internal" href="Rules.html#catch-overwrite-variable"><span class="std std-ref">Catch Overwrite Variable</span></a>, in app/subnets/scan/subnet-scan-snmp-route.php:58.</p>
<p>$e is used both as ‘local’ variable : it is local to the catch clause, and it is a blind variable in a foreach(). There is little overlap between the two occurrences, but one reader may wonder why the caught exception is shown later on.</p>
<div class="highlight-php notranslate"><div class="highlight"><pre><span></span><span class="k">try</span> <span class="p">{</span>
        <span class="nv">$res</span> <span class="o">=</span> <span class="nv">$Snmp</span><span class="o">-&gt;</span><span class="na">get_query</span><span class="p">(</span><span class="nx">get_routing_table</span><span class="p">);</span>
        <span class="c1">// remove those not in subnet</span>
        <span class="k">if</span> <span class="p">(</span><span class="nb">sizeof</span><span class="p">(</span><span class="nv">$res</span><span class="p">)</span><span class="o">&gt;</span><span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
           <span class="c1">// save for debug</span>
           <span class="nv">$debug</span><span class="p">[</span><span class="nv">$d</span><span class="o">-&gt;</span><span class="na">hostname</span><span class="p">][</span><span class="nv">$q</span><span class="p">]</span> <span class="o">=</span> <span class="nv">$res</span><span class="p">;</span>

           <span class="c1">// save result</span>
           <span class="nv">$found</span><span class="p">[</span><span class="nv">$d</span><span class="o">-&gt;</span><span class="na">id</span><span class="p">][</span><span class="nv">$q</span><span class="p">]</span> <span class="o">=</span> <span class="nv">$res</span><span class="p">;</span>
        <span class="p">}</span>
    <span class="p">}</span> <span class="k">catch</span> <span class="p">(</span><span class="nx">Exception</span> <span class="nv">$e</span><span class="p">)</span> <span class="p">{</span>
       <span class="c1">// save for debug</span>
       <span class="nv">$debug</span><span class="p">[</span><span class="nv">$d</span><span class="o">-&gt;</span><span class="na">hostname</span><span class="p">][</span><span class="nv">$q</span><span class="p">]</span> <span class="o">=</span> <span class="nv">$res</span><span class="p">;</span>
       <span class="nv">$errors</span><span class="p">[]</span> <span class="o">=</span> <span class="nv">$e</span><span class="o">-&gt;</span><span class="na">getMessage</span><span class="p">();</span>
    <span class="p">}</span>

<span class="c1">// lots of code</span>
<span class="c1">// on line 132</span>
    <span class="c1">// print errors</span>
    <span class="k">if</span> <span class="p">(</span><span class="nb">isset</span><span class="p">(</span><span class="nv">$errors</span><span class="p">))</span> <span class="p">{</span>
        <span class="k">print</span> <span class="o">&lt;</span><span class="nx">hr</span><span class="o">&gt;</span><span class="p">;</span>
        <span class="k">foreach</span> <span class="p">(</span><span class="nv">$errors</span> <span class="k">as</span> <span class="nv">$e</span><span class="p">)</span> <span class="p">{</span>
            <span class="k">print</span> <span class="nv">$Result</span><span class="o">-&gt;</span><span class="na">show</span> <span class="p">(</span><span class="nx">warning</span><span class="p">,</span> <span class="nv">$e</span><span class="p">,</span> <span class="k">false</span><span class="p">,</span> <span class="k">false</span><span class="p">,</span> <span class="k">true</span><span class="p">);</span>
        <span class="p">}</span>
    <span class="p">}</span>
</pre></div>
</div>
</div>
<div class="section" id="case-suitecrm-structures-catchshadowsvariable">
<span id="id196"></span><h4><span class="section-number">5.2.150.2. </span>SuiteCrm<a class="headerlink" href="#case-suitecrm-structures-catchshadowsvariable" title="Permalink to this headline">¶</a></h4>
<p><a class="reference internal" href="Rules.html#catch-overwrite-variable"><span class="std std-ref">Catch Overwrite Variable</span></a>, in modules/Emails/EmailUIAjax.php:1082.</p>
<p>$e starts as an Email(), in the ‘getMultipleMessagesFromSugar’ case, while a few lines later, in ‘refreshSugarFolders’, $e is now an exception. Breaks are in place, so both occurrences are separated, yet, one may wonder why an email is a warning, or a mail is a warning.</p>
<div class="highlight-php notranslate"><div class="highlight"><pre><span></span><span class="c1">// On line 900, $e is a Email</span>
        <span class="k">case</span> <span class="nx">getMultipleMessagesFromSugar</span><span class="o">:</span>
            <span class="nv">$GLOBALS</span><span class="p">[</span><span class="s1">&#39;log&#39;</span><span class="p">]</span><span class="o">-&gt;</span><span class="na">debug</span><span class="p">(</span><span class="o">**********</span> <span class="nx">EMAIL</span> <span class="mf">2.0</span> <span class="o">-</span> <span class="nx">Asynchronous</span> <span class="o">-</span> <span class="nx">at</span><span class="o">:</span> <span class="nx">getMultipleMessagesFromSugar</span><span class="p">);</span>
            <span class="k">if</span> <span class="p">(</span><span class="nb">isset</span><span class="p">(</span><span class="nv">$_REQUEST</span><span class="p">[</span><span class="s1">&#39;uid&#39;</span><span class="p">])</span> <span class="o">&amp;&amp;</span> <span class="o">!</span><span class="k">empty</span><span class="p">(</span><span class="nv">$_REQUEST</span><span class="p">[</span><span class="s1">&#39;uid&#39;</span><span class="p">]))</span> <span class="p">{</span>
                <span class="nv">$exIds</span> <span class="o">=</span> <span class="nb">explode</span><span class="p">(,,</span> <span class="nv">$_REQUEST</span><span class="p">[</span><span class="s1">&#39;uid&#39;</span><span class="p">]);</span>
                <span class="nv">$out</span> <span class="o">=</span> <span class="k">array</span><span class="p">();</span>

                <span class="k">foreach</span> <span class="p">(</span><span class="nv">$exIds</span> <span class="k">as</span> <span class="nv">$id</span><span class="p">)</span> <span class="p">{</span>
                    <span class="nv">$e</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Email</span><span class="p">();</span>
                    <span class="nv">$e</span><span class="o">-&gt;</span><span class="na">retrieve</span><span class="p">(</span><span class="nv">$id</span><span class="p">);</span>
                    <span class="nv">$e</span><span class="o">-&gt;</span><span class="na">description_html</span> <span class="o">=</span> <span class="nx">from_html</span><span class="p">(</span><span class="nv">$e</span><span class="o">-&gt;</span><span class="na">description_html</span><span class="p">);</span>
                    <span class="nv">$ie</span><span class="o">-&gt;</span><span class="na">email</span> <span class="o">=</span> <span class="nv">$e</span><span class="p">;</span>
                    <span class="nv">$out</span><span class="p">[]</span> <span class="o">=</span> <span class="nv">$ie</span><span class="o">-&gt;</span><span class="na">displayOneEmail</span><span class="p">(</span><span class="nv">$id</span><span class="p">,</span> <span class="nv">$_REQUEST</span><span class="p">[</span><span class="s1">&#39;mbox&#39;</span><span class="p">]);</span>
                <span class="p">}</span>

                <span class="k">echo</span> <span class="nv">$json</span><span class="o">-&gt;</span><span class="na">encode</span><span class="p">(</span><span class="nv">$out</span><span class="p">);</span>
            <span class="p">}</span>

            <span class="k">break</span><span class="p">;</span>


<span class="c1">// lots of code</span>
<span class="c1">// on line 1082</span>
        <span class="k">case</span> <span class="nx">refreshSugarFolders</span><span class="o">:</span>
            <span class="k">try</span> <span class="p">{</span>
                <span class="nv">$GLOBALS</span><span class="p">[</span><span class="s1">&#39;log&#39;</span><span class="p">]</span><span class="o">-&gt;</span><span class="na">debug</span><span class="p">(</span><span class="o">**********</span> <span class="nx">EMAIL</span> <span class="mf">2.0</span> <span class="o">-</span> <span class="nx">Asynchronous</span> <span class="o">-</span> <span class="nx">at</span><span class="o">:</span> <span class="nx">refreshSugarFolders</span><span class="p">);</span>
                <span class="nv">$rootNode</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">ExtNode</span><span class="p">(</span><span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">);</span>
                <span class="nv">$folderOpenState</span> <span class="o">=</span> <span class="nv">$current_user</span><span class="o">-&gt;</span><span class="na">getPreference</span><span class="p">(</span><span class="s1">&#39;folderOpenState&#39;</span><span class="p">,</span> <span class="s1">&#39;Emails&#39;</span><span class="p">);</span>
                <span class="nv">$folderOpenState</span> <span class="o">=</span> <span class="p">(</span><span class="k">empty</span><span class="p">(</span><span class="nv">$folderOpenState</span><span class="p">))</span> <span class="o">?</span>  <span class="o">:</span> <span class="nv">$folderOpenState</span><span class="p">;</span>
                <span class="nv">$ret</span> <span class="o">=</span> <span class="nv">$email</span><span class="o">-&gt;</span><span class="na">et</span><span class="o">-&gt;</span><span class="na">folder</span><span class="o">-&gt;</span><span class="na">getUserFolders</span><span class="p">(</span>
                    <span class="nv">$rootNode</span><span class="p">,</span>
                    <span class="nx">sugar_unserialize</span><span class="p">(</span><span class="nv">$folderOpenState</span><span class="p">),</span>
                    <span class="nv">$current_user</span><span class="p">,</span>
                    <span class="k">true</span>
                <span class="p">);</span>
                <span class="nv">$out</span> <span class="o">=</span> <span class="nv">$json</span><span class="o">-&gt;</span><span class="na">encode</span><span class="p">(</span><span class="nv">$ret</span><span class="p">);</span>
                <span class="k">echo</span> <span class="nv">$out</span><span class="p">;</span>
            <span class="p">}</span> <span class="k">catch</span> <span class="p">(</span><span class="nx">SugarFolderEmptyException</span> <span class="nv">$e</span><span class="p">)</span> <span class="p">{</span>
                <span class="nv">$GLOBALS</span><span class="p">[</span><span class="s1">&#39;log&#39;</span><span class="p">]</span><span class="o">-&gt;</span><span class="na">warn</span><span class="p">(</span><span class="nv">$e</span><span class="p">);</span>
                <span class="nv">$out</span> <span class="o">=</span> <span class="nv">$json</span><span class="o">-&gt;</span><span class="na">encode</span><span class="p">(</span><span class="k">array</span><span class="p">(</span>
                    <span class="s1">&#39;message&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;No folder selected warning message here...&#39;</span><span class="p">,</span>
                <span class="p">));</span>
                <span class="k">echo</span> <span class="nv">$out</span><span class="p">;</span>
            <span class="p">}</span>
            <span class="k">break</span><span class="p">;</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="check-all-types">
<span id="case-check-all-types"></span><h3><span class="section-number">5.2.151. </span>Check All Types<a class="headerlink" href="#check-all-types" title="Permalink to this headline">¶</a></h3>
<div class="section" id="case-zend-config-structures-checkalltypes">
<span id="id197"></span><h4><span class="section-number">5.2.151.1. </span>Zend-Config<a class="headerlink" href="#case-zend-config-structures-checkalltypes" title="Permalink to this headline">¶</a></h4>
<p><a class="reference internal" href="Rules.html#check-all-types"><span class="std std-ref">Check All Types</span></a>, in src/Writer/Ini.php:122.</p>
<p>$value must be an array or a string here.</p>
<div class="highlight-php notranslate"><div class="highlight"><pre><span></span><span class="k">foreach</span> <span class="p">(</span><span class="nv">$config</span> <span class="k">as</span> <span class="nv">$key</span> <span class="o">=&gt;</span> <span class="nv">$value</span><span class="p">)</span> <span class="p">{</span>
            <span class="nv">$group</span> <span class="o">=</span> <span class="nb">array_merge</span><span class="p">(</span><span class="nv">$parents</span><span class="p">,</span> <span class="p">[</span><span class="nv">$key</span><span class="p">]);</span>

            <span class="k">if</span> <span class="p">(</span><span class="nb">is_array</span><span class="p">(</span><span class="nv">$value</span><span class="p">))</span> <span class="p">{</span>
                <span class="nv">$iniString</span> <span class="o">.=</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">addBranch</span><span class="p">(</span><span class="nv">$value</span><span class="p">,</span> <span class="nv">$group</span><span class="p">);</span>
            <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
                <span class="nv">$iniString</span> <span class="o">.=</span> <span class="nb">implode</span><span class="p">(</span><span class="nv">$this</span><span class="o">-&gt;</span><span class="na">nestSeparator</span><span class="p">,</span> <span class="nv">$group</span><span class="p">)</span>
                           <span class="o">.</span>  <span class="s1">&#39; = &#39;</span>
                           <span class="o">.</span>  <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">prepareValue</span><span class="p">(</span><span class="nv">$value</span><span class="p">)</span>
                           <span class="o">.</span>  <span class="nx">\n</span><span class="p">;</span>
            <span class="p">}</span>
        <span class="p">}</span>
</pre></div>
</div>
</div>
<div class="section" id="case-vanilla-structures-checkalltypes">
<span id="id198"></span><h4><span class="section-number">5.2.151.2. </span>Vanilla<a class="headerlink" href="#case-vanilla-structures-checkalltypes" title="Permalink to this headline">¶</a></h4>
<p><a class="reference internal" href="Rules.html#check-all-types"><span class="std std-ref">Check All Types</span></a>, in library/core/class.form.php:2488.</p>
<p>When $this-&gt;_FormValues is not null, then it is an array or an object, as it may be used immediately with foreach(). A check with is_array() would be a stronger option here.</p>
<div class="highlight-php notranslate"><div class="highlight"><pre><span></span><span class="k">public</span> <span class="k">function</span> <span class="nf">formDataSet</span><span class="p">()</span> <span class="p">{</span>
        <span class="k">if</span> <span class="p">(</span><span class="nb">is_null</span><span class="p">(</span><span class="nv">$this</span><span class="o">-&gt;</span><span class="na">_FormValues</span><span class="p">))</span> <span class="p">{</span>
            <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">formValues</span><span class="p">();</span>
        <span class="p">}</span>

        <span class="nv">$result</span> <span class="o">=</span> <span class="p">[[]];</span>
        <span class="k">foreach</span> <span class="p">(</span><span class="nv">$this</span><span class="o">-&gt;</span><span class="na">_FormValues</span> <span class="k">as</span> <span class="nv">$key</span> <span class="o">=&gt;</span> <span class="nv">$value</span><span class="p">)</span> <span class="p">{</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="check-json">
<span id="case-check-json"></span><h3><span class="section-number">5.2.152. </span>Check JSON<a class="headerlink" href="#check-json" title="Permalink to this headline">¶</a></h3>
<div class="section" id="case-woocommerce-structures-checkjson">
<span id="id199"></span><h4><span class="section-number">5.2.152.1. </span>Woocommerce<a class="headerlink" href="#case-woocommerce-structures-checkjson" title="Permalink to this headline">¶</a></h4>
<p><a class="reference internal" href="Rules.html#check-json"><span class="std std-ref">Check JSON</span></a>, in includes/admin/helper/class-wc-helper-plugin-info.php:66.</p>
<p>In case the body is an empty string, this will be correctly decoded, but will yield an object with an empty-named property.</p>
<div class="highlight-php notranslate"><div class="highlight"><pre><span></span><span class="nv">$results</span> <span class="o">=</span> <span class="nb">json_decode</span><span class="p">(</span> <span class="nx">wp_remote_retrieve_body</span><span class="p">(</span> <span class="nv">$request</span> <span class="p">),</span> <span class="k">true</span> <span class="p">);</span>
            <span class="k">if</span> <span class="p">(</span> <span class="o">!</span> <span class="k">empty</span><span class="p">(</span> <span class="nv">$results</span> <span class="p">)</span> <span class="p">)</span> <span class="p">{</span>
                    <span class="nv">$response</span> <span class="o">=</span> <span class="p">(</span><span class="nx">object</span><span class="p">)</span> <span class="nv">$results</span><span class="p">;</span>
            <span class="p">}</span>

            <span class="k">return</span> <span class="nv">$response</span><span class="p">;</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="common-alternatives">
<span id="case-common-alternatives"></span><h3><span class="section-number">5.2.153. </span>Common Alternatives<a class="headerlink" href="#common-alternatives" title="Permalink to this headline">¶</a></h3>
<div class="section" id="case-dolibarr-structures-commonalternatives">
<span id="id200"></span><h4><span class="section-number">5.2.153.1. </span>Dolibarr<a class="headerlink" href="#case-dolibarr-structures-commonalternatives" title="Permalink to this headline">¶</a></h4>
<p><a class="reference internal" href="Rules.html#common-alternatives"><span class="std std-ref">Common Alternatives</span></a>, in htdocs/admin/facture.php:531.</p>
<p>The opening an closing tag couldd be moved outside the if condition : they are compulsory in both cases.</p>
<div class="highlight-php notranslate"><div class="highlight"><pre><span></span><span class="c1">// Active</span>
                                <span class="k">if</span> <span class="p">(</span><span class="nb">in_array</span><span class="p">(</span><span class="nv">$name</span><span class="p">,</span> <span class="nv">$def</span><span class="p">))</span>
                                <span class="p">{</span>
                                    <span class="k">print</span> <span class="s1">&#39;&lt;td class=&quot;center&quot;&gt;&#39;</span><span class="o">.</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">;</span>
                                    <span class="k">print</span> <span class="s1">&#39;&lt;a href=&quot;&#39;</span><span class="o">.</span><span class="nv">$_SERVER</span><span class="p">[</span><span class="s2">&quot;PHP_SELF&quot;</span><span class="p">]</span><span class="o">.</span><span class="s1">&#39;?action=del&amp;value=&#39;</span><span class="o">.</span><span class="nv">$name</span><span class="o">.</span><span class="s1">&#39;&quot;&gt;&#39;</span><span class="p">;</span>
                                    <span class="k">print</span> <span class="nx">img_picto</span><span class="p">(</span><span class="nv">$langs</span><span class="o">-&gt;</span><span class="na">trans</span><span class="p">(</span><span class="s2">&quot;Enabled&quot;</span><span class="p">),</span> <span class="s1">&#39;switch_on&#39;</span><span class="p">);</span>
                                    <span class="k">print</span> <span class="s1">&#39;&lt;/a&gt;&#39;</span><span class="p">;</span>
                                    <span class="k">print</span> <span class="s1">&#39;&lt;/td&gt;&#39;</span><span class="p">;</span>
                                <span class="p">}</span>
                                <span class="k">else</span>
                                <span class="p">{</span>
                                    <span class="k">print</span> <span class="s1">&#39;&lt;td class=center\&gt;&#39;</span><span class="o">.</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">;</span>
                                    <span class="k">print</span> <span class="s1">&#39;&lt;a href=&quot;&#39;</span><span class="o">.</span><span class="nv">$_SERVER</span><span class="p">[</span><span class="s2">&quot;PHP_SELF&quot;</span><span class="p">]</span><span class="o">.</span><span class="s1">&#39;?action=set&amp;value=&#39;</span><span class="o">.</span><span class="nv">$name</span><span class="o">.</span><span class="s1">&#39;&amp;scan_dir=&#39;</span><span class="o">.</span><span class="nv">$module</span><span class="o">-&gt;</span><span class="na">scandir</span><span class="o">.</span><span class="s1">&#39;&amp;label=&#39;</span><span class="o">.</span><span class="nb">urlencode</span><span class="p">(</span><span class="nv">$module</span><span class="o">-&gt;</span><span class="na">name</span><span class="p">)</span><span class="o">.</span><span class="s1">&#39;&quot;&gt;&#39;</span><span class="o">.</span><span class="nx">img_picto</span><span class="p">(</span><span class="nv">$langs</span><span class="o">-&gt;</span><span class="na">trans</span><span class="p">(</span><span class="s2">&quot;SetAsDefault&quot;</span><span class="p">),</span> <span class="s1">&#39;switch_off&#39;</span><span class="p">)</span><span class="o">.</span><span class="s1">&#39;&lt;/a&gt;&#39;</span><span class="p">;</span>
                                    <span class="k">print</span> <span class="s2">&quot;&lt;/td&gt;&quot;</span><span class="p">;</span>
                                <span class="p">}</span>
</pre></div>
</div>
</div>
<div class="section" id="case-nextcloud-structures-commonalternatives">
<span id="id201"></span><h4><span class="section-number">5.2.153.2. </span>NextCloud<a class="headerlink" href="#case-nextcloud-structures-commonalternatives" title="Permalink to this headline">¶</a></h4>
<p><a class="reference internal" href="Rules.html#common-alternatives"><span class="std std-ref">Common Alternatives</span></a>, in apps/encryption/lib/KeyManager.php:436.</p>
<p><cite>$shareKey = $this-&gt;getShareKey($path, $uid);</cite> is common to all three alternatives. In fact, <cite>$uid = $this-&gt;getPublicShareKeyId();</cite> is not common, and that shoul de reviewed, as <cite>$uid</cite> will be undefined.</p>
<div class="highlight-php notranslate"><div class="highlight"><pre><span></span><span class="k">if</span> <span class="p">(</span><span class="nv">$this</span><span class="o">-&gt;</span><span class="na">util</span><span class="o">-&gt;</span><span class="na">isMasterKeyEnabled</span><span class="p">())</span> <span class="p">{</span>
                    <span class="nv">$uid</span> <span class="o">=</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">getMasterKeyId</span><span class="p">();</span>
                    <span class="nv">$shareKey</span> <span class="o">=</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">getShareKey</span><span class="p">(</span><span class="nv">$path</span><span class="p">,</span> <span class="nv">$uid</span><span class="p">);</span>
                    <span class="k">if</span> <span class="p">(</span><span class="nv">$publicAccess</span><span class="p">)</span> <span class="p">{</span>
                            <span class="nv">$privateKey</span> <span class="o">=</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">getSystemPrivateKey</span><span class="p">(</span><span class="nv">$uid</span><span class="p">);</span>
                            <span class="nv">$privateKey</span> <span class="o">=</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">crypt</span><span class="o">-&gt;</span><span class="na">decryptPrivateKey</span><span class="p">(</span><span class="nv">$privateKey</span><span class="p">,</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">getMasterKeyPassword</span><span class="p">(),</span> <span class="nv">$uid</span><span class="p">);</span>
                    <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
                            <span class="c1">// when logged in, the master key is already decrypted in the session</span>
                            <span class="nv">$privateKey</span> <span class="o">=</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">session</span><span class="o">-&gt;</span><span class="na">getPrivateKey</span><span class="p">();</span>
                    <span class="p">}</span>
            <span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="nv">$publicAccess</span><span class="p">)</span> <span class="p">{</span>
                    <span class="c1">// use public share key for public links</span>
                    <span class="nv">$uid</span> <span class="o">=</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">getPublicShareKeyId</span><span class="p">();</span>
                    <span class="nv">$shareKey</span> <span class="o">=</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">getShareKey</span><span class="p">(</span><span class="nv">$path</span><span class="p">,</span> <span class="nv">$uid</span><span class="p">);</span>
                    <span class="nv">$privateKey</span> <span class="o">=</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">keyStorage</span><span class="o">-&gt;</span><span class="na">getSystemUserKey</span><span class="p">(</span><span class="nv">$this</span><span class="o">-&gt;</span><span class="na">publicShareKeyId</span> <span class="o">.</span> <span class="s1">&#39;.privateKey&#39;</span><span class="p">,</span> <span class="nx">Encryption</span><span class="o">::</span><span class="na">ID</span><span class="p">);</span>
                    <span class="nv">$privateKey</span> <span class="o">=</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">crypt</span><span class="o">-&gt;</span><span class="na">decryptPrivateKey</span><span class="p">(</span><span class="nv">$privateKey</span><span class="p">);</span>
            <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
                    <span class="nv">$shareKey</span> <span class="o">=</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">getShareKey</span><span class="p">(</span><span class="nv">$path</span><span class="p">,</span> <span class="nv">$uid</span><span class="p">);</span>
                    <span class="nv">$privateKey</span> <span class="o">=</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">session</span><span class="o">-&gt;</span><span class="na">getPrivateKey</span><span class="p">();</span>
            <span class="p">}</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="continue-is-for-loop">
<span id="case-continue-is-for-loop"></span><h3><span class="section-number">5.2.154. </span>Continue Is For Loop<a class="headerlink" href="#continue-is-for-loop" title="Permalink to this headline">¶</a></h3>
<div class="section" id="case-xoops-structures-continueisforloop">
<span id="id202"></span><h4><span class="section-number">5.2.154.1. </span>XOOPS<a class="headerlink" href="#case-xoops-structures-continueisforloop" title="Permalink to this headline">¶</a></h4>
<p><a class="reference internal" href="Rules.html#continue-is-for-loop"><span class="std std-ref">Continue Is For Loop</span></a>, in htdocs/kernel/object.php:711.</p>
<p>break is used here for cases, unless the case includes a if/then structures, in which it becomes a continue. It really should be a break.</p>
<div class="highlight-php notranslate"><div class="highlight"><pre><span></span><span class="k">foreach</span> <span class="p">(</span><span class="nv">$this</span><span class="o">-&gt;</span><span class="na">vars</span> <span class="k">as</span> <span class="nv">$k</span> <span class="o">=&gt;</span> <span class="nv">$v</span><span class="p">)</span> <span class="p">{</span>
            <span class="nv">$cleanv</span> <span class="o">=</span> <span class="nv">$v</span><span class="p">[</span><span class="s1">&#39;value&#39;</span><span class="p">];</span>
            <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nv">$v</span><span class="p">[</span><span class="s1">&#39;changed&#39;</span><span class="p">])</span> <span class="p">{</span>
            <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
                <span class="nv">$cleanv</span> <span class="o">=</span> <span class="nb">is_string</span><span class="p">(</span><span class="nv">$cleanv</span><span class="p">)</span> <span class="o">?</span> <span class="nb">trim</span><span class="p">(</span><span class="nv">$cleanv</span><span class="p">)</span> <span class="o">:</span> <span class="nv">$cleanv</span><span class="p">;</span>
                <span class="k">switch</span> <span class="p">(</span><span class="nv">$v</span><span class="p">[</span><span class="s1">&#39;data_type&#39;</span><span class="p">])</span> <span class="p">{</span>
                    <span class="k">case</span> <span class="nx">XOBJ_DTYPE_TIMESTAMP</span><span class="o">:</span>
                        <span class="nv">$cleanv</span> <span class="o">=</span> <span class="o">!</span><span class="nb">is_string</span><span class="p">(</span><span class="nv">$cleanv</span><span class="p">)</span> <span class="o">&amp;&amp;</span> <span class="nb">is_numeric</span><span class="p">(</span><span class="nv">$cleanv</span><span class="p">)</span> <span class="o">?</span> <span class="nb">date</span><span class="p">(</span><span class="nx">_DBTIMESTAMPSTRING</span><span class="p">,</span> <span class="nv">$cleanv</span><span class="p">)</span> <span class="o">:</span> <span class="nb">date</span><span class="p">(</span><span class="nx">_DBTIMESTAMPSTRING</span><span class="p">,</span> <span class="nb">strtotime</span><span class="p">(</span><span class="nv">$cleanv</span><span class="p">));</span>
                        <span class="k">break</span><span class="p">;</span>
                    <span class="k">case</span> <span class="nx">XOBJ_DTYPE_TIME</span><span class="o">:</span>
                        <span class="nv">$cleanv</span> <span class="o">=</span> <span class="o">!</span><span class="nb">is_string</span><span class="p">(</span><span class="nv">$cleanv</span><span class="p">)</span> <span class="o">&amp;&amp;</span> <span class="nb">is_numeric</span><span class="p">(</span><span class="nv">$cleanv</span><span class="p">)</span> <span class="o">?</span> <span class="nb">date</span><span class="p">(</span><span class="nx">_DBTIMESTRING</span><span class="p">,</span> <span class="nv">$cleanv</span><span class="p">)</span> <span class="o">:</span> <span class="nb">date</span><span class="p">(</span><span class="nx">_DBTIMESTRING</span><span class="p">,</span> <span class="nb">strtotime</span><span class="p">(</span><span class="nv">$cleanv</span><span class="p">));</span>
                        <span class="k">break</span><span class="p">;</span>
                    <span class="k">case</span> <span class="nx">XOBJ_DTYPE_DATE</span><span class="o">:</span>
                        <span class="nv">$cleanv</span> <span class="o">=</span> <span class="o">!</span><span class="nb">is_string</span><span class="p">(</span><span class="nv">$cleanv</span><span class="p">)</span> <span class="o">&amp;&amp;</span> <span class="nb">is_numeric</span><span class="p">(</span><span class="nv">$cleanv</span><span class="p">)</span> <span class="o">?</span> <span class="nb">date</span><span class="p">(</span><span class="nx">_DBDATESTRING</span><span class="p">,</span> <span class="nv">$cleanv</span><span class="p">)</span> <span class="o">:</span> <span class="nb">date</span><span class="p">(</span><span class="nx">_DBDATESTRING</span><span class="p">,</span> <span class="nb">strtotime</span><span class="p">(</span><span class="nv">$cleanv</span><span class="p">));</span>
                        <span class="k">break</span><span class="p">;</span>
                    <span class="k">case</span> <span class="nx">XOBJ_DTYPE_TXTBOX</span><span class="o">:</span>
                        <span class="k">if</span> <span class="p">(</span><span class="nv">$v</span><span class="p">[</span><span class="s1">&#39;required&#39;</span><span class="p">]</span> <span class="o">&amp;&amp;</span> <span class="nv">$cleanv</span> <span class="o">!=</span> <span class="s1">&#39;0&#39;</span> <span class="o">&amp;&amp;</span> <span class="nv">$cleanv</span> <span class="o">==</span> <span class="s1">&#39;&#39;</span><span class="p">)</span> <span class="p">{</span>
                            <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">setErrors</span><span class="p">(</span><span class="nb">sprintf</span><span class="p">(</span><span class="nx">_XOBJ_ERR_REQUIRED</span><span class="p">,</span> <span class="nv">$k</span><span class="p">));</span>
                            <span class="k">continue</span> <span class="mi">2</span><span class="p">;</span>
                        <span class="p">}</span>
                        <span class="k">if</span> <span class="p">(</span><span class="nb">isset</span><span class="p">(</span><span class="nv">$v</span><span class="p">[</span><span class="s1">&#39;maxlength&#39;</span><span class="p">])</span> <span class="o">&amp;&amp;</span> <span class="nb">strlen</span><span class="p">(</span><span class="nv">$cleanv</span><span class="p">)</span> <span class="o">&gt;</span> <span class="p">(</span><span class="nx">int</span><span class="p">)</span><span class="nv">$v</span><span class="p">[</span><span class="s1">&#39;maxlength&#39;</span><span class="p">])</span> <span class="p">{</span>
                            <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">setErrors</span><span class="p">(</span><span class="nb">sprintf</span><span class="p">(</span><span class="nx">_XOBJ_ERR_SHORTERTHAN</span><span class="p">,</span> <span class="nv">$k</span><span class="p">,</span> <span class="p">(</span><span class="nx">int</span><span class="p">)</span><span class="nv">$v</span><span class="p">[</span><span class="s1">&#39;maxlength&#39;</span><span class="p">]));</span>
                            <span class="k">continue</span> <span class="mi">2</span><span class="p">;</span>
                        <span class="p">}</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="could-be-else">
<span id="case-could-be-else"></span><h3><span class="section-number">5.2.155. </span>Could Be Else<a class="headerlink" href="#could-be-else" title="Permalink to this headline">¶</a></h3>
<div class="section" id="case-sugarcrm-structures-couldbeelse">
<span id="id203"></span><h4><span class="section-number">5.2.155.1. </span>SugarCrm<a class="headerlink" href="#case-sugarcrm-structures-couldbeelse" title="Permalink to this headline">¶</a></h4>
<p><a class="reference internal" href="Rules.html#could-be-else"><span class="std std-ref">Could Be Else</span></a>, in SugarCE-Full-6.5.26/modules/Emails/ListViewGroup.php:79.</p>
<p>The first condition makes different checks if ‘query’ is in $_REQUEST or not. The second only applies to $_REQUEST[‘query’], as there is no else. There is also no visible sign that the first condition may change $_REQUEST or not</p>
<div class="highlight-php notranslate"><div class="highlight"><pre><span></span><span class="k">if</span><span class="p">(</span><span class="o">!</span><span class="nb">isset</span><span class="p">(</span><span class="nv">$_REQUEST</span><span class="p">[</span><span class="s1">&#39;query&#39;</span><span class="p">])){</span>
    <span class="c1">//_pp(&#39;loading: &#39;.$currentModule.&#39;Group&#39;);</span>
    <span class="c1">//_pp($current_user-&gt;user_preferences[$currentModule.&#39;GroupQ&#39;]);</span>
    <span class="nv">$storeQuery</span><span class="o">-&gt;</span><span class="na">loadQuery</span><span class="p">(</span><span class="nv">$currentModule</span><span class="o">.</span><span class="s1">&#39;Group&#39;</span><span class="p">);</span>
    <span class="nv">$storeQuery</span><span class="o">-&gt;</span><span class="na">populateRequest</span><span class="p">();</span>
<span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
    <span class="c1">//_pp($current_user-&gt;user_preferences[$currentModule.&#39;GroupQ&#39;]);</span>
    <span class="c1">//_pp(&#39;saving: &#39;.$currentModule.&#39;Group&#39;);</span>
    <span class="nv">$storeQuery</span><span class="o">-&gt;</span><span class="na">saveFromGet</span><span class="p">(</span><span class="nv">$currentModule</span><span class="o">.</span><span class="s1">&#39;Group&#39;</span><span class="p">);</span>
<span class="p">}</span>

<span class="k">if</span><span class="p">(</span><span class="nb">isset</span><span class="p">(</span><span class="nv">$_REQUEST</span><span class="p">[</span><span class="s1">&#39;query&#39;</span><span class="p">]))</span> <span class="p">{</span>
    <span class="c1">// we have a query</span>
    <span class="k">if</span><span class="p">(</span><span class="nb">isset</span><span class="p">(</span><span class="nv">$_REQUEST</span><span class="p">[</span><span class="s1">&#39;email_type&#39;</span><span class="p">]))</span>                              <span class="nv">$email_type</span> <span class="o">=</span> <span class="nv">$_REQUEST</span><span class="p">[</span><span class="s1">&#39;email_type&#39;</span><span class="p">];</span>
    <span class="k">if</span><span class="p">(</span><span class="nb">isset</span><span class="p">(</span><span class="nv">$_REQUEST</span><span class="p">[</span><span class="s1">&#39;assigned_to&#39;</span><span class="p">]))</span>                             <span class="nv">$assigned_to</span> <span class="o">=</span> <span class="nv">$_REQUEST</span><span class="p">[</span><span class="s1">&#39;assigned_to&#39;</span><span class="p">];</span>
    <span class="k">if</span><span class="p">(</span><span class="nb">isset</span><span class="p">(</span><span class="nv">$_REQUEST</span><span class="p">[</span><span class="s1">&#39;status&#39;</span><span class="p">]))</span>                                  <span class="nv">$status</span> <span class="o">=</span> <span class="nv">$_REQUEST</span><span class="p">[</span><span class="s1">&#39;status&#39;</span><span class="p">];</span>
    <span class="c1">// More code</span>
<span class="p">}</span>
</pre></div>
</div>
</div>
<div class="section" id="case-openemr-structures-couldbeelse">
<span id="id204"></span><h4><span class="section-number">5.2.155.2. </span>OpenEMR<a class="headerlink" href="#case-openemr-structures-couldbeelse" title="Permalink to this headline">¶</a></h4>
<p><a class="reference internal" href="Rules.html#could-be-else"><span class="std std-ref">Could Be Else</span></a>, in library/log.inc:653.</p>
<p>Those two if structure may definitely merged into one single instruction.</p>
<div class="highlight-php notranslate"><div class="highlight"><pre><span></span><span class="nv">$success</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>
    <span class="nv">$checksum</span> <span class="o">=</span> <span class="p">;</span>
    <span class="k">if</span> <span class="p">(</span><span class="nv">$outcome</span> <span class="o">===</span> <span class="k">false</span><span class="p">)</span> <span class="p">{</span>
        <span class="nv">$success</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="k">if</span> <span class="p">(</span><span class="nv">$outcome</span> <span class="o">!==</span> <span class="k">false</span><span class="p">)</span> <span class="p">{</span>
        <span class="c1">// Should use the $statement rather than the processed</span>
        <span class="c1">// variables, which includes the binded stuff. If do</span>
        <span class="c1">// indeed need the binded values, then will need</span>
        <span class="c1">// to include this as a separate array.</span>

        <span class="c1">//error_log(STATEMENT: .$statement,0);</span>
        <span class="c1">//error_log(BINDS: .$processed_binds,0);</span>
        <span class="nv">$checksum</span> <span class="o">=</span> <span class="nx">sql_checksum_of_modified_row</span><span class="p">(</span><span class="nv">$statement</span><span class="p">);</span>
        <span class="c1">//error_log(CHECKSUM: .$checksum,0);</span>
    <span class="p">}</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="could-be-static">
<span id="case-could-be-static"></span><h3><span class="section-number">5.2.156. </span>Could Be Static<a class="headerlink" href="#could-be-static" title="Permalink to this headline">¶</a></h3>
<div class="section" id="case-dolphin-structures-couldbestatic">
<span id="id205"></span><h4><span class="section-number">5.2.156.1. </span>Dolphin<a class="headerlink" href="#case-dolphin-structures-couldbestatic" title="Permalink to this headline">¶</a></h4>
<p><a class="reference internal" href="Rules.html#could-be-static"><span class="std std-ref">Could Be Static</span></a>, in inc/utils.inc.php:673.</p>
<p>Dolphin pro relies on HTMLPurifier to handle cleaning of values : it is used to prevent xss threat. In this method, oHtmlPurifier is first checked, and if needed, created. Since creation is long and costly, it is only created once. Once the object is created, it is stored as a global to be accessible at the next call of the method. In fact, oHtmlPurifier is never used outside this method, so it could be turned into a ‘static’ variable, and prevent other methods to modify it. This is a typical example of variable that could be static instead of global.</p>
<div class="highlight-php notranslate"><div class="highlight"><pre><span></span><span class="k">function</span> <span class="nf">clear_xss</span><span class="p">(</span><span class="nv">$val</span><span class="p">)</span>
<span class="p">{</span>
    <span class="c1">// HTML Purifier plugin</span>
    <span class="k">global</span> <span class="nv">$oHtmlPurifier</span><span class="p">;</span>
    <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nb">isset</span><span class="p">(</span><span class="nv">$oHtmlPurifier</span><span class="p">)</span> <span class="o">&amp;&amp;</span> <span class="o">!</span><span class="nv">$GLOBALS</span><span class="p">[</span><span class="s1">&#39;logged&#39;</span><span class="p">][</span><span class="s1">&#39;admin&#39;</span><span class="p">])</span> <span class="p">{</span>

        <span class="k">require_once</span><span class="p">(</span><span class="nx">BX_DIRECTORY_PATH_PLUGINS</span> <span class="o">.</span> <span class="s1">&#39;htmlpurifier/HTMLPurifier.standalone.php&#39;</span><span class="p">);</span>

<span class="o">/..../</span>

        <span class="nv">$oHtmlPurifier</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">HTMLPurifier</span><span class="p">(</span><span class="nv">$oConfig</span><span class="p">);</span>
    <span class="p">}</span>

    <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nv">$GLOBALS</span><span class="p">[</span><span class="s1">&#39;logged&#39;</span><span class="p">][</span><span class="s1">&#39;admin&#39;</span><span class="p">])</span> <span class="p">{</span>
        <span class="nv">$val</span> <span class="o">=</span> <span class="nv">$oHtmlPurifier</span><span class="o">-&gt;</span><span class="na">purify</span><span class="p">(</span><span class="nv">$val</span><span class="p">);</span>
    <span class="p">}</span>

    <span class="nv">$oZ</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">BxDolAlerts</span><span class="p">(</span><span class="s1">&#39;system&#39;</span><span class="p">,</span> <span class="s1">&#39;clear_xss&#39;</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span>
        <span class="k">array</span><span class="p">(</span><span class="s1">&#39;oHtmlPurifier&#39;</span> <span class="o">=&gt;</span> <span class="nv">$oHtmlPurifier</span><span class="p">,</span> <span class="s1">&#39;return_data&#39;</span> <span class="o">=&gt;</span> <span class="o">&amp;</span><span class="nv">$val</span><span class="p">));</span>
    <span class="nv">$oZ</span><span class="o">-&gt;</span><span class="na">alert</span><span class="p">();</span>

    <span class="k">return</span> <span class="nv">$val</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>
</div>
</div>
<div class="section" id="case-contao-structures-couldbestatic">
<span id="id206"></span><h4><span class="section-number">5.2.156.2. </span>Contao<a class="headerlink" href="#case-contao-structures-couldbestatic" title="Permalink to this headline">¶</a></h4>
<p><a class="reference internal" href="Rules.html#could-be-static"><span class="std std-ref">Could Be Static</span></a>, in system/helper/functions.php:184.</p>
<p>$arrScanCache is a typical cache variables. It is set as global for persistence between calls. If it contains an already stored answer, it is returned immediately. If it is not set yet, it is then filled with a value, and later reused. This global could be turned into static, and avoid pollution of global space.</p>
<div class="highlight-php notranslate"><div class="highlight"><pre><span></span><span class="k">function</span> <span class="nf">scan</span><span class="p">(</span><span class="nv">$strFolder</span><span class="p">,</span> <span class="nv">$blnUncached</span><span class="o">=</span><span class="k">false</span><span class="p">)</span>
<span class="p">{</span>
    <span class="k">global</span> <span class="nv">$arrScanCache</span><span class="p">;</span>

    <span class="c1">// Add a trailing slash</span>
    <span class="k">if</span> <span class="p">(</span><span class="nb">substr</span><span class="p">(</span><span class="nv">$strFolder</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span> <span class="o">!=</span> <span class="s1">&#39;/&#39;</span><span class="p">)</span>
    <span class="p">{</span>
            <span class="nv">$strFolder</span> <span class="o">.=</span> <span class="s1">&#39;/&#39;</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="c1">// Load from cache</span>
    <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nv">$blnUncached</span> <span class="o">&amp;&amp;</span> <span class="nb">isset</span><span class="p">(</span><span class="nv">$arrScanCache</span><span class="p">[</span><span class="nv">$strFolder</span><span class="p">]))</span>
    <span class="p">{</span>
            <span class="k">return</span> <span class="nv">$arrScanCache</span><span class="p">[</span><span class="nv">$strFolder</span><span class="p">];</span>
    <span class="p">}</span>
    <span class="nv">$arrReturn</span> <span class="o">=</span> <span class="k">array</span><span class="p">();</span>

    <span class="c1">// Scan directory</span>
    <span class="k">foreach</span> <span class="p">(</span><span class="nb">scandir</span><span class="p">(</span><span class="nv">$strFolder</span><span class="p">)</span> <span class="k">as</span> <span class="nv">$strFile</span><span class="p">)</span>
    <span class="p">{</span>
            <span class="k">if</span> <span class="p">(</span><span class="nv">$strFile</span> <span class="o">==</span> <span class="s1">&#39;.&#39;</span> <span class="o">||</span> <span class="nv">$strFile</span> <span class="o">==</span> <span class="s1">&#39;..&#39;</span><span class="p">)</span>
            <span class="p">{</span>
                    <span class="k">continue</span><span class="p">;</span>
            <span class="p">}</span>

            <span class="nv">$arrReturn</span><span class="p">[]</span> <span class="o">=</span> <span class="nv">$strFile</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="c1">// Cache the result</span>
    <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nv">$blnUncached</span><span class="p">)</span>
    <span class="p">{</span>
            <span class="nv">$arrScanCache</span><span class="p">[</span><span class="nv">$strFolder</span><span class="p">]</span> <span class="o">=</span> <span class="nv">$arrReturn</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="k">return</span> <span class="nv">$arrReturn</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="could-use-array-fill-keys">
<span id="case-could-use-array-fill-keys"></span><h3><span class="section-number">5.2.157. </span>Could Use array_fill_keys<a class="headerlink" href="#could-use-array-fill-keys" title="Permalink to this headline">¶</a></h3>
<div class="section" id="case-churchcrm-structures-couldusearrayfillkeys">
<span id="id207"></span><h4><span class="section-number">5.2.157.1. </span>ChurchCRM<a class="headerlink" href="#case-churchcrm-structures-couldusearrayfillkeys" title="Permalink to this headline">¶</a></h4>
<p><a class="reference internal" href="Rules.html#could-use-array-fill-keys"><span class="std std-ref">Could Use array_fill_keys</span></a>, in src/ManageEnvelopes.php:107.</p>
<p>There are two initialisations at the same time here : that should make two call to array_fill_keys().</p>
<div class="highlight-php notranslate"><div class="highlight"><pre><span></span><span class="k">foreach</span> <span class="p">(</span><span class="nv">$familyArray</span> <span class="k">as</span> <span class="nv">$fam_ID</span> <span class="o">=&gt;</span> <span class="nv">$fam_Data</span><span class="p">)</span> <span class="p">{</span>
        <span class="nv">$envelopesByFamID</span><span class="p">[</span><span class="nv">$fam_ID</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
        <span class="nv">$envelopesToWrite</span><span class="p">[</span><span class="nv">$fam_ID</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
    <span class="p">}</span>
</pre></div>
</div>
</div>
<div class="section" id="case-phpipam-structures-couldusearrayfillkeys">
<span id="id208"></span><h4><span class="section-number">5.2.157.2. </span>PhpIPAM<a class="headerlink" href="#case-phpipam-structures-couldusearrayfillkeys" title="Permalink to this headline">¶</a></h4>
<p><a class="reference internal" href="Rules.html#could-use-array-fill-keys"><span class="std std-ref">Could Use array_fill_keys</span></a>, in functions/scripts/merge_databases.php:418.</p>
<p>Even when the initialization is mixed with other operations, it is a good idea to extract it from the loop and give it to array_fill_keys().</p>
<div class="highlight-php notranslate"><div class="highlight"><pre><span></span><span class="nv">$arr_new</span> <span class="o">=</span> <span class="k">array</span><span class="p">();</span>
                            <span class="k">foreach</span> <span class="p">(</span><span class="nv">$arr</span> <span class="k">as</span> <span class="nv">$type</span><span class="o">=&gt;</span><span class="nv">$objects</span><span class="p">)</span> <span class="p">{</span>
                                    <span class="nv">$arr_new</span><span class="p">[</span><span class="nv">$type</span><span class="p">]</span> <span class="o">=</span> <span class="k">array</span><span class="p">();</span>
                                    <span class="k">if</span><span class="p">(</span><span class="nb">sizeof</span><span class="p">(</span><span class="nv">$objects</span><span class="p">)</span><span class="o">&gt;</span><span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
                                            <span class="k">foreach</span><span class="p">(</span><span class="nv">$objects</span> <span class="k">as</span> <span class="nv">$ok</span><span class="o">=&gt;</span><span class="nv">$object</span><span class="p">)</span> <span class="p">{</span>
                                                    <span class="nv">$arr_new</span><span class="p">[</span><span class="nv">$type</span><span class="p">][]</span> <span class="o">=</span> <span class="nv">$highest_ids_append</span><span class="p">[</span><span class="nv">$type</span><span class="p">]</span> <span class="o">+</span> <span class="nv">$object</span><span class="p">;</span>
                                            <span class="p">}</span>
                                    <span class="p">}</span>
                            <span class="p">}</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="could-use-array-unique">
<span id="case-could-use-array-unique"></span><h3><span class="section-number">5.2.158. </span>Could Use array_unique<a class="headerlink" href="#could-use-array-unique" title="Permalink to this headline">¶</a></h3>
<div class="section" id="case-dolibarr-structures-couldusearrayunique">
<span id="id209"></span><h4><span class="section-number">5.2.158.1. </span>Dolibarr<a class="headerlink" href="#case-dolibarr-structures-couldusearrayunique" title="Permalink to this headline">¶</a></h4>
<p><a class="reference internal" href="Rules.html#could-use-array-unique"><span class="std std-ref">Could Use array_unique</span></a>, in htdocs/includes/restler/framework/Luracast/Restler/Format/XmlFormat.php:250.</p>
<p>This loop has two distinct operations : the first collect keys and keep them unique. A combinaison of array_keys() and array_unique() would do that job, while saving the in_array() lookup, and the configuration check with ‘static::$importSettingsFromXml’. The second operation is distinct, and could be done with array_map().</p>
<div class="highlight-php notranslate"><div class="highlight"><pre><span></span><span class="nv">$attributes</span> <span class="o">=</span> <span class="nv">$xml</span><span class="o">-&gt;</span><span class="na">attributes</span><span class="p">();</span>
            <span class="k">foreach</span> <span class="p">(</span><span class="nv">$attributes</span> <span class="k">as</span> <span class="nv">$key</span> <span class="o">=&gt;</span> <span class="nv">$value</span><span class="p">)</span> <span class="p">{</span>
                <span class="k">if</span> <span class="p">(</span><span class="k">static</span><span class="o">::</span><span class="nv">$importSettingsFromXml</span>
                    <span class="o">&amp;&amp;</span> <span class="o">!</span><span class="nb">in_array</span><span class="p">(</span><span class="nv">$key</span><span class="p">,</span> <span class="k">static</span><span class="o">::</span><span class="nv">$attributeNames</span><span class="p">)</span>
                <span class="p">)</span> <span class="p">{</span>
                    <span class="k">static</span><span class="o">::</span><span class="nv">$attributeNames</span><span class="p">[]</span> <span class="o">=</span> <span class="nv">$key</span><span class="p">;</span>
                <span class="p">}</span>
                <span class="nv">$r</span><span class="p">[</span><span class="nv">$key</span><span class="p">]</span> <span class="o">=</span> <span class="k">static</span><span class="o">::</span><span class="na">setType</span><span class="p">((</span><span class="nx">string</span><span class="p">)</span><span class="nv">$value</span><span class="p">);</span>
            <span class="p">}</span>
</pre></div>
</div>
</div>
<div class="section" id="case-openemr-structures-couldusearrayunique">
<span id="id210"></span><h4><span class="section-number">5.2.158.2. </span>OpenEMR<a class="headerlink" href="#case-openemr-structures-couldusearrayunique" title="Permalink to this headline">¶</a></h4>
<p><a class="reference internal" href="Rules.html#could-use-array-unique"><span class="std std-ref">Could Use array_unique</span></a>, in gacl/gacl_api.class.php:441:441.</p>
<p>This loop is quite complex : it collects $aro_value in $acl_array[‘aro’][$aro_section_value], but also creates the array in $acl_array[‘aro’][$aro_section_value], and report errors in the debug log. array_unique() could replace the collection, while the debug would have to be done somewhere else.</p>
<div class="highlight-php notranslate"><div class="highlight"><pre><span></span><span class="k">foreach</span> <span class="p">(</span><span class="nv">$aro_value_array</span> <span class="k">as</span> <span class="nv">$aro_value</span><span class="p">)</span> <span class="p">{</span>
                                    <span class="k">if</span> <span class="p">(</span> <span class="nb">count</span><span class="p">(</span><span class="nv">$acl_array</span><span class="p">[</span><span class="s1">&#39;aro&#39;</span><span class="p">][</span><span class="nv">$aro_section_value</span><span class="p">])</span> <span class="o">!=</span> <span class="mi">0</span> <span class="p">)</span> <span class="p">{</span>
                                            <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nb">in_array</span><span class="p">(</span><span class="nv">$aro_value</span><span class="p">,</span> <span class="nv">$acl_array</span><span class="p">[</span><span class="s1">&#39;aro&#39;</span><span class="p">][</span><span class="nv">$aro_section_value</span><span class="p">]))</span> <span class="p">{</span>
                                                    <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">debug_text</span><span class="p">(</span><span class="s2">&quot;append_acl(): ARO Section Value: </span><span class="si">$aro_section_value</span><span class="s2"> ARO VALUE: </span><span class="si">$aro_value</span><span class="s2">&quot;</span><span class="p">);</span>
                                                    <span class="nv">$acl_array</span><span class="p">[</span><span class="s1">&#39;aro&#39;</span><span class="p">][</span><span class="nv">$aro_section_value</span><span class="p">][]</span> <span class="o">=</span> <span class="nv">$aro_value</span><span class="p">;</span>
                                                    <span class="nv">$update</span><span class="o">=</span><span class="mi">1</span><span class="p">;</span>
                                            <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
                                                    <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">debug_text</span><span class="p">(</span><span class="s2">&quot;append_acl(): Duplicate ARO, ignoring... &quot;</span><span class="p">);</span>
                                            <span class="p">}</span>
                                    <span class="p">}</span> <span class="k">else</span> <span class="p">{</span> <span class="c1">//Array is empty so add this aro value.</span>
                                            <span class="nv">$acl_array</span><span class="p">[</span><span class="s1">&#39;aro&#39;</span><span class="p">][</span><span class="nv">$aro_section_value</span><span class="p">][]</span> <span class="o">=</span> <span class="nv">$aro_value</span><span class="p">;</span>
                                            <span class="nv">$update</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>
                                    <span class="p">}</span>
                            <span class="p">}</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="could-use-compact">
<span id="case-could-use-compact"></span><h3><span class="section-number">5.2.159. </span>Could Use Compact<a class="headerlink" href="#could-use-compact" title="Permalink to this headline">¶</a></h3>
<div class="section" id="case-wordpress-structures-couldusecompact">
<span id="id211"></span><h4><span class="section-number">5.2.159.1. </span>WordPress<a class="headerlink" href="#case-wordpress-structures-couldusecompact" title="Permalink to this headline">¶</a></h4>
<p><a class="reference internal" href="Rules.html#could-use-compact"><span class="std std-ref">Could Use Compact</span></a>, in wp-admin/includes/misc.php:74.</p>
<p>This code actually loads the file, join it, then split it again. file() would be sufficient.</p>
<div class="highlight-php notranslate"><div class="highlight"><pre><span></span><span class="nv">$markerdata</span> <span class="o">=</span> <span class="nb">explode</span><span class="p">(</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">,</span> <span class="nb">implode</span><span class="p">(</span> <span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="nb">file</span><span class="p">(</span> <span class="nv">$filename</span> <span class="p">)</span> <span class="p">)</span> <span class="p">);</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="could-use-dir">
<span id="case-could-use-dir"></span><h3><span class="section-number">5.2.160. </span>Could Use __DIR__<a class="headerlink" href="#could-use-dir" title="Permalink to this headline">¶</a></h3>
<div class="section" id="case-woocommerce-structures-couldusedir">
<span id="id212"></span><h4><span class="section-number">5.2.160.1. </span>Woocommerce<a class="headerlink" href="#case-woocommerce-structures-couldusedir" title="Permalink to this headline">¶</a></h4>
<p><a class="reference internal" href="Rules.html#could-use-dir"><span class="std std-ref">Could Use __DIR__</span></a>, in includes/class-wc-api.php:162.</p>
<p>All the 120 occurrences use <cite>dirname( __FILE__ )</cite>, and could be upgraded to __DIR__ if backward compatibility to PHP 5.2 is not critical.</p>
<div class="highlight-php notranslate"><div class="highlight"><pre><span></span><span class="k">private</span> <span class="k">function</span> <span class="nf">rest_api_includes</span><span class="p">()</span> <span class="p">{</span>
            <span class="c1">// Exception handler.</span>
            <span class="k">include_once</span> <span class="nb">dirname</span><span class="p">(</span> <span class="no">__FILE__</span> <span class="p">)</span> <span class="o">.</span> <span class="s1">&#39;/api/class-wc-rest-exception.php&#39;</span><span class="p">;</span>

            <span class="c1">// Authentication.</span>
            <span class="k">include_once</span> <span class="nb">dirname</span><span class="p">(</span> <span class="no">__FILE__</span> <span class="p">)</span> <span class="o">.</span> <span class="s1">&#39;/api/class-wc-rest-authentication.php&#39;</span><span class="p">;</span>
</pre></div>
</div>
</div>
<div class="section" id="case-piwigo-structures-couldusedir">
<span id="id213"></span><h4><span class="section-number">5.2.160.2. </span>Piwigo<a class="headerlink" href="#case-piwigo-structures-couldusedir" title="Permalink to this headline">¶</a></h4>
<p><a class="reference internal" href="Rules.html#could-use-dir"><span class="std std-ref">Could Use __DIR__</span></a>, in include/random_compat/random.php:50.</p>
<p><cite>dirname( __FILE__ )</cite> is cached into $RandomCompatDIR, then reused three times. Using __DIR__ would save that detour.</p>
<div class="highlight-php notranslate"><div class="highlight"><pre><span></span><span class="nv">$RandomCompatDIR</span> <span class="o">=</span> <span class="nb">dirname</span><span class="p">(</span><span class="no">__FILE__</span><span class="p">);</span>

    <span class="k">require_once</span> <span class="nv">$RandomCompatDIR</span><span class="o">.</span><span class="s1">&#39;/byte_safe_strings.php&#39;</span><span class="p">;</span>
    <span class="k">require_once</span> <span class="nv">$RandomCompatDIR</span><span class="o">.</span><span class="s1">&#39;/cast_to_int.php&#39;</span><span class="p">;</span>
    <span class="k">require_once</span> <span class="nv">$RandomCompatDIR</span><span class="o">.</span><span class="s1">&#39;/error_polyfill.php&#39;</span><span class="p">;</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="could-use-short-assignation">
<span id="case-could-use-short-assignation"></span><h3><span class="section-number">5.2.161. </span>Could Use Short Assignation<a class="headerlink" href="#could-use-short-assignation" title="Permalink to this headline">¶</a></h3>
<div class="section" id="case-churchcrm-structures-coulduseshortassignation">
<span id="id214"></span><h4><span class="section-number">5.2.161.1. </span>ChurchCRM<a class="headerlink" href="#case-churchcrm-structures-coulduseshortassignation" title="Permalink to this headline">¶</a></h4>
<p><a class="reference internal" href="Rules.html#could-use-short-assignation"><span class="std std-ref">Could Use Short Assignation</span></a>, in src/ChurchCRM/utils/GeoUtils.php:74.</p>
<p>Sometimes, the variable is on the other side of the operator.</p>
<div class="highlight-php notranslate"><div class="highlight"><pre><span></span><span class="nv">$distance</span> <span class="o">=</span> <span class="mf">0.6213712</span> <span class="o">*</span> <span class="nv">$distance</span><span class="p">;</span>
</pre></div>
</div>
</div>
<div class="section" id="case-thelia-structures-coulduseshortassignation">
<span id="id215"></span><h4><span class="section-number">5.2.161.2. </span>Thelia<a class="headerlink" href="#case-thelia-structures-coulduseshortassignation" title="Permalink to this headline">¶</a></h4>
<p><a class="reference internal" href="Rules.html#could-use-short-assignation"><span class="std std-ref">Could Use Short Assignation</span></a>, in local/modules/Tinymce/Resources/js/tinymce/filemanager/include/utils.php:70.</p>
<p>/= is rare, but it definitely could be used here.</p>
<div class="highlight-php notranslate"><div class="highlight"><pre><span></span><span class="nv">$size</span> <span class="o">=</span> <span class="nv">$size</span> <span class="o">/</span> <span class="mi">1024</span><span class="p">;</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="could-use-str-repeat">
<span id="case-could-use-str-repeat"></span><h3><span class="section-number">5.2.162. </span>Could Use str_repeat()<a class="headerlink" href="#could-use-str-repeat" title="Permalink to this headline">¶</a></h3>
<div class="section" id="case-zencart-structures-couldusestrrepeat">
<span id="id216"></span><h4><span class="section-number">5.2.162.1. </span>Zencart<a class="headerlink" href="#case-zencart-structures-couldusestrrepeat" title="Permalink to this headline">¶</a></h4>
<p><a class="reference internal" href="Rules.html#could-use-str-repeat"><span class="std std-ref">Could Use str_repeat()</span></a>, in includes/functions/functions_general.php:1234.</p>
<p>That’s a 45 repeat of &amp;nbsp;</p>
<div class="highlight-php notranslate"><div class="highlight"><pre><span></span><span class="k">if</span> <span class="p">(</span> <span class="p">(</span><span class="o">!</span><span class="nx">zen_browser_detect</span><span class="p">(</span><span class="s1">&#39;MSIE&#39;</span><span class="p">))</span> <span class="o">&amp;&amp;</span> <span class="p">(</span><span class="nx">zen_browser_detect</span><span class="p">(</span><span class="s1">&#39;Mozilla/4&#39;</span><span class="p">))</span> <span class="p">)</span> <span class="p">{</span>
      <span class="k">for</span> <span class="p">(</span><span class="nv">$i</span><span class="o">=</span><span class="mi">0</span><span class="p">;</span> <span class="nv">$i</span><span class="o">&lt;</span><span class="mi">45</span><span class="p">;</span> <span class="nv">$i</span><span class="o">++</span><span class="p">)</span> <span class="nv">$pre</span> <span class="o">.=</span> <span class="s1">&#39;&amp;nbsp;&#39;</span><span class="p">;</span>
    <span class="p">}</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="dangling-array-references">
<span id="case-dangling-array-references"></span><h3><span class="section-number">5.2.163. </span>Dangling Array References<a class="headerlink" href="#dangling-array-references" title="Permalink to this headline">¶</a></h3>
<div class="section" id="case-typo3-structures-danglingarrayreferences">
<span id="id217"></span><h4><span class="section-number">5.2.163.1. </span>Typo3<a class="headerlink" href="#case-typo3-structures-danglingarrayreferences" title="Permalink to this headline">¶</a></h4>
<p><a class="reference internal" href="Rules.html#dangling-array-references"><span class="std std-ref">Dangling Array References</span></a>, in typo3/sysext/impexp/Classes/ImportExport.php:322.</p>
<p>foreach() reads $lines into $r, and augment those lines. By the end, the $r variable is not unset. Yet, several lines later, in the same method but with different conditions, another loop reuse the variable $r. If is_array($this-&gt;dat[‘header’][‘pagetree’] and is_array($this-&gt;remainHeader[‘records’]) are arrays at the same moment, then both loops are called, and they share the same reference. Values of the latter array will end up in the formar.</p>
<div class="highlight-php notranslate"><div class="highlight"><pre><span></span><span class="k">if</span> <span class="p">(</span><span class="nb">is_array</span><span class="p">(</span><span class="nv">$this</span><span class="o">-&gt;</span><span class="na">dat</span><span class="p">[</span><span class="s1">&#39;header&#39;</span><span class="p">][</span><span class="s1">&#39;pagetree&#39;</span><span class="p">]))</span> <span class="p">{</span>
    <span class="nb">reset</span><span class="p">(</span><span class="nv">$this</span><span class="o">-&gt;</span><span class="na">dat</span><span class="p">[</span><span class="s1">&#39;header&#39;</span><span class="p">][</span><span class="s1">&#39;pagetree&#39;</span><span class="p">]);</span>
    <span class="nv">$lines</span> <span class="o">=</span> <span class="p">[];</span>
    <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">traversePageTree</span><span class="p">(</span><span class="nv">$this</span><span class="o">-&gt;</span><span class="na">dat</span><span class="p">[</span><span class="s1">&#39;header&#39;</span><span class="p">][</span><span class="s1">&#39;pagetree&#39;</span><span class="p">],</span> <span class="nv">$lines</span><span class="p">);</span>

    <span class="nv">$viewData</span><span class="p">[</span><span class="s1">&#39;dat&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">dat</span><span class="p">;</span>
    <span class="nv">$viewData</span><span class="p">[</span><span class="s1">&#39;update&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">update</span><span class="p">;</span>
    <span class="nv">$viewData</span><span class="p">[</span><span class="s1">&#39;showDiff&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">showDiff</span><span class="p">;</span>
    <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="k">empty</span><span class="p">(</span><span class="nv">$lines</span><span class="p">))</span> <span class="p">{</span>
        <span class="k">foreach</span> <span class="p">(</span><span class="nv">$lines</span> <span class="k">as</span> <span class="o">&amp;</span><span class="nv">$r</span><span class="p">)</span> <span class="p">{</span>
            <span class="nv">$r</span><span class="p">[</span><span class="s1">&#39;controls&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">renderControls</span><span class="p">(</span><span class="nv">$r</span><span class="p">);</span>
            <span class="nv">$r</span><span class="p">[</span><span class="s1">&#39;fileSize&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="nx">GeneralUtility</span><span class="o">::</span><span class="na">formatSize</span><span class="p">(</span><span class="nv">$r</span><span class="p">[</span><span class="s1">&#39;size&#39;</span><span class="p">]);</span>
            <span class="nv">$r</span><span class="p">[</span><span class="s1">&#39;message&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="nv">$r</span><span class="p">[</span><span class="s1">&#39;msg&#39;</span><span class="p">]</span> <span class="o">&amp;&amp;</span> <span class="o">!</span><span class="nv">$this</span><span class="o">-&gt;</span><span class="na">doesImport</span> <span class="o">?</span> <span class="s1">&#39;&lt;span class=text-danger&gt;&#39;</span> <span class="o">.</span> <span class="nb">htmlspecialchars</span><span class="p">(</span><span class="nv">$r</span><span class="p">[</span><span class="s1">&#39;msg&#39;</span><span class="p">])</span> <span class="o">.</span> <span class="s1">&#39;&lt;/span&gt;&#39;</span> <span class="o">:</span> <span class="s1">&#39;&#39;</span><span class="p">);</span>
        <span class="p">}</span>
        <span class="nv">$viewData</span><span class="p">[</span><span class="s1">&#39;pagetreeLines&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="nv">$lines</span><span class="p">;</span>
    <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
        <span class="nv">$viewData</span><span class="p">[</span><span class="s1">&#39;pagetreeLines&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[];</span>
    <span class="p">}</span>
<span class="p">}</span>
<span class="c1">// Print remaining records that were not contained inside the page tree:</span>
<span class="k">if</span> <span class="p">(</span><span class="nb">is_array</span><span class="p">(</span><span class="nv">$this</span><span class="o">-&gt;</span><span class="na">remainHeader</span><span class="p">[</span><span class="s1">&#39;records&#39;</span><span class="p">]))</span> <span class="p">{</span>
    <span class="nv">$lines</span> <span class="o">=</span> <span class="p">[];</span>
    <span class="k">if</span> <span class="p">(</span><span class="nb">is_array</span><span class="p">(</span><span class="nv">$this</span><span class="o">-&gt;</span><span class="na">remainHeader</span><span class="p">[</span><span class="s1">&#39;records&#39;</span><span class="p">][</span><span class="s1">&#39;pages&#39;</span><span class="p">]))</span> <span class="p">{</span>
        <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">traversePageRecords</span><span class="p">(</span><span class="nv">$this</span><span class="o">-&gt;</span><span class="na">remainHeader</span><span class="p">[</span><span class="s1">&#39;records&#39;</span><span class="p">][</span><span class="s1">&#39;pages&#39;</span><span class="p">],</span> <span class="nv">$lines</span><span class="p">);</span>
    <span class="p">}</span>
    <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">traverseAllRecords</span><span class="p">(</span><span class="nv">$this</span><span class="o">-&gt;</span><span class="na">remainHeader</span><span class="p">[</span><span class="s1">&#39;records&#39;</span><span class="p">],</span> <span class="nv">$lines</span><span class="p">);</span>
    <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="k">empty</span><span class="p">(</span><span class="nv">$lines</span><span class="p">))</span> <span class="p">{</span>
        <span class="k">foreach</span> <span class="p">(</span><span class="nv">$lines</span> <span class="k">as</span> <span class="o">&amp;</span><span class="nv">$r</span><span class="p">)</span> <span class="p">{</span>
            <span class="nv">$r</span><span class="p">[</span><span class="s1">&#39;controls&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">renderControls</span><span class="p">(</span><span class="nv">$r</span><span class="p">);</span>
            <span class="nv">$r</span><span class="p">[</span><span class="s1">&#39;fileSize&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="nx">GeneralUtility</span><span class="o">::</span><span class="na">formatSize</span><span class="p">(</span><span class="nv">$r</span><span class="p">[</span><span class="s1">&#39;size&#39;</span><span class="p">]);</span>
            <span class="nv">$r</span><span class="p">[</span><span class="s1">&#39;message&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="nv">$r</span><span class="p">[</span><span class="s1">&#39;msg&#39;</span><span class="p">]</span> <span class="o">&amp;&amp;</span> <span class="o">!</span><span class="nv">$this</span><span class="o">-&gt;</span><span class="na">doesImport</span> <span class="o">?</span> <span class="s1">&#39;&lt;span class=text-danger&gt;&#39;</span> <span class="o">.</span> <span class="nb">htmlspecialchars</span><span class="p">(</span><span class="nv">$r</span><span class="p">[</span><span class="s1">&#39;msg&#39;</span><span class="p">])</span> <span class="o">.</span> <span class="s1">&#39;&lt;/span&gt;&#39;</span> <span class="o">:</span> <span class="s1">&#39;&#39;</span><span class="p">);</span>
        <span class="p">}</span>
        <span class="nv">$viewData</span><span class="p">[</span><span class="s1">&#39;remainingRecords&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="nv">$lines</span><span class="p">;</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
</div>
<div class="section" id="case-sugarcrm-structures-danglingarrayreferences">
<span id="id218"></span><h4><span class="section-number">5.2.163.2. </span>SugarCrm<a class="headerlink" href="#case-sugarcrm-structures-danglingarrayreferences" title="Permalink to this headline">¶</a></h4>
<p><a class="reference internal" href="Rules.html#dangling-array-references"><span class="std std-ref">Dangling Array References</span></a>, in SugarCE-Full-6.5.26/modules/Import/CsvAutoDetect.php:165.</p>
<p>There are two nested foreach here : they both have referenced blind variables. The second one uses $data, but never changes it. Yet, it is reused the next round in the first loop, leading to pollution from the first rows of $this-&gt;_parser-&gt;data into the lasts. This may happen even if $data is not modified explicitely : in fact, it will be modified the next call to foreach($row as …), for each element in $row.</p>
<div class="highlight-php notranslate"><div class="highlight"><pre><span></span><span class="k">foreach</span> <span class="p">(</span><span class="nv">$this</span><span class="o">-&gt;</span><span class="na">_parser</span><span class="o">-&gt;</span><span class="na">data</span> <span class="k">as</span> <span class="o">&amp;</span><span class="nv">$row</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">foreach</span> <span class="p">(</span><span class="nv">$row</span> <span class="k">as</span> <span class="o">&amp;</span><span class="nv">$data</span><span class="p">)</span> <span class="p">{</span>
        <span class="nv">$len</span> <span class="o">=</span> <span class="nb">strlen</span><span class="p">(</span><span class="nv">$data</span><span class="p">);</span>
        <span class="c1">// check if it begins and ends with single quotes</span>
        <span class="c1">// if it does, then it double quotes may not be the enclosure</span>
        <span class="k">if</span> <span class="p">(</span><span class="nv">$len</span><span class="o">&gt;=</span><span class="mi">2</span> <span class="o">&amp;&amp;</span> <span class="nv">$data</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot; &amp;&amp; </span><span class="si">$data[$len-1]</span><span class="s2"> == &quot;</span><span class="p">)</span> <span class="p">{</span>
            <span class="nv">$beginEndWithSingle</span> <span class="o">=</span> <span class="k">true</span><span class="p">;</span>
            <span class="k">break</span><span class="p">;</span>
        <span class="p">}</span>
    <span class="p">}</span>
    <span class="k">if</span> <span class="p">(</span><span class="nv">$beginEndWithSingle</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">break</span><span class="p">;</span>
    <span class="p">}</span>
    <span class="nv">$depth</span><span class="o">++</span><span class="p">;</span>
    <span class="k">if</span> <span class="p">(</span><span class="nv">$depth</span> <span class="o">&gt;</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">_max_depth</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">break</span><span class="p">;</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="dir-then-slash">
<span id="case-dir-then-slash"></span><h3><span class="section-number">5.2.164. </span>__DIR__ Then Slash<a class="headerlink" href="#dir-then-slash" title="Permalink to this headline">¶</a></h3>
<div class="section" id="case-traq-structures-dirthenslash">
<span id="id219"></span><h4><span class="section-number">5.2.164.1. </span>Traq<a class="headerlink" href="#case-traq-structures-dirthenslash" title="Permalink to this headline">¶</a></h4>
<p><a class="reference internal" href="Rules.html#dir-then-slash"><span class="std std-ref">__DIR__ Then Slash</span></a>, in src/Kernel.php:60.</p>
<p>When executed in a path ‘/a/b/c’, this code will require ‘/a../../vendor/autoload.php.</p>
<div class="highlight-php notranslate"><div class="highlight"><pre><span></span><span class="k">static</span><span class="o">::</span><span class="nv">$loader</span> <span class="o">=</span> <span class="k">require</span> <span class="no">__DIR__</span><span class="o">.</span><span class="s1">&#39;../../vendor/autoload.php&#39;</span><span class="p">;</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="don-t-loop-on-yield">
<span id="case-don-t-loop-on-yield"></span><h3><span class="section-number">5.2.165. </span>Don’t Loop On Yield<a class="headerlink" href="#don-t-loop-on-yield" title="Permalink to this headline">¶</a></h3>
<div class="section" id="case-dolibarr-structures-dontlooponyield">
<span id="id220"></span><h4><span class="section-number">5.2.165.1. </span>Dolibarr<a class="headerlink" href="#case-dolibarr-structures-dontlooponyield" title="Permalink to this headline">¶</a></h4>
<p><a class="reference internal" href="Rules.html#don-t-loop-on-yield"><span class="std std-ref">Don’t Loop On Yield</span></a>, in htdocs/includes/sabre/sabre/dav/lib/DAV/Server.php:912.</p>
<p>Yield from is a straight replacement here.</p>
<div class="highlight-php notranslate"><div class="highlight"><pre><span></span><span class="k">if</span> <span class="p">((</span><span class="nv">$newDepth</span> <span class="o">===</span> <span class="nx">self</span><span class="o">::</span><span class="na">DEPTH_INFINITY</span> <span class="o">||</span> <span class="nv">$newDepth</span> <span class="o">&gt;=</span> <span class="mi">1</span><span class="p">)</span> <span class="o">&amp;&amp;</span> <span class="nv">$childNode</span> <span class="nx">instanceof</span> <span class="nx">ICollection</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">foreach</span> <span class="p">(</span><span class="nv">$this</span><span class="o">-&gt;</span><span class="na">generatePathNodes</span><span class="p">(</span><span class="nv">$subPropFind</span><span class="p">)</span> <span class="k">as</span> <span class="nv">$subItem</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">yield</span> <span class="nv">$subItem</span><span class="p">;</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
</div>
<div class="section" id="case-tikiwiki-structures-dontlooponyield">
<span id="id221"></span><h4><span class="section-number">5.2.165.2. </span>Tikiwiki<a class="headerlink" href="#case-tikiwiki-structures-dontlooponyield" title="Permalink to this headline">¶</a></h4>
<p><a class="reference internal" href="Rules.html#don-t-loop-on-yield"><span class="std std-ref">Don’t Loop On Yield</span></a>, in lib/goal/goallib.php:944.</p>
<p>The replacement with <code class="docutils literal notranslate"><span class="pre">yield</span> <span class="pre">from``is</span> <span class="pre">not</span> <span class="pre">straigthforward</span> <span class="pre">here.</span> <span class="pre">Yield</span> <span class="pre">is</span> <span class="pre">only</span> <span class="pre">called</span> <span class="pre">when</span> <span class="pre">$user</span> <span class="pre">hasn't</span> <span class="pre">been</span> <span class="pre">``$done</span></code> : this is a unicity check. So, the double loop may produce a fully merged array, that may be reduced further by array_unique(). The final array, then, can be used with yield from.</p>
<div class="highlight-php notranslate"><div class="highlight"><pre><span></span><span class="nv">$done</span> <span class="o">=</span> <span class="p">[];</span>

<span class="k">foreach</span> <span class="p">(</span><span class="nv">$goal</span><span class="p">[</span><span class="s1">&#39;eligible&#39;</span><span class="p">]</span> <span class="k">as</span> <span class="nv">$groupName</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">foreach</span> <span class="p">(</span><span class="nv">$userlib</span><span class="o">-&gt;</span><span class="na">get_group_users</span><span class="p">(</span><span class="nv">$groupName</span><span class="p">)</span> <span class="k">as</span> <span class="nv">$user</span><span class="p">)</span> <span class="p">{</span>
            <span class="k">if</span> <span class="p">(</span><span class="o">!</span> <span class="nb">isset</span><span class="p">(</span><span class="nv">$done</span><span class="p">[</span><span class="nv">$user</span><span class="p">]))</span> <span class="p">{</span>
                    <span class="k">yield</span> <span class="p">[</span><span class="s1">&#39;user&#39;</span> <span class="o">=&gt;</span> <span class="nv">$user</span><span class="p">,</span> <span class="s1">&#39;group&#39;</span> <span class="o">=&gt;</span> <span class="k">null</span><span class="p">];</span>
                    <span class="nv">$done</span><span class="p">[</span><span class="nv">$user</span><span class="p">]</span> <span class="o">=</span> <span class="k">true</span><span class="p">;</span>
            <span class="p">}</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="dont-mix">
<span id="case-dont-mix"></span><h3><span class="section-number">5.2.166. </span>Dont Mix ++<a class="headerlink" href="#dont-mix" title="Permalink to this headline">¶</a></h3>
<div class="section" id="case-contao-structures-dontmixplusplus">
<span id="id222"></span><h4><span class="section-number">5.2.166.1. </span>Contao<a class="headerlink" href="#case-contao-structures-dontmixplusplus" title="Permalink to this headline">¶</a></h4>
<p><a class="reference internal" href="Rules.html#dont-mix"><span class="std std-ref">Dont Mix ++</span></a>, in core-bundle/src/Resources/contao/drivers/DC_Table.php:1272.</p>
<p>Incrementing and multiplying at the same time.</p>
<div class="highlight-php notranslate"><div class="highlight"><pre><span></span><span class="nv">$this</span><span class="o">-&gt;</span><span class="na">Database</span><span class="o">-&gt;</span><span class="na">prepare</span><span class="p">(</span><span class="s2">&quot;UPDATE &quot;</span> <span class="o">.</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">strTable</span> <span class="o">.</span> <span class="s2">&quot; SET sorting=? WHERE id=?&quot;</span><span class="p">)</span>
               <span class="o">-&gt;</span><span class="na">execute</span><span class="p">((</span><span class="nv">$count</span><span class="o">++</span> <span class="o">*</span> <span class="mi">128</span><span class="p">),</span> <span class="nv">$objNewSorting</span><span class="o">-&gt;</span><span class="na">id</span><span class="p">);</span>
</pre></div>
</div>
</div>
<div class="section" id="case-typo3-structures-dontmixplusplus">
<span id="id223"></span><h4><span class="section-number">5.2.166.2. </span>Typo3<a class="headerlink" href="#case-typo3-structures-dontmixplusplus" title="Permalink to this headline">¶</a></h4>
<p><a class="reference internal" href="Rules.html#dont-mix"><span class="std std-ref">Dont Mix ++</span></a>, in typo3/sysext/backend/Classes/Controller/SiteConfigurationController.php:74.</p>
<p>The post-increment is not readable at first glance.</p>
<div class="highlight-php notranslate"><div class="highlight"><pre><span></span><span class="k">foreach</span> <span class="p">(</span><span class="nv">$row</span><span class="p">[</span><span class="s1">&#39;rootline&#39;</span><span class="p">]</span> <span class="k">as</span> <span class="o">&amp;</span><span class="nv">$record</span><span class="p">)</span> <span class="p">{</span>
                <span class="nv">$record</span><span class="p">[</span><span class="s1">&#39;margin&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="nv">$i</span><span class="o">++</span> <span class="o">*</span> <span class="mi">20</span><span class="p">;</span>
            <span class="p">}</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="echo-with-concat">
<span id="case-echo-with-concat"></span><h3><span class="section-number">5.2.167. </span>Echo With Concat<a class="headerlink" href="#echo-with-concat" title="Permalink to this headline">¶</a></h3>
<div class="section" id="case-phpdocumentor-structures-echowithconcat">
<span id="id224"></span><h4><span class="section-number">5.2.167.1. </span>Phpdocumentor<a class="headerlink" href="#case-phpdocumentor-structures-echowithconcat" title="Permalink to this headline">¶</a></h4>
<p><a class="reference internal" href="Rules.html#echo-with-concat"><span class="std std-ref">Echo With Concat</span></a>, in src/phpDocumentor/Bootstrap.php:76.</p>
<p>Simply replace the dot by a comma.</p>
<div class="highlight-php notranslate"><div class="highlight"><pre><span></span><span class="k">echo</span> <span class="s1">&#39;PROFILING ENABLED&#39;</span> <span class="o">.</span> <span class="nx">PHP_EOL</span>
</pre></div>
</div>
</div>
<div class="section" id="case-teampass-structures-echowithconcat">
<span id="id225"></span><h4><span class="section-number">5.2.167.2. </span>TeamPass<a class="headerlink" href="#case-teampass-structures-echowithconcat" title="Permalink to this headline">¶</a></h4>
<p><a class="reference internal" href="Rules.html#echo-with-concat"><span class="std std-ref">Echo With Concat</span></a>, in includes/libraries/Authentication/Yubico/PEAR.php:162.</p>
<p>This is less obvious, but turning print to echo, and the double-quoted string to single quoted string will yield the same optimisation.</p>
<div class="highlight-php notranslate"><div class="highlight"><pre><span></span><span class="k">print</span> <span class="s2">&quot;PEAR constructor called, class=</span><span class="si">$classname\n</span><span class="s2">&quot;</span><span class="p">;</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="else-if-versus-elseif">
<span id="case-else-if-versus-elseif"></span><h3><span class="section-number">5.2.168. </span>Else If Versus Elseif<a class="headerlink" href="#else-if-versus-elseif" title="Permalink to this headline">¶</a></h3>
<div class="section" id="case-teampass-structures-elseifelseif">
<span id="id226"></span><h4><span class="section-number">5.2.168.1. </span>TeamPass<a class="headerlink" href="#case-teampass-structures-elseifelseif" title="Permalink to this headline">¶</a></h4>
<p><a class="reference internal" href="Rules.html#else-if-versus-elseif"><span class="std std-ref">Else If Versus Elseif</span></a>, in items.php:819.</p>
<p>This code could be turned into a switch() structure.</p>
<div class="highlight-php notranslate"><div class="highlight"><pre><span></span><span class="k">if</span> <span class="p">(</span><span class="nv">$field</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span> <span class="o">===</span> <span class="s1">&#39;text&#39;</span><span class="p">)</span> <span class="p">{</span>
                <span class="k">echo</span> <span class="s1">&#39;</span>
<span class="s1">                        &lt;input type=text id=edit_field_.$field[0]._.$elem[0]. class=edit_item_field input_text text ui-widget-content ui-corner-all size=40 data-field-type=.$field[3]. data-field-masked=.$field[4]. data-field-is-mandatory=.$field[5]. data-template-id=.$templateID.&gt;&#39;</span><span class="p">;</span>
            <span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="nv">$field</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span> <span class="o">===</span> <span class="s1">&#39;textarea&#39;</span><span class="p">)</span> <span class="p">{</span>
                <span class="k">echo</span> <span class="s1">&#39;</span>
<span class="s1">                        &lt;textarea id=edit_field_.$field[0]._.$elem[0]. class=edit_item_field input_text text ui-widget-content ui-corner-all colums=40 rows=5 data-field-type=.$field[&quot;3&quot;]. data-field-masked=.$field[4]. data-field-is-mandatory=.$field[5]. data-template-id=.$templateID.&gt;&lt;/textarea&gt;&#39;</span><span class="p">;</span>
            <span class="p">}</span>
</pre></div>
</div>
</div>
<div class="section" id="case-phpdocumentor-structures-elseifelseif">
<span id="id227"></span><h4><span class="section-number">5.2.168.2. </span>Phpdocumentor<a class="headerlink" href="#case-phpdocumentor-structures-elseifelseif" title="Permalink to this headline">¶</a></h4>
<p><a class="reference internal" href="Rules.html#else-if-versus-elseif"><span class="std std-ref">Else If Versus Elseif</span></a>, in src/phpDocumentor/Plugin/Core/Transformer/Writer/Xsl.php:112.</p>
<p>The first then block is long and complex. The else block, on the other hand, only contains a single if/then/else. Both conditions are distinct at first sight, so a if / elseif / then structure would be the best.</p>
<div class="highlight-php notranslate"><div class="highlight"><pre><span></span><span class="k">if</span> <span class="p">(</span><span class="nv">$transformation</span><span class="o">-&gt;</span><span class="na">getQuery</span><span class="p">()</span> <span class="o">!==</span> <span class="s1">&#39;&#39;</span><span class="p">)</span> <span class="p">{</span>
<span class="sd">/** Long then block **/</span>
        <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
            <span class="k">if</span> <span class="p">(</span><span class="nb">substr</span><span class="p">(</span><span class="nv">$transformation</span><span class="o">-&gt;</span><span class="na">getArtifact</span><span class="p">(),</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span> <span class="o">==</span> <span class="s1">&#39;$&#39;</span><span class="p">)</span> <span class="p">{</span>
                <span class="c1">// not a file, it must become a variable!</span>
                <span class="nv">$variable_name</span> <span class="o">=</span> <span class="nb">substr</span><span class="p">(</span><span class="nv">$transformation</span><span class="o">-&gt;</span><span class="na">getArtifact</span><span class="p">(),</span> <span class="mi">1</span><span class="p">);</span>
                <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">xsl_variables</span><span class="p">[</span><span class="nv">$variable_name</span><span class="p">]</span> <span class="o">=</span> <span class="nv">$proc</span><span class="o">-&gt;</span><span class="na">transformToXml</span><span class="p">(</span><span class="nv">$structure</span><span class="p">);</span>
            <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
                <span class="nv">$relativeFileName</span> <span class="o">=</span> <span class="nb">substr</span><span class="p">(</span><span class="nv">$artifact</span><span class="p">,</span> <span class="nb">strlen</span><span class="p">(</span><span class="nv">$transformation</span><span class="o">-&gt;</span><span class="na">getTransformer</span><span class="p">()</span><span class="o">-&gt;</span><span class="na">getTarget</span><span class="p">())</span> <span class="o">+</span> <span class="mi">1</span><span class="p">);</span>
                <span class="nv">$proc</span><span class="o">-&gt;</span><span class="na">setParameter</span><span class="p">(</span><span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="s1">&#39;root&#39;</span><span class="p">,</span> <span class="nb">str_repeat</span><span class="p">(</span><span class="s1">&#39;../&#39;</span><span class="p">,</span> <span class="nb">substr_count</span><span class="p">(</span><span class="nv">$relativeFileName</span><span class="p">,</span> <span class="s1">&#39;/&#39;</span><span class="p">)));</span>

                <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">writeToFile</span><span class="p">(</span><span class="nv">$artifact</span><span class="p">,</span> <span class="nv">$proc</span><span class="p">,</span> <span class="nv">$structure</span><span class="p">);</span>
            <span class="p">}</span>
        <span class="p">}</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="empty-blocks">
<span id="case-empty-blocks"></span><h3><span class="section-number">5.2.169. </span>Empty Blocks<a class="headerlink" href="#empty-blocks" title="Permalink to this headline">¶</a></h3>
<div class="section" id="case-cleverstyle-structures-emptyblocks">
<span id="id228"></span><h4><span class="section-number">5.2.169.1. </span>Cleverstyle<a class="headerlink" href="#case-cleverstyle-structures-emptyblocks" title="Permalink to this headline">¶</a></h4>
<p><a class="reference internal" href="Rules.html#empty-blocks"><span class="std std-ref">Empty Blocks</span></a>, in modules/Blogs/api/Controller.php:44.</p>
<p>Else is empty, but commented.</p>
<div class="highlight-php notranslate"><div class="highlight"><pre><span></span><span class="k">public</span> <span class="k">static</span> <span class="k">function</span> <span class="nf">posts_get</span> <span class="p">(</span><span class="nv">$Request</span><span class="p">)</span> <span class="p">{</span>
            <span class="nv">$id</span> <span class="o">=</span> <span class="nv">$Request</span><span class="o">-&gt;</span><span class="na">route_ids</span><span class="p">(</span><span class="mi">0</span><span class="p">);</span>
            <span class="k">if</span> <span class="p">(</span><span class="nv">$id</span><span class="p">)</span> <span class="p">{</span>
                    <span class="nv">$post</span> <span class="o">=</span> <span class="nx">Posts</span><span class="o">::</span><span class="na">instance</span><span class="p">()</span><span class="o">-&gt;</span><span class="na">get</span><span class="p">(</span><span class="nv">$id</span><span class="p">);</span>
                    <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nv">$post</span><span class="p">)</span> <span class="p">{</span>
                            <span class="k">throw</span> <span class="k">new</span> <span class="nx">ExitException</span><span class="p">(</span><span class="mi">404</span><span class="p">);</span>
                    <span class="p">}</span>
                    <span class="k">return</span> <span class="nv">$post</span><span class="p">;</span>
            <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
                    <span class="c1">// TODO: implement latest posts</span>
            <span class="p">}</span>
    <span class="p">}</span>
</pre></div>
</div>
</div>
<div class="section" id="case-phpipam-structures-emptyblocks">
<span id="id229"></span><h4><span class="section-number">5.2.169.2. </span>PhpIPAM<a class="headerlink" href="#case-phpipam-structures-emptyblocks" title="Permalink to this headline">¶</a></h4>
<p><a class="reference internal" href="Rules.html#empty-blocks"><span class="std std-ref">Empty Blocks</span></a>, in wp-admin/includes/misc.php:74.</p>
<p>The <code class="docutils literal notranslate"><span class="pre">then</span></code> block is empty and commented : yet, it may have been clearer to make the condition != and omitted the whole empty block.</p>
<div class="highlight-php notranslate"><div class="highlight"><pre><span></span><span class="cm">/* checks */</span>
<span class="k">if</span><span class="p">(</span><span class="nv">$_POST</span><span class="p">[</span><span class="s1">&#39;action&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="nx">delete</span><span class="p">)</span> <span class="p">{</span>
    <span class="c1"># no cecks</span>
<span class="p">}</span>
<span class="k">else</span> <span class="p">{</span>
    <span class="c1"># remove spaces</span>
    <span class="nv">$_POST</span><span class="p">[</span><span class="s1">&#39;name&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">trim</span><span class="p">(</span><span class="nv">$_POST</span><span class="p">[</span><span class="s1">&#39;name&#39;</span><span class="p">]);</span>

    <span class="c1"># length &gt; 4 and &lt; 12</span>
    <span class="k">if</span><span class="p">(</span> <span class="p">(</span><span class="nb">mb_strlen</span><span class="p">(</span><span class="nv">$_POST</span><span class="p">[</span><span class="s1">&#39;name&#39;</span><span class="p">])</span> <span class="o">&lt;</span> <span class="mi">2</span><span class="p">)</span> <span class="o">||</span> <span class="p">(</span><span class="nb">mb_strlen</span><span class="p">(</span><span class="nv">$_POST</span><span class="p">[</span><span class="s1">&#39;name&#39;</span><span class="p">])</span> <span class="o">&gt;</span> <span class="mi">24</span><span class="p">)</span> <span class="p">)</span>       <span class="p">{</span> <span class="nv">$errors</span><span class="p">[]</span> <span class="o">=</span> <span class="nx">_</span><span class="p">(</span><span class="s1">&#39;Name must be between 4 and 24 characters&#39;</span><span class="p">);</span> <span class="p">}</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="empty-instructions">
<span id="case-empty-instructions"></span><h3><span class="section-number">5.2.170. </span>Empty Instructions<a class="headerlink" href="#empty-instructions" title="Permalink to this headline">¶</a></h3>
<div class="section" id="case-zurmo-structures-emptylines">
<span id="id230"></span><h4><span class="section-number">5.2.170.1. </span>Zurmo<a class="headerlink" href="#case-zurmo-structures-emptylines" title="Permalink to this headline">¶</a></h4>
<p><a class="reference internal" href="Rules.html#empty-instructions"><span class="std std-ref">Empty Instructions</span></a>, in app/protected/core/widgets/MentionInput.php:84.</p>
<p>There is no need for a semi-colon after a if/then structure.</p>
<div class="highlight-php notranslate"><div class="highlight"><pre><span></span><span class="k">public</span> <span class="k">function</span> <span class="nf">run</span><span class="p">()</span>
        <span class="p">{</span>
            <span class="nv">$id</span> <span class="o">=</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">getId</span><span class="p">();</span>
            <span class="nv">$additionalSettingsJs</span> <span class="o">=</span> <span class="nx">showAvatars</span><span class="o">:</span> <span class="o">.</span> <span class="nb">var_export</span><span class="p">(</span><span class="nv">$this</span><span class="o">-&gt;</span><span class="na">showAvatars</span><span class="p">,</span> <span class="k">true</span><span class="p">)</span> <span class="o">.</span> <span class="p">,;</span>
            <span class="k">if</span> <span class="p">(</span><span class="nv">$this</span><span class="o">-&gt;</span><span class="na">classes</span><span class="p">)</span>
            <span class="p">{</span>
                <span class="nv">$additionalSettingsJs</span> <span class="o">.=</span>  <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">classes</span> <span class="o">.</span> <span class="s1">&#39;,&#39;</span><span class="p">;</span>
            <span class="p">};</span>
            <span class="k">if</span> <span class="p">(</span><span class="nv">$this</span><span class="o">-&gt;</span><span class="na">templates</span><span class="p">)</span>
            <span class="p">{</span>
                <span class="nv">$additionalSettingsJs</span> <span class="o">.=</span>  <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">templates</span><span class="p">;</span>
            <span class="p">};</span>
</pre></div>
</div>
</div>
<div class="section" id="case-thinkphp-structures-emptylines">
<span id="id231"></span><h4><span class="section-number">5.2.170.2. </span>ThinkPHP<a class="headerlink" href="#case-thinkphp-structures-emptylines" title="Permalink to this headline">¶</a></h4>
<p><a class="reference internal" href="Rules.html#empty-instructions"><span class="std std-ref">Empty Instructions</span></a>, in ThinkPHP/Library/Vendor/Smarty/sysplugins/smarty_internal_configfileparser.php:83.</p>
<p>There is no need for a semi-colon after a class structure, unless it is an anonymous class.</p>
<div class="highlight-php notranslate"><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">TPC_yyStackEntry</span>
<span class="p">{</span>
    <span class="k">public</span> <span class="nv">$stateno</span><span class="p">;</span>       <span class="cm">/* The state-number */</span>
    <span class="k">public</span> <span class="nv">$major</span><span class="p">;</span>         <span class="cm">/* The major token value.  This is the code</span>
<span class="cm">                     ** number for the token at this stack level */</span>
    <span class="k">public</span> <span class="nv">$minor</span><span class="p">;</span> <span class="cm">/* The user-supplied minor token value.  This</span>
<span class="cm">                     ** is the value of the token  */</span>
<span class="p">};</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="empty-try-catch">
<span id="case-empty-try-catch"></span><h3><span class="section-number">5.2.171. </span>Empty Try Catch<a class="headerlink" href="#empty-try-catch" title="Permalink to this headline">¶</a></h3>
<div class="section" id="case-livezilla-structures-emptytrycatch">
<span id="id232"></span><h4><span class="section-number">5.2.171.1. </span>LiveZilla<a class="headerlink" href="#case-livezilla-structures-emptytrycatch" title="Permalink to this headline">¶</a></h4>
<p><a class="reference internal" href="Rules.html#empty-try-catch"><span class="std std-ref">Empty Try Catch</span></a>, in livezilla/_lib/trdp/Zend/Mail/Protocol/Pop3.php:237.</p>
<p>This is an aptly commented empty try/catch : the emited exception is extra check for a Zend Mail Protocol Exception. Hopefully, the Zend_Mail_Protocol_Exception only covers a already-closed situation. Anyhow, this should be logged for later diagnostic.</p>
<div class="highlight-php notranslate"><div class="highlight"><pre><span></span><span class="k">public</span> <span class="k">function</span> <span class="nf">logout</span><span class="p">()</span>
    <span class="p">{</span>
        <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nv">$this</span><span class="o">-&gt;</span><span class="na">_socket</span><span class="p">)</span> <span class="p">{</span>
            <span class="k">return</span><span class="p">;</span>
        <span class="p">}</span>

        <span class="k">try</span> <span class="p">{</span>
            <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">request</span><span class="p">(</span><span class="s1">&#39;QUIT&#39;</span><span class="p">);</span>
        <span class="p">}</span> <span class="k">catch</span> <span class="p">(</span><span class="nx">Zend_Mail_Protocol_Exception</span> <span class="nv">$e</span><span class="p">)</span> <span class="p">{</span>
            <span class="c1">// ignore error - we&#39;re closing the socket anyway</span>
        <span class="p">}</span>

        <span class="nb">fclose</span><span class="p">(</span><span class="nv">$this</span><span class="o">-&gt;</span><span class="na">_socket</span><span class="p">);</span>
        <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">_socket</span> <span class="o">=</span> <span class="k">null</span><span class="p">;</span>
    <span class="p">}</span>
</pre></div>
</div>
</div>
<div class="section" id="case-mautic-structures-emptytrycatch">
<span id="id233"></span><h4><span class="section-number">5.2.171.2. </span>Mautic<a class="headerlink" href="#case-mautic-structures-emptytrycatch" title="Permalink to this headline">¶</a></h4>
<p><a class="reference internal" href="Rules.html#empty-try-catch"><span class="std std-ref">Empty Try Catch</span></a>, in app/bundles/ReportBundle/Model/ExportHandler.php:66.</p>
<p>Removing a file : if the file is not ‘deleted’ by the method call, but raises an error, it is hidden. When file destruction is impossible because the file is already destroyed (or missing), this is well. If the file couldn’t be destroyed because of missing writing privileges, hiding this error will have serious consequences.</p>
<div class="highlight-php notranslate"><div class="highlight"><pre><span></span><span class="sd">/**</span>
<span class="sd">     * @param string $fileName</span>
<span class="sd">     */</span>
    <span class="k">public</span> <span class="k">function</span> <span class="nf">removeFile</span><span class="p">(</span><span class="nv">$fileName</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="k">try</span> <span class="p">{</span>
            <span class="nv">$path</span> <span class="o">=</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">getPath</span><span class="p">(</span><span class="nv">$fileName</span><span class="p">);</span>
            <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">filePathResolver</span><span class="o">-&gt;</span><span class="na">delete</span><span class="p">(</span><span class="nv">$path</span><span class="p">);</span>
        <span class="p">}</span> <span class="k">catch</span> <span class="p">(</span><span class="nx">FileIOException</span> <span class="nv">$e</span><span class="p">)</span> <span class="p">{</span>
        <span class="p">}</span>
    <span class="p">}</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="empty-with-expression">
<span id="case-empty-with-expression"></span><h3><span class="section-number">5.2.172. </span>Empty With Expression<a class="headerlink" href="#empty-with-expression" title="Permalink to this headline">¶</a></h3>
<div class="section" id="case-humo-gen-structures-emptywithexpression">
<span id="id234"></span><h4><span class="section-number">5.2.172.1. </span>HuMo-Gen<a class="headerlink" href="#case-humo-gen-structures-emptywithexpression" title="Permalink to this headline">¶</a></h4>
<p><a class="reference internal" href="Rules.html#empty-with-expression"><span class="std std-ref">Empty With Expression</span></a>, in fanchart.php:297.</p>
<p>The test on $pid may be directly done on $treeid[$sosa][0]. The distance between the assignation and the empty() makes it hard to spot.</p>
<div class="highlight-php notranslate"><div class="highlight"><pre><span></span><span class="nv">$pid</span><span class="o">=</span><span class="nv">$treeid</span><span class="p">[</span><span class="nv">$sosa</span><span class="p">][</span><span class="mi">0</span><span class="p">];</span>
                    <span class="nv">$birthyr</span><span class="o">=</span><span class="nv">$treeid</span><span class="p">[</span><span class="nv">$sosa</span><span class="p">][</span><span class="mi">1</span><span class="p">];</span>
                    <span class="nv">$deathyr</span><span class="o">=</span><span class="nv">$treeid</span><span class="p">[</span><span class="nv">$sosa</span><span class="p">][</span><span class="mi">4</span><span class="p">];</span>
                    <span class="nv">$fontpx</span><span class="o">=</span><span class="nv">$fontsize</span><span class="p">;</span>
                    <span class="k">if</span><span class="p">(</span><span class="nv">$sosa</span><span class="o">&gt;=</span><span class="mi">16</span> <span class="k">AND</span> <span class="nv">$fandeg</span><span class="o">==</span><span class="mi">180</span><span class="p">)</span> <span class="p">{</span> <span class="nv">$fontpx</span><span class="o">=</span><span class="nv">$fontsize</span><span class="o">-</span><span class="mi">1</span><span class="p">;</span> <span class="p">}</span>
                    <span class="k">if</span><span class="p">(</span><span class="nv">$sosa</span><span class="o">&gt;=</span><span class="mi">32</span> <span class="k">AND</span> <span class="nv">$fandeg</span><span class="o">!=</span><span class="mi">180</span><span class="p">)</span> <span class="p">{</span> <span class="nv">$fontpx</span><span class="o">=</span><span class="nv">$fontsize</span><span class="o">-</span><span class="mi">1</span><span class="p">;</span> <span class="p">}</span>
                    <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="k">empty</span><span class="p">(</span><span class="nv">$pid</span><span class="p">))</span> <span class="p">{</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="error-reporting-with-integers">
<span id="case-error-reporting-with-integers"></span><h3><span class="section-number">5.2.173. </span>error_reporting() With Integers<a class="headerlink" href="#error-reporting-with-integers" title="Permalink to this headline">¶</a></h3>
<div class="section" id="case-sugarcrm-structures-errorreportingwithinteger">
<span id="id235"></span><h4><span class="section-number">5.2.173.1. </span>SugarCrm<a class="headerlink" href="#case-sugarcrm-structures-errorreportingwithinteger" title="Permalink to this headline">¶</a></h4>
<p><a class="reference internal" href="Rules.html#error-reporting-with-integers"><span class="std std-ref">error_reporting() With Integers</span></a>, in modules/UpgradeWizard/silentUpgrade_step1.php:436.</p>
<p>This only displays E_ERROR, the highest level of error reporting. It should be checked, as it happens in the ‘silentUpgrade’ script.</p>
<div class="highlight-php notranslate"><div class="highlight"><pre><span></span><span class="nb">ini_set</span><span class="p">(</span><span class="s1">&#39;error_reporting&#39;</span><span class="p">,</span> <span class="mi">1</span><span class="p">);</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="eval-usage">
<span id="case-eval-usage"></span><h3><span class="section-number">5.2.174. </span>Eval() Usage<a class="headerlink" href="#eval-usage" title="Permalink to this headline">¶</a></h3>
<div class="section" id="case-xoops-structures-evalusage">
<span id="id236"></span><h4><span class="section-number">5.2.174.1. </span>XOOPS<a class="headerlink" href="#case-xoops-structures-evalusage" title="Permalink to this headline">¶</a></h4>
<p><a class="reference internal" href="Rules.html#eval-usage"><span class="std std-ref">Eval() Usage</span></a>, in htdocs/modules/system/class/block.php:266.</p>
<p>eval() execute code that was arbitrarily stored in $this, in one of the properties. Then, it is sent to output, but collected before reaching the browser, and put again in $content. May be the echo/ob_get_contents() could have been skipped.</p>
<div class="highlight-php notranslate"><div class="highlight"><pre><span></span><span class="nb">ob_start</span><span class="p">();</span>
                    <span class="k">echo</span> <span class="k">eval</span><span class="p">(</span><span class="nv">$this</span><span class="o">-&gt;</span><span class="na">getVar</span><span class="p">(</span><span class="s1">&#39;content&#39;</span><span class="p">,</span> <span class="s1">&#39;n&#39;</span><span class="p">));</span>
                    <span class="nv">$content</span> <span class="o">=</span> <span class="nb">ob_get_contents</span><span class="p">();</span>
                    <span class="nb">ob_end_clean</span><span class="p">();</span>
</pre></div>
</div>
</div>
<div class="section" id="case-mautic-structures-evalusage">
<span id="id237"></span><h4><span class="section-number">5.2.174.2. </span>Mautic<a class="headerlink" href="#case-mautic-structures-evalusage" title="Permalink to this headline">¶</a></h4>
<p><a class="reference internal" href="Rules.html#eval-usage"><span class="std std-ref">Eval() Usage</span></a>, in app/bundles/InstallBundle/Configurator/Step/CheckStep.php:238.</p>
<p>create_function() is actually an eval() in disguise : replace it with a closure for code modernization</p>
<div class="highlight-php notranslate"><div class="highlight"><pre><span></span><span class="nb">create_function</span><span class="p">(</span><span class="s1">&#39;$cfgValue&#39;</span><span class="p">,</span> <span class="s1">&#39;return $cfgValue &gt; 100;&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="eval-without-try">
<span id="case-eval-without-try"></span><h3><span class="section-number">5.2.175. </span>eval() Without Try<a class="headerlink" href="#eval-without-try" title="Permalink to this headline">¶</a></h3>
<div class="section" id="case-fuelcms-structures-evalwithouttry">
<span id="id238"></span><h4><span class="section-number">5.2.175.1. </span>FuelCMS<a class="headerlink" href="#case-fuelcms-structures-evalwithouttry" title="Permalink to this headline">¶</a></h4>
<p><a class="reference internal" href="Rules.html#eval-without-try"><span class="std std-ref">eval() Without Try</span></a>, in fuel/modules/fuel/controllers/Blocks.php:268.</p>
<p>The &#64; will prevent any error, while the try/catch allows the processing of certain types of error, namely the Fatal ones.</p>
<div class="highlight-php notranslate"><div class="highlight"><pre><span></span><span class="o">@</span><span class="k">eval</span><span class="p">(</span><span class="nv">$_name_var_eval</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="section" id="case-expressionengine-structures-evalwithouttry">
<span id="id239"></span><h4><span class="section-number">5.2.175.2. </span>ExpressionEngine<a class="headerlink" href="#case-expressionengine-structures-evalwithouttry" title="Permalink to this headline">¶</a></h4>
<p><a class="reference internal" href="Rules.html#eval-without-try"><span class="std std-ref">eval() Without Try</span></a>, in system/ee/EllisLab/Addons/member/mod.member_memberlist.php:637.</p>
<p>$cond is build from values extracted from the $fields array. Although it is probably reasonably safe, a try/catch here will collect any unexpected situation cleaningly.</p>
<div class="highlight-php notranslate"><div class="highlight"><pre><span></span><span class="k">elseif</span> <span class="p">(</span><span class="nb">isset</span><span class="p">(</span><span class="nv">$fields</span><span class="p">[</span><span class="nv">$val</span><span class="p">[</span><span class="s1">&#39;3&#39;</span><span class="p">]]))</span>
                                    <span class="p">{</span>
                                            <span class="k">if</span> <span class="p">(</span><span class="nb">array_key_exists</span><span class="p">(</span><span class="s1">&#39;m_field_id_&#39;</span><span class="o">.</span><span class="nv">$fields</span><span class="p">[</span><span class="nv">$val</span><span class="p">[</span><span class="s1">&#39;3&#39;</span><span class="p">]],</span> <span class="nv">$row</span><span class="p">))</span>
                                            <span class="p">{</span>
                                                    <span class="nv">$v</span> <span class="o">=</span> <span class="nv">$row</span><span class="p">[</span><span class="s1">&#39;m_field_id_&#39;</span><span class="o">.</span><span class="nv">$fields</span><span class="p">[</span><span class="nv">$val</span><span class="p">[</span><span class="s1">&#39;3&#39;</span><span class="p">]]];</span>

                                                    <span class="nv">$lcond</span> <span class="o">=</span> <span class="nb">str_replace</span><span class="p">(</span><span class="nv">$val</span><span class="p">[</span><span class="s1">&#39;3&#39;</span><span class="p">],</span> <span class="s2">&quot;</span><span class="si">$v</span><span class="s2">&quot;</span><span class="p">,</span> <span class="nv">$lcond</span><span class="p">);</span>
                                                    <span class="nv">$cond</span> <span class="o">=</span> <span class="nv">$lcond</span><span class="o">.</span><span class="s1">&#39; &#39;</span><span class="o">.</span><span class="nv">$rcond</span><span class="p">;</span>
                                                    <span class="nv">$cond</span> <span class="o">=</span> <span class="nb">str_replace</span><span class="p">(</span><span class="s2">&quot;\|&quot;</span><span class="p">,</span> <span class="s2">&quot;|&quot;</span><span class="p">,</span> <span class="nv">$cond</span><span class="p">);</span>

                                                    <span class="k">eval</span><span class="p">(</span><span class="s2">&quot;</span><span class="si">$result</span><span class="s2"> = &quot;</span><span class="o">.</span><span class="nv">$cond</span><span class="o">.</span><span class="s2">&quot;;&quot;</span><span class="p">);</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="exit-usage">
<span id="case-exit-usage"></span><h3><span class="section-number">5.2.176. </span>Exit() Usage<a class="headerlink" href="#exit-usage" title="Permalink to this headline">¶</a></h3>
<div class="section" id="case-traq-structures-exitusage">
<span id="id240"></span><h4><span class="section-number">5.2.176.1. </span>Traq<a class="headerlink" href="#case-traq-structures-exitusage" title="Permalink to this headline">¶</a></h4>
<p><a class="reference internal" href="Rules.html#exit-usage"><span class="std std-ref">Exit() Usage</span></a>, in src/Controllers/attachments.php:75.</p>
<p>This acts as a view. The final ‘exit’ is meant to ensure that no other piece of data is emitted, potentially polluting the view. This also prevent any code cleaning to happen.</p>
<div class="highlight-php notranslate"><div class="highlight"><pre><span></span><span class="sd">/**</span>
<span class="sd">     * View attachment page</span>
<span class="sd">     *</span>
<span class="sd">     * @param integer $attachment_id</span>
<span class="sd">     */</span>
    <span class="k">public</span> <span class="k">function</span> <span class="nf">action_view</span><span class="p">(</span><span class="nv">$attachment_id</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="c1">// Don&#39;t try to load a view</span>
        <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">render</span><span class="p">[</span><span class="s1">&#39;view&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="k">false</span><span class="p">;</span>

        <span class="nb">header</span><span class="p">(</span><span class="nx">Content</span><span class="o">-</span><span class="nx">type</span><span class="o">:</span> <span class="p">{</span><span class="nv">$this</span><span class="o">-&gt;</span><span class="na">attachment</span><span class="o">-&gt;</span><span class="na">type</span><span class="p">});</span>
        <span class="nv">$content_type</span> <span class="o">=</span> <span class="nb">explode</span><span class="p">(</span><span class="s1">&#39;/&#39;</span><span class="p">,</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">attachment</span><span class="o">-&gt;</span><span class="na">type</span><span class="p">);</span>

        <span class="c1">// Check what type of file we&#39;re dealing with.</span>
        <span class="k">if</span><span class="p">(</span><span class="nv">$content_type</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;text&#39;</span> <span class="k">or</span> <span class="nv">$content_type</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;image&#39;</span><span class="p">)</span> <span class="p">{</span>
            <span class="c1">// If the mime-type is text, we can just display it</span>
            <span class="c1">// as plain text. I hate having to download files.</span>
            <span class="k">if</span> <span class="p">(</span><span class="nv">$content_type</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;text&#39;</span><span class="p">)</span> <span class="p">{</span>
                <span class="nb">header</span><span class="p">(</span><span class="nx">Content</span><span class="o">-</span><span class="nx">type</span><span class="o">:</span> <span class="nx">text</span><span class="o">/</span><span class="nx">plain</span><span class="p">);</span>
            <span class="p">}</span>
            <span class="nb">header</span><span class="p">(</span><span class="s2">&quot;Content-Disposition: filename=\</span><span class="si">{</span><span class="nv">$this</span><span class="o">-&gt;</span><span class="na">attachment</span><span class="o">-&gt;</span><span class="na">name</span><span class="si">}</span><span class="se">\\</span><span class="s2">&quot;</span><span class="p">);</span>
        <span class="p">}</span>
        <span class="c1">// Anything else should be downloaded</span>
        <span class="k">else</span> <span class="p">{</span>
            <span class="nb">header</span><span class="p">(</span><span class="s2">&quot;Content-Disposition: attachment; filename=\</span><span class="si">{</span><span class="nv">$this</span><span class="o">-&gt;</span><span class="na">attachment</span><span class="o">-&gt;</span><span class="na">name</span><span class="si">}</span><span class="se">\\</span><span class="s2">&quot;</span><span class="p">);</span>
        <span class="p">}</span>

        <span class="c1">// Decode the contents and display it</span>
        <span class="k">print</span><span class="p">(</span><span class="nb">base64_decode</span><span class="p">(</span><span class="nv">$this</span><span class="o">-&gt;</span><span class="na">attachment</span><span class="o">-&gt;</span><span class="na">contents</span><span class="p">));</span>
        <span class="k">exit</span><span class="p">;</span>
    <span class="p">}</span>
</pre></div>
</div>
</div>
<div class="section" id="case-thinkphp-structures-exitusage">
<span id="id241"></span><h4><span class="section-number">5.2.176.2. </span>ThinkPHP<a class="headerlink" href="#case-thinkphp-structures-exitusage" title="Permalink to this headline">¶</a></h4>
<p><a class="reference internal" href="Rules.html#exit-usage"><span class="std std-ref">Exit() Usage</span></a>, in ThinkPHP/Library/Vendor/EaseTemplate/template.core.php:60.</p>
<p>Here, exit is used as a rudimentary error management. When the version is not correctly provided via EaseTemplateVer, the application stop totally.</p>
<div class="highlight-php notranslate"><div class="highlight"><pre><span></span><span class="nv">$this</span><span class="o">-&gt;</span><span class="na">version</span>              <span class="o">=</span> <span class="p">(</span><span class="nb">trim</span><span class="p">(</span><span class="nv">$_GET</span><span class="p">[</span><span class="s1">&#39;EaseTemplateVer&#39;</span><span class="p">]))</span><span class="o">?</span><span class="k">die</span><span class="p">(</span><span class="s1">&#39;Ease Templae E3!&#39;</span><span class="p">)</span><span class="o">:</span><span class="s1">&#39;&#39;</span><span class="p">;</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="failed-substr-comparison">
<span id="case-failed-substr-comparison"></span><h3><span class="section-number">5.2.177. </span>Failed Substr Comparison<a class="headerlink" href="#failed-substr-comparison" title="Permalink to this headline">¶</a></h3>
<div class="section" id="case-zurmo-structures-failingsubstrcomparison">
<span id="id242"></span><h4><span class="section-number">5.2.177.1. </span>Zurmo<a class="headerlink" href="#case-zurmo-structures-failingsubstrcomparison" title="Permalink to this headline">¶</a></h4>
<p><a class="reference internal" href="Rules.html#failed-substr-comparison"><span class="std std-ref">Failed Substr Comparison</span></a>, in app/protected/modules/zurmo/modules/SecurableModule.php:117.</p>
<p>filterAuditEvent compares a six char string with ‘AUDIT_EVENT_’ which contains 10 chars. This method returns only FALSE. Although it is used only once, the whole block that calls this method is now dead code.</p>
<div class="highlight-php notranslate"><div class="highlight"><pre><span></span><span class="k">private</span> <span class="k">static</span> <span class="k">function</span> <span class="nf">filterAuditEvent</span><span class="p">(</span><span class="nv">$s</span><span class="p">)</span>
        <span class="p">{</span>
            <span class="k">return</span> <span class="nb">substr</span><span class="p">(</span><span class="nv">$s</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">6</span><span class="p">)</span> <span class="o">==</span> <span class="s1">&#39;AUDIT_EVENT_&#39;</span><span class="p">;</span>
        <span class="p">}</span>
</pre></div>
</div>
</div>
<div class="section" id="case-mediawiki-structures-failingsubstrcomparison">
<span id="id243"></span><h4><span class="section-number">5.2.177.2. </span>MediaWiki<a class="headerlink" href="#case-mediawiki-structures-failingsubstrcomparison" title="Permalink to this headline">¶</a></h4>
<p><a class="reference internal" href="Rules.html#failed-substr-comparison"><span class="std std-ref">Failed Substr Comparison</span></a>, in includes/media/DjVu.php:263.</p>
<p>$metadata contains data that may be in different formats. When it is a pure XML file, it is ‘Old style’. The comment helps understanding that this is not the modern way to go : the Old Style is actually never called, due to a failing condition.</p>
<div class="highlight-php notranslate"><div class="highlight"><pre><span></span><span class="k">private</span> <span class="k">function</span> <span class="nf">getUnserializedMetadata</span><span class="p">(</span> <span class="nx">File</span> <span class="nv">$file</span> <span class="p">)</span> <span class="p">{</span>
            <span class="nv">$metadata</span> <span class="o">=</span> <span class="nv">$file</span><span class="o">-&gt;</span><span class="na">getMetadata</span><span class="p">();</span>
            <span class="k">if</span> <span class="p">(</span> <span class="nb">substr</span><span class="p">(</span> <span class="nv">$metadata</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">3</span> <span class="p">)</span> <span class="o">===</span> <span class="s1">&#39;&lt;?xml&#39;</span> <span class="p">)</span> <span class="p">{</span>
                    <span class="c1">// Old style. Not serialized but instead just a raw string of XML.</span>
                    <span class="k">return</span> <span class="nv">$metadata</span><span class="p">;</span>
            <span class="p">}</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="foreach-reference-is-not-modified">
<span id="case-foreach-reference-is-not-modified"></span><h3><span class="section-number">5.2.178. </span>Foreach Reference Is Not Modified<a class="headerlink" href="#foreach-reference-is-not-modified" title="Permalink to this headline">¶</a></h3>
<div class="section" id="case-dolibarr-structures-foreachreferenceisnotmodified">
<span id="id244"></span><h4><span class="section-number">5.2.178.1. </span>Dolibarr<a class="headerlink" href="#case-dolibarr-structures-foreachreferenceisnotmodified" title="Permalink to this headline">¶</a></h4>
<p><a class="reference internal" href="Rules.html#foreach-reference-is-not-modified"><span class="std std-ref">Foreach Reference Is Not Modified</span></a>, in htdocs/product/reassort.php:364.</p>
<p>$wh is an array, and is read for its index ‘id’, but it is not modified. The reference sign is too much.</p>
<div class="highlight-php notranslate"><div class="highlight"><pre><span></span><span class="k">if</span><span class="p">(</span><span class="nv">$nb_warehouse</span><span class="o">&gt;</span><span class="mi">1</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">foreach</span><span class="p">(</span><span class="nv">$warehouses_list</span> <span class="k">as</span> <span class="o">&amp;</span><span class="nv">$wh</span><span class="p">)</span> <span class="p">{</span>

        <span class="k">print</span> <span class="s1">&#39;&lt;td class=right&gt;&#39;</span><span class="p">;</span>
        <span class="k">print</span> <span class="k">empty</span><span class="p">(</span><span class="nv">$product</span><span class="o">-&gt;</span><span class="na">stock_warehouse</span><span class="p">[</span><span class="nv">$wh</span><span class="p">[</span><span class="s1">&#39;id&#39;</span><span class="p">]]</span><span class="o">-&gt;</span><span class="na">real</span><span class="p">)</span> <span class="o">?</span> <span class="s1">&#39;0&#39;</span> <span class="o">:</span> <span class="nv">$product</span><span class="o">-&gt;</span><span class="na">stock_warehouse</span><span class="p">[</span><span class="nv">$wh</span><span class="p">[</span><span class="s1">&#39;id&#39;</span><span class="p">]]</span><span class="o">-&gt;</span><span class="na">real</span><span class="p">;</span>
        <span class="k">print</span> <span class="s1">&#39;&lt;/td&gt;&#39;</span><span class="p">;</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
</div>
<div class="section" id="case-vanilla-structures-foreachreferenceisnotmodified">
<span id="id245"></span><h4><span class="section-number">5.2.178.2. </span>Vanilla<a class="headerlink" href="#case-vanilla-structures-foreachreferenceisnotmodified" title="Permalink to this headline">¶</a></h4>
<p><a class="reference internal" href="Rules.html#foreach-reference-is-not-modified"><span class="std std-ref">Foreach Reference Is Not Modified</span></a>, in applications/vanilla/models/class.discussionmodel.php:944.</p>
<p>$discussion is also an object : it doesn’t need any reference to be modified. And, it is not modified, but only read.</p>
<div class="highlight-php notranslate"><div class="highlight"><pre><span></span><span class="k">foreach</span> <span class="p">(</span><span class="nv">$result</span> <span class="k">as</span> <span class="nv">$key</span> <span class="o">=&gt;</span> <span class="o">&amp;</span><span class="nv">$discussion</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">if</span> <span class="p">(</span><span class="nb">isset</span><span class="p">(</span><span class="nv">$this</span><span class="o">-&gt;</span><span class="na">_AnnouncementIDs</span><span class="p">))</span> <span class="p">{</span>
        <span class="k">if</span> <span class="p">(</span><span class="nb">in_array</span><span class="p">(</span><span class="nv">$discussion</span><span class="o">-&gt;</span><span class="na">DiscussionID</span><span class="p">,</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">_AnnouncementIDs</span><span class="p">))</span> <span class="p">{</span>
            <span class="nb">unset</span><span class="p">(</span><span class="nv">$result</span><span class="p">[</span><span class="nv">$key</span><span class="p">]);</span>
            <span class="nv">$unset</span> <span class="o">=</span> <span class="k">true</span><span class="p">;</span>
        <span class="p">}</span>
    <span class="p">}</span> <span class="k">elseif</span> <span class="p">(</span><span class="nv">$discussion</span><span class="o">-&gt;</span><span class="na">Announce</span> <span class="o">&amp;&amp;</span> <span class="nv">$discussion</span><span class="o">-&gt;</span><span class="na">Dismissed</span> <span class="o">==</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
        <span class="c1">// Unset discussions that are announced and not dismissed</span>
        <span class="nb">unset</span><span class="p">(</span><span class="nv">$result</span><span class="p">[</span><span class="nv">$key</span><span class="p">]);</span>
        <span class="nv">$unset</span> <span class="o">=</span> <span class="k">true</span><span class="p">;</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="overwritten-source-and-value">
<span id="case-overwritten-source-and-value"></span><h3><span class="section-number">5.2.179. </span>Overwritten Source And Value<a class="headerlink" href="#overwritten-source-and-value" title="Permalink to this headline">¶</a></h3>
<div class="section" id="case-churchcrm-structures-foreachsourcevalue">
<span id="id246"></span><h4><span class="section-number">5.2.179.1. </span>ChurchCRM<a class="headerlink" href="#case-churchcrm-structures-foreachsourcevalue" title="Permalink to this headline">¶</a></h4>
<p><a class="reference internal" href="Rules.html#overwritten-source-and-value"><span class="std std-ref">Overwritten Source And Value</span></a>, in edusoho/vendor/symfony/symfony/src/Symfony/Component/VarDumper/Dumper/CliDumper.php:194.</p>
<p>$str is actually processed as an array (string of characters), and it is also modified along the way.</p>
<div class="highlight-php notranslate"><div class="highlight"><pre><span></span><span class="k">foreach</span> <span class="p">(</span><span class="nv">$str</span> <span class="k">as</span> <span class="nv">$str</span><span class="p">)</span> <span class="p">{</span>
                <span class="k">if</span> <span class="p">(</span><span class="nv">$i</span> <span class="o">&lt;</span> <span class="nv">$m</span><span class="p">)</span> <span class="p">{</span>
                    <span class="nv">$str</span> <span class="o">.=</span> <span class="nx">\n</span><span class="p">;</span>
                <span class="p">}</span>
                <span class="k">if</span> <span class="p">(</span><span class="mi">0</span> <span class="o">&lt;</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">maxStringWidth</span> <span class="o">&amp;&amp;</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">maxStringWidth</span> <span class="o">&lt;</span> <span class="nv">$len</span> <span class="o">=</span> <span class="nb">mb_strlen</span><span class="p">(</span><span class="nv">$str</span><span class="p">,</span> <span class="s1">&#39;UTF-8&#39;</span><span class="p">))</span> <span class="p">{</span>
                    <span class="nv">$str</span> <span class="o">=</span> <span class="nb">mb_substr</span><span class="p">(</span><span class="nv">$str</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">maxStringWidth</span><span class="p">,</span> <span class="s1">&#39;UTF-8&#39;</span><span class="p">);</span>
                    <span class="nv">$lineCut</span> <span class="o">=</span> <span class="nv">$len</span> <span class="o">-</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">maxStringWidth</span><span class="p">;</span>
                <span class="p">}</span>
                <span class="c1">//.... More code</span>
</pre></div>
</div>
</div>
<div class="section" id="case-expressionengine-structures-foreachsourcevalue">
<span id="id247"></span><h4><span class="section-number">5.2.179.2. </span>ExpressionEngine<a class="headerlink" href="#case-expressionengine-structures-foreachsourcevalue" title="Permalink to this headline">¶</a></h4>
<p><a class="reference internal" href="Rules.html#overwritten-source-and-value"><span class="std std-ref">Overwritten Source And Value</span></a>, in system/ee/EllisLab/ExpressionEngine/Service/Theme/ThemeInstaller.php:595.</p>
<p>Looping over $filename.</p>
<div class="highlight-php notranslate"><div class="highlight"><pre><span></span><span class="k">foreach</span> <span class="p">(</span><span class="nx">directory_map</span><span class="p">(</span><span class="nv">$to_dir</span><span class="p">)</span> <span class="k">as</span> <span class="nv">$directory</span> <span class="o">=&gt;</span> <span class="nv">$filename</span><span class="p">)</span>
                    <span class="p">{</span>
                            <span class="k">if</span> <span class="p">(</span><span class="nb">is_string</span><span class="p">(</span><span class="nv">$directory</span><span class="p">))</span>
                            <span class="p">{</span>
                                    <span class="k">foreach</span> <span class="p">(</span><span class="nv">$filename</span> <span class="k">as</span> <span class="nv">$filename</span><span class="p">)</span>
                                    <span class="p">{</span>
                                            <span class="nb">unlink</span><span class="p">(</span><span class="nv">$to_dir</span><span class="o">.</span><span class="nv">$directory</span><span class="o">.</span><span class="s1">&#39;/&#39;</span><span class="o">.</span><span class="nv">$filename</span><span class="p">);</span>
                                    <span class="p">}</span>

                                    <span class="o">@</span><span class="nb">rmdir</span><span class="p">(</span><span class="nv">$to_dir</span><span class="o">.</span><span class="nv">$directory</span><span class="p">);</span>
                            <span class="p">}</span>
                            <span class="k">else</span>
                            <span class="p">{</span>
                                    <span class="nb">unlink</span><span class="p">(</span><span class="nv">$to_dir</span><span class="o">.</span><span class="nv">$filename</span><span class="p">);</span>
                            <span class="p">}</span>
                    <span class="p">}</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="function-subscripting-old-style">
<span id="case-function-subscripting-old-style"></span><h3><span class="section-number">5.2.180. </span>Function Subscripting, Old Style<a class="headerlink" href="#function-subscripting-old-style" title="Permalink to this headline">¶</a></h3>
<div class="section" id="case-openconf-structures-functionpresubscripting">
<span id="id248"></span><h4><span class="section-number">5.2.180.1. </span>OpenConf<a class="headerlink" href="#case-openconf-structures-functionpresubscripting" title="Permalink to this headline">¶</a></h4>
<p><a class="reference internal" href="Rules.html#function-subscripting-old-style"><span class="std std-ref">Function Subscripting, Old Style</span></a>, in openconf/include.php:1469.</p>
<p>Here, $advocateid may be directly read from ocsql_fetch_assoc(), although, checking for the existence of ‘advocateid’ before accessing it would make the code more robust</p>
<div class="highlight-php notranslate"><div class="highlight"><pre><span></span><span class="nv">$advocateid</span> <span class="o">=</span> <span class="k">false</span><span class="p">;</span>
    <span class="k">if</span> <span class="p">(</span><span class="nb">isset</span><span class="p">(</span><span class="nv">$GLOBALS</span><span class="p">[</span><span class="s1">&#39;OC_configAR&#39;</span><span class="p">][</span><span class="s1">&#39;OC_paperAdvocates&#39;</span><span class="p">])</span> <span class="o">&amp;&amp;</span> <span class="nv">$GLOBALS</span><span class="p">[</span><span class="s1">&#39;OC_configAR&#39;</span><span class="p">][</span><span class="s1">&#39;OC_paperAdvocates&#39;</span><span class="p">])</span> <span class="p">{</span>
            <span class="nv">$ar</span> <span class="o">=</span> <span class="nx">ocsql_query</span><span class="p">(</span><span class="nx">SELECT</span> <span class="sb">`advocateid`</span> <span class="nx">FROM</span> <span class="sb">` . OCC_TABLE_PAPERADVOCATE . `</span> <span class="nx">WHERE</span> <span class="sb">`paperid`</span><span class="o">=</span><span class="s1">&#39; . safeSQLstr($pid) . &#39;</span><span class="p">)</span> <span class="k">or</span> <span class="nx">err</span><span class="p">(</span><span class="s1">&#39;Unable to retrieve advocate&#39;</span><span class="p">);</span>
            <span class="k">if</span> <span class="p">(</span><span class="nx">ocsql_num_rows</span><span class="p">(</span><span class="nv">$ar</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span><span class="p">)</span> <span class="p">{</span>
                    <span class="nv">$al</span> <span class="o">=</span> <span class="nx">ocsql_fetch_assoc</span><span class="p">(</span><span class="nv">$ar</span><span class="p">);</span>
                    <span class="nv">$advocateid</span> <span class="o">=</span> <span class="nv">$al</span><span class="p">[</span><span class="s1">&#39;advocateid&#39;</span><span class="p">];</span>
            <span class="p">}</span>
    <span class="p">}</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="case-identical-conditions">
<span id="identical-conditions"></span><h3><span class="section-number">5.2.181. </span>Identical Conditions<a class="headerlink" href="#case-identical-conditions" title="Permalink to this headline">¶</a></h3>
<div class="section" id="case-wordpress-structures-identicalconditions">
<span id="id249"></span><h4><span class="section-number">5.2.181.1. </span>WordPress<a class="headerlink" href="#case-wordpress-structures-identicalconditions" title="Permalink to this headline">¶</a></h4>
<p><a class="reference internal" href="Rules.html#identical-conditions"><span class="std std-ref">Identical Conditions</span></a>, in wp-admin/theme-editor.php:247.</p>
<p>The condition checks first if $has_templates or $theme-&gt;parent(), and one of the two is sufficient to be valid. Then, it checks again that $theme-&gt;parent() is activated with &amp;&amp;. This condition may be reduced by calling $theme-&gt;parent(), as $has_template is unused here.</p>
<div class="highlight-php notranslate"><div class="highlight"><pre><span></span><span class="o">&lt;?</span><span class="nx">php</span> <span class="k">if</span> <span class="p">(</span> <span class="p">(</span> <span class="nv">$has_templates</span> <span class="o">||</span> <span class="nv">$theme</span><span class="o">-&gt;</span><span class="na">parent</span><span class="p">()</span> <span class="p">)</span> <span class="o">&amp;&amp;</span> <span class="nv">$theme</span><span class="o">-&gt;</span><span class="na">parent</span><span class="p">()</span> <span class="p">)</span> <span class="o">:</span> <span class="cp">?&gt;</span><span class="x"></span>
</pre></div>
</div>
</div>
<div class="section" id="case-dolibarr-structures-identicalconditions">
<span id="id250"></span><h4><span class="section-number">5.2.181.2. </span>Dolibarr<a class="headerlink" href="#case-dolibarr-structures-identicalconditions" title="Permalink to this headline">¶</a></h4>
<p><a class="reference internal" href="Rules.html#identical-conditions"><span class="std std-ref">Identical Conditions</span></a>, in htdocs/core/lib/files.lib.php:2052.</p>
<p>Better check twice that $modulepart is really ‘apercusupplier_invoice’.</p>
<div class="highlight-php notranslate"><div class="highlight"><pre><span></span><span class="nv">$modulepart</span> <span class="o">==</span> <span class="s1">&#39;apercusupplier_invoice&#39;</span> <span class="o">||</span> <span class="nv">$modulepart</span> <span class="o">==</span> <span class="s1">&#39;apercusupplier_invoice&#39;</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="case-identical-on-both-sides">
<span id="identical-on-both-sides"></span><h3><span class="section-number">5.2.182. </span>Identical On Both Sides<a class="headerlink" href="#case-identical-on-both-sides" title="Permalink to this headline">¶</a></h3>
<div class="section" id="case-phpmyadmin-structures-identicalonbothsides">
<span id="id251"></span><h4><span class="section-number">5.2.182.1. </span>phpMyAdmin<a class="headerlink" href="#case-phpmyadmin-structures-identicalonbothsides" title="Permalink to this headline">¶</a></h4>
<p><a class="reference internal" href="Rules.html#identical-on-both-sides"><span class="std std-ref">Identical On Both Sides</span></a>, in libraries/classes/DatabaseInterface.php:323.</p>
<p>This code looks like <code class="docutils literal notranslate"><span class="pre">($options</span> <span class="pre">&amp;</span> <span class="pre">DatabaseInterface::QUERY_STORE)</span> <span class="pre">==</span> <span class="pre">DatabaseInterface::QUERY_STORE</span></code>, which would make sense. But PHP precedence is actually executing <code class="docutils literal notranslate"><span class="pre">$options</span> <span class="pre">&amp;</span> <span class="pre">(DatabaseInterface::QUERY_STORE</span> <span class="pre">==</span> <span class="pre">DatabaseInterface::QUERY_STORE)</span></code>, which then doesn’t depends on QUERY_STORE but only on $options.</p>
<div class="highlight-php notranslate"><div class="highlight"><pre><span></span><span class="k">if</span> <span class="p">(</span><span class="nv">$options</span> <span class="o">&amp;</span> <span class="nx">DatabaseInterface</span><span class="o">::</span><span class="na">QUERY_STORE</span> <span class="o">==</span> <span class="nx">DatabaseInterface</span><span class="o">::</span><span class="na">QUERY_STORE</span><span class="p">)</span> <span class="p">{</span>
    <span class="nv">$tmp</span> <span class="o">=</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">_extension</span><span class="o">-&gt;</span><span class="na">realQuery</span><span class="p">(</span><span class="s1">&#39;</span>
<span class="s1">        SHOW COUNT(*) WARNINGS&#39;</span><span class="p">,</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">_links</span><span class="p">[</span><span class="nv">$link</span><span class="p">],</span> <span class="nx">DatabaseInterface</span><span class="o">::</span><span class="na">QUERY_STORE</span>
    <span class="p">);</span>
    <span class="nv">$warnings</span> <span class="o">=</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">fetchRow</span><span class="p">(</span><span class="nv">$tmp</span><span class="p">);</span>
<span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
    <span class="nv">$warnings</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>
</div>
</div>
<div class="section" id="case-humo-gen-structures-identicalonbothsides">
<span id="id252"></span><h4><span class="section-number">5.2.182.2. </span>HuMo-Gen<a class="headerlink" href="#case-humo-gen-structures-identicalonbothsides" title="Permalink to this headline">¶</a></h4>
<p><a class="reference internal" href="Rules.html#identical-on-both-sides"><span class="std std-ref">Identical On Both Sides</span></a>, in include/person_cls.php:73.</p>
<p>In that long logical expression, $personDb-&gt;pers_cal_date is tested twice</p>
<div class="highlight-php notranslate"><div class="highlight"><pre><span></span><span class="c1">// *** Filter person&#39;s WITHOUT any date&#39;s ***</span>
                    <span class="k">if</span> <span class="p">(</span><span class="nv">$user</span><span class="p">[</span><span class="nx">group_filter_date</span><span class="p">]</span><span class="o">==</span><span class="s1">&#39;j&#39;</span><span class="p">){</span>
                            <span class="k">if</span> <span class="p">(</span><span class="nv">$personDb</span><span class="o">-&gt;</span><span class="na">pers_birth_date</span><span class="o">==</span><span class="s1">&#39;&#39;</span> <span class="k">AND</span> <span class="nv">$personDb</span><span class="o">-&gt;</span><span class="na">pers_bapt_date</span><span class="o">==</span><span class="s1">&#39;&#39;</span>
                            <span class="k">AND</span> <span class="nv">$personDb</span><span class="o">-&gt;</span><span class="na">pers_death_date</span><span class="o">==</span><span class="s1">&#39;&#39;</span> <span class="k">AND</span> <span class="nv">$personDb</span><span class="o">-&gt;</span><span class="na">pers_buried_date</span><span class="o">==</span><span class="s1">&#39;&#39;</span>
                            <span class="k">AND</span> <span class="nv">$personDb</span><span class="o">-&gt;</span><span class="na">pers_cal_date</span><span class="o">==</span><span class="s1">&#39;&#39;</span> <span class="k">AND</span> <span class="nv">$personDb</span><span class="o">-&gt;</span><span class="na">pers_cal_date</span><span class="o">==</span><span class="s1">&#39;&#39;</span>
                            <span class="p">){</span>
                                    <span class="nv">$privacy_person</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">;</span>
                            <span class="p">}</span>
                    <span class="p">}</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="if-with-same-conditions">
<span id="case-if-with-same-conditions"></span><h3><span class="section-number">5.2.183. </span>If With Same Conditions<a class="headerlink" href="#if-with-same-conditions" title="Permalink to this headline">¶</a></h3>
<div class="section" id="case-phpmyadmin-structures-ifwithsameconditions">
<span id="id253"></span><h4><span class="section-number">5.2.183.1. </span>phpMyAdmin<a class="headerlink" href="#case-phpmyadmin-structures-ifwithsameconditions" title="Permalink to this headline">¶</a></h4>
<p><a class="reference internal" href="Rules.html#if-with-same-conditions"><span class="std std-ref">If With Same Conditions</span></a>, in libraries/classes/Response.php:345.</p>
<p>The first test on $this-&gt;_isSuccess settles the situation with _JSON. Then, a second check is made. Both could be merged, also the second one is fairly long (not shown).</p>
<div class="highlight-php notranslate"><div class="highlight"><pre><span></span><span class="k">if</span> <span class="p">(</span><span class="nv">$this</span><span class="o">-&gt;</span><span class="na">_isSuccess</span><span class="p">)</span> <span class="p">{</span>
            <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">_JSON</span><span class="p">[</span><span class="s1">&#39;success&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="k">true</span><span class="p">;</span>
        <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
            <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">_JSON</span><span class="p">[</span><span class="s1">&#39;success&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="k">false</span><span class="p">;</span>
            <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">_JSON</span><span class="p">[</span><span class="s1">&#39;error&#39;</span><span class="p">]</span>   <span class="o">=</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">_JSON</span><span class="p">[</span><span class="s1">&#39;message&#39;</span><span class="p">];</span>
            <span class="nb">unset</span><span class="p">(</span><span class="nv">$this</span><span class="o">-&gt;</span><span class="na">_JSON</span><span class="p">[</span><span class="s1">&#39;message&#39;</span><span class="p">]);</span>
        <span class="p">}</span>

        <span class="k">if</span> <span class="p">(</span><span class="nv">$this</span><span class="o">-&gt;</span><span class="na">_isSuccess</span><span class="p">)</span> <span class="p">{</span>
</pre></div>
</div>
</div>
<div class="section" id="case-phpdocumentor-structures-ifwithsameconditions">
<span id="id254"></span><h4><span class="section-number">5.2.183.2. </span>Phpdocumentor<a class="headerlink" href="#case-phpdocumentor-structures-ifwithsameconditions" title="Permalink to this headline">¶</a></h4>
<p><a class="reference internal" href="Rules.html#if-with-same-conditions"><span class="std std-ref">If With Same Conditions</span></a>, in src/phpDocumentor/Transformer/Command/Project/TransformCommand.php:239.</p>
<p>$templates is extracted from $input. If it is empty, a second source is polled. Finally, if nothing has worked, a default value is used (‘clean’). In this case, each attempt is an alternative solution to the previous failing call. The second test could be reported on $templatesFromConfig, and not $templates.</p>
<div class="highlight-php notranslate"><div class="highlight"><pre><span></span><span class="nv">$templates</span> <span class="o">=</span> <span class="nv">$input</span><span class="o">-&gt;</span><span class="na">getOption</span><span class="p">(</span><span class="s1">&#39;template&#39;</span><span class="p">);</span>
        <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nv">$templates</span><span class="p">)</span> <span class="p">{</span>
            <span class="sd">/** @var Template[] $templatesFromConfig */</span>
            <span class="nv">$templatesFromConfig</span> <span class="o">=</span> <span class="nv">$configurationHelper</span><span class="o">-&gt;</span><span class="na">getConfigValueFromPath</span><span class="p">(</span><span class="s1">&#39;transformations/templates&#39;</span><span class="p">);</span>
            <span class="k">foreach</span> <span class="p">(</span><span class="nv">$templatesFromConfig</span> <span class="k">as</span> <span class="nv">$template</span><span class="p">)</span> <span class="p">{</span>
                <span class="nv">$templates</span><span class="p">[]</span> <span class="o">=</span> <span class="nv">$template</span><span class="o">-&gt;</span><span class="na">getName</span><span class="p">();</span>
            <span class="p">}</span>
        <span class="p">}</span>

        <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nv">$templates</span><span class="p">)</span> <span class="p">{</span>
            <span class="nv">$templates</span> <span class="o">=</span> <span class="k">array</span><span class="p">(</span><span class="s1">&#39;clean&#39;</span><span class="p">);</span>
        <span class="p">}</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="inconsistent-concatenation">
<span id="case-inconsistent-concatenation"></span><h3><span class="section-number">5.2.184. </span>Inconsistent Concatenation<a class="headerlink" href="#inconsistent-concatenation" title="Permalink to this headline">¶</a></h3>
<div class="section" id="case-fuelcms-structures-inconsistentconcatenation">
<span id="id255"></span><h4><span class="section-number">5.2.184.1. </span>FuelCMS<a class="headerlink" href="#case-fuelcms-structures-inconsistentconcatenation" title="Permalink to this headline">¶</a></h4>
<p><a class="reference internal" href="Rules.html#inconsistent-concatenation"><span class="std std-ref">Inconsistent Concatenation</span></a>, in wp-admin/includes/misc.php:74.</p>
<p>This code actually loads the file, join it, then split it again. file() would be sufficient.</p>
<div class="highlight-php notranslate"><div class="highlight"><pre><span></span><span class="nv">$markerdata</span> <span class="o">=</span> <span class="nb">explode</span><span class="p">(</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">,</span> <span class="nb">implode</span><span class="p">(</span> <span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="nb">file</span><span class="p">(</span> <span class="nv">$filename</span> <span class="p">)</span> <span class="p">)</span> <span class="p">);</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="indices-are-int-or-string">
<span id="case-indices-are-int-or-string"></span><h3><span class="section-number">5.2.185. </span>Indices Are Int Or String<a class="headerlink" href="#indices-are-int-or-string" title="Permalink to this headline">¶</a></h3>
<div class="section" id="case-zencart-structures-indicesareintorstring">
<span id="id256"></span><h4><span class="section-number">5.2.185.1. </span>Zencart<a class="headerlink" href="#case-zencart-structures-indicesareintorstring" title="Permalink to this headline">¶</a></h4>
<p><a class="reference internal" href="Rules.html#indices-are-int-or-string"><span class="std std-ref">Indices Are Int Or String</span></a>, in includes/modules/payment/paypaldp.php:2523.</p>
<p>All those strings ends up as integers.</p>
<div class="highlight-php notranslate"><div class="highlight"><pre><span></span><span class="c1">// Build Currency format table</span>
    <span class="nv">$curFormat</span> <span class="o">=</span> <span class="k">Array</span><span class="p">();</span>
    <span class="nv">$curFormat</span><span class="p">[</span><span class="mo">036</span><span class="p">]</span><span class="o">=</span><span class="mi">2</span><span class="p">;</span>
    <span class="nv">$curFormat</span><span class="p">[</span><span class="mi">124</span><span class="p">]</span><span class="o">=</span><span class="mi">2</span><span class="p">;</span>
    <span class="nv">$curFormat</span><span class="p">[</span><span class="mi">203</span><span class="p">]</span><span class="o">=</span><span class="mi">2</span><span class="p">;</span>
    <span class="nv">$curFormat</span><span class="p">[</span><span class="mi">208</span><span class="p">]</span><span class="o">=</span><span class="mi">2</span><span class="p">;</span>
    <span class="nv">$curFormat</span><span class="p">[</span><span class="mi">348</span><span class="p">]</span><span class="o">=</span><span class="mi">2</span><span class="p">;</span>
    <span class="nv">$curFormat</span><span class="p">[</span><span class="mi">392</span><span class="p">]</span><span class="o">=</span><span class="mi">0</span><span class="p">;</span>
    <span class="nv">$curFormat</span><span class="p">[</span><span class="mi">554</span><span class="p">]</span><span class="o">=</span><span class="mi">2</span><span class="p">;</span>
    <span class="nv">$curFormat</span><span class="p">[</span><span class="mi">578</span><span class="p">]</span><span class="o">=</span><span class="mi">2</span><span class="p">;</span>
    <span class="nv">$curFormat</span><span class="p">[</span><span class="mi">702</span><span class="p">]</span><span class="o">=</span><span class="mi">2</span><span class="p">;</span>
    <span class="nv">$curFormat</span><span class="p">[</span><span class="mi">752</span><span class="p">]</span><span class="o">=</span><span class="mi">2</span><span class="p">;</span>
    <span class="nv">$curFormat</span><span class="p">[</span><span class="mi">756</span><span class="p">]</span><span class="o">=</span><span class="mi">2</span><span class="p">;</span>
    <span class="nv">$curFormat</span><span class="p">[</span><span class="mi">826</span><span class="p">]</span><span class="o">=</span><span class="mi">2</span><span class="p">;</span>
    <span class="nv">$curFormat</span><span class="p">[</span><span class="mi">840</span><span class="p">]</span><span class="o">=</span><span class="mi">2</span><span class="p">;</span>
    <span class="nv">$curFormat</span><span class="p">[</span><span class="mi">978</span><span class="p">]</span><span class="o">=</span><span class="mi">2</span><span class="p">;</span>
    <span class="nv">$curFormat</span><span class="p">[</span><span class="mi">985</span><span class="p">]</span><span class="o">=</span><span class="mi">2</span><span class="p">;</span>
</pre></div>
</div>
</div>
<div class="section" id="case-mautic-structures-indicesareintorstring">
<span id="id257"></span><h4><span class="section-number">5.2.185.2. </span>Mautic<a class="headerlink" href="#case-mautic-structures-indicesareintorstring" title="Permalink to this headline">¶</a></h4>
<p><a class="reference internal" href="Rules.html#indices-are-int-or-string"><span class="std std-ref">Indices Are Int Or String</span></a>, in app/bundles/CoreBundle/Entity/CommonRepository.php:315.</p>
<p>$baseCols has 1 and 0 (respectively) for index.</p>
<div class="highlight-php notranslate"><div class="highlight"><pre><span></span><span class="k">foreach</span> <span class="p">(</span><span class="nv">$metadata</span><span class="o">-&gt;</span><span class="na">getAssociationMappings</span><span class="p">()</span> <span class="k">as</span> <span class="nv">$field</span> <span class="o">=&gt;</span> <span class="nv">$association</span><span class="p">)</span> <span class="p">{</span>
                    <span class="k">if</span> <span class="p">(</span><span class="nb">in_array</span><span class="p">(</span><span class="nv">$association</span><span class="p">[</span><span class="s1">&#39;type&#39;</span><span class="p">],</span> <span class="p">[</span><span class="nx">ClassMetadataInfo</span><span class="o">::</span><span class="na">ONE_TO_ONE</span><span class="p">,</span> <span class="nx">ClassMetadataInfo</span><span class="o">::</span><span class="na">MANY_TO_ONE</span><span class="p">]))</span> <span class="p">{</span>
                        <span class="nv">$baseCols</span><span class="p">[</span><span class="k">true</span><span class="p">][</span><span class="nv">$entityClass</span><span class="p">][]</span>  <span class="o">=</span> <span class="nv">$association</span><span class="p">[</span><span class="s1">&#39;joinColumns&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">][</span><span class="s1">&#39;name&#39;</span><span class="p">];</span>
                        <span class="nv">$baseCols</span><span class="p">[</span><span class="k">false</span><span class="p">][</span><span class="nv">$entityClass</span><span class="p">][]</span> <span class="o">=</span> <span class="nv">$field</span><span class="p">;</span>
                    <span class="p">}</span>
                <span class="p">}</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="invalid-regex">
<span id="case-invalid-regex"></span><h3><span class="section-number">5.2.186. </span>Invalid Regex<a class="headerlink" href="#invalid-regex" title="Permalink to this headline">¶</a></h3>
<div class="section" id="case-sugarcrm-structures-invalidregex">
<span id="id258"></span><h4><span class="section-number">5.2.186.1. </span>SugarCrm<a class="headerlink" href="#case-sugarcrm-structures-invalidregex" title="Permalink to this headline">¶</a></h4>
<p><a class="reference internal" href="Rules.html#invalid-regex"><span class="std std-ref">Invalid Regex</span></a>, in SugarCE-Full-6.5.26/include/utils/file_utils.php:513.</p>
<p>This yields an error at execution time : <a href="#id259"><span class="problematic" id="id260">``</span></a>Compilation failed: invalid range in character class at offset 4 <a href="#id261"><span class="problematic" id="id262">``</span></a>.</p>
<div class="highlight-php notranslate"><div class="highlight"><pre><span></span><span class="nb">preg_replace</span><span class="p">(</span><span class="s1">&#39;/[^\w-._]+/i&#39;</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="nv">$name</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="is-actually-zero">
<span id="case-is-actually-zero"></span><h3><span class="section-number">5.2.187. </span>Is Actually Zero<a class="headerlink" href="#is-actually-zero" title="Permalink to this headline">¶</a></h3>
<div class="section" id="case-dolibarr-structures-iszero">
<span id="id263"></span><h4><span class="section-number">5.2.187.1. </span>Dolibarr<a class="headerlink" href="#case-dolibarr-structures-iszero" title="Permalink to this headline">¶</a></h4>
<p><a class="reference internal" href="Rules.html#is-actually-zero"><span class="std std-ref">Is Actually Zero</span></a>, in htdocs/compta/ajaxpayment.php:99.</p>
<p>Here, the $amountToBreakDown is either $currentRemain or $result.</p>
<div class="highlight-php notranslate"><div class="highlight"><pre><span></span><span class="nv">$amountToBreakdown</span> <span class="o">=</span> <span class="p">(</span><span class="nv">$result</span> <span class="o">-</span> <span class="nv">$currentRemain</span> <span class="o">&gt;=</span> <span class="mi">0</span> <span class="o">?</span>
                                                                            <span class="nv">$currentRemain</span> <span class="o">:</span>                                                                <span class="c1">// Remain can be fully paid</span>
                                                                            <span class="nv">$currentRemain</span> <span class="o">+</span> <span class="p">(</span><span class="nv">$result</span> <span class="o">-</span> <span class="nv">$currentRemain</span><span class="p">));</span>   <span class="c1">// Remain can only partially be paid</span>
</pre></div>
</div>
</div>
<div class="section" id="case-suitecrm-structures-iszero">
<span id="id264"></span><h4><span class="section-number">5.2.187.2. </span>SuiteCrm<a class="headerlink" href="#case-suitecrm-structures-iszero" title="Permalink to this headline">¶</a></h4>
<p><a class="reference internal" href="Rules.html#is-actually-zero"><span class="std std-ref">Is Actually Zero</span></a>, in modules/AOR_Charts/lib/pChart/class/pDraw.class.php:523.</p>
<p>$Xa may only amount to $iX2, though the expression looks weird.</p>
<div class="highlight-php notranslate"><div class="highlight"><pre><span></span><span class="k">if</span> <span class="p">(</span> <span class="nv">$X</span> <span class="o">&gt;</span> <span class="nv">$iX2</span> <span class="p">)</span> <span class="p">{</span> <span class="nv">$Xa</span> <span class="o">=</span> <span class="nv">$X</span><span class="o">-</span><span class="p">(</span><span class="nv">$X</span><span class="o">-</span><span class="nv">$iX2</span><span class="p">);</span> <span class="nv">$Ya</span> <span class="o">=</span> <span class="nv">$iY1</span><span class="o">+</span><span class="p">(</span><span class="nv">$X</span><span class="o">-</span><span class="nv">$iX2</span><span class="p">);</span> <span class="p">}</span> <span class="k">else</span> <span class="p">{</span> <span class="nv">$Xa</span> <span class="o">=</span> <span class="nv">$X</span><span class="p">;</span> <span class="nv">$Ya</span> <span class="o">=</span> <span class="nv">$iY1</span><span class="p">;</span> <span class="p">}</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="list-may-omit-variables">
<span id="case-list-may-omit-variables"></span><h3><span class="section-number">5.2.188. </span>list() May Omit Variables<a class="headerlink" href="#list-may-omit-variables" title="Permalink to this headline">¶</a></h3>
<div class="section" id="case-openconf-structures-listomissions">
<span id="id265"></span><h4><span class="section-number">5.2.188.1. </span>OpenConf<a class="headerlink" href="#case-openconf-structures-listomissions" title="Permalink to this headline">¶</a></h4>
<p><a class="reference internal" href="Rules.html#list-may-omit-variables"><span class="std std-ref">list() May Omit Variables</span></a>, in openconf/author/privacy.php:29.</p>
<p>The first variable in the list(), $none, isn’t reused anywhere in the script. In fact, its name convey the meaning that is it useless, but is in the array nonetheless.</p>
<div class="highlight-php notranslate"><div class="highlight"><pre><span></span><span class="k">list</span><span class="p">(</span><span class="nv">$none</span><span class="p">,</span> <span class="nv">$OC_privacy_policy</span><span class="p">)</span> <span class="o">=</span> <span class="nx">oc_getTemplate</span><span class="p">(</span><span class="s1">&#39;privacy_policy&#39;</span><span class="p">);</span>
</pre></div>
</div>
</div>
<div class="section" id="case-fuelcms-structures-listomissions">
<span id="id266"></span><h4><span class="section-number">5.2.188.2. </span>FuelCMS<a class="headerlink" href="#case-fuelcms-structures-listomissions" title="Permalink to this headline">¶</a></h4>
<p><a class="reference internal" href="Rules.html#list-may-omit-variables"><span class="std std-ref">list() May Omit Variables</span></a>, in wp-admin/includes/misc.php:74.</p>
<p>$a is never reused again. $b, on the other hand is. Not assigning any value to $a saves some memory, and avoid polluting the local variable space.</p>
<div class="highlight-php notranslate"><div class="highlight"><pre><span></span><span class="k">list</span><span class="p">(</span><span class="nv">$b</span><span class="p">,</span> <span class="nv">$a</span><span class="p">)</span> <span class="o">=</span> <span class="k">array</span><span class="p">(</span><span class="nb">reset</span><span class="p">(</span><span class="nv">$params</span><span class="o">-&gt;</span><span class="na">me</span><span class="p">),</span> <span class="nb">key</span><span class="p">(</span><span class="nv">$params</span><span class="o">-&gt;</span><span class="na">me</span><span class="p">));</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="logical-mistakes">
<span id="case-logical-mistakes"></span><h3><span class="section-number">5.2.189. </span>Logical Mistakes<a class="headerlink" href="#logical-mistakes" title="Permalink to this headline">¶</a></h3>
<div class="section" id="case-dolibarr-structures-logicalmistakes">
<span id="id267"></span><h4><span class="section-number">5.2.189.1. </span>Dolibarr<a class="headerlink" href="#case-dolibarr-structures-logicalmistakes" title="Permalink to this headline">¶</a></h4>
<p><a class="reference internal" href="Rules.html#logical-mistakes"><span class="std std-ref">Logical Mistakes</span></a>, in htdocs/core/lib/admin.lib.php:1165.</p>
<p>This expression is always true. When <cite>$nbtabsql</cite> is <cite>$nbtablib</cite>, the left part is true; When <cite>$nbtabsql</cite> is <cite>$nbtabsqlsort</cite>, the right part is true; When any other value is provided, both operands are true.</p>
<div class="highlight-php notranslate"><div class="highlight"><pre><span></span><span class="nv">$nbtablib</span> <span class="o">!=</span> <span class="nv">$nbtabsql</span> <span class="o">||</span> <span class="nv">$nbtabsql</span> <span class="o">!=</span> <span class="nv">$nbtabsqlsort</span>
</pre></div>
</div>
</div>
<div class="section" id="case-cleverstyle-structures-logicalmistakes">
<span id="id268"></span><h4><span class="section-number">5.2.189.2. </span>Cleverstyle<a class="headerlink" href="#case-cleverstyle-structures-logicalmistakes" title="Permalink to this headline">¶</a></h4>
<p><a class="reference internal" href="Rules.html#logical-mistakes"><span class="std std-ref">Logical Mistakes</span></a>, in modules/HybridAuth/Hybrid/Providers/DigitalOcean.php:123.</p>
<p>This expression is always false. When <cite>$data-&gt;account-&gt;email_verified</cite> is <cite>true</cite>, the right part is false; When <cite>$data-&gt;account-&gt;email_verified</cite> is <cite>$data-&gt;account-&gt;email</cite>, the right part is false; The only viable solution is to have ` $data-&gt;account-&gt;email`true : this is may be the intend it, though it is not easy to understand.</p>
<div class="highlight-php notranslate"><div class="highlight"><pre><span></span><span class="k">TRUE</span> <span class="o">==</span> <span class="nv">$data</span><span class="o">-&gt;</span><span class="na">account</span><span class="o">-&gt;</span><span class="na">email_verified</span> <span class="k">and</span> <span class="nv">$data</span><span class="o">-&gt;</span><span class="na">account</span><span class="o">-&gt;</span><span class="na">email</span> <span class="o">==</span> <span class="nv">$data</span><span class="o">-&gt;</span><span class="na">account</span><span class="o">-&gt;</span><span class="na">email_verified</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="lone-blocks">
<span id="case-lone-blocks"></span><h3><span class="section-number">5.2.190. </span>Lone Blocks<a class="headerlink" href="#lone-blocks" title="Permalink to this headline">¶</a></h3>
<div class="section" id="case-thinkphp-structures-loneblock">
<span id="id269"></span><h4><span class="section-number">5.2.190.1. </span>ThinkPHP<a class="headerlink" href="#case-thinkphp-structures-loneblock" title="Permalink to this headline">¶</a></h4>
<p><a class="reference internal" href="Rules.html#lone-blocks"><span class="std std-ref">Lone Blocks</span></a>, in ThinkPHP/Library/Vendor/Hprose/HproseReader.php:163.</p>
<p>There is no need for block in a case/default clause. PHP executes all command in order, until a break or the end of the switch. There is another occurrence of that situation in this code : it seems to be a coding convention, while only applied to a few switch statements.</p>
<div class="highlight-php notranslate"><div class="highlight"><pre><span></span><span class="k">for</span> <span class="p">(</span><span class="nv">$i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="nv">$i</span> <span class="o">&lt;</span> <span class="nv">$len</span><span class="p">;</span> <span class="o">++</span><span class="nv">$i</span><span class="p">)</span> <span class="p">{</span>
            <span class="k">switch</span> <span class="p">(</span><span class="nb">ord</span><span class="p">(</span><span class="nv">$this</span><span class="o">-&gt;</span><span class="na">stream</span><span class="o">-&gt;</span><span class="na">getc</span><span class="p">())</span> <span class="o">&gt;&gt;</span> <span class="mi">4</span><span class="p">)</span> <span class="p">{</span>
                <span class="k">case</span> <span class="mi">0</span><span class="o">:</span>
                <span class="k">case</span> <span class="mi">1</span><span class="o">:</span>
                <span class="k">case</span> <span class="mi">2</span><span class="o">:</span>
                <span class="k">case</span> <span class="mi">3</span><span class="o">:</span>
                <span class="k">case</span> <span class="mi">4</span><span class="o">:</span>
                <span class="k">case</span> <span class="mi">5</span><span class="o">:</span>
                <span class="k">case</span> <span class="mi">6</span><span class="o">:</span>
                <span class="k">case</span> <span class="mi">7</span><span class="o">:</span> <span class="p">{</span>
                    <span class="c1">// 0xxx xxxx</span>
                    <span class="nv">$utf8len</span><span class="o">++</span><span class="p">;</span>
                    <span class="k">break</span><span class="p">;</span>
                <span class="p">}</span>
                <span class="k">case</span> <span class="mi">12</span><span class="o">:</span>
                <span class="k">case</span> <span class="mi">13</span><span class="o">:</span> <span class="p">{</span>
                    <span class="c1">// 110x xxxx   10xx xxxx</span>
                    <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">stream</span><span class="o">-&gt;</span><span class="na">skip</span><span class="p">(</span><span class="mi">1</span><span class="p">);</span>
                    <span class="nv">$utf8len</span> <span class="o">+=</span> <span class="mi">2</span><span class="p">;</span>
                    <span class="k">break</span><span class="p">;</span>
                <span class="p">}</span>
</pre></div>
</div>
</div>
<div class="section" id="case-tine20-structures-loneblock">
<span id="id270"></span><h4><span class="section-number">5.2.190.2. </span>Tine20<a class="headerlink" href="#case-tine20-structures-loneblock" title="Permalink to this headline">¶</a></h4>
<p><a class="reference internal" href="Rules.html#lone-blocks"><span class="std std-ref">Lone Blocks</span></a>, in tine20/Addressbook/Convert/Contact/VCard/Abstract.php:199.</p>
<p>A case of empty case, with empty blocks. This is useless code. Event the curly brackets with the final case are useless.</p>
<div class="highlight-php notranslate"><div class="highlight"><pre><span></span><span class="k">switch</span> <span class="p">(</span> <span class="nv">$property</span><span class="p">[</span><span class="s1">&#39;TYPE&#39;</span><span class="p">]</span> <span class="p">)</span> <span class="p">{</span>
                        <span class="k">case</span> <span class="s1">&#39;JPG&#39;</span> <span class="o">:</span> <span class="p">{}</span>
                        <span class="k">case</span> <span class="s1">&#39;jpg&#39;</span> <span class="o">:</span> <span class="p">{}</span>
                        <span class="k">case</span> <span class="s1">&#39;Jpg&#39;</span> <span class="o">:</span> <span class="p">{}</span>
                        <span class="k">case</span> <span class="s1">&#39;Jpeg&#39;</span> <span class="o">:</span> <span class="p">{}</span>
                        <span class="k">case</span> <span class="s1">&#39;jpeg&#39;</span> <span class="o">:</span> <span class="p">{}</span>
                        <span class="k">case</span> <span class="s1">&#39;PNG&#39;</span> <span class="o">:</span> <span class="p">{}</span>
                        <span class="k">case</span> <span class="s1">&#39;png&#39;</span> <span class="o">:</span> <span class="p">{}</span>
                        <span class="k">case</span> <span class="s1">&#39;JPEG&#39;</span> <span class="o">:</span> <span class="p">{</span>
                            <span class="k">if</span> <span class="p">(</span><span class="nx">Tinebase_Core</span><span class="o">::</span><span class="na">isLogLevel</span><span class="p">(</span><span class="nx">Zend_Log</span><span class="o">::</span><span class="na">DEBUG</span><span class="p">))</span>
                                <span class="nx">Tinebase_Core</span><span class="o">::</span><span class="na">getLogger</span><span class="p">()</span><span class="o">-&gt;</span><span class="na">warn</span><span class="p">(</span><span class="no">__METHOD__</span> <span class="o">.</span> <span class="s1">&#39;::&#39;</span> <span class="o">.</span> <span class="no">__LINE__</span> <span class="o">.</span> <span class="s1">&#39; Photo: passing on invalid &#39;</span> <span class="o">.</span> <span class="nv">$property</span><span class="p">[</span><span class="s1">&#39;TYPE&#39;</span><span class="p">]</span> <span class="o">.</span> <span class="s1">&#39; image as is (&#39;</span> <span class="o">.</span> <span class="nb">strlen</span><span class="p">(</span><span class="nv">$property</span><span class="o">-&gt;</span><span class="na">getValue</span><span class="p">())</span> <span class="o">.</span><span class="s1">&#39;)&#39;</span> <span class="p">);</span>
                            <span class="nv">$jpegphoto</span> <span class="o">=</span> <span class="nv">$property</span><span class="o">-&gt;</span><span class="na">getValue</span><span class="p">();</span>
                            <span class="k">break</span><span class="p">;</span>
                        <span class="p">}</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="long-arguments">
<span id="case-long-arguments"></span><h3><span class="section-number">5.2.191. </span>Long Arguments<a class="headerlink" href="#long-arguments" title="Permalink to this headline">¶</a></h3>
<div class="section" id="case-cleverstyle-structures-longarguments">
<span id="id271"></span><h4><span class="section-number">5.2.191.1. </span>Cleverstyle<a class="headerlink" href="#case-cleverstyle-structures-longarguments" title="Permalink to this headline">¶</a></h4>
<p><a class="reference internal" href="Rules.html#long-arguments"><span class="std std-ref">Long Arguments</span></a>, in core/drivers/DB/MySQLi.php:40.</p>
<p>This query is not complex, but its length tend to push the end out of the view in the IDE. It could be rewritten as a variable, on the previous line, with some formatting. The same formatting would help without the variable too, yet, mixing the SQL syntax with the PHP methodcall adds a layer of confusion.</p>
<div class="highlight-php notranslate"><div class="highlight"><pre><span></span><span class="nv">$this</span><span class="o">-&gt;</span><span class="na">instance</span><span class="o">-&gt;</span><span class="na">query</span><span class="p">(</span><span class="s2">&quot;SET SESSION sql_mode=&#39;ONLY_FULL_GROUP_BY,STRICT_TRANS_TABLES,NO_ZERO_IN_DATE,NO_ZERO_DATE,ERROR_FOR_DIVISION_BY_ZERO,NO_AUTO_CREATE_USER,NO_ENGINE_SUBSTITUTION&#39;&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="section" id="case-contao-structures-longarguments">
<span id="id272"></span><h4><span class="section-number">5.2.191.2. </span>Contao<a class="headerlink" href="#case-contao-structures-longarguments" title="Permalink to this headline">¶</a></h4>
<p><a class="reference internal" href="Rules.html#long-arguments"><span class="std std-ref">Long Arguments</span></a>, in core-bundle/src/Resources/contao/widgets/CheckBoxWizard.php:145.</p>
<p>This one-liner includes 9 members and 6 variables : some are formatted by sprintf, some are directly concatenated in the string. Breaking this into two lines improves readbility and code review.</p>
<div class="highlight-php notranslate"><div class="highlight"><pre><span></span><span class="nb">sprintf</span><span class="p">(</span><span class="s1">&#39;&lt;span&gt;&lt;input type=&quot;checkbox&quot; name=&quot;%s&quot; id=&quot;opt_%s&quot; class=&quot;tl_checkbox&quot; value=&quot;%s&quot;%s%s onfocus=&quot;Backend.getScrollOffset()&quot;&gt; %s&lt;label for=&quot;opt_%s&quot;&gt;%s&lt;/label&gt;&lt;/span&gt;&#39;</span><span class="p">,</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">strName</span> <span class="o">.</span> <span class="p">(</span><span class="nv">$this</span><span class="o">-&gt;</span><span class="na">multiple</span> <span class="o">?</span> <span class="s1">&#39;[]&#39;</span> <span class="o">:</span> <span class="s1">&#39;&#39;</span><span class="p">),</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">strId</span> <span class="o">.</span> <span class="s1">&#39;_&#39;</span> <span class="o">.</span> <span class="nv">$i</span><span class="p">,</span> <span class="p">(</span><span class="nv">$this</span><span class="o">-&gt;</span><span class="na">multiple</span> <span class="o">?</span> <span class="nx">\StringUtil</span><span class="o">::</span><span class="na">specialchars</span><span class="p">(</span><span class="nv">$arrOption</span><span class="p">[</span><span class="s1">&#39;value&#39;</span><span class="p">])</span> <span class="o">:</span> <span class="mi">1</span><span class="p">),</span> <span class="p">(((</span><span class="nx">\is_array</span><span class="p">(</span><span class="nv">$this</span><span class="o">-&gt;</span><span class="na">varValue</span><span class="p">)</span> <span class="o">&amp;&amp;</span> <span class="nx">\in_array</span><span class="p">(</span><span class="nv">$arrOption</span><span class="p">[</span><span class="s1">&#39;value&#39;</span><span class="p">],</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">varValue</span><span class="p">))</span> <span class="o">||</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">varValue</span> <span class="o">==</span> <span class="nv">$arrOption</span><span class="p">[</span><span class="s1">&#39;value&#39;</span><span class="p">])</span> <span class="o">?</span> <span class="s1">&#39; checked=&quot;checked&quot;&#39;</span> <span class="o">:</span> <span class="s1">&#39;&#39;</span><span class="p">),</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">getAttributes</span><span class="p">(</span> <span class="p">),</span> <span class="nv">$strButtons</span><span class="p">,</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">strId</span> <span class="o">.</span> <span class="s1">&#39;_&#39;</span> <span class="o">.</span> <span class="nv">$i</span><span class="p">,</span> <span class="nv">$arrOption</span><span class="p">[</span><span class="s1">&#39;label&#39;</span><span class="p">])</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="mismatched-ternary-alternatives">
<span id="case-mismatched-ternary-alternatives"></span><h3><span class="section-number">5.2.192. </span>Mismatched Ternary Alternatives<a class="headerlink" href="#mismatched-ternary-alternatives" title="Permalink to this headline">¶</a></h3>
<div class="section" id="case-phpadsnew-structures-mismatchedternary">
<span id="id273"></span><h4><span class="section-number">5.2.192.1. </span>phpadsnew<a class="headerlink" href="#case-phpadsnew-structures-mismatchedternary" title="Permalink to this headline">¶</a></h4>
<p><a class="reference internal" href="Rules.html#mismatched-ternary-alternatives"><span class="std std-ref">Mismatched Ternary Alternatives</span></a>, in phpAdsNew-2.0/admin/lib-misc-stats.inc.php:219.</p>
<p>This is an unusual way to apply a condition. $bgcolor is ‘#FFFFFF’ by default, and if $i % 2, then $bcolor is ‘#F6F6F6’;. A more readable ternary option would be ‘$bgcolor =  =        $i % 2 ? “#FFFFFF” : “#F6F6F6”;’, and make a matched alternative branches.</p>
<div class="highlight-php notranslate"><div class="highlight"><pre><span></span><span class="nv">$bgcolor</span> <span class="o">=</span> <span class="c1">#FFFFFF;</span>
    <span class="nv">$i</span> <span class="o">%</span> <span class="mi">2</span> <span class="o">?</span> <span class="mi">0</span> <span class="o">:</span> <span class="nv">$bgcolor</span> <span class="o">=</span> <span class="c1">#F6F6F6;</span>
</pre></div>
</div>
</div>
<div class="section" id="case-openemr-structures-mismatchedternary">
<span id="id274"></span><h4><span class="section-number">5.2.192.2. </span>OpenEMR<a class="headerlink" href="#case-openemr-structures-mismatchedternary" title="Permalink to this headline">¶</a></h4>
<p><a class="reference internal" href="Rules.html#mismatched-ternary-alternatives"><span class="std std-ref">Mismatched Ternary Alternatives</span></a>, in portal/messaging/messages.php:132.</p>
<p>IS_DASHBOARD is defined as a boolean or a string. Later, it is tested as a boolean, and displayed as a integer, which will be cast to string by echo. Lots of transtyping are happening here.</p>
<div class="highlight-php notranslate"><div class="highlight"><pre><span></span><span class="c1">// In two distinct if/then branch</span>
<span class="nx">l</span><span class="o">:</span><span class="mi">29</span><span class="p">)</span> <span class="nb">define</span><span class="p">(</span><span class="s1">&#39;IS_DASHBOARD&#39;</span><span class="p">,</span> <span class="k">false</span><span class="p">);</span>
<span class="nx">l</span><span class="o">:</span><span class="mi">41</span><span class="p">)</span> <span class="nb">define</span><span class="p">(</span><span class="s1">&#39;IS_DASHBOARD&#39;</span><span class="p">,</span> <span class="nv">$_SESSION</span><span class="p">[</span><span class="s1">&#39;authUser&#39;</span><span class="p">]);</span>

<span class="nx">l</span><span class="o">:</span><span class="mi">132</span><span class="p">)</span> <span class="k">echo</span> <span class="nx">IS_DASHBOARD</span> <span class="o">?</span> <span class="nx">IS_DASHBOARD</span> <span class="o">:</span> <span class="mi">0</span><span class="p">;</span>
<span class="cp">?&gt;</span><span class="x"></span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="missing-cases-in-switch">
<span id="case-missing-cases-in-switch"></span><h3><span class="section-number">5.2.193. </span>Missing Cases In Switch<a class="headerlink" href="#missing-cases-in-switch" title="Permalink to this headline">¶</a></h3>
<div class="section" id="case-tikiwiki-structures-missingcases">
<span id="id275"></span><h4><span class="section-number">5.2.193.1. </span>Tikiwiki<a class="headerlink" href="#case-tikiwiki-structures-missingcases" title="Permalink to this headline">¶</a></h4>
<p><a class="reference internal" href="Rules.html#missing-cases-in-switch"><span class="std std-ref">Missing Cases In Switch</span></a>, in lib/articles/artlib.php:1075.</p>
<p>This switch handles 3 cases, plus the default for all others. There are other switch structures which also handle the ‘’ case. There may be a missing case here. In particular, projects/tikiwiki/code//article_image.php host another switch with the same case, plus another ‘topic’ case.</p>
<div class="highlight-php notranslate"><div class="highlight"><pre><span></span><span class="k">switch</span> <span class="p">(</span><span class="nv">$image_type</span><span class="p">)</span> <span class="p">{</span>
                    <span class="k">case</span> <span class="s1">&#39;article&#39;</span><span class="o">:</span>
                            <span class="nv">$image_cache_prefix</span> <span class="o">=</span> <span class="s1">&#39;article&#39;</span><span class="p">;</span>
                            <span class="k">break</span><span class="p">;</span>
                    <span class="k">case</span> <span class="s1">&#39;submission&#39;</span><span class="o">:</span>
                            <span class="nv">$image_cache_prefix</span> <span class="o">=</span> <span class="s1">&#39;article_submission&#39;</span><span class="p">;</span>
                            <span class="k">break</span><span class="p">;</span>
                    <span class="k">case</span> <span class="s1">&#39;preview&#39;</span><span class="o">:</span>
                            <span class="nv">$image_cache_prefix</span> <span class="o">=</span> <span class="s1">&#39;article_preview&#39;</span><span class="p">;</span>
                            <span class="k">break</span><span class="p">;</span>
                    <span class="k">default</span><span class="o">:</span>
                            <span class="k">return</span> <span class="k">false</span><span class="p">;</span>
            <span class="p">}</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="mixed-concat-and-interpolation">
<span id="case-mixed-concat-and-interpolation"></span><h3><span class="section-number">5.2.194. </span>Mixed Concat And Interpolation<a class="headerlink" href="#mixed-concat-and-interpolation" title="Permalink to this headline">¶</a></h3>
<div class="section" id="case-suitecrm-structures-mixedconcatinterpolation">
<span id="id276"></span><h4><span class="section-number">5.2.194.1. </span>SuiteCrm<a class="headerlink" href="#case-suitecrm-structures-mixedconcatinterpolation" title="Permalink to this headline">¶</a></h4>
<p><a class="reference internal" href="Rules.html#mixed-concat-and-interpolation"><span class="std std-ref">Mixed Concat And Interpolation</span></a>, in modules/AOW_Actions/actions/actionSendEmail.php:89.</p>
<p>How long did it take to spot the hidden $checked variable in this long concatenation ? Using a consistent method of interpolation would help readability here.</p>
<div class="highlight-php notranslate"><div class="highlight"><pre><span></span><span class="s2">&quot;&lt;input type=&#39;checkbox&#39; id=&#39;aow_actions_param[&quot;</span> <span class="o">.</span> <span class="nv">$line</span> <span class="o">.</span> <span class="s2">&quot;][individual_email]&#39; name=&#39;aow_actions_param[&quot;</span> <span class="o">.</span> <span class="nv">$line</span> <span class="o">.</span> <span class="s2">&quot;][individual_email]&#39; value=&#39;1&#39; </span><span class="si">$checked</span><span class="s2">&gt;&lt;/td&gt;&quot;</span>
</pre></div>
</div>
</div>
<div class="section" id="case-edusoho-structures-mixedconcatinterpolation">
<span id="id277"></span><h4><span class="section-number">5.2.194.2. </span>Edusoho<a class="headerlink" href="#case-edusoho-structures-mixedconcatinterpolation" title="Permalink to this headline">¶</a></h4>
<p><a class="reference internal" href="Rules.html#mixed-concat-and-interpolation"><span class="std std-ref">Mixed Concat And Interpolation</span></a>, in src/AppBundle/Controller/Admin/SiteSettingController.php:168.</p>
<p>Calling a method from a property of an object is possible inside a string, though it is rare. Setting the method outside the string make it more readable.</p>
<div class="highlight-php notranslate"><div class="highlight"><pre><span></span><span class="s2">&quot;</span><span class="si">{</span><span class="nv">$this</span><span class="o">-&gt;</span><span class="na">container</span><span class="o">-&gt;</span><span class="na">getParameter</span><span class="p">(</span><span class="s1">&#39;topxia.upload.public_url_path&#39;</span><span class="p">)</span><span class="si">}</span><span class="s2">/&quot;</span> <span class="o">.</span> <span class="nv">$parsed</span><span class="p">[</span><span class="s1">&#39;path&#39;</span><span class="p">]</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="multiples-identical-case">
<span id="case-multiples-identical-case"></span><h3><span class="section-number">5.2.195. </span>Multiples Identical Case<a class="headerlink" href="#multiples-identical-case" title="Permalink to this headline">¶</a></h3>
<div class="section" id="case-sugarcrm-structures-multipledefinedcase">
<span id="id278"></span><h4><span class="section-number">5.2.195.1. </span>SugarCrm<a class="headerlink" href="#case-sugarcrm-structures-multipledefinedcase" title="Permalink to this headline">¶</a></h4>
<p><a class="reference internal" href="Rules.html#multiples-identical-case"><span class="std std-ref">Multiples Identical Case</span></a>, in modules/ModuleBuilder/MB/MBPackage.php:439.</p>
<p>It takes a while to find the double ‘required’ case, but the executed code is actually the same, so this is dead code at worst.</p>
<div class="highlight-php notranslate"><div class="highlight"><pre><span></span><span class="k">switch</span> <span class="p">(</span><span class="nv">$col</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">case</span> <span class="s1">&#39;custom_module&#39;</span><span class="o">:</span>
            <span class="nv">$installdefs</span><span class="p">[</span><span class="s1">&#39;custom_fields&#39;</span><span class="p">][</span><span class="nv">$name</span><span class="p">][</span><span class="s1">&#39;module&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="nv">$res</span><span class="p">;</span>
            <span class="k">break</span><span class="p">;</span>
    <span class="k">case</span> <span class="s1">&#39;required&#39;</span><span class="o">:</span>
            <span class="nv">$installdefs</span><span class="p">[</span><span class="s1">&#39;custom_fields&#39;</span><span class="p">][</span><span class="nv">$name</span><span class="p">][</span><span class="s1">&#39;require_option&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="nv">$res</span><span class="p">;</span>
            <span class="k">break</span><span class="p">;</span>
    <span class="k">case</span> <span class="s1">&#39;vname&#39;</span><span class="o">:</span>
            <span class="nv">$installdefs</span><span class="p">[</span><span class="s1">&#39;custom_fields&#39;</span><span class="p">][</span><span class="nv">$name</span><span class="p">][</span><span class="s1">&#39;label&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="nv">$res</span><span class="p">;</span>
            <span class="k">break</span><span class="p">;</span>
    <span class="k">case</span> <span class="s1">&#39;required&#39;</span><span class="o">:</span>
            <span class="nv">$installdefs</span><span class="p">[</span><span class="s1">&#39;custom_fields&#39;</span><span class="p">][</span><span class="nv">$name</span><span class="p">][</span><span class="s1">&#39;require_option&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="nv">$res</span><span class="p">;</span>
            <span class="k">break</span><span class="p">;</span>
    <span class="k">case</span> <span class="s1">&#39;massupdate&#39;</span><span class="o">:</span>
            <span class="nv">$installdefs</span><span class="p">[</span><span class="s1">&#39;custom_fields&#39;</span><span class="p">][</span><span class="nv">$name</span><span class="p">][</span><span class="s1">&#39;mass_update&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="nv">$res</span><span class="p">;</span>
            <span class="k">break</span><span class="p">;</span>
    <span class="k">case</span> <span class="s1">&#39;comments&#39;</span><span class="o">:</span>
            <span class="nv">$installdefs</span><span class="p">[</span><span class="s1">&#39;custom_fields&#39;</span><span class="p">][</span><span class="nv">$name</span><span class="p">][</span><span class="s1">&#39;comments&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="nv">$res</span><span class="p">;</span>
            <span class="k">break</span><span class="p">;</span>
    <span class="k">case</span> <span class="s1">&#39;help&#39;</span><span class="o">:</span>
            <span class="nv">$installdefs</span><span class="p">[</span><span class="s1">&#39;custom_fields&#39;</span><span class="p">][</span><span class="nv">$name</span><span class="p">][</span><span class="s1">&#39;help&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="nv">$res</span><span class="p">;</span>
            <span class="k">break</span><span class="p">;</span>
    <span class="k">case</span> <span class="s1">&#39;len&#39;</span><span class="o">:</span>
            <span class="nv">$installdefs</span><span class="p">[</span><span class="s1">&#39;custom_fields&#39;</span><span class="p">][</span><span class="nv">$name</span><span class="p">][</span><span class="s1">&#39;max_size&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="nv">$res</span><span class="p">;</span>
            <span class="k">break</span><span class="p">;</span>
    <span class="k">default</span><span class="o">:</span>
            <span class="nv">$installdefs</span><span class="p">[</span><span class="s1">&#39;custom_fields&#39;</span><span class="p">][</span><span class="nv">$name</span><span class="p">][</span><span class="nv">$col</span><span class="p">]</span> <span class="o">=</span> <span class="nv">$res</span><span class="p">;</span>
<span class="p">}</span><span class="c1">//switch</span>
</pre></div>
</div>
</div>
<div class="section" id="case-expressionengine-structures-multipledefinedcase">
<span id="id279"></span><h4><span class="section-number">5.2.195.2. </span>ExpressionEngine<a class="headerlink" href="#case-expressionengine-structures-multipledefinedcase" title="Permalink to this headline">¶</a></h4>
<p><a class="reference internal" href="Rules.html#multiples-identical-case"><span class="std std-ref">Multiples Identical Case</span></a>, in ExpressionEngine_Core2.9.2/system/expressionengine/controllers/cp/admin_content.php:577.</p>
<p>‘deft_status’ is doubled, with a fallthrough. This looks like some forgotten copy/paste.</p>
<div class="highlight-php notranslate"><div class="highlight"><pre><span></span><span class="k">switch</span> <span class="p">(</span><span class="nv">$key</span><span class="p">){</span>
                                                            <span class="k">case</span> <span class="s1">&#39;cat_group&#39;</span><span class="o">:</span>
                                                                <span class="c1">//PHP code</span>
                                                                    <span class="k">break</span><span class="p">;</span>
                                                            <span class="k">case</span> <span class="s1">&#39;status_group&#39;</span><span class="o">:</span>
                                                            <span class="k">case</span> <span class="s1">&#39;field_group&#39;</span><span class="o">:</span>
                                                                <span class="c1">//PHP code</span>
                                                                    <span class="k">break</span><span class="p">;</span>
                                                            <span class="k">case</span> <span class="s1">&#39;deft_status&#39;</span><span class="o">:</span>
                                                            <span class="k">case</span> <span class="s1">&#39;deft_status&#39;</span><span class="o">:</span>
                                                                <span class="c1">//PHP code</span>
                                                                    <span class="k">break</span><span class="p">;</span>
                                                            <span class="k">case</span> <span class="s1">&#39;search_excerpt&#39;</span><span class="o">:</span>
                                                                <span class="c1">//PHP code</span>
                                                                    <span class="k">break</span><span class="p">;</span>
                                                            <span class="k">case</span> <span class="s1">&#39;deft_category&#39;</span><span class="o">:</span>
                                                                <span class="c1">//PHP code</span>
                                                                    <span class="k">break</span><span class="p">;</span>
                                                            <span class="k">case</span> <span class="s1">&#39;blog_url&#39;</span><span class="o">:</span>
                                                            <span class="k">case</span> <span class="s1">&#39;comment_url&#39;</span><span class="o">:</span>
                                                            <span class="k">case</span> <span class="s1">&#39;search_results_url&#39;</span><span class="o">:</span>
                                                            <span class="k">case</span> <span class="s1">&#39;rss_url&#39;</span><span class="o">:</span>
                                                                <span class="c1">//PHP code</span>
                                                                    <span class="k">break</span><span class="p">;</span>
                                                            <span class="k">default</span> <span class="o">:</span>
                                                                <span class="c1">//PHP code</span>
                                                                    <span class="k">break</span><span class="p">;</span>
                                                    <span class="p">}</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="multiple-type-variable">
<span id="case-multiple-type-variable"></span><h3><span class="section-number">5.2.196. </span>Multiple Type Variable<a class="headerlink" href="#multiple-type-variable" title="Permalink to this headline">¶</a></h3>
<div class="section" id="case-typo3-structures-multipletypevariable">
<span id="id280"></span><h4><span class="section-number">5.2.196.1. </span>Typo3<a class="headerlink" href="#case-typo3-structures-multipletypevariable" title="Permalink to this headline">¶</a></h4>
<p><a class="reference internal" href="Rules.html#multiple-type-variable"><span class="std std-ref">Multiple Type Variable</span></a>, in typo3/sysext/backend/Classes/Form/Element/InputDateTimeElement.php:270.</p>
<p>$fullElement is an array most of the time, but finally ends up being a string. Since the array is not the final state, it may be interesting to make it a class, which collects the various variables, and export the final string. Such class would be usefull in several places in this repository.</p>
<div class="highlight-php notranslate"><div class="highlight"><pre><span></span><span class="nv">$fullElement</span> <span class="o">=</span> <span class="p">[];</span>
            <span class="nv">$fullElement</span><span class="p">[]</span> <span class="o">=</span> <span class="s1">&#39;&lt;div class=checkbox t3js-form-field-eval-null-placeholder-checkbox&gt;&#39;</span><span class="p">;</span>
            <span class="nv">$fullElement</span><span class="p">[]</span> <span class="o">=</span>     <span class="s1">&#39;&lt;label for= . $nullControlNameEscaped . &gt;&#39;</span><span class="p">;</span>
            <span class="nv">$fullElement</span><span class="p">[]</span> <span class="o">=</span>         <span class="s1">&#39;&lt;input type=hidden name= . $nullControlNameEscaped .  value= . $fallbackValue .  /&gt;&#39;</span><span class="p">;</span>
            <span class="nv">$fullElement</span><span class="p">[]</span> <span class="o">=</span>         <span class="s1">&#39;&lt;input type=checkbox name= . $nullControlNameEscaped .  id= . $nullControlNameEscaped .  value=1&#39;</span> <span class="o">.</span> <span class="nv">$checked</span> <span class="o">.</span> <span class="nv">$disabled</span> <span class="o">.</span> <span class="s1">&#39; /&gt;&#39;</span><span class="p">;</span>
            <span class="nv">$fullElement</span><span class="p">[]</span> <span class="o">=</span>         <span class="nv">$overrideLabel</span><span class="p">;</span>
            <span class="nv">$fullElement</span><span class="p">[]</span> <span class="o">=</span>     <span class="s1">&#39;&lt;/label&gt;&#39;</span><span class="p">;</span>
            <span class="nv">$fullElement</span><span class="p">[]</span> <span class="o">=</span> <span class="s1">&#39;&lt;/div&gt;&#39;</span><span class="p">;</span>
            <span class="nv">$fullElement</span><span class="p">[]</span> <span class="o">=</span> <span class="s1">&#39;&lt;div class=t3js-formengine-placeholder-placeholder&gt;&#39;</span><span class="p">;</span>
            <span class="nv">$fullElement</span><span class="p">[]</span> <span class="o">=</span>    <span class="s1">&#39;&lt;div class=form-control-wrap style=max-width: . $width . px&gt;&#39;</span><span class="p">;</span>
            <span class="nv">$fullElement</span><span class="p">[]</span> <span class="o">=</span>        <span class="s1">&#39;&lt;input type=text class=form-control disabled=disabled value= . $shortenedPlaceholder .  /&gt;&#39;</span><span class="p">;</span>
            <span class="nv">$fullElement</span><span class="p">[]</span> <span class="o">=</span>    <span class="s1">&#39;&lt;/div&gt;&#39;</span><span class="p">;</span>
            <span class="nv">$fullElement</span><span class="p">[]</span> <span class="o">=</span> <span class="s1">&#39;&lt;/div&gt;&#39;</span><span class="p">;</span>
            <span class="nv">$fullElement</span><span class="p">[]</span> <span class="o">=</span> <span class="s1">&#39;&lt;div class=t3js-formengine-placeholder-formfield&gt;&#39;</span><span class="p">;</span>
            <span class="nv">$fullElement</span><span class="p">[]</span> <span class="o">=</span>    <span class="nv">$expansionHtml</span><span class="p">;</span>
            <span class="nv">$fullElement</span><span class="p">[]</span> <span class="o">=</span> <span class="s1">&#39;&lt;/div&gt;&#39;</span><span class="p">;</span>
            <span class="nv">$fullElement</span> <span class="o">=</span> <span class="nb">implode</span><span class="p">(</span><span class="nx">LF</span><span class="p">,</span> <span class="nv">$fullElement</span><span class="p">);</span>
</pre></div>
</div>
</div>
<div class="section" id="case-vanilla-structures-multipletypevariable">
<span id="id281"></span><h4><span class="section-number">5.2.196.2. </span>Vanilla<a class="headerlink" href="#case-vanilla-structures-multipletypevariable" title="Permalink to this headline">¶</a></h4>
<p><a class="reference internal" href="Rules.html#multiple-type-variable"><span class="std std-ref">Multiple Type Variable</span></a>, in library/core/functions.general.php:1427.</p>
<p>Here, $value may be of different type. The if() structures merges all the incoming format into one standard type (int). This is actually the contrary of this analysis, and is a false positive.</p>
<div class="highlight-php notranslate"><div class="highlight"><pre><span></span><span class="k">if</span> <span class="p">(</span><span class="nb">is_array</span><span class="p">(</span><span class="nv">$value</span><span class="p">))</span> <span class="p">{</span>
                        <span class="nv">$value</span> <span class="o">=</span> <span class="nb">count</span><span class="p">(</span><span class="nv">$value</span><span class="p">);</span>
                    <span class="p">}</span> <span class="k">elseif</span> <span class="p">(</span><span class="nx">stringEndsWith</span><span class="p">(</span><span class="nv">$field</span><span class="p">,</span> <span class="s1">&#39;UserID&#39;</span><span class="p">,</span> <span class="k">true</span><span class="p">))</span> <span class="p">{</span>
                        <span class="nv">$value</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>
                    <span class="p">}</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="multiply-by-one">
<span id="case-multiply-by-one"></span><h3><span class="section-number">5.2.197. </span>Multiply By One<a class="headerlink" href="#multiply-by-one" title="Permalink to this headline">¶</a></h3>
<div class="section" id="case-sugarcrm-structures-multiplybyone">
<span id="id282"></span><h4><span class="section-number">5.2.197.1. </span>SugarCrm<a class="headerlink" href="#case-sugarcrm-structures-multiplybyone" title="Permalink to this headline">¶</a></h4>
<p><a class="reference internal" href="Rules.html#multiply-by-one"><span class="std std-ref">Multiply By One</span></a>, in SugarCE-Full-6.5.26/modules/Relationships/views/view.editfields.php:74.</p>
<p>Here, ‘$count % 1’ is always true, after the first loop of the foreach. There is no need for % usage.</p>
<div class="highlight-php notranslate"><div class="highlight"><pre><span></span><span class="nv">$count</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
        <span class="k">foreach</span><span class="p">(</span><span class="nv">$this</span><span class="o">-&gt;</span><span class="na">fields</span> <span class="k">as</span> <span class="nv">$def</span><span class="p">)</span>
        <span class="p">{</span>
            <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="k">empty</span><span class="p">(</span><span class="nv">$def</span><span class="p">[</span><span class="s1">&#39;relationship_field&#39;</span><span class="p">]))</span> <span class="p">{</span>
                <span class="nv">$label</span> <span class="o">=</span> <span class="o">!</span><span class="k">empty</span><span class="p">(</span><span class="nv">$def</span><span class="p">[</span><span class="s1">&#39;vname&#39;</span><span class="p">])</span> <span class="o">?</span> <span class="nv">$def</span><span class="p">[</span><span class="s1">&#39;vname&#39;</span><span class="p">]</span> <span class="o">:</span> <span class="nv">$def</span><span class="p">[</span><span class="s1">&#39;name&#39;</span><span class="p">];</span>
                <span class="k">echo</span> <span class="o">&lt;</span><span class="nx">td</span><span class="o">&gt;</span> <span class="o">.</span> <span class="nx">translate</span><span class="p">(</span><span class="nv">$label</span><span class="p">,</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">module</span><span class="p">)</span> <span class="o">.</span> <span class="o">:&lt;/</span><span class="nx">td</span><span class="o">&gt;</span>
                   <span class="o">.</span> <span class="o">&lt;</span><span class="nx">td</span><span class="o">&gt;&lt;</span><span class="nx">input</span> <span class="nx">id</span><span class="o">=</span><span class="s1">&#39;{$def[&#39;</span><span class="nx">name</span><span class="s1">&#39;]}&#39;</span> <span class="nx">name</span><span class="o">=</span><span class="s1">&#39;{$def[&#39;</span><span class="nx">name</span><span class="s1">&#39;]}&#39;</span><span class="o">&gt;</span>  <span class="p">;</span>

                <span class="k">if</span> <span class="p">(</span><span class="nv">$count</span><span class="o">%</span><span class="mi">1</span><span class="p">)</span>
                    <span class="k">echo</span> <span class="o">&lt;/</span><span class="nx">tr</span><span class="o">&gt;&lt;</span><span class="nx">tr</span><span class="o">&gt;</span><span class="p">;</span>
                <span class="nv">$count</span><span class="o">++</span><span class="p">;</span>
            <span class="p">}</span>
        <span class="p">}</span>
        <span class="k">echo</span> <span class="o">&lt;/</span><span class="nx">tr</span><span class="o">&gt;&lt;/</span><span class="nx">table</span><span class="o">&gt;&lt;/</span><span class="nx">form</span><span class="o">&gt;</span><span class="p">;</span>
</pre></div>
</div>
</div>
<div class="section" id="case-edusoho-structures-multiplybyone">
<span id="id283"></span><h4><span class="section-number">5.2.197.2. </span>Edusoho<a class="headerlink" href="#case-edusoho-structures-multiplybyone" title="Permalink to this headline">¶</a></h4>
<p><a class="reference internal" href="Rules.html#multiply-by-one"><span class="std std-ref">Multiply By One</span></a>, in wp-admin/includes/misc.php:74.</p>
<p>1 is useless here, since 24 * 3600 is already an integer. And, of course, a day is not 24 * 3600… at least every day.</p>
<div class="highlight-php notranslate"><div class="highlight"><pre><span></span><span class="s1">&#39;yesterdayStart&#39;</span> <span class="o">=&gt;</span> <span class="nb">date</span><span class="p">(</span><span class="s1">&#39;Y-m-d&#39;</span><span class="p">,</span> <span class="nb">strtotime</span><span class="p">(</span><span class="nb">date</span><span class="p">(</span><span class="s1">&#39;Y-m-d&#39;</span><span class="p">,</span> <span class="nb">time</span><span class="p">()))</span> <span class="o">-</span> <span class="mi">1</span> <span class="o">*</span> <span class="mi">24</span> <span class="o">*</span> <span class="mi">3600</span><span class="p">),</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="named-regex">
<span id="case-named-regex"></span><h3><span class="section-number">5.2.198. </span>Named Regex<a class="headerlink" href="#named-regex" title="Permalink to this headline">¶</a></h3>
<div class="section" id="case-phinx-structures-namedregex">
<span id="id284"></span><h4><span class="section-number">5.2.198.1. </span>Phinx<a class="headerlink" href="#case-phinx-structures-namedregex" title="Permalink to this headline">¶</a></h4>
<p><a class="reference internal" href="Rules.html#named-regex"><span class="std std-ref">Named Regex</span></a>, in src/Phinx/Util/Util.php:127.</p>
<p>$matches[1] could be renamed by $matches[‘filename’], if the capturing subpattern was named ‘filename’.</p>
<div class="highlight-php notranslate"><div class="highlight"><pre><span></span><span class="k">const</span> <span class="no">MIGRATION_FILE_NAME_PATTERN</span> <span class="o">=</span> <span class="s1">&#39;/^\d+_([\w_]+).php$/i&#39;</span><span class="p">;</span>
<span class="c1">//.... More code with class definition</span>
    <span class="k">public</span> <span class="k">static</span> <span class="k">function</span> <span class="nf">mapFileNameToClassName</span><span class="p">(</span><span class="nv">$fileName</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="nv">$matches</span> <span class="o">=</span> <span class="p">[];</span>
        <span class="k">if</span> <span class="p">(</span><span class="nb">preg_match</span><span class="p">(</span><span class="k">static</span><span class="o">::</span><span class="na">MIGRATION_FILE_NAME_PATTERN</span><span class="p">,</span> <span class="nv">$fileName</span><span class="p">,</span> <span class="nv">$matches</span><span class="p">))</span> <span class="p">{</span>
            <span class="nv">$fileName</span> <span class="o">=</span> <span class="nv">$matches</span><span class="p">[</span><span class="mi">1</span><span class="p">];</span>
        <span class="p">}</span>

        <span class="k">return</span> <span class="nb">str_replace</span><span class="p">(</span><span class="s1">&#39; &#39;</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="nb">ucwords</span><span class="p">(</span><span class="nb">str_replace</span><span class="p">(</span><span class="s1">&#39;_&#39;</span><span class="p">,</span> <span class="s1">&#39; &#39;</span><span class="p">,</span> <span class="nv">$fileName</span><span class="p">)));</span>
    <span class="p">}</span>
</pre></div>
</div>
</div>
<div class="section" id="case-shopware-structures-namedregex">
<span id="id285"></span><h4><span class="section-number">5.2.198.2. </span>shopware<a class="headerlink" href="#case-shopware-structures-namedregex" title="Permalink to this headline">¶</a></h4>
<p><a class="reference internal" href="Rules.html#named-regex"><span class="std std-ref">Named Regex</span></a>, in engine/Library/Enlight/Components/Snippet/Resource.php:207.</p>
<p>$_match[3] is actually extracted two preg_match() before : by the time we read its usage, the first regex has been forgotten. A named subpattern would be useful here to remember what was captured.</p>
<div class="highlight-php notranslate"><div class="highlight"><pre><span></span><span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nb">preg_match</span><span class="p">(</span><span class="s2">&quot;!(.?)(name=)(.*?)(?=(\s|$))!&quot;</span><span class="p">,</span> <span class="nv">$_block_args</span><span class="p">,</span> <span class="nv">$_match</span><span class="p">)</span> <span class="o">&amp;&amp;</span> <span class="k">empty</span><span class="p">(</span><span class="nv">$_block_default</span><span class="p">))</span> <span class="p">{</span>
                <span class="k">throw</span> <span class="k">new</span> <span class="nx">SmartyException</span><span class="p">(</span><span class="s1">&#39;&quot;&#39;</span> <span class="o">.</span> <span class="nv">$_block_tag</span> <span class="o">.</span> <span class="s1">&#39;&quot; missing name attribute&#39;</span><span class="p">);</span>
            <span class="p">}</span>
            <span class="nv">$_block_force</span> <span class="o">=</span> <span class="p">(</span><span class="nx">bool</span><span class="p">)</span> <span class="nb">preg_match</span><span class="p">(</span><span class="s1">&#39;#[\s]force#&#39;</span><span class="p">,</span> <span class="nv">$_block_args</span><span class="p">);</span>
            <span class="nv">$_block_json</span> <span class="o">=</span> <span class="p">(</span><span class="nx">bool</span><span class="p">)</span> <span class="nb">preg_match</span><span class="p">(</span><span class="s1">&#39;#[\s]json=[&quot;\&#39;]true[&quot;\&#39;]\W#&#39;</span><span class="p">,</span> <span class="nv">$_block_args</span><span class="p">);</span>
            <span class="nv">$_block_name</span> <span class="o">=</span> <span class="o">!</span><span class="k">empty</span><span class="p">(</span><span class="nv">$_match</span><span class="p">[</span><span class="mi">3</span><span class="p">])</span> <span class="o">?</span> <span class="nb">trim</span><span class="p">(</span><span class="nv">$_match</span><span class="p">[</span><span class="mi">3</span><span class="p">],</span> <span class="s1">&#39;\&#39;&quot;&#39;</span><span class="p">)</span> <span class="o">:</span> <span class="nv">$_block_default</span><span class="p">;</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="nested-ifthen">
<span id="case-nested-ifthen"></span><h3><span class="section-number">5.2.199. </span>Nested Ifthen<a class="headerlink" href="#nested-ifthen" title="Permalink to this headline">¶</a></h3>
<div class="section" id="case-livezilla-structures-nestedifthen">
<span id="id286"></span><h4><span class="section-number">5.2.199.1. </span>LiveZilla<a class="headerlink" href="#case-livezilla-structures-nestedifthen" title="Permalink to this headline">¶</a></h4>
<p><a class="reference internal" href="Rules.html#nested-ifthen"><span class="std std-ref">Nested Ifthen</span></a>, in livezilla/_lib/objects.global.inc.php:847.</p>
<p>The first condition is fairly complex, and could also return early. Then, the second nested if could be merged into one : this would reduce the number of nesting, but make the condition higher.</p>
<div class="highlight-php notranslate"><div class="highlight"><pre><span></span><span class="k">if</span><span class="p">(</span><span class="nb">isset</span><span class="p">(</span><span class="nx">Server</span><span class="o">::</span><span class="nv">$Configuration</span><span class="o">-&gt;</span><span class="na">File</span><span class="p">[</span><span class="s2">&quot;gl_url_detect&quot;</span><span class="p">])</span> <span class="o">&amp;&amp;</span> <span class="o">!</span><span class="nx">Server</span><span class="o">::</span><span class="nv">$Configuration</span><span class="o">-&gt;</span><span class="na">File</span><span class="p">[</span><span class="s2">&quot;gl_url_detect&quot;</span><span class="p">]</span> <span class="o">&amp;&amp;</span> <span class="nb">isset</span><span class="p">(</span><span class="nx">Server</span><span class="o">::</span><span class="nv">$Configuration</span><span class="o">-&gt;</span><span class="na">File</span><span class="p">[</span><span class="s2">&quot;gl_url&quot;</span><span class="p">])</span> <span class="o">&amp;&amp;</span> <span class="o">!</span><span class="k">empty</span><span class="p">(</span><span class="nx">Server</span><span class="o">::</span><span class="nv">$Configuration</span><span class="o">-&gt;</span><span class="na">File</span><span class="p">[</span><span class="s2">&quot;gl_url&quot;</span><span class="p">]))</span>
        <span class="p">{</span>
            <span class="nv">$url</span> <span class="o">=</span> <span class="nx">Server</span><span class="o">::</span><span class="nv">$Configuration</span><span class="o">-&gt;</span><span class="na">File</span><span class="p">[</span><span class="s2">&quot;gl_url&quot;</span><span class="p">];</span>
        <span class="p">}</span>
        <span class="k">else</span> <span class="k">if</span><span class="p">(</span><span class="nb">isset</span><span class="p">(</span><span class="nv">$_SERVER</span><span class="p">[</span><span class="s2">&quot;HTTP_HOST&quot;</span><span class="p">])</span> <span class="o">&amp;&amp;</span> <span class="o">!</span><span class="k">empty</span><span class="p">(</span><span class="nv">$_SERVER</span><span class="p">[</span><span class="s2">&quot;HTTP_HOST&quot;</span><span class="p">]))</span>
        <span class="p">{</span>
            <span class="nv">$host</span> <span class="o">=</span> <span class="nv">$_SERVER</span><span class="p">[</span><span class="s2">&quot;HTTP_HOST&quot;</span><span class="p">];</span>
            <span class="nv">$path</span> <span class="o">=</span> <span class="nv">$_SERVER</span><span class="p">[</span><span class="s2">&quot;PHP_SELF&quot;</span><span class="p">];</span>

            <span class="k">if</span><span class="p">(</span><span class="o">!</span><span class="k">empty</span><span class="p">(</span><span class="nv">$path</span><span class="p">)</span> <span class="o">&amp;&amp;</span> <span class="o">!</span><span class="nx">Str</span><span class="o">::</span><span class="na">EndsWith</span><span class="p">(</span><span class="nb">strtolower</span><span class="p">(</span><span class="nv">$path</span><span class="p">),</span><span class="nb">strtolower</span><span class="p">(</span><span class="nv">$_file</span><span class="p">))</span> <span class="o">&amp;&amp;</span> <span class="nb">strpos</span><span class="p">(</span><span class="nb">strtolower</span><span class="p">(</span><span class="nv">$path</span><span class="p">),</span><span class="nb">strtolower</span><span class="p">(</span><span class="nv">$_file</span><span class="p">))</span> <span class="o">!==</span> <span class="k">false</span><span class="p">)</span>
            <span class="p">{</span>
                <span class="k">if</span><span class="p">(</span><span class="k">empty</span><span class="p">(</span><span class="nx">Server</span><span class="o">::</span><span class="nv">$Configuration</span><span class="o">-&gt;</span><span class="na">File</span><span class="p">[</span><span class="s2">&quot;gl_kbmr&quot;</span><span class="p">]))</span>
                <span class="p">{</span>
                    <span class="nx">Logging</span><span class="o">::</span><span class="na">DebugLog</span><span class="p">(</span><span class="nb">serialize</span><span class="p">(</span><span class="nv">$_SERVER</span><span class="p">));</span>
                    <span class="k">exit</span><span class="p">(</span><span class="s2">&quot;err 888383; can&#39;t read </span><span class="si">$_SERVER[\HTTP_HOST\\]</span><span class="s2"> and </span><span class="si">$_SERVER[\PHP_SELF\\]</span><span class="s2">&quot;</span><span class="p">);</span>
                <span class="p">}</span>
            <span class="p">}</span>

            <span class="nb">define</span><span class="p">(</span><span class="s2">&quot;LIVEZILLA_DOMAIN&quot;</span><span class="p">,</span><span class="nx">Communication</span><span class="o">::</span><span class="na">GetScheme</span><span class="p">()</span> <span class="o">.</span> <span class="nv">$host</span><span class="p">);</span>
            <span class="nv">$url</span> <span class="o">=</span> <span class="nx">LIVEZILLA_DOMAIN</span> <span class="o">.</span> <span class="nb">str_replace</span><span class="p">(</span><span class="nv">$_file</span><span class="p">,</span><span class="s2">&quot;&quot;</span><span class="p">,</span><span class="nb">htmlentities</span><span class="p">(</span><span class="nv">$path</span><span class="p">,</span><span class="nx">ENT_QUOTES</span><span class="p">,</span><span class="s2">&quot;UTF-8&quot;</span><span class="p">));</span>
        <span class="p">}</span>
</pre></div>
</div>
</div>
<div class="section" id="case-mediawiki-structures-nestedifthen">
<span id="id287"></span><h4><span class="section-number">5.2.199.2. </span>MediaWiki<a class="headerlink" href="#case-mediawiki-structures-nestedifthen" title="Permalink to this headline">¶</a></h4>
<p><a class="reference internal" href="Rules.html#nested-ifthen"><span class="std std-ref">Nested Ifthen</span></a>, in includes/Linker.php:1493.</p>
<p>There are 5 level of nesting here, from the beginning of the method, down to the last condition. All work on local variables, as it is a static method. May be breaking this into smaller functions would help readability.</p>
<div class="highlight-php notranslate"><div class="highlight"><pre><span></span><span class="k">public</span> <span class="k">static</span> <span class="k">function</span> <span class="nf">normalizeSubpageLink</span><span class="p">(</span> <span class="nv">$contextTitle</span><span class="p">,</span> <span class="nv">$target</span><span class="p">,</span> <span class="o">&amp;</span><span class="nv">$text</span> <span class="p">)</span> <span class="p">{</span>
            <span class="nv">$ret</span> <span class="o">=</span> <span class="nv">$target</span><span class="p">;</span> <span class="c1"># default return value is no change</span>

            <span class="c1"># Some namespaces don&#39;t allow subpages,</span>
            <span class="c1"># so only perform processing if subpages are allowed</span>
            <span class="k">if</span> <span class="p">(</span>
                    <span class="nv">$contextTitle</span> <span class="o">&amp;&amp;</span> <span class="nx">MediaWikiServices</span><span class="o">::</span><span class="na">getInstance</span><span class="p">()</span><span class="o">-&gt;</span><span class="na">getNamespaceInfo</span><span class="p">()</span><span class="o">-&gt;</span>
                    <span class="na">hasSubpages</span><span class="p">(</span> <span class="nv">$contextTitle</span><span class="o">-&gt;</span><span class="na">getNamespace</span><span class="p">()</span> <span class="p">)</span>
            <span class="p">)</span> <span class="p">{</span>
                    <span class="nv">$hash</span> <span class="o">=</span> <span class="nb">strpos</span><span class="p">(</span> <span class="nv">$target</span><span class="p">,</span> <span class="s1">&#39;#&#39;</span> <span class="p">);</span>
                    <span class="k">if</span> <span class="p">(</span> <span class="nv">$hash</span> <span class="o">!==</span> <span class="k">false</span> <span class="p">)</span> <span class="p">{</span>
                            <span class="nv">$suffix</span> <span class="o">=</span> <span class="nb">substr</span><span class="p">(</span> <span class="nv">$target</span><span class="p">,</span> <span class="nv">$hash</span> <span class="p">);</span>
                            <span class="nv">$target</span> <span class="o">=</span> <span class="nb">substr</span><span class="p">(</span> <span class="nv">$target</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="nv">$hash</span> <span class="p">);</span>
                    <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
                            <span class="nv">$suffix</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span><span class="p">;</span>
                    <span class="p">}</span>
                    <span class="c1"># T9425</span>
                    <span class="nv">$target</span> <span class="o">=</span> <span class="nb">trim</span><span class="p">(</span> <span class="nv">$target</span> <span class="p">);</span>
                    <span class="nv">$contextPrefixedText</span> <span class="o">=</span> <span class="nx">MediaWikiServices</span><span class="o">::</span><span class="na">getInstance</span><span class="p">()</span><span class="o">-&gt;</span><span class="na">getTitleFormatter</span><span class="p">()</span><span class="o">-&gt;</span>
                            <span class="na">getPrefixedText</span><span class="p">(</span> <span class="nv">$contextTitle</span> <span class="p">);</span>
                    <span class="c1"># Look at the first character</span>
                    <span class="k">if</span> <span class="p">(</span> <span class="nv">$target</span> <span class="o">!=</span> <span class="s1">&#39;&#39;</span> <span class="o">&amp;&amp;</span> <span class="nv">$target</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">===</span> <span class="s1">&#39;/&#39;</span> <span class="p">)</span> <span class="p">{</span>
                            <span class="c1"># / at end means we don&#39;t want the slash to be shown</span>
                            <span class="nv">$m</span> <span class="o">=</span> <span class="p">[];</span>
                            <span class="nv">$trailingSlashes</span> <span class="o">=</span> <span class="nb">preg_match_all</span><span class="p">(</span> <span class="s1">&#39;%(/+)$%&#39;</span><span class="p">,</span> <span class="nv">$target</span><span class="p">,</span> <span class="nv">$m</span> <span class="p">);</span>
                            <span class="k">if</span> <span class="p">(</span> <span class="nv">$trailingSlashes</span> <span class="p">)</span> <span class="p">{</span>
                                    <span class="nv">$noslash</span> <span class="o">=</span> <span class="nv">$target</span> <span class="o">=</span> <span class="nb">substr</span><span class="p">(</span> <span class="nv">$target</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="o">-</span><span class="nb">strlen</span><span class="p">(</span> <span class="nv">$m</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span> <span class="p">)</span> <span class="p">);</span>
                            <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
                                    <span class="nv">$noslash</span> <span class="o">=</span> <span class="nb">substr</span><span class="p">(</span> <span class="nv">$target</span><span class="p">,</span> <span class="mi">1</span> <span class="p">);</span>
                            <span class="p">}</span>

                            <span class="nv">$ret</span> <span class="o">=</span> <span class="nv">$contextPrefixedText</span> <span class="o">.</span> <span class="s1">&#39;/&#39;</span> <span class="o">.</span> <span class="nb">trim</span><span class="p">(</span> <span class="nv">$noslash</span> <span class="p">)</span> <span class="o">.</span> <span class="nv">$suffix</span><span class="p">;</span>
                            <span class="k">if</span> <span class="p">(</span> <span class="nv">$text</span> <span class="o">===</span> <span class="s1">&#39;&#39;</span> <span class="p">)</span> <span class="p">{</span>
                                    <span class="nv">$text</span> <span class="o">=</span> <span class="nv">$target</span> <span class="o">.</span> <span class="nv">$suffix</span><span class="p">;</span>
                            <span class="p">}</span> <span class="c1"># this might be changed for ugliness reasons</span>
                    <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
                            <span class="c1"># check for .. subpage backlinks</span>
                            <span class="nv">$dotdotcount</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
                            <span class="nv">$nodotdot</span> <span class="o">=</span> <span class="nv">$target</span><span class="p">;</span>
                            <span class="k">while</span> <span class="p">(</span> <span class="nb">strncmp</span><span class="p">(</span> <span class="nv">$nodotdot</span><span class="p">,</span> <span class="s2">&quot;../&quot;</span><span class="p">,</span> <span class="mi">3</span> <span class="p">)</span> <span class="o">==</span> <span class="mi">0</span> <span class="p">)</span> <span class="p">{</span>
                                    <span class="o">++</span><span class="nv">$dotdotcount</span><span class="p">;</span>
                                    <span class="nv">$nodotdot</span> <span class="o">=</span> <span class="nb">substr</span><span class="p">(</span> <span class="nv">$nodotdot</span><span class="p">,</span> <span class="mi">3</span> <span class="p">);</span>
                            <span class="p">}</span>
                            <span class="k">if</span> <span class="p">(</span> <span class="nv">$dotdotcount</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="p">)</span> <span class="p">{</span>
                                    <span class="nv">$exploded</span> <span class="o">=</span> <span class="nb">explode</span><span class="p">(</span> <span class="s1">&#39;/&#39;</span><span class="p">,</span> <span class="nv">$contextPrefixedText</span> <span class="p">);</span>
                                    <span class="k">if</span> <span class="p">(</span> <span class="nb">count</span><span class="p">(</span> <span class="nv">$exploded</span> <span class="p">)</span> <span class="o">&gt;</span> <span class="nv">$dotdotcount</span> <span class="p">)</span> <span class="p">{</span> <span class="c1"># not allowed to go below top level page</span>
                                            <span class="nv">$ret</span> <span class="o">=</span> <span class="nb">implode</span><span class="p">(</span> <span class="s1">&#39;/&#39;</span><span class="p">,</span> <span class="nb">array_slice</span><span class="p">(</span> <span class="nv">$exploded</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="o">-</span><span class="nv">$dotdotcount</span> <span class="p">)</span> <span class="p">);</span>
                                            <span class="c1"># / at the end means don&#39;t show full path</span>
                                            <span class="k">if</span> <span class="p">(</span> <span class="nb">substr</span><span class="p">(</span> <span class="nv">$nodotdot</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span> <span class="p">)</span> <span class="o">===</span> <span class="s1">&#39;/&#39;</span> <span class="p">)</span> <span class="p">{</span>
                                                    <span class="nv">$nodotdot</span> <span class="o">=</span> <span class="nb">rtrim</span><span class="p">(</span> <span class="nv">$nodotdot</span><span class="p">,</span> <span class="s1">&#39;/&#39;</span> <span class="p">);</span>
                                                    <span class="k">if</span> <span class="p">(</span> <span class="nv">$text</span> <span class="o">===</span> <span class="s1">&#39;&#39;</span> <span class="p">)</span> <span class="p">{</span>
                                                            <span class="nv">$text</span> <span class="o">=</span> <span class="nv">$nodotdot</span> <span class="o">.</span> <span class="nv">$suffix</span><span class="p">;</span>
                                                    <span class="p">}</span>
                                            <span class="p">}</span>
                                            <span class="nv">$nodotdot</span> <span class="o">=</span> <span class="nb">trim</span><span class="p">(</span> <span class="nv">$nodotdot</span> <span class="p">);</span>
                                            <span class="k">if</span> <span class="p">(</span> <span class="nv">$nodotdot</span> <span class="o">!=</span> <span class="s1">&#39;&#39;</span> <span class="p">)</span> <span class="p">{</span>
                                                    <span class="nv">$ret</span> <span class="o">.=</span> <span class="s1">&#39;/&#39;</span> <span class="o">.</span> <span class="nv">$nodotdot</span><span class="p">;</span>
                                            <span class="p">}</span>
                                            <span class="nv">$ret</span> <span class="o">.=</span> <span class="nv">$suffix</span><span class="p">;</span>
                                    <span class="p">}</span>
                            <span class="p">}</span>
                    <span class="p">}</span>
            <span class="p">}</span>

            <span class="k">return</span> <span class="nv">$ret</span><span class="p">;</span>
    <span class="p">}</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="nested-ternary">
<span id="case-nested-ternary"></span><h3><span class="section-number">5.2.200. </span>Nested Ternary<a class="headerlink" href="#nested-ternary" title="Permalink to this headline">¶</a></h3>
<div class="section" id="case-spip-structures-nestedternary">
<span id="id288"></span><h4><span class="section-number">5.2.200.1. </span>SPIP<a class="headerlink" href="#case-spip-structures-nestedternary" title="Permalink to this headline">¶</a></h4>
<p><a class="reference internal" href="Rules.html#nested-ternary"><span class="std std-ref">Nested Ternary</span></a>, in ecrire/inc/utils.php:2648.</p>
<p>Interesting usage of both if/then, for the flow control, and ternary, for data process. Even on multiple lines, nested ternaries are quite hard to read.</p>
<div class="highlight-php notranslate"><div class="highlight"><pre><span></span><span class="c1">// le script de l&#39;espace prive</span>
    <span class="c1">// Mettre a &quot;index.php&quot; si DirectoryIndex ne le fait pas ou pb connexes:</span>
    <span class="c1">// les anciens IIS n&#39;acceptent pas les POST sur ecrire/ (#419)</span>
    <span class="c1">// meme pb sur thttpd cf. http://forum.spip.net/fr_184153.html</span>
    <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nb">defined</span><span class="p">(</span><span class="s1">&#39;_SPIP_ECRIRE_SCRIPT&#39;</span><span class="p">))</span> <span class="p">{</span>
            <span class="nb">define</span><span class="p">(</span><span class="s1">&#39;_SPIP_ECRIRE_SCRIPT&#39;</span><span class="p">,</span> <span class="p">(</span><span class="k">empty</span><span class="p">(</span><span class="nv">$_SERVER</span><span class="p">[</span><span class="s1">&#39;SERVER_SOFTWARE&#39;</span><span class="p">])</span> <span class="o">?</span> <span class="s1">&#39;&#39;</span> <span class="o">:</span>
                    <span class="nb">preg_match</span><span class="p">(</span><span class="s1">&#39;,IIS|thttpd,&#39;</span><span class="p">,</span> <span class="nv">$_SERVER</span><span class="p">[</span><span class="s1">&#39;SERVER_SOFTWARE&#39;</span><span class="p">])</span> <span class="o">?</span>
                            <span class="s1">&#39;index.php&#39;</span> <span class="o">:</span> <span class="s1">&#39;&#39;</span><span class="p">));</span>
    <span class="p">}</span>
</pre></div>
</div>
</div>
<div class="section" id="case-zencart-structures-nestedternary">
<span id="id289"></span><h4><span class="section-number">5.2.200.2. </span>Zencart<a class="headerlink" href="#case-zencart-structures-nestedternary" title="Permalink to this headline">¶</a></h4>
<p><a class="reference internal" href="Rules.html#nested-ternary"><span class="std std-ref">Nested Ternary</span></a>, in app/library/zencart/ListingQueryAndOutput/src/formatters/TabularProduct.php:143.</p>
<p>No more than one level of nesting for this ternary call, yet it feels a lot more, thanks to the usage of arrayed properties, constants, and functioncalls.</p>
<div class="highlight-php notranslate"><div class="highlight"><pre><span></span><span class="nv">$lc_text</span> <span class="o">.=</span> <span class="s1">&#39;&lt;br /&gt;&#39;</span> <span class="o">.</span> <span class="p">(</span><span class="nx">zen_get_show_product_switch</span><span class="p">(</span><span class="nv">$listing</span><span class="o">-&gt;</span><span class="na">fields</span><span class="p">[</span><span class="s1">&#39;products_id&#39;</span><span class="p">],</span> <span class="s1">&#39;ALWAYS_FREE_SHIPPING_IMAGE_SWITCH&#39;</span><span class="p">)</span> <span class="o">?</span> <span class="p">(</span><span class="nx">zen_get_product_is_always_free_shipping</span><span class="p">(</span><span class="nv">$listing</span><span class="o">-&gt;</span><span class="na">fields</span><span class="p">[</span><span class="s1">&#39;products_id&#39;</span><span class="p">])</span> <span class="o">?</span> <span class="nx">TEXT_PRODUCT_FREE_SHIPPING_ICON</span> <span class="o">.</span> <span class="s1">&#39;&lt;br /&gt;&#39;</span> <span class="o">:</span> <span class="s1">&#39;&#39;</span><span class="p">)</span> <span class="o">:</span> <span class="s1">&#39;&#39;</span><span class="p">);</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="always-positive-comparison">
<span id="case-always-positive-comparison"></span><h3><span class="section-number">5.2.201. </span>Always Positive Comparison<a class="headerlink" href="#always-positive-comparison" title="Permalink to this headline">¶</a></h3>
<div class="section" id="case-magento-structures-nevernegative">
<span id="id290"></span><h4><span class="section-number">5.2.201.1. </span>Magento<a class="headerlink" href="#case-magento-structures-nevernegative" title="Permalink to this headline">¶</a></h4>
<p><a class="reference internal" href="Rules.html#always-positive-comparison"><span class="std std-ref">Always Positive Comparison</span></a>, in app/code/core/Mage/Dataflow/Model/Profile.php:85.</p>
<p>strlen(($actiosXML) will never be negative, and hence, is always false. This exception is never thrown.</p>
<div class="highlight-php notranslate"><div class="highlight"><pre><span></span><span class="k">if</span> <span class="p">(</span><span class="nb">strlen</span><span class="p">(</span><span class="nv">$actionsXML</span><span class="p">)</span> <span class="o">&lt;</span> <span class="mi">0</span> <span class="o">&amp;&amp;</span>
        <span class="o">@</span><span class="nb">simplexml_load_string</span><span class="p">(</span><span class="s1">&#39;&lt;data&gt;&#39;</span> <span class="o">.</span> <span class="nv">$actionsXML</span> <span class="o">.</span> <span class="s1">&#39;&lt;/data&gt;&#39;</span><span class="p">,</span> <span class="k">null</span><span class="p">,</span> <span class="nx">LIBXML_NOERROR</span><span class="p">)</span> <span class="o">===</span> <span class="k">false</span><span class="p">)</span> <span class="p">{</span>
            <span class="nx">Mage</span><span class="o">::</span><span class="na">throwException</span><span class="p">(</span><span class="nx">Mage</span><span class="o">::</span><span class="na">helper</span><span class="p">(</span><span class="s1">&#39;dataflow&#39;</span><span class="p">)</span><span class="o">-&gt;</span><span class="na">__</span><span class="p">(</span><span class="s2">&quot;Actions XML is not valid.&quot;</span><span class="p">));</span>
        <span class="p">}</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="next-month-trap">
<span id="case-next-month-trap"></span><h3><span class="section-number">5.2.202. </span>Next Month Trap<a class="headerlink" href="#next-month-trap" title="Permalink to this headline">¶</a></h3>
<div class="section" id="case-contao-structures-nextmonthtrap">
<span id="id291"></span><h4><span class="section-number">5.2.202.1. </span>Contao<a class="headerlink" href="#case-contao-structures-nextmonthtrap" title="Permalink to this headline">¶</a></h4>
<p><a class="reference internal" href="Rules.html#next-month-trap"><span class="std std-ref">Next Month Trap</span></a>, in system/modules/calendar/classes/Events.php:515.</p>
<p>This code is wrong on August 29,th 30th and 31rst : 6 months before is caculated here as February 31rst, so march 2. Of course, this depends on the leap years.</p>
<div class="highlight-php notranslate"><div class="highlight"><pre><span></span><span class="k">case</span> <span class="s1">&#39;past_180&#39;</span><span class="o">:</span>
                            <span class="k">return</span> <span class="k">array</span><span class="p">(</span><span class="nb">strtotime</span><span class="p">(</span><span class="s1">&#39;-6 months&#39;</span><span class="p">),</span> <span class="nb">time</span><span class="p">(),</span> <span class="nv">$GLOBALS</span><span class="p">[</span><span class="s1">&#39;TL_LANG&#39;</span><span class="p">][</span><span class="s1">&#39;MSC&#39;</span><span class="p">][</span><span class="s1">&#39;cal_empty&#39;</span><span class="p">]);</span>
</pre></div>
</div>
</div>
<div class="section" id="case-edusoho-structures-nextmonthtrap">
<span id="id292"></span><h4><span class="section-number">5.2.202.2. </span>Edusoho<a class="headerlink" href="#case-edusoho-structures-nextmonthtrap" title="Permalink to this headline">¶</a></h4>
<p><a class="reference internal" href="Rules.html#next-month-trap"><span class="std std-ref">Next Month Trap</span></a>, in src/AppBundle/Controller/Admin/AnalysisController.php:1426.</p>
<p>The last month is wrong 8 times a year : on 31rst, and by the end of March.</p>
<div class="highlight-php notranslate"><div class="highlight"><pre><span></span><span class="s1">&#39;lastMonthStart&#39;</span> <span class="o">=&gt;</span> <span class="nb">date</span><span class="p">(</span><span class="s1">&#39;Y-m-d&#39;</span><span class="p">,</span> <span class="nb">strtotime</span><span class="p">(</span><span class="nb">date</span><span class="p">(</span><span class="s1">&#39;Y-m&#39;</span><span class="p">,</span> <span class="nb">strtotime</span><span class="p">(</span><span class="s1">&#39;-1 month&#39;</span><span class="p">)))),</span>
            <span class="s1">&#39;lastMonthEnd&#39;</span> <span class="o">=&gt;</span> <span class="nb">date</span><span class="p">(</span><span class="s1">&#39;Y-m-d&#39;</span><span class="p">,</span> <span class="nb">strtotime</span><span class="p">(</span><span class="nb">date</span><span class="p">(</span><span class="s1">&#39;Y-m&#39;</span><span class="p">,</span> <span class="nb">time</span><span class="p">()))</span> <span class="o">-</span> <span class="mi">24</span> <span class="o">*</span> <span class="mi">3600</span><span class="p">),</span>
            <span class="s1">&#39;lastThreeMonthsStart&#39;</span> <span class="o">=&gt;</span> <span class="nb">date</span><span class="p">(</span><span class="s1">&#39;Y-m-d&#39;</span><span class="p">,</span> <span class="nb">strtotime</span><span class="p">(</span><span class="nb">date</span><span class="p">(</span><span class="s1">&#39;Y-m&#39;</span><span class="p">,</span> <span class="nb">strtotime</span><span class="p">(</span><span class="s1">&#39;-2 month&#39;</span><span class="p">)))),</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="no-choice">
<span id="case-no-choice"></span><h3><span class="section-number">5.2.203. </span>No Choice<a class="headerlink" href="#no-choice" title="Permalink to this headline">¶</a></h3>
<div class="section" id="case-nextcloud-structures-nochoice">
<span id="id293"></span><h4><span class="section-number">5.2.203.1. </span>NextCloud<a class="headerlink" href="#case-nextcloud-structures-nochoice" title="Permalink to this headline">¶</a></h4>
<p><a class="reference internal" href="Rules.html#no-choice"><span class="std std-ref">No Choice</span></a>, in build/integration/features/bootstrap/FilesDropContext.php:71.</p>
<p>Token is checked, but processed in the same way each time. This actual check is done twice, in the same class, in the method droppingFileWith().</p>
<div class="highlight-php notranslate"><div class="highlight"><pre><span></span><span class="k">public</span> <span class="k">function</span> <span class="nf">creatingFolderInDrop</span><span class="p">(</span><span class="nv">$folder</span><span class="p">)</span> <span class="p">{</span>
            <span class="nv">$client</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Client</span><span class="p">();</span>
            <span class="nv">$options</span> <span class="o">=</span> <span class="p">[];</span>
            <span class="k">if</span> <span class="p">(</span><span class="nb">count</span><span class="p">(</span><span class="nv">$this</span><span class="o">-&gt;</span><span class="na">lastShareData</span><span class="o">-&gt;</span><span class="na">data</span><span class="o">-&gt;</span><span class="na">element</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">){</span>
                    <span class="nv">$token</span> <span class="o">=</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">lastShareData</span><span class="o">-&gt;</span><span class="na">data</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">-&gt;</span><span class="na">token</span><span class="p">;</span>
            <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
                    <span class="nv">$token</span> <span class="o">=</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">lastShareData</span><span class="o">-&gt;</span><span class="na">data</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">-&gt;</span><span class="na">token</span><span class="p">;</span>
            <span class="p">}</span>
            <span class="nv">$base</span> <span class="o">=</span> <span class="nb">substr</span><span class="p">(</span><span class="nv">$this</span><span class="o">-&gt;</span><span class="na">baseUrl</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="o">-</span><span class="mi">4</span><span class="p">);</span>
            <span class="nv">$fullUrl</span> <span class="o">=</span> <span class="nv">$base</span> <span class="o">.</span> <span class="s1">&#39;/public.php/webdav/&#39;</span> <span class="o">.</span> <span class="nv">$folder</span><span class="p">;</span>

            <span class="nv">$options</span><span class="p">[</span><span class="s1">&#39;auth&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="nv">$token</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">];</span>
</pre></div>
</div>
</div>
<div class="section" id="case-zencart-structures-nochoice">
<span id="id294"></span><h4><span class="section-number">5.2.203.2. </span>Zencart<a class="headerlink" href="#case-zencart-structures-nochoice" title="Permalink to this headline">¶</a></h4>
<p><a class="reference internal" href="Rules.html#no-choice"><span class="std std-ref">No Choice</span></a>, in admin/includes/functions/html_output.php:179.</p>
<p>At least, it always choose the most secure way : use SSL.</p>
<div class="highlight-php notranslate"><div class="highlight"><pre><span></span><span class="k">if</span> <span class="p">(</span><span class="nv">$usessl</span><span class="p">)</span> <span class="p">{</span>
        <span class="nv">$form</span> <span class="o">.=</span> <span class="nx">zen_href_link</span><span class="p">(</span><span class="nv">$action</span><span class="p">,</span> <span class="nv">$parameters</span><span class="p">,</span> <span class="s1">&#39;NONSSL&#39;</span><span class="p">);</span>
      <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
        <span class="nv">$form</span> <span class="o">.=</span> <span class="nx">zen_href_link</span><span class="p">(</span><span class="nv">$action</span><span class="p">,</span> <span class="nv">$parameters</span><span class="p">,</span> <span class="s1">&#39;NONSSL&#39;</span><span class="p">);</span>
      <span class="p">}</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="no-direct-usage">
<span id="case-no-direct-usage"></span><h3><span class="section-number">5.2.204. </span>No Direct Usage<a class="headerlink" href="#no-direct-usage" title="Permalink to this headline">¶</a></h3>
<div class="section" id="case-edusoho-structures-nodirectusage">
<span id="id295"></span><h4><span class="section-number">5.2.204.1. </span>Edusoho<a class="headerlink" href="#case-edusoho-structures-nodirectusage" title="Permalink to this headline">¶</a></h4>
<p><a class="reference internal" href="Rules.html#no-direct-usage"><span class="std std-ref">No Direct Usage</span></a>, in edusoho/src/AppBundle/Controller/Admin/FinanceSettingController.php:107.</p>
<p>Glob() returns false, in case of error. It returns an empty array in case everything is fine, but nothing was found. In case of error, array_map() will stop the script.</p>
<div class="highlight-php notranslate"><div class="highlight"><pre><span></span><span class="nb">array_map</span><span class="p">(</span><span class="s1">&#39;unlink&#39;</span><span class="p">,</span> <span class="nb">glob</span><span class="p">(</span><span class="nv">$dir</span><span class="o">.</span><span class="s1">&#39;/MP_verify_*.txt&#39;</span><span class="p">));</span>
</pre></div>
</div>
</div>
<div class="section" id="case-xoops-structures-nodirectusage">
<span id="id296"></span><h4><span class="section-number">5.2.204.2. </span>XOOPS<a class="headerlink" href="#case-xoops-structures-nodirectusage" title="Permalink to this headline">¶</a></h4>
<p><a class="reference internal" href="Rules.html#no-direct-usage"><span class="std std-ref">No Direct Usage</span></a>, in htdocs/Frameworks/moduleclasses/moduleadmin/moduleadmin.php:585.</p>
<p>Although the file is readable, file() may return false in case of failure. On the other hand, implode doesn’t accept boolean values.</p>
<div class="highlight-php notranslate"><div class="highlight"><pre><span></span><span class="nv">$file</span> <span class="o">=</span> <span class="nx">XOOPS_ROOT_PATH</span> <span class="o">.</span> <span class="o">/</span><span class="nx">modules</span><span class="o">/</span><span class="p">{</span><span class="nv">$module_dir</span><span class="p">}</span><span class="o">/</span><span class="nx">docs</span><span class="o">/</span><span class="nx">changelog</span><span class="o">.</span><span class="nx">txt</span><span class="p">;</span>
            <span class="k">if</span> <span class="p">(</span> <span class="nb">is_readable</span><span class="p">(</span> <span class="nv">$file</span> <span class="p">)</span> <span class="p">)</span> <span class="p">{</span>
                <span class="nv">$ret</span> <span class="o">.=</span> <span class="nb">implode</span><span class="p">(</span> <span class="s1">&#39;&lt;br&gt;&#39;</span><span class="p">,</span> <span class="nb">file</span><span class="p">(</span> <span class="nv">$file</span> <span class="p">)</span> <span class="p">)</span> <span class="o">.</span> <span class="nx">\n</span><span class="p">;</span>
            <span class="p">}</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="no-empty-regex">
<span id="case-no-empty-regex"></span><h3><span class="section-number">5.2.205. </span>No Empty Regex<a class="headerlink" href="#no-empty-regex" title="Permalink to this headline">¶</a></h3>
<div class="section" id="case-tikiwiki-structures-noemptyregex">
<span id="id297"></span><h4><span class="section-number">5.2.205.1. </span>Tikiwiki<a class="headerlink" href="#case-tikiwiki-structures-noemptyregex" title="Permalink to this headline">¶</a></h4>
<p><a class="reference internal" href="Rules.html#no-empty-regex"><span class="std std-ref">No Empty Regex</span></a>, in lib/sheet/excel/writer/worksheet.php:1925.</p>
<p>The initial ‘s’ seems to be too much. May be a typo ?</p>
<div class="highlight-php notranslate"><div class="highlight"><pre><span></span><span class="c1">// Strip URL type</span>
        <span class="nv">$url</span> <span class="o">=</span> <span class="nb">preg_replace</span><span class="p">(</span><span class="s1">&#39;s[^internal:]&#39;</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="nv">$url</span><span class="p">);</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="no-hardcoded-hash">
<span id="case-no-hardcoded-hash"></span><h3><span class="section-number">5.2.206. </span>No Hardcoded Hash<a class="headerlink" href="#no-hardcoded-hash" title="Permalink to this headline">¶</a></h3>
<div class="section" id="case-shopware-structures-nohardcodedhash">
<span id="id298"></span><h4><span class="section-number">5.2.206.1. </span>shopware<a class="headerlink" href="#case-shopware-structures-nohardcodedhash" title="Permalink to this headline">¶</a></h4>
<p><a class="reference internal" href="Rules.html#no-hardcoded-hash"><span class="std std-ref">No Hardcoded Hash</span></a>, in engine/Shopware/Models/Document/Data/OrderData.php:254.</p>
<p>This is actually a hashed hardcoded password. As the file explains, this is a demo order, for populating the database when in demo mode, so this is fine. We also learn that the password are securily sorted here. It may also be advised to avoid hardcoding this password, as any demo shop has the same user credential : it is the first to be tried when a demo installation is found.</p>
<div class="highlight-php notranslate"><div class="highlight"><pre><span></span><span class="s1">&#39;_userID&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;3&#39;</span><span class="p">,</span>
    <span class="s1">&#39;_user&#39;</span> <span class="o">=&gt;</span> <span class="k">new</span> <span class="nx">ArrayObject</span><span class="p">([</span>
            <span class="s1">&#39;id&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;3&#39;</span><span class="p">,</span>
            <span class="s1">&#39;password&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;$2y$10$GAGAC6.1kMRvN4RRcLrYleDx.EfWhHcW./cmoOQg11sjFUY73SO.C&#39;</span><span class="p">,</span>
            <span class="s1">&#39;encoder&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;bcrypt&#39;</span><span class="p">,</span>
            <span class="s1">&#39;email&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;demo@shopware.com&#39;</span><span class="p">,</span>
            <span class="s1">&#39;customernumber&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;20005&#39;</span><span class="p">,</span>
</pre></div>
</div>
</div>
<div class="section" id="case-sugarcrm-structures-nohardcodedhash">
<span id="id299"></span><h4><span class="section-number">5.2.206.2. </span>SugarCrm<a class="headerlink" href="#case-sugarcrm-structures-nohardcodedhash" title="Permalink to this headline">¶</a></h4>
<p><a class="reference internal" href="Rules.html#no-hardcoded-hash"><span class="std std-ref">No Hardcoded Hash</span></a>, in SugarCE-Full-6.5.26/include/Smarty/Smarty.class.php:460.</p>
<p>The MD5(‘Smarty’) is hardcoded in the properties. This property is not used in the class, but in parts of the code, when a unique delimiter is needed.</p>
<div class="highlight-php notranslate"><div class="highlight"><pre><span></span><span class="sd">/**</span>
<span class="sd">     * md5 checksum of the string &#39;Smarty&#39;</span>
<span class="sd">     *</span>
<span class="sd">     * @var string</span>
<span class="sd">     */</span>
    <span class="k">var</span> <span class="nv">$_smarty_md5</span>           <span class="o">=</span> <span class="s1">&#39;f8d698aea36fcbead2b9d5359ffca76f&#39;</span><span class="p">;</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="no-hardcoded-ip">
<span id="case-no-hardcoded-ip"></span><h3><span class="section-number">5.2.207. </span>No Hardcoded Ip<a class="headerlink" href="#no-hardcoded-ip" title="Permalink to this headline">¶</a></h3>
<div class="section" id="case-openemr-structures-nohardcodedip">
<span id="id300"></span><h4><span class="section-number">5.2.207.1. </span>OpenEMR<a class="headerlink" href="#case-openemr-structures-nohardcodedip" title="Permalink to this headline">¶</a></h4>
<p><a class="reference internal" href="Rules.html#no-hardcoded-ip"><span class="std std-ref">No Hardcoded Ip</span></a>, in wp-admin/includes/misc.php:74.</p>
<p>Although they are commented just above, the values provided here are suspicious.</p>
<div class="highlight-php notranslate"><div class="highlight"><pre><span></span><span class="c1">// FTP parameters that you must customize.  If you are not sending</span>
 <span class="c1">// then set $FTP_SERVER to an empty string.</span>
 <span class="c1">//</span>
 <span class="nv">$FTP_SERVER</span> <span class="o">=</span> <span class="mf">192.168</span><span class="o">.</span><span class="mf">0.30</span><span class="p">;</span>
 <span class="nv">$FTP_USER</span>   <span class="o">=</span> <span class="nx">openemr</span><span class="p">;</span>
 <span class="nv">$FTP_PASS</span>   <span class="o">=</span> <span class="nx">secret</span><span class="p">;</span>
 <span class="nv">$FTP_DIR</span>    <span class="o">=</span> <span class="p">;</span>
</pre></div>
</div>
</div>
<div class="section" id="case-nextcloud-structures-nohardcodedip">
<span id="id301"></span><h4><span class="section-number">5.2.207.2. </span>NextCloud<a class="headerlink" href="#case-nextcloud-structures-nohardcodedip" title="Permalink to this headline">¶</a></h4>
<p><a class="reference internal" href="Rules.html#no-hardcoded-ip"><span class="std std-ref">No Hardcoded Ip</span></a>, in config/config.sample.php:1561.</p>
<p>Although they are documented as empty array, 3 values are provided as examples. They do not responds, at the time of writing, but they may.</p>
<div class="highlight-php notranslate"><div class="highlight"><pre><span></span><span class="sd">/**</span>
<span class="sd"> * List of trusted proxy servers</span>
<span class="sd"> *</span>
<span class="sd"> * You may set this to an array containing a combination of</span>
<span class="sd"> * - IPv4 addresses, e.g. `192.168.2.123`</span>
<span class="sd"> * - IPv4 ranges in CIDR notation, e.g. `192.168.2.0/24`</span>
<span class="sd"> * - IPv6 addresses, e.g. `fd9e:21a7:a92c:2323::1`</span>
<span class="sd"> *</span>
<span class="sd"> * _(CIDR notation for IPv6 is currently work in progress and thus not</span>
<span class="sd"> * available as of yet)_</span>
<span class="sd"> *</span>
<span class="sd"> * When an incoming request&#39;s `REMOTE_ADDR` matches any of the IP addresses</span>
<span class="sd"> * specified here, it is assumed to be a proxy instead of a client. Thus, the</span>
<span class="sd"> * client IP will be read from the HTTP header specified in</span>
<span class="sd"> * `forwarded_for_headers` instead of from `REMOTE_ADDR`.</span>
<span class="sd"> *</span>
<span class="sd"> * So if you configure `trusted_proxies`, also consider setting</span>
<span class="sd"> * `forwarded_for_headers` which otherwise defaults to `HTTP_X_FORWARDED_FOR`</span>
<span class="sd"> * (the `X-Forwarded-For` header).</span>
<span class="sd"> *</span>
<span class="sd"> * Defaults to an empty array.</span>
<span class="sd"> */</span>
<span class="s1">&#39;trusted_proxies&#39;</span> <span class="o">=&gt;</span> <span class="k">array</span><span class="p">(</span><span class="s1">&#39;203.0.113.45&#39;</span><span class="p">,</span> <span class="s1">&#39;198.51.100.128&#39;</span><span class="p">,</span> <span class="s1">&#39;192.168.2.0/24&#39;</span><span class="p">),</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="no-hardcoded-path">
<span id="case-no-hardcoded-path"></span><h3><span class="section-number">5.2.208. </span>No Hardcoded Path<a class="headerlink" href="#no-hardcoded-path" title="Permalink to this headline">¶</a></h3>
<div class="section" id="case-tine20-structures-nohardcodedpath">
<span id="id302"></span><h4><span class="section-number">5.2.208.1. </span>Tine20<a class="headerlink" href="#case-tine20-structures-nohardcodedpath" title="Permalink to this headline">¶</a></h4>
<p><a class="reference internal" href="Rules.html#no-hardcoded-path"><span class="std std-ref">No Hardcoded Path</span></a>, in tine20/Tinebase/DummyController.php:28.</p>
<p>When this script is not run on a Linux system, the file save will fail.</p>
<div class="highlight-php notranslate"><div class="highlight"><pre><span></span><span class="nb">file_put_contents</span><span class="p">(</span><span class="s1">&#39;/var/run/tine20/DummyController.txt&#39;</span><span class="p">,</span> <span class="s1">&#39;success &#39;</span> <span class="o">.</span> <span class="nv">$n</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="section" id="case-thelia-structures-nohardcodedpath">
<span id="id303"></span><h4><span class="section-number">5.2.208.2. </span>Thelia<a class="headerlink" href="#case-thelia-structures-nohardcodedpath" title="Permalink to this headline">¶</a></h4>
<p><a class="reference internal" href="Rules.html#no-hardcoded-path"><span class="std std-ref">No Hardcoded Path</span></a>, in local/modules/Tinymce/Resources/js/tinymce/filemanager/include/php_image_magician.php:2317.</p>
<p>The <cite>iptc.jpg</cite> file is written. It looks like the file may be written next to the php_image_magician.php file, but this is deep in the source code and is unlikely. This means that the working directory has been set to some other place, though we don’t read it immediately.</p>
<div class="highlight-php notranslate"><div class="highlight"><pre><span></span><span class="k">private</span> <span class="k">function</span> <span class="nf">writeIPTC</span><span class="p">(</span><span class="nv">$dat</span><span class="p">,</span> <span class="nv">$value</span><span class="p">)</span>
    <span class="p">{</span>

            <span class="c1"># LIMIT TO JPG</span>

            <span class="nv">$caption_block</span> <span class="o">=</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">iptc_maketag</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="nv">$dat</span><span class="p">,</span> <span class="nv">$value</span><span class="p">);</span>
            <span class="nv">$image_string</span> <span class="o">=</span> <span class="nb">iptcembed</span><span class="p">(</span><span class="nv">$caption_block</span><span class="p">,</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">fileName</span><span class="p">);</span>
            <span class="nb">file_put_contents</span><span class="p">(</span><span class="s1">&#39;iptc.jpg&#39;</span><span class="p">,</span> <span class="nv">$image_string</span><span class="p">);</span>
    <span class="p">}</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="no-hardcoded-port">
<span id="case-no-hardcoded-port"></span><h3><span class="section-number">5.2.209. </span>No Hardcoded Port<a class="headerlink" href="#no-hardcoded-port" title="Permalink to this headline">¶</a></h3>
<div class="section" id="case-wordpress-structures-nohardcodedport">
<span id="id304"></span><h4><span class="section-number">5.2.209.1. </span>WordPress<a class="headerlink" href="#case-wordpress-structures-nohardcodedport" title="Permalink to this headline">¶</a></h4>
<p><a class="reference internal" href="Rules.html#no-hardcoded-port"><span class="std std-ref">No Hardcoded Port</span></a>, in wp-admin/includes/misc.php:74.</p>
<p>This code actually loads the file, join it, then split it again. file() would be sufficient.</p>
<div class="highlight-php notranslate"><div class="highlight"><pre><span></span><span class="nv">$markerdata</span> <span class="o">=</span> <span class="nb">explode</span><span class="p">(</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">,</span> <span class="nb">implode</span><span class="p">(</span> <span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="nb">file</span><span class="p">(</span> <span class="nv">$filename</span> <span class="p">)</span> <span class="p">)</span> <span class="p">);</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="no-isset-with-empty">
<span id="case-no-isset-with-empty"></span><h3><span class="section-number">5.2.210. </span>No isset() With empty()<a class="headerlink" href="#no-isset-with-empty" title="Permalink to this headline">¶</a></h3>
<div class="section" id="case-xoops-structures-noissetwithempty">
<span id="id305"></span><h4><span class="section-number">5.2.210.1. </span>XOOPS<a class="headerlink" href="#case-xoops-structures-noissetwithempty" title="Permalink to this headline">¶</a></h4>
<p><a class="reference internal" href="Rules.html#no-isset-with-empty"><span class="std std-ref">No isset() With empty()</span></a>, in htdocs/class/tree.php:297.</p>
<p>Too much vlaidation</p>
<div class="highlight-php notranslate"><div class="highlight"><pre><span></span><span class="nb">isset</span><span class="p">(</span><span class="nv">$this</span><span class="o">-&gt;</span><span class="na">tree</span><span class="p">[</span><span class="nv">$key</span><span class="p">][</span><span class="s1">&#39;child&#39;</span><span class="p">])</span> <span class="o">&amp;&amp;</span> <span class="o">!</span><span class="k">empty</span><span class="p">(</span><span class="nv">$this</span><span class="o">-&gt;</span><span class="na">tree</span><span class="p">[</span><span class="nv">$key</span><span class="p">][</span><span class="s1">&#39;child&#39;</span><span class="p">]);</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="no-need-for-else">
<span id="case-no-need-for-else"></span><h3><span class="section-number">5.2.211. </span>No Need For Else<a class="headerlink" href="#no-need-for-else" title="Permalink to this headline">¶</a></h3>
<div class="section" id="case-thelia-structures-noneedforelse">
<span id="id306"></span><h4><span class="section-number">5.2.211.1. </span>Thelia<a class="headerlink" href="#case-thelia-structures-noneedforelse" title="Permalink to this headline">¶</a></h4>
<p><a class="reference internal" href="Rules.html#no-need-for-else"><span class="std std-ref">No Need For Else</span></a>, in core/lib/Thelia/Core/Template/Loop/Address.php:92.</p>
<p>After checking that $currentCustomer is null, the method returns. The block with Else may be removed and its code may be moved one level up.</p>
<div class="highlight-php notranslate"><div class="highlight"><pre><span></span><span class="k">if</span> <span class="p">(</span><span class="nv">$customer</span> <span class="o">===</span> <span class="s1">&#39;current&#39;</span><span class="p">)</span> <span class="p">{</span>
            <span class="nv">$currentCustomer</span> <span class="o">=</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">securityContext</span><span class="o">-&gt;</span><span class="na">getCustomerUser</span><span class="p">();</span>
            <span class="k">if</span> <span class="p">(</span><span class="nv">$currentCustomer</span> <span class="o">===</span> <span class="k">null</span><span class="p">)</span> <span class="p">{</span>
                <span class="k">return</span> <span class="k">null</span><span class="p">;</span>
            <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
                <span class="nv">$search</span><span class="o">-&gt;</span><span class="na">filterByCustomerId</span><span class="p">(</span><span class="nv">$currentCustomer</span><span class="o">-&gt;</span><span class="na">getId</span><span class="p">(),</span> <span class="nx">Criteria</span><span class="o">::</span><span class="na">EQUAL</span><span class="p">);</span>
            <span class="p">}</span>
        <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
            <span class="nv">$search</span><span class="o">-&gt;</span><span class="na">filterByCustomerId</span><span class="p">(</span><span class="nv">$customer</span><span class="p">,</span> <span class="nx">Criteria</span><span class="o">::</span><span class="na">EQUAL</span><span class="p">);</span>
        <span class="p">}</span>
</pre></div>
</div>
</div>
<div class="section" id="case-thinkphp-structures-noneedforelse">
<span id="id307"></span><h4><span class="section-number">5.2.211.2. </span>ThinkPHP<a class="headerlink" href="#case-thinkphp-structures-noneedforelse" title="Permalink to this headline">¶</a></h4>
<p><a class="reference internal" href="Rules.html#no-need-for-else"><span class="std std-ref">No Need For Else</span></a>, in projects/thinkphp/code//ThinkPHP/Library/Org/Util/Rbac.class.php:187.</p>
<p>This code has both good and bad example. Good : no use of else, after $_SESSION[$accessGuid] check. Issue : else usage after usage of !isset($accessList[strtoupper($appName)][strtoupper(CONTROLLER_NAME)][strtoupper(ACTION_NAME)])</p>
<div class="highlight-php notranslate"><div class="highlight"><pre><span></span><span class="k">if</span> <span class="p">(</span><span class="k">empty</span><span class="p">(</span><span class="nv">$_SESSION</span><span class="p">[</span><span class="nx">C</span><span class="p">(</span><span class="s1">&#39;ADMIN_AUTH_KEY&#39;</span><span class="p">)]))</span> <span class="p">{</span>
                <span class="k">if</span> <span class="p">(</span><span class="nx">C</span><span class="p">(</span><span class="s1">&#39;USER_AUTH_TYPE&#39;</span><span class="p">)</span> <span class="o">==</span> <span class="mi">2</span><span class="p">)</span> <span class="p">{</span>
                    <span class="c1">//加强验证和即时验证模式 更加安全 后台权限修改可以即时生效</span>
                    <span class="c1">//通过数据库进行访问检查</span>
                    <span class="nv">$accessList</span> <span class="o">=</span> <span class="nx">self</span><span class="o">::</span><span class="na">getAccessList</span><span class="p">(</span><span class="nv">$_SESSION</span><span class="p">[</span><span class="nx">C</span><span class="p">(</span><span class="s1">&#39;USER_AUTH_KEY&#39;</span><span class="p">)]);</span>
                <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
                    <span class="c1">// 如果是管理员或者当前操作已经认证过，无需再次认证</span>
                    <span class="k">if</span> <span class="p">(</span><span class="nv">$_SESSION</span><span class="p">[</span><span class="nv">$accessGuid</span><span class="p">])</span> <span class="p">{</span>
                        <span class="k">return</span> <span class="k">true</span><span class="p">;</span>
                    <span class="p">}</span>
                    <span class="c1">//登录验证模式，比较登录后保存的权限访问列表</span>
                    <span class="nv">$accessList</span> <span class="o">=</span> <span class="nv">$_SESSION</span><span class="p">[</span><span class="s1">&#39;_ACCESS_LIST&#39;</span><span class="p">];</span>
                <span class="p">}</span>
                <span class="c1">//判断是否为组件化模式，如果是，验证其全模块名</span>
                <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nb">isset</span><span class="p">(</span><span class="nv">$accessList</span><span class="p">[</span><span class="nb">strtoupper</span><span class="p">(</span><span class="nv">$appName</span><span class="p">)][</span><span class="nb">strtoupper</span><span class="p">(</span><span class="nx">CONTROLLER_NAME</span><span class="p">)][</span><span class="nb">strtoupper</span><span class="p">(</span><span class="nx">ACTION_NAME</span><span class="p">)]))</span> <span class="p">{</span>
                    <span class="nv">$_SESSION</span><span class="p">[</span><span class="nv">$accessGuid</span><span class="p">]</span> <span class="o">=</span> <span class="k">false</span><span class="p">;</span>
                    <span class="k">return</span> <span class="k">false</span><span class="p">;</span>
                <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
                    <span class="nv">$_SESSION</span><span class="p">[</span><span class="nv">$accessGuid</span><span class="p">]</span> <span class="o">=</span> <span class="k">true</span><span class="p">;</span>
                <span class="p">}</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="no-parenthesis-for-language-construct">
<span id="case-no-parenthesis-for-language-construct"></span><h3><span class="section-number">5.2.212. </span>No Parenthesis For Language Construct<a class="headerlink" href="#no-parenthesis-for-language-construct" title="Permalink to this headline">¶</a></h3>
<div class="section" id="case-phpdocumentor-structures-noparenthesisforlanguageconstruct">
<span id="id308"></span><h4><span class="section-number">5.2.212.1. </span>Phpdocumentor<a class="headerlink" href="#case-phpdocumentor-structures-noparenthesisforlanguageconstruct" title="Permalink to this headline">¶</a></h4>
<p><a class="reference internal" href="Rules.html#no-parenthesis-for-language-construct"><span class="std std-ref">No Parenthesis For Language Construct</span></a>, in src/Application/Renderer/Router/StandardRouter.php:55.</p>
<p>No need for parenthesis with require(). instanceof has a higher precedence than return anyway.</p>
<div class="highlight-php notranslate"><div class="highlight"><pre><span></span><span class="nv">$this</span><span class="p">[]</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Rule</span><span class="p">(</span><span class="k">function</span> <span class="p">(</span><span class="nv">$node</span><span class="p">)</span> <span class="p">{</span> <span class="k">return</span> <span class="p">(</span><span class="nv">$node</span> <span class="nx">instanceof</span> <span class="nx">NamespaceDescriptor</span><span class="p">);</span> <span class="p">},</span> <span class="nv">$namespaceGenerator</span><span class="p">);</span>
</pre></div>
</div>
</div>
<div class="section" id="case-phpmyadmin-structures-noparenthesisforlanguageconstruct">
<span id="id309"></span><h4><span class="section-number">5.2.212.2. </span>phpMyAdmin<a class="headerlink" href="#case-phpmyadmin-structures-noparenthesisforlanguageconstruct" title="Permalink to this headline">¶</a></h4>
<p><a class="reference internal" href="Rules.html#no-parenthesis-for-language-construct"><span class="std std-ref">No Parenthesis For Language Construct</span></a>, in db_datadict.php:170.</p>
<p>Not only echo() doesn’t use any parenthesis, but this syntax gives the illusion that echo() only accepts one argument, while it actually accepts an arbitrary number of argument.</p>
<div class="highlight-php notranslate"><div class="highlight"><pre><span></span><span class="k">echo</span> <span class="p">((</span><span class="nv">$row</span><span class="p">[</span><span class="s1">&#39;Null&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;NO&#39;</span><span class="p">)</span> <span class="o">?</span> <span class="nx">__</span><span class="p">(</span><span class="s1">&#39;No&#39;</span><span class="p">)</span> <span class="o">:</span> <span class="nx">__</span><span class="p">(</span><span class="s1">&#39;Yes&#39;</span><span class="p">))</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="avoid-substr-one">
<span id="case-avoid-substr-one"></span><h3><span class="section-number">5.2.213. </span>Avoid Substr() One<a class="headerlink" href="#avoid-substr-one" title="Permalink to this headline">¶</a></h3>
<div class="section" id="case-churchcrm-structures-nosubstrone">
<span id="id310"></span><h4><span class="section-number">5.2.213.1. </span>ChurchCRM<a class="headerlink" href="#case-churchcrm-structures-nosubstrone" title="Permalink to this headline">¶</a></h4>
<p><a class="reference internal" href="Rules.html#avoid-substr-one"><span class="std std-ref">Avoid Substr() One</span></a>, in src/Login.php:141.</p>
<p>No need to call substr() to get only one char.</p>
<div class="highlight-php notranslate"><div class="highlight"><pre><span></span><span class="k">if</span> <span class="p">(</span><span class="nb">substr</span><span class="p">(</span><span class="nv">$LocationFromGet</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span> <span class="o">==</span> <span class="s2">&quot;/&quot;</span><span class="p">)</span> <span class="p">{</span>
    <span class="nv">$LocationFromGet</span> <span class="o">=</span> <span class="nb">substr</span><span class="p">(</span><span class="nv">$LocationFromGet</span><span class="p">,</span> <span class="mi">1</span><span class="p">);</span>
<span class="p">}</span>
</pre></div>
</div>
</div>
<div class="section" id="case-livezilla-structures-nosubstrone">
<span id="id311"></span><h4><span class="section-number">5.2.213.2. </span>LiveZilla<a class="headerlink" href="#case-livezilla-structures-nosubstrone" title="Permalink to this headline">¶</a></h4>
<p><a class="reference internal" href="Rules.html#avoid-substr-one"><span class="std std-ref">Avoid Substr() One</span></a>, in livezilla/_lib/objects.global.inc.php:2243.</p>
<p>No need to call substr() to get only one char.</p>
<div class="highlight-php notranslate"><div class="highlight"><pre><span></span><span class="nv">$_hex</span> <span class="o">=</span> <span class="nb">str_replace</span><span class="p">(</span><span class="s2">&quot;#&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">,</span> <span class="nv">$_hex</span><span class="p">);</span>
            <span class="k">if</span><span class="p">(</span><span class="nb">strlen</span><span class="p">(</span><span class="nv">$_hex</span><span class="p">)</span> <span class="o">==</span> <span class="mi">3</span><span class="p">)</span> <span class="p">{</span>
            <span class="nv">$r</span> <span class="o">=</span> <span class="nb">hexdec</span><span class="p">(</span><span class="nb">substr</span><span class="p">(</span><span class="nv">$_hex</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">)</span><span class="o">.</span><span class="nb">substr</span><span class="p">(</span><span class="nv">$_hex</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">));</span>
            <span class="nv">$g</span> <span class="o">=</span> <span class="nb">hexdec</span><span class="p">(</span><span class="nb">substr</span><span class="p">(</span><span class="nv">$_hex</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">)</span><span class="o">.</span><span class="nb">substr</span><span class="p">(</span><span class="nv">$_hex</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">));</span>
            <span class="nv">$b</span> <span class="o">=</span> <span class="nb">hexdec</span><span class="p">(</span><span class="nb">substr</span><span class="p">(</span><span class="nv">$_hex</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">1</span><span class="p">)</span><span class="o">.</span><span class="nb">substr</span><span class="p">(</span><span class="nv">$_hex</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">1</span><span class="p">));</span>
        <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
            <span class="nv">$r</span> <span class="o">=</span> <span class="nb">hexdec</span><span class="p">(</span><span class="nb">substr</span><span class="p">(</span><span class="nv">$_hex</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">2</span><span class="p">));</span>
            <span class="nv">$g</span> <span class="o">=</span> <span class="nb">hexdec</span><span class="p">(</span><span class="nb">substr</span><span class="p">(</span><span class="nv">$_hex</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">2</span><span class="p">));</span>
            <span class="nv">$b</span> <span class="o">=</span> <span class="nb">hexdec</span><span class="p">(</span><span class="nb">substr</span><span class="p">(</span><span class="nv">$_hex</span><span class="p">,</span><span class="mi">4</span><span class="p">,</span><span class="mi">2</span><span class="p">));</span>
        <span class="p">}</span>
        <span class="nv">$rgb</span> <span class="o">=</span> <span class="k">array</span><span class="p">(</span><span class="nv">$r</span><span class="p">,</span> <span class="nv">$g</span><span class="p">,</span> <span class="nv">$b</span><span class="p">);</span>
        <span class="k">return</span> <span class="nv">$rgb</span><span class="p">;</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="operator">
<span id="case-operator"></span><h3><span class="section-number">5.2.214. </span>&#64; Operator<a class="headerlink" href="#operator" title="Permalink to this headline">¶</a></h3>
<div class="section" id="case-phinx-structures-noscream">
<span id="id312"></span><h4><span class="section-number">5.2.214.1. </span>Phinx<a class="headerlink" href="#case-phinx-structures-noscream" title="Permalink to this headline">¶</a></h4>
<p><a class="reference internal" href="Rules.html#operator"><span class="std std-ref">&#64; Operator</span></a>, in src/Phinx/Util/Util.php:239.</p>
<p>fopen() may be tested for existence, readability before using it. Although, it actually emits some errors on Windows, with network volumes.</p>
<div class="highlight-php notranslate"><div class="highlight"><pre><span></span><span class="nv">$isReadable</span> <span class="o">=</span> <span class="o">@</span><span class="nx">\fopen</span><span class="p">(</span><span class="nv">$filePath</span><span class="p">,</span> <span class="s1">&#39;r&#39;</span><span class="p">)</span> <span class="o">!==</span> <span class="k">false</span><span class="p">;</span>

        <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nv">$filePath</span> <span class="o">||</span> <span class="o">!</span><span class="nv">$isReadable</span><span class="p">)</span> <span class="p">{</span>
            <span class="k">throw</span> <span class="k">new</span> <span class="nx">\Exception</span><span class="p">(</span><span class="nb">sprintf</span><span class="p">(</span><span class="nx">Cannot</span> <span class="nx">open</span> <span class="nb">file</span> <span class="o">%</span><span class="nx">s</span> <span class="nx">\n</span><span class="p">,</span> <span class="nv">$filename</span><span class="p">));</span>
        <span class="p">}</span>
</pre></div>
</div>
</div>
<div class="section" id="case-phpipam-structures-noscream">
<span id="id313"></span><h4><span class="section-number">5.2.214.2. </span>PhpIPAM<a class="headerlink" href="#case-phpipam-structures-noscream" title="Permalink to this headline">¶</a></h4>
<p><a class="reference internal" href="Rules.html#operator"><span class="std std-ref">&#64; Operator</span></a>, in functions/classes/class.Log.php:322.</p>
<p>Variable and index existence should always be tested with isset() : it is faster than using <code class="docutils literal notranslate"><span class="pre">&#64;</span></code>.</p>
<div class="highlight-php notranslate"><div class="highlight"><pre><span></span><span class="nv">$_SESSION</span><span class="p">[</span><span class="s1">&#39;ipamusername&#39;</span><span class="p">]</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="not-not">
<span id="case-not-not"></span><h3><span class="section-number">5.2.215. </span>Not Not<a class="headerlink" href="#not-not" title="Permalink to this headline">¶</a></h3>
<div class="section" id="case-cleverstyle-structures-notnot">
<span id="id314"></span><h4><span class="section-number">5.2.215.1. </span>Cleverstyle<a class="headerlink" href="#case-cleverstyle-structures-notnot" title="Permalink to this headline">¶</a></h4>
<p><a class="reference internal" href="Rules.html#not-not"><span class="std std-ref">Not Not</span></a>, in modules/OAuth2/OAuth2.php:190.</p>
<p>This double-call returns <code class="docutils literal notranslate"><span class="pre">$results</span></code> as a boolean, preventing a spill of data to the calling method. The <code class="docutils literal notranslate"><span class="pre">(bool)</span></code> operator would be clearer here.</p>
<div class="highlight-php notranslate"><div class="highlight"><pre><span></span><span class="nv">$result</span> <span class="o">=</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">db_prime</span><span class="p">()</span><span class="o">-&gt;</span><span class="na">q</span><span class="p">(</span>
                    <span class="p">[</span>
                            <span class="nx">DELETE</span> <span class="nx">FROM</span> <span class="sb">`[prefix]oauth2_clients`</span>
                            <span class="nx">WHERE</span> <span class="sb">`id`</span> <span class="o">=</span> <span class="s1">&#39;%s&#39;</span><span class="p">,</span>
                            <span class="nx">DELETE</span> <span class="nx">FROM</span> <span class="sb">`[prefix]oauth2_clients_grant_access`</span>
                            <span class="nx">WHERE</span> <span class="sb">`id`</span>      <span class="o">=</span> <span class="s1">&#39;%s&#39;</span><span class="p">,</span>
                            <span class="nx">DELETE</span> <span class="nx">FROM</span> <span class="sb">`[prefix]oauth2_clients_sessions`</span>
                            <span class="nx">WHERE</span> <span class="sb">`id`</span>      <span class="o">=</span> <span class="s1">&#39;%s&#39;</span>
                    <span class="p">],</span>
                    <span class="nv">$id</span>
            <span class="p">);</span>
            <span class="nb">unset</span><span class="p">(</span><span class="nv">$this</span><span class="o">-&gt;</span><span class="na">cache</span><span class="o">-&gt;</span><span class="p">{</span><span class="s1">&#39;/&#39;</span><span class="p">});</span>
            <span class="k">return</span> <span class="o">!!</span><span class="nv">$result</span><span class="p">;</span>
</pre></div>
</div>
</div>
<div class="section" id="case-tine20-structures-notnot">
<span id="id315"></span><h4><span class="section-number">5.2.215.2. </span>Tine20<a class="headerlink" href="#case-tine20-structures-notnot" title="Permalink to this headline">¶</a></h4>
<p><a class="reference internal" href="Rules.html#not-not"><span class="std std-ref">Not Not</span></a>, in tine20/Calendar/Controller/MSEventFacade.php:392.</p>
<p>It seems that !! is almost superfluous, as a property called ‘is_deleted’ should already be a boolean.</p>
<div class="highlight-php notranslate"><div class="highlight"><pre><span></span><span class="k">foreach</span> <span class="p">(</span><span class="nv">$exceptions</span> <span class="k">as</span> <span class="nv">$exception</span><span class="p">)</span> <span class="p">{</span>
                <span class="nv">$exception</span><span class="o">-&gt;</span><span class="na">assertAttendee</span><span class="p">(</span><span class="nv">$this</span><span class="o">-&gt;</span><span class="na">getCalendarUser</span><span class="p">());</span>
                <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">_prepareException</span><span class="p">(</span><span class="nv">$savedEvent</span><span class="p">,</span> <span class="nv">$exception</span><span class="p">);</span>
                <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">_preserveMetaData</span><span class="p">(</span><span class="nv">$savedEvent</span><span class="p">,</span> <span class="nv">$exception</span><span class="p">,</span> <span class="k">true</span><span class="p">);</span>
                <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">_eventController</span><span class="o">-&gt;</span><span class="na">createRecurException</span><span class="p">(</span><span class="nv">$exception</span><span class="p">,</span> <span class="o">!!</span><span class="nv">$exception</span><span class="o">-&gt;</span><span class="na">is_deleted</span><span class="p">);</span>
            <span class="p">}</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="objects-don-t-need-references">
<span id="case-objects-don-t-need-references"></span><h3><span class="section-number">5.2.216. </span>Objects Don’t Need References<a class="headerlink" href="#objects-don-t-need-references" title="Permalink to this headline">¶</a></h3>
<div class="section" id="case-zencart-structures-objectreferences">
<span id="id316"></span><h4><span class="section-number">5.2.216.1. </span>Zencart<a class="headerlink" href="#case-zencart-structures-objectreferences" title="Permalink to this headline">¶</a></h4>
<p><a class="reference internal" href="Rules.html#objects-don-t-need-references"><span class="std std-ref">Objects Don’t Need References</span></a>, in includes/library/illuminate/support/helpers.php:484.</p>
<p>No need for &amp; operator when $class is only used for a method call.</p>
<div class="highlight-php notranslate"><div class="highlight"><pre><span></span><span class="sd">/**</span>
<span class="sd">     * @param $class</span>
<span class="sd">     * @param $eventID</span>
<span class="sd">     * @param array $paramsArray</span>
<span class="sd">     */</span>
    <span class="k">public</span> <span class="k">function</span> <span class="nf">updateNotifyCheckoutflowFinishedManageSuccessOrderLinkEnd</span><span class="p">(</span><span class="o">&amp;</span><span class="nv">$class</span><span class="p">,</span> <span class="nv">$eventID</span><span class="p">,</span> <span class="nv">$paramsArray</span> <span class="o">=</span> <span class="k">array</span><span class="p">())</span>
    <span class="p">{</span>
        <span class="nv">$class</span><span class="o">-&gt;</span><span class="na">getView</span><span class="p">()</span><span class="o">-&gt;</span><span class="na">getTplVarManager</span><span class="p">()</span><span class="o">-&gt;</span><span class="na">se</span><span class="p">(</span><span class="s1">&#39;flag_show_order_link&#39;</span><span class="p">,</span> <span class="k">false</span><span class="p">);</span>
    <span class="p">}</span>
</pre></div>
</div>
</div>
<div class="section" id="case-xoops-structures-objectreferences">
<span id="id317"></span><h4><span class="section-number">5.2.216.2. </span>XOOPS<a class="headerlink" href="#case-xoops-structures-objectreferences" title="Permalink to this headline">¶</a></h4>
<p><a class="reference internal" href="Rules.html#objects-don-t-need-references"><span class="std std-ref">Objects Don’t Need References</span></a>, in htdocs/class/theme_blocks.phps:221.</p>
<p>Here, $template is modified, when its properties are modified. When only the properties are modified, or read, then &amp; is not necessary.</p>
<div class="highlight-php notranslate"><div class="highlight"><pre><span></span><span class="k">public</span> <span class="k">function</span> <span class="nf">buildBlock</span><span class="p">(</span><span class="nv">$xobject</span><span class="p">,</span> <span class="o">&amp;</span><span class="nv">$template</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="c1">// The lame type workaround will change</span>
        <span class="c1">// bid is added temporarily as workaround for specific block manipulation</span>
        <span class="nv">$block</span> <span class="o">=</span> <span class="k">array</span><span class="p">(</span>
            <span class="s1">&#39;id&#39;</span>      <span class="o">=&gt;</span> <span class="nv">$xobject</span><span class="o">-&gt;</span><span class="na">getVar</span><span class="p">(</span><span class="s1">&#39;bid&#39;</span><span class="p">),</span>
            <span class="s1">&#39;module&#39;</span>  <span class="o">=&gt;</span> <span class="nv">$xobject</span><span class="o">-&gt;</span><span class="na">getVar</span><span class="p">(</span><span class="s1">&#39;dirname&#39;</span><span class="p">),</span>
            <span class="s1">&#39;title&#39;</span>   <span class="o">=&gt;</span> <span class="nv">$xobject</span><span class="o">-&gt;</span><span class="na">getVar</span><span class="p">(</span><span class="s1">&#39;title&#39;</span><span class="p">),</span>
            <span class="c1">// &#39;name&#39;        =&gt; strtolower( preg_replace( &#39;/[^0-9a-zA-Z_]/&#39;, &#39;&#39;, str_replace( &#39; &#39;, &#39;_&#39;, $xobject-&gt;getVar( &#39;name&#39; ) ) ) ),</span>
            <span class="s1">&#39;weight&#39;</span>  <span class="o">=&gt;</span> <span class="nv">$xobject</span><span class="o">-&gt;</span><span class="na">getVar</span><span class="p">(</span><span class="s1">&#39;weight&#39;</span><span class="p">),</span>
            <span class="s1">&#39;lastmod&#39;</span> <span class="o">=&gt;</span> <span class="nv">$xobject</span><span class="o">-&gt;</span><span class="na">getVar</span><span class="p">(</span><span class="s1">&#39;last_modified&#39;</span><span class="p">));</span>

        <span class="nv">$bcachetime</span> <span class="o">=</span> <span class="p">(</span><span class="nx">int</span><span class="p">)</span><span class="nv">$xobject</span><span class="o">-&gt;</span><span class="na">getVar</span><span class="p">(</span><span class="s1">&#39;bcachetime&#39;</span><span class="p">);</span>
        <span class="k">if</span> <span class="p">(</span><span class="k">empty</span><span class="p">(</span><span class="nv">$bcachetime</span><span class="p">))</span> <span class="p">{</span>
            <span class="nv">$template</span><span class="o">-&gt;</span><span class="na">caching</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
        <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
            <span class="nv">$template</span><span class="o">-&gt;</span><span class="na">caching</span>        <span class="o">=</span> <span class="mi">2</span><span class="p">;</span>
            <span class="nv">$template</span><span class="o">-&gt;</span><span class="na">cache_lifetime</span> <span class="o">=</span> <span class="nv">$bcachetime</span><span class="p">;</span>
        <span class="p">}</span>
        <span class="nv">$template</span><span class="o">-&gt;</span><span class="na">setCompileId</span><span class="p">(</span><span class="nv">$xobject</span><span class="o">-&gt;</span><span class="na">getVar</span><span class="p">(</span><span class="s1">&#39;dirname&#39;</span><span class="p">,</span> <span class="s1">&#39;n&#39;</span><span class="p">));</span>
        <span class="nv">$tplName</span> <span class="o">=</span> <span class="p">(</span><span class="nv">$tplName</span> <span class="o">=</span> <span class="nv">$xobject</span><span class="o">-&gt;</span><span class="na">getVar</span><span class="p">(</span><span class="s1">&#39;template&#39;</span><span class="p">))</span> <span class="o">?</span> <span class="nx">db</span><span class="o">:</span><span class="nv">$tplName</span> <span class="o">:</span> <span class="s1">&#39;db:system_block_dummy.tpl&#39;</span><span class="p">;</span>
        <span class="nv">$cacheid</span> <span class="o">=</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">generateCacheId</span><span class="p">(</span><span class="s1">&#39;blk_&#39;</span> <span class="o">.</span> <span class="nv">$xobject</span><span class="o">-&gt;</span><span class="na">getVar</span><span class="p">(</span><span class="s1">&#39;bid&#39;</span><span class="p">));</span>
<span class="c1">// more code to the end of the method</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="include-once-usage">
<span id="case-include-once-usage"></span><h3><span class="section-number">5.2.217. </span>include_once() Usage<a class="headerlink" href="#include-once-usage" title="Permalink to this headline">¶</a></h3>
<div class="section" id="case-xoops-structures-onceusage">
<span id="id318"></span><h4><span class="section-number">5.2.217.1. </span>XOOPS<a class="headerlink" href="#case-xoops-structures-onceusage" title="Permalink to this headline">¶</a></h4>
<p><a class="reference internal" href="Rules.html#include-once-usage"><span class="std std-ref">include_once() Usage</span></a>, in /htdocs/xoops_lib/modules/protector/admin/center.php:5.</p>
<p>Loading() classes should be down with autoload(). autload() may be build in several distinct functions, using spl_autoload_register().</p>
<div class="highlight-php notranslate"><div class="highlight"><pre><span></span><span class="k">require_once</span> <span class="nb">dirname</span><span class="p">(</span><span class="no">__DIR__</span><span class="p">)</span> <span class="o">.</span> <span class="s1">&#39;class/gtickets.php&#39;</span>
</pre></div>
</div>
</div>
<div class="section" id="case-tikiwiki-structures-onceusage">
<span id="id319"></span><h4><span class="section-number">5.2.217.2. </span>Tikiwiki<a class="headerlink" href="#case-tikiwiki-structures-onceusage" title="Permalink to this headline">¶</a></h4>
<p><a class="reference internal" href="Rules.html#include-once-usage"><span class="std std-ref">include_once() Usage</span></a>, in tiki-mytiki_shared.php :140.</p>
<p>Turn the code from tiki-mytiki_shared.php into a function or a method, and call it when needed.</p>
<div class="highlight-php notranslate"><div class="highlight"><pre><span></span><span class="k">include_once</span><span class="p">(</span><span class="s1">&#39;tiki-mytiki_shared.php&#39;</span><span class="p">);</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="one-if-is-sufficient">
<span id="case-one-if-is-sufficient"></span><h3><span class="section-number">5.2.218. </span>One If Is Sufficient<a class="headerlink" href="#one-if-is-sufficient" title="Permalink to this headline">¶</a></h3>
<div class="section" id="case-tikiwiki-structures-oneifissufficient">
<span id="id320"></span><h4><span class="section-number">5.2.218.1. </span>Tikiwiki<a class="headerlink" href="#case-tikiwiki-structures-oneifissufficient" title="Permalink to this headline">¶</a></h4>
<p><a class="reference internal" href="Rules.html#one-if-is-sufficient"><span class="std std-ref">One If Is Sufficient</span></a>, in lib/wiki-plugins/wikiplugin_trade.php:152.</p>
<p>empty($params[‘inputtitle’]) should have priority over $params[‘wanted’] == ‘n’.</p>
<div class="highlight-php notranslate"><div class="highlight"><pre><span></span><span class="k">if</span> <span class="p">(</span><span class="nv">$params</span><span class="p">[</span><span class="s1">&#39;wanted&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;n&#39;</span><span class="p">)</span> <span class="p">{</span>
            <span class="k">if</span> <span class="p">(</span><span class="k">empty</span><span class="p">(</span><span class="nv">$params</span><span class="p">[</span><span class="s1">&#39;inputtitle&#39;</span><span class="p">]))</span> <span class="p">{</span>
                    <span class="nv">$params</span><span class="p">[</span><span class="s1">&#39;inputtitle&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;Payment of %0 %1 from user %2 to %3&#39;</span><span class="p">;</span>
            <span class="p">}</span>
    <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
            <span class="k">if</span> <span class="p">(</span><span class="k">empty</span><span class="p">(</span><span class="nv">$params</span><span class="p">[</span><span class="s1">&#39;inputtitle&#39;</span><span class="p">]))</span> <span class="p">{</span>
                    <span class="nv">$params</span><span class="p">[</span><span class="s1">&#39;inputtitle&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;Request payment of %0 %1 to user %2 from %3&#39;</span><span class="p">;</span>
            <span class="p">}</span>
    <span class="p">}</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="several-instructions-on-the-same-line">
<span id="case-several-instructions-on-the-same-line"></span><h3><span class="section-number">5.2.219. </span>Several Instructions On The Same Line<a class="headerlink" href="#several-instructions-on-the-same-line" title="Permalink to this headline">¶</a></h3>
<div class="section" id="case-piwigo-structures-onelinetwoinstructions">
<span id="id321"></span><h4><span class="section-number">5.2.219.1. </span>Piwigo<a class="headerlink" href="#case-piwigo-structures-onelinetwoinstructions" title="Permalink to this headline">¶</a></h4>
<p><a class="reference internal" href="Rules.html#several-instructions-on-the-same-line"><span class="std std-ref">Several Instructions On The Same Line</span></a>, in tools/triggers_list.php:993.</p>
<p>There are two instructions on the line with the if(). Note that the condition is not followed by a bracketed block. When reviewing, it really seems that echo ‘&lt;br&gt;’ and $f=0; are on the same block, but the second is indeed an unconditional expression. This is very difficult to spot.</p>
<div class="highlight-php notranslate"><div class="highlight"><pre><span></span><span class="k">foreach</span> <span class="p">(</span><span class="nv">$trigger</span><span class="p">[</span><span class="s1">&#39;files&#39;</span><span class="p">]</span> <span class="k">as</span> <span class="nv">$file</span><span class="p">)</span>
      <span class="p">{</span>
        <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nv">$f</span><span class="p">)</span> <span class="k">echo</span> <span class="s1">&#39;&lt;br&gt;&#39;</span><span class="p">;</span> <span class="nv">$f</span><span class="o">=</span><span class="mi">0</span><span class="p">;</span>
        <span class="k">echo</span> <span class="nb">preg_replace</span><span class="p">(</span><span class="s1">&#39;#\((.+)\)#&#39;</span><span class="p">,</span> <span class="s1">&#39;(&lt;i&gt;$1&lt;/i&gt;)&#39;</span><span class="p">,</span> <span class="nv">$file</span><span class="p">);</span>
      <span class="p">}</span>
</pre></div>
</div>
</div>
<div class="section" id="case-tine20-structures-onelinetwoinstructions">
<span id="id322"></span><h4><span class="section-number">5.2.219.2. </span>Tine20<a class="headerlink" href="#case-tine20-structures-onelinetwoinstructions" title="Permalink to this headline">¶</a></h4>
<p><a class="reference internal" href="Rules.html#several-instructions-on-the-same-line"><span class="std std-ref">Several Instructions On The Same Line</span></a>, in tine20/Calendar/Controller/Event.php:1594.</p>
<p>Here, $_event-&gt;attendee is saved in a local variable, then the property is destroyed. Same for $_event-&gt;notes; Strangely, a few lines above, the properties are unset on their own line. Unsetting properties leads to surprise bugs, and hidding the unset after ; makes it harder to spot.</p>
<div class="highlight-php notranslate"><div class="highlight"><pre><span></span><span class="nv">$futurePersistentExceptionEvents</span><span class="o">-&gt;</span><span class="na">setRecurId</span><span class="p">(</span><span class="nv">$_event</span><span class="o">-&gt;</span><span class="na">getId</span><span class="p">());</span>
                <span class="nb">unset</span><span class="p">(</span><span class="nv">$_event</span><span class="o">-&gt;</span><span class="na">recurid</span><span class="p">);</span>
                <span class="nb">unset</span><span class="p">(</span><span class="nv">$_event</span><span class="o">-&gt;</span><span class="na">base_event_id</span><span class="p">);</span>
                <span class="k">foreach</span><span class="p">(</span><span class="k">array</span><span class="p">(</span><span class="s1">&#39;attendee&#39;</span><span class="p">,</span> <span class="s1">&#39;notes&#39;</span><span class="p">,</span> <span class="s1">&#39;alarms&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="nv">$prop</span><span class="p">)</span> <span class="p">{</span>
                    <span class="k">if</span> <span class="p">(</span><span class="nv">$_event</span><span class="o">-&gt;</span><span class="p">{</span><span class="nv">$prop</span><span class="p">}</span> <span class="nx">instanceof</span> <span class="nx">Tinebase_Record_RecordSet</span><span class="p">)</span> <span class="p">{</span>
                        <span class="nv">$_event</span><span class="o">-&gt;</span><span class="p">{</span><span class="nv">$prop</span><span class="p">}</span><span class="o">-&gt;</span><span class="na">setId</span><span class="p">(</span><span class="k">NULL</span><span class="p">);</span>
                    <span class="p">}</span>
                <span class="p">}</span>
                <span class="nv">$_event</span><span class="o">-&gt;</span><span class="na">exdate</span> <span class="o">=</span> <span class="nv">$futureExdates</span><span class="p">;</span>

                <span class="nv">$attendees</span> <span class="o">=</span> <span class="nv">$_event</span><span class="o">-&gt;</span><span class="na">attendee</span><span class="p">;</span> <span class="nb">unset</span><span class="p">(</span><span class="nv">$_event</span><span class="o">-&gt;</span><span class="na">attendee</span><span class="p">);</span>
                <span class="nv">$note</span> <span class="o">=</span> <span class="nv">$_event</span><span class="o">-&gt;</span><span class="na">notes</span><span class="p">;</span> <span class="nb">unset</span><span class="p">(</span><span class="nv">$_event</span><span class="o">-&gt;</span><span class="na">notes</span><span class="p">);</span>
                <span class="nv">$persistentExceptionEvent</span> <span class="o">=</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">create</span><span class="p">(</span><span class="nv">$_event</span><span class="p">,</span> <span class="nv">$_checkBusyConflicts</span> <span class="o">&amp;&amp;</span> <span class="nv">$dtStartHasDiff</span><span class="p">);</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="or-die">
<span id="case-or-die"></span><h3><span class="section-number">5.2.220. </span>Or Die<a class="headerlink" href="#or-die" title="Permalink to this headline">¶</a></h3>
<div class="section" id="case-tine20-structures-ordie">
<span id="id323"></span><h4><span class="section-number">5.2.220.1. </span>Tine20<a class="headerlink" href="#case-tine20-structures-ordie" title="Permalink to this headline">¶</a></h4>
<p><a class="reference internal" href="Rules.html#or-die"><span class="std std-ref">Or Die</span></a>, in scripts/addgrant.php:34.</p>
<p>Typical error handling, which also displays the MySQL error message, and leaks informations about the system. One may also note that mysql_connect is not supported anymore, and was replaced with mysqli and pdo : this may be a backward compatibile file.</p>
<div class="highlight-php notranslate"><div class="highlight"><pre><span></span><span class="nv">$link</span> <span class="o">=</span> <span class="nb">mysql_connect</span><span class="p">(</span><span class="nv">$host</span><span class="p">,</span> <span class="nv">$user</span><span class="p">,</span> <span class="nv">$pass</span><span class="p">)</span> <span class="k">or</span> <span class="k">die</span><span class="p">(</span><span class="s2">&quot;No connection: &quot;</span> <span class="o">.</span> <span class="nb">mysql_error</span><span class="p">(</span> <span class="p">))</span>
</pre></div>
</div>
</div>
<div class="section" id="case-openconf-structures-ordie">
<span id="id324"></span><h4><span class="section-number">5.2.220.2. </span>OpenConf<a class="headerlink" href="#case-openconf-structures-ordie" title="Permalink to this headline">¶</a></h4>
<p><a class="reference internal" href="Rules.html#or-die"><span class="std std-ref">Or Die</span></a>, in openconf/chair/export.inc:143.</p>
<p>or die() is also applied to many situations, where a blocking situation arise. Here, with the creation of a temporary file.</p>
<div class="highlight-php notranslate"><div class="highlight"><pre><span></span><span class="nv">$coreFile</span> <span class="o">=</span> <span class="nb">tempnam</span><span class="p">(</span><span class="s1">&#39;/tmp/&#39;</span><span class="p">,</span> <span class="s1">&#39;ocexport&#39;</span><span class="p">)</span> <span class="k">or</span> <span class="k">die</span><span class="p">(</span><span class="s1">&#39;could not generate Excel file (6)&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="php7-dirname">
<span id="case-php7-dirname"></span><h3><span class="section-number">5.2.221. </span>PHP7 Dirname<a class="headerlink" href="#php7-dirname" title="Permalink to this headline">¶</a></h3>
<div class="section" id="case-openconf-structures-php7dirname">
<span id="id325"></span><h4><span class="section-number">5.2.221.1. </span>OpenConf<a class="headerlink" href="#case-openconf-structures-php7dirname" title="Permalink to this headline">¶</a></h4>
<p><a class="reference internal" href="Rules.html#php7-dirname"><span class="std std-ref">PHP7 Dirname</span></a>, in include.php:61.</p>
<p>Since PHP 7.0, dirname( , 2); does the job.</p>
<div class="highlight-php notranslate"><div class="highlight"><pre><span></span><span class="nv">$OC_basepath</span> <span class="o">=</span> <span class="nb">dirname</span><span class="p">(</span><span class="nb">dirname</span><span class="p">(</span><span class="nv">$_SERVER</span><span class="p">[</span><span class="s1">&#39;PHP_SELF&#39;</span><span class="p">]));</span>
</pre></div>
</div>
</div>
<div class="section" id="case-mediawiki-structures-php7dirname">
<span id="id326"></span><h4><span class="section-number">5.2.221.2. </span>MediaWiki<a class="headerlink" href="#case-mediawiki-structures-php7dirname" title="Permalink to this headline">¶</a></h4>
<p><a class="reference internal" href="Rules.html#php7-dirname"><span class="std std-ref">PHP7 Dirname</span></a>, in includes/installer/Installer.php:1173.</p>
<p>Since PHP 7.0, dirname( , 2); does the job.</p>
<div class="highlight-php notranslate"><div class="highlight"><pre><span></span><span class="k">protected</span> <span class="k">function</span> <span class="nf">envPrepPath</span><span class="p">()</span> <span class="p">{</span>
            <span class="k">global</span> <span class="nv">$IP</span><span class="p">;</span>
            <span class="nv">$IP</span> <span class="o">=</span> <span class="nb">dirname</span><span class="p">(</span> <span class="nb">dirname</span><span class="p">(</span> <span class="no">__DIR__</span> <span class="p">)</span> <span class="p">);</span>
            <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">setVar</span><span class="p">(</span> <span class="s1">&#39;IP&#39;</span><span class="p">,</span> <span class="nv">$IP</span> <span class="p">);</span>
    <span class="p">}</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="phpinfo">
<span id="case-phpinfo"></span><h3><span class="section-number">5.2.222. </span>Phpinfo<a class="headerlink" href="#phpinfo" title="Permalink to this headline">¶</a></h3>
<div class="section" id="case-dolphin-structures-phpinfousage">
<span id="id327"></span><h4><span class="section-number">5.2.222.1. </span>Dolphin<a class="headerlink" href="#case-dolphin-structures-phpinfousage" title="Permalink to this headline">¶</a></h4>
<p><a class="reference internal" href="Rules.html#id6960"><span class="std std-ref">Phpinfo</span></a>, in Dolphin-v.7.3.5/install/exec.php:4.</p>
<p>An actual phpinfo(), available during installation. Note that the phpinfo() is actually triggered by a hidden POST variable.</p>
<div class="highlight-php notranslate"><div class="highlight"><pre><span></span><span class="o">&lt;?</span><span class="nx">php</span>

    <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="k">empty</span><span class="p">(</span><span class="nv">$_POST</span><span class="p">[</span><span class="s1">&#39;phpinfo&#39;</span><span class="p">]))</span>
        <span class="nb">phpinfo</span><span class="p">();</span>
    <span class="k">elseif</span> <span class="p">(</span><span class="o">!</span><span class="k">empty</span><span class="p">(</span><span class="nv">$_POST</span><span class="p">[</span><span class="s1">&#39;gdinfo&#39;</span><span class="p">]))</span>
        <span class="k">echo</span> <span class="s1">&#39;&lt;pre&gt;&#39;</span> <span class="o">.</span> <span class="nb">print_r</span><span class="p">(</span><span class="nb">gd_info</span><span class="p">(),</span> <span class="k">true</span><span class="p">)</span> <span class="o">.</span> <span class="s1">&#39;&lt;/pre&gt;&#39;</span><span class="p">;</span>

<span class="cp">?&gt;</span><span class="x"></span>
<span class="x">&lt;center&gt;</span>

<span class="x">    &lt;form method=post&gt;</span>
<span class="x">        &lt;input type=submit name=phpinfo value=&quot;PHP Info&quot;&gt;</span>
<span class="x">    &lt;/form&gt;</span>
<span class="x">    &lt;form method=post&gt;</span>
<span class="x">        &lt;input type=submit name=gdinfo value=&quot;GD Info&quot;&gt;</span>
<span class="x">    &lt;/form&gt;</span>

<span class="x">&lt;/center&gt;</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="possible-increment">
<span id="case-possible-increment"></span><h3><span class="section-number">5.2.223. </span>Possible Increment<a class="headerlink" href="#possible-increment" title="Permalink to this headline">¶</a></h3>
<div class="section" id="case-zurmo-structures-possibleincrement">
<span id="id328"></span><h4><span class="section-number">5.2.223.1. </span>Zurmo<a class="headerlink" href="#case-zurmo-structures-possibleincrement" title="Permalink to this headline">¶</a></h4>
<p><a class="reference internal" href="Rules.html#possible-increment"><span class="std std-ref">Possible Increment</span></a>, in app/protected/modules/workflows/utils/SavedWorkflowsUtil.php:196.</p>
<p>There are suspicious extra spaces around the +, that give the hint that there used to be something else, like a constant, there. From the name of the methods, it seems that this code was refactored from an addition to a simple method call.</p>
<div class="highlight-php notranslate"><div class="highlight"><pre><span></span><span class="nv">$timeStamp</span> <span class="o">=</span>  <span class="o">+</span> <span class="nv">$workflow</span><span class="o">-&gt;</span><span class="na">getTimeTrigger</span><span class="p">()</span><span class="o">-&gt;</span><span class="na">resolveNewTimeStampForDuration</span><span class="p">(</span><span class="nb">time</span><span class="p">());</span>
</pre></div>
</div>
</div>
<div class="section" id="case-mediawiki-structures-possibleincrement">
<span id="id329"></span><h4><span class="section-number">5.2.223.2. </span>MediaWiki<a class="headerlink" href="#case-mediawiki-structures-possibleincrement" title="Permalink to this headline">¶</a></h4>
<p><a class="reference internal" href="Rules.html#possible-increment"><span class="std std-ref">Possible Increment</span></a>, in includes/filerepo/file/LocalFile.php:613.</p>
<p>That is a useless assignation, except for the transtyping to integer that PHP does silently. May be that should be a +=, or completely dropped.</p>
<div class="highlight-php notranslate"><div class="highlight"><pre><span></span><span class="nv">$decoded</span><span class="p">[</span><span class="nv">$field</span><span class="p">]</span> <span class="o">=</span> <span class="o">+</span><span class="nv">$decoded</span><span class="p">[</span><span class="nv">$field</span><span class="p">]</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="printf-number-of-arguments">
<span id="case-printf-number-of-arguments"></span><h3><span class="section-number">5.2.224. </span>Printf Number Of Arguments<a class="headerlink" href="#printf-number-of-arguments" title="Permalink to this headline">¶</a></h3>
<div class="section" id="case-phpipam-structures-printfarguments">
<span id="id330"></span><h4><span class="section-number">5.2.224.1. </span>PhpIPAM<a class="headerlink" href="#case-phpipam-structures-printfarguments" title="Permalink to this headline">¶</a></h4>
<p><a class="reference internal" href="Rules.html#printf-number-of-arguments"><span class="std std-ref">Printf Number Of Arguments</span></a>, in functions/classes/class.Common.php:1174.</p>
<p>16 will not be displayed.</p>
<div class="highlight-php notranslate"><div class="highlight"><pre><span></span><span class="nb">sprintf</span><span class="p">(</span><span class="s1">&#39;%032s&#39;</span><span class="p">,</span> <span class="nb">gmp_strval</span><span class="p">(</span><span class="nb">gmp_init</span><span class="p">(</span><span class="nv">$ipv6long</span><span class="p">,</span> <span class="mi">10</span><span class="p">),</span> <span class="mi">16</span><span class="p">);</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="property-variable-confusion">
<span id="case-property-variable-confusion"></span><h3><span class="section-number">5.2.225. </span>Property Variable Confusion<a class="headerlink" href="#property-variable-confusion" title="Permalink to this headline">¶</a></h3>
<div class="section" id="case-phpipam-structures-propertyvariableconfusion">
<span id="id331"></span><h4><span class="section-number">5.2.225.1. </span>PhpIPAM<a class="headerlink" href="#case-phpipam-structures-propertyvariableconfusion" title="Permalink to this headline">¶</a></h4>
<p><a class="reference internal" href="Rules.html#property-variable-confusion"><span class="std std-ref">Property Variable Confusion</span></a>, in functions/classes/class.Admin.php:16.</p>
<p>There is a property called ‘$users’. It is easy to mistake $this-&gt;users and $users. Also, it seems that $this-&gt;users may be used as a cache system, yet it is not employed here.</p>
<div class="highlight-php notranslate"><div class="highlight"><pre><span></span><span class="sd">/**</span>
<span class="sd">     * (array of objects) to store users, user id is array index</span>
<span class="sd">     *</span>
<span class="sd">     * @var mixed</span>
<span class="sd">     * @access public</span>
<span class="sd">     */</span>
    <span class="k">public</span> <span class="nv">$users</span><span class="p">;</span>

<span class="c1">////////////</span>

    <span class="sd">/**</span>
<span class="sd">     * Fetches all users that are in group</span>
<span class="sd">     *</span>
<span class="sd">     * @access public</span>
<span class="sd">     * @return array of user ids</span>
<span class="sd">     */</span>
    <span class="k">public</span> <span class="k">function</span> <span class="nf">group_fetch_users</span> <span class="p">(</span><span class="nv">$group_id</span><span class="p">)</span> <span class="p">{</span>
            <span class="nv">$out</span> <span class="o">=</span> <span class="k">array</span> <span class="p">();</span>
            <span class="c1"># get all users</span>
            <span class="nv">$users</span> <span class="o">=</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">fetch_all_objects</span><span class="p">(</span><span class="nx">users</span><span class="p">);</span>
            <span class="c1"># check if $gid in array</span>
            <span class="k">if</span><span class="p">(</span><span class="nv">$users</span><span class="o">!==</span><span class="k">false</span><span class="p">)</span> <span class="p">{</span>
                    <span class="k">foreach</span><span class="p">(</span><span class="nv">$users</span> <span class="k">as</span> <span class="nv">$u</span><span class="p">)</span> <span class="p">{</span>
                            <span class="nv">$group_array</span> <span class="o">=</span> <span class="nb">json_decode</span><span class="p">(</span><span class="nv">$u</span><span class="o">-&gt;</span><span class="na">groups</span><span class="p">,</span> <span class="k">true</span><span class="p">);</span>
                            <span class="nv">$group_array</span> <span class="o">=</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">groups_parse</span><span class="p">(</span><span class="nv">$group_array</span><span class="p">);</span>

                            <span class="k">if</span><span class="p">(</span><span class="nb">sizeof</span><span class="p">(</span><span class="nv">$group_array</span><span class="p">)</span><span class="o">&gt;</span><span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
                                    <span class="k">foreach</span><span class="p">(</span><span class="nv">$group_array</span> <span class="k">as</span> <span class="nv">$group</span><span class="p">)</span> <span class="p">{</span>
                                            <span class="k">if</span><span class="p">(</span><span class="nb">in_array</span><span class="p">(</span><span class="nv">$group_id</span><span class="p">,</span> <span class="nv">$group</span><span class="p">))</span> <span class="p">{</span>
                                                    <span class="nv">$out</span><span class="p">[]</span> <span class="o">=</span> <span class="nv">$u</span><span class="o">-&gt;</span><span class="na">id</span><span class="p">;</span>
                                            <span class="p">}</span>
                                    <span class="p">}</span>
                            <span class="p">}</span>
                    <span class="p">}</span>
            <span class="p">}</span>
            <span class="c1"># return</span>
            <span class="k">return</span> <span class="nb">isset</span><span class="p">(</span><span class="nv">$out</span><span class="p">)</span> <span class="o">?</span> <span class="nv">$out</span> <span class="o">:</span> <span class="k">array</span><span class="p">();</span>
    <span class="p">}</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="queries-in-loops">
<span id="case-queries-in-loops"></span><h3><span class="section-number">5.2.226. </span>Queries In Loops<a class="headerlink" href="#queries-in-loops" title="Permalink to this headline">¶</a></h3>
<div class="section" id="case-teampass-structures-queriesinloop">
<span id="id332"></span><h4><span class="section-number">5.2.226.1. </span>TeamPass<a class="headerlink" href="#case-teampass-structures-queriesinloop" title="Permalink to this headline">¶</a></h4>
<p><a class="reference internal" href="Rules.html#queries-in-loops"><span class="std std-ref">Queries In Loops</span></a>, in install/install.queries.php:551.</p>
<p>The value is SELECTed first in the database, and it is INSERTed if not. This may be done in one call in most databases.</p>
<div class="highlight-php notranslate"><div class="highlight"><pre><span></span><span class="k">foreach</span> <span class="p">(</span><span class="nv">$aMiscVal</span> <span class="k">as</span> <span class="nv">$elem</span><span class="p">)</span> <span class="p">{</span>
    <span class="c1">//Check if exists before inserting</span>
    <span class="nv">$tmp</span> <span class="o">=</span> <span class="nx">mysqli_num_rows</span><span class="p">(</span>
        <span class="nx">mysqli_query</span><span class="p">(</span>
            <span class="nv">$dbTmp</span><span class="p">,</span>
            <span class="nx">SELECT</span> <span class="o">*</span> <span class="nx">FROM</span> <span class="sb">`.$var[&#39;tbl_prefix&#39;].misc`</span>
            <span class="nx">WHERE</span> <span class="nx">type</span><span class="o">=</span><span class="s1">&#39;.$elem[0].&#39;</span> <span class="k">AND</span> <span class="nx">intitule</span><span class="o">=</span><span class="s1">&#39;.$elem[1].&#39;</span>
        <span class="p">)</span>
    <span class="p">);</span>
    <span class="k">if</span> <span class="p">(</span><span class="nb">intval</span><span class="p">(</span><span class="nv">$tmp</span><span class="p">)</span> <span class="o">===</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
        <span class="nv">$queryRes</span> <span class="o">=</span> <span class="nx">mysqli_query</span><span class="p">(</span>
            <span class="nv">$dbTmp</span><span class="p">,</span>
            <span class="nx">INSERT</span> <span class="nx">INTO</span> <span class="sb">`.$var[&#39;tbl_prefix&#39;].misc`</span>
            <span class="p">(</span><span class="sb">`type`</span><span class="p">,</span> <span class="sb">`intitule`</span><span class="p">,</span> <span class="sb">`valeur`</span><span class="p">)</span> <span class="nx">VALUES</span>
            <span class="p">(</span><span class="s1">&#39;.$elem[0].&#39;</span><span class="p">,</span> <span class="s1">&#39;.$elem[1].&#39;</span><span class="p">,</span> <span class="s1">&#39;.</span>
<span class="s1">            str_replace(&#39;</span><span class="p">,</span> <span class="p">,</span> <span class="nv">$elem</span><span class="p">[</span><span class="mi">2</span><span class="p">])</span><span class="o">.</span><span class="s1">&#39;);</span>
<span class="s1">        ); // or die(mysqli_error($dbTmp))</span>
<span class="s1">    }</span>

<span class="s1">    // append new setting in config file</span>
<span class="s1">    $config_text .= &#39;</span><span class="o">.</span><span class="nv">$elem</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="s1">&#39; =&gt; &#39;</span><span class="o">.</span><span class="nb">str_replace</span><span class="p">(</span><span class="s1">&#39;, , $elem[2]).&#39;</span><span class="p">,;</span>
                        <span class="p">}</span>
</pre></div>
</div>
</div>
<div class="section" id="case-openemr-structures-queriesinloop">
<span id="id333"></span><h4><span class="section-number">5.2.226.2. </span>OpenEMR<a class="headerlink" href="#case-openemr-structures-queriesinloop" title="Permalink to this headline">¶</a></h4>
<p><a class="reference internal" href="Rules.html#queries-in-loops"><span class="std std-ref">Queries In Loops</span></a>, in contrib/util/deidentification/deidentification.php:287.</p>
<p>The value is SELECTed first in the database, and it is INSERTed if not. This may be done in one call in most databases.</p>
<div class="highlight-php notranslate"><div class="highlight"><pre><span></span><span class="nv">$query</span> <span class="o">=</span> <span class="nx">select</span> <span class="o">*</span> <span class="nx">from</span> <span class="nx">facility</span><span class="p">;</span>
<span class="nv">$result</span> <span class="o">=</span> <span class="nx">mysqli_query</span><span class="p">(</span><span class="nv">$con</span><span class="p">,</span> <span class="nv">$query</span><span class="p">);</span>
<span class="k">while</span> <span class="p">(</span><span class="nv">$row</span> <span class="o">=</span> <span class="nx">mysqli_fetch_array</span><span class="p">(</span><span class="nv">$result</span><span class="p">))</span> <span class="p">{</span>
    <span class="nv">$string</span> <span class="o">=</span> <span class="nx">update</span> <span class="nx">facility</span> <span class="nx">set</span>

          <span class="sb">`name`</span>    <span class="o">=</span> <span class="s1">&#39;Facility_{$row[&#39;</span><span class="nx">id</span><span class="s1">&#39;]}&#39;</span><span class="p">,</span>
          <span class="sb">`phone`</span>   <span class="o">=</span> <span class="s1">&#39;(000) 000-0000&#39;</span>

        <span class="nx">where</span> <span class="sb">`id`</span> <span class="o">=</span> <span class="p">{</span><span class="nv">$row</span><span class="p">[</span><span class="s1">&#39;id&#39;</span><span class="p">]};</span>

    <span class="nx">mysqli_query</span><span class="p">(</span><span class="nv">$con</span><span class="p">,</span> <span class="nv">$string</span><span class="p">)</span> <span class="k">or</span> <span class="k">print</span> <span class="nx">Error</span> <span class="nx">altering</span> <span class="nx">facility</span> <span class="nx">table</span> <span class="nx">\n</span><span class="p">;</span>
    <span class="nv">$string</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="repeated-print">
<span id="case-repeated-print"></span><h3><span class="section-number">5.2.227. </span>Repeated print()<a class="headerlink" href="#repeated-print" title="Permalink to this headline">¶</a></h3>
<div class="section" id="case-edusoho-structures-repeatedprint">
<span id="id334"></span><h4><span class="section-number">5.2.227.1. </span>Edusoho<a class="headerlink" href="#case-edusoho-structures-repeatedprint" title="Permalink to this headline">¶</a></h4>
<p><a class="reference internal" href="Rules.html#repeated-print"><span class="std std-ref">Repeated print()</span></a>, in app/check.php:71.</p>
<p>All echo may be merged into one : do this by turning the ; and . into ‘,’, and removing the superfluous echo. Also, echo_style may be turned into a non-display function, returning the build style, rather than echoing it to the output.</p>
<div class="highlight-php notranslate"><div class="highlight"><pre><span></span><span class="k">echo</span> <span class="nx">PHP_EOL</span><span class="p">;</span>
<span class="nx">echo_style</span><span class="p">(</span><span class="s1">&#39;title&#39;</span><span class="p">,</span> <span class="s1">&#39;Note&#39;</span><span class="p">);</span>
<span class="k">echo</span> <span class="s1">&#39;  The command console could use a different php.ini file&#39;</span><span class="o">.</span><span class="nx">PHP_EOL</span><span class="p">;</span>
<span class="nx">echo_style</span><span class="p">(</span><span class="s1">&#39;title&#39;</span><span class="p">,</span> <span class="s1">&#39;~~~~&#39;</span><span class="p">);</span>
<span class="k">echo</span> <span class="s1">&#39;  than the one used with your web server. To be on the&#39;</span><span class="o">.</span><span class="nx">PHP_EOL</span><span class="p">;</span>
<span class="k">echo</span> <span class="s1">&#39;      safe side, please check the requirements from your web&#39;</span><span class="o">.</span><span class="nx">PHP_EOL</span><span class="p">;</span>
<span class="k">echo</span> <span class="s1">&#39;      server using the &#39;</span><span class="p">;</span>
<span class="nx">echo_style</span><span class="p">(</span><span class="s1">&#39;yellow&#39;</span><span class="p">,</span> <span class="s1">&#39;web/config.php&#39;</span><span class="p">);</span>
<span class="k">echo</span> <span class="s1">&#39; script.&#39;</span><span class="o">.</span><span class="nx">PHP_EOL</span><span class="p">;</span>
<span class="k">echo</span> <span class="nx">PHP_EOL</span><span class="p">;</span>
</pre></div>
</div>
</div>
<div class="section" id="case-humo-gen-structures-repeatedprint">
<span id="id335"></span><h4><span class="section-number">5.2.227.2. </span>HuMo-Gen<a class="headerlink" href="#case-humo-gen-structures-repeatedprint" title="Permalink to this headline">¶</a></h4>
<p><a class="reference internal" href="Rules.html#repeated-print"><span class="std std-ref">Repeated print()</span></a>, in menu.php:71.</p>
<p>Simply calling print once is better than three times. Here too, echo usage would reduce the amount of memory allocation due to concatenation prior display.</p>
<div class="highlight-php notranslate"><div class="highlight"><pre><span></span><span class="k">print</span> <span class="s1">&#39;&lt;input type=text name=quicksearch value=.$quicksearch. size=10 &#39;</span><span class="o">.</span><span class="nv">$pattern</span><span class="o">.</span><span class="s1">&#39; title=.__(Minimum:).$min_chars.__(characters).&gt;&#39;</span><span class="p">;</span>
                    <span class="k">print</span> <span class="s1">&#39; &lt;input type=submit value=.__(Search).&gt;&#39;</span><span class="p">;</span>
            <span class="k">print</span> <span class="o">&lt;/</span><span class="nx">form</span><span class="o">&gt;</span><span class="p">;</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="repeated-regex">
<span id="case-repeated-regex"></span><h3><span class="section-number">5.2.228. </span>Repeated Regex<a class="headerlink" href="#repeated-regex" title="Permalink to this headline">¶</a></h3>
<div class="section" id="case-vanilla-structures-repeatedregex">
<span id="id336"></span><h4><span class="section-number">5.2.228.1. </span>Vanilla<a class="headerlink" href="#case-vanilla-structures-repeatedregex" title="Permalink to this headline">¶</a></h4>
<p><a class="reference internal" href="Rules.html#repeated-regex"><span class="std std-ref">Repeated Regex</span></a>, in library/core/class.pluginmanager.php:1200.</p>
<p>This regex is actually repeated 4 times across the Vanilla database, including this variation : ‘#^(https?:)?//#i’.</p>
<div class="highlight-php notranslate"><div class="highlight"><pre><span></span><span class="s1">&#39;`^https?://`&#39;</span>
</pre></div>
</div>
</div>
<div class="section" id="case-tikiwiki-structures-repeatedregex">
<span id="id337"></span><h4><span class="section-number">5.2.228.2. </span>Tikiwiki<a class="headerlink" href="#case-tikiwiki-structures-repeatedregex" title="Permalink to this headline">¶</a></h4>
<p><a class="reference internal" href="Rules.html#repeated-regex"><span class="std std-ref">Repeated Regex</span></a>, in tiki-login.php:369.</p>
<p>This regex is use twice, identically, in the same file, with a few line of distance. It may be federated at the file level.</p>
<div class="highlight-php notranslate"><div class="highlight"><pre><span></span><span class="nb">preg_match</span><span class="p">(</span><span class="s1">&#39;/(tiki-register|tiki-login_validate|tiki-login_scr)\.php/&#39;</span><span class="p">,</span> <span class="nv">$url</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="return-true-false">
<span id="case-return-true-false"></span><h3><span class="section-number">5.2.229. </span>Return True False<a class="headerlink" href="#return-true-false" title="Permalink to this headline">¶</a></h3>
<div class="section" id="case-mautic-structures-returntruefalse">
<span id="id338"></span><h4><span class="section-number">5.2.229.1. </span>Mautic<a class="headerlink" href="#case-mautic-structures-returntruefalse" title="Permalink to this headline">¶</a></h4>
<p><a class="reference internal" href="Rules.html#return-true-false"><span class="std std-ref">Return True False</span></a>, in app/bundles/LeadBundle/Model/ListModel.php:125.</p>
<p>$isNew could be a typecast.</p>
<div class="highlight-php notranslate"><div class="highlight"><pre><span></span><span class="nv">$isNew</span> <span class="o">=</span> <span class="p">(</span><span class="nv">$entity</span><span class="o">-&gt;</span><span class="na">getId</span><span class="p">())</span> <span class="o">?</span> <span class="k">false</span> <span class="o">:</span> <span class="k">true</span><span class="p">;</span>
</pre></div>
</div>
</div>
<div class="section" id="case-fuelcms-structures-returntruefalse">
<span id="id339"></span><h4><span class="section-number">5.2.229.2. </span>FuelCMS<a class="headerlink" href="#case-fuelcms-structures-returntruefalse" title="Permalink to this headline">¶</a></h4>
<p><a class="reference internal" href="Rules.html#return-true-false"><span class="std std-ref">Return True False</span></a>, in fuel/modules/fuel/helpers/validator_helper.php:254.</p>
<p>If/then is a lot of code to produce a boolean.</p>
<div class="highlight-php notranslate"><div class="highlight"><pre><span></span><span class="k">function</span> <span class="nf">length_min</span><span class="p">(</span><span class="nv">$str</span><span class="p">,</span> <span class="nv">$limit</span> <span class="o">=</span> <span class="mi">1</span><span class="p">)</span>
    <span class="p">{</span>
            <span class="k">if</span> <span class="p">(</span><span class="nb">strlen</span><span class="p">(</span><span class="nb">strval</span><span class="p">(</span><span class="nv">$str</span><span class="p">))</span> <span class="o">&lt;</span> <span class="nv">$limit</span><span class="p">)</span>
            <span class="p">{</span>
                    <span class="k">return</span> <span class="k">FALSE</span><span class="p">;</span>
            <span class="p">}</span>
            <span class="k">else</span>
            <span class="p">{</span>
                    <span class="k">return</span> <span class="k">TRUE</span><span class="p">;</span>
            <span class="p">}</span>
    <span class="p">}</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="same-conditions-in-condition">
<span id="case-same-conditions-in-condition"></span><h3><span class="section-number">5.2.230. </span>Same Conditions In Condition<a class="headerlink" href="#same-conditions-in-condition" title="Permalink to this headline">¶</a></h3>
<div class="section" id="case-teampass-structures-sameconditions">
<span id="id340"></span><h4><span class="section-number">5.2.230.1. </span>TeamPass<a class="headerlink" href="#case-teampass-structures-sameconditions" title="Permalink to this headline">¶</a></h4>
<p><a class="reference internal" href="Rules.html#same-conditions-in-condition"><span class="std std-ref">Same Conditions In Condition</span></a>, in sources/identify.php:1096.</p>
<p><cite>$result == 1</cite> is use once in the main if/then, then again the second if/then/elseif structure. Both are incompatible, since, in the else, <cite>$result</cite> will be different from 1.</p>
<div class="highlight-php notranslate"><div class="highlight"><pre><span></span><span class="k">if</span> <span class="p">(</span><span class="nv">$result</span> <span class="o">==</span> <span class="mi">1</span><span class="p">)</span> <span class="p">{</span>
                <span class="nv">$return</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span><span class="p">;</span>
                <span class="nv">$logError</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span><span class="p">;</span>
                <span class="nv">$proceedIdentification</span> <span class="o">=</span> <span class="k">true</span><span class="p">;</span>
                <span class="nv">$userPasswordVerified</span> <span class="o">=</span> <span class="k">false</span><span class="p">;</span>
                <span class="nb">unset</span><span class="p">(</span><span class="nv">$_SESSION</span><span class="p">[</span><span class="s1">&#39;hedgeId&#39;</span><span class="p">]);</span>
                <span class="nb">unset</span><span class="p">(</span><span class="nv">$_SESSION</span><span class="p">[</span><span class="s1">&#39;flickercode&#39;</span><span class="p">]);</span>
            <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
                <span class="k">if</span> <span class="p">(</span><span class="nv">$result</span> <span class="o">&lt;</span> <span class="o">-</span><span class="mi">10</span><span class="p">)</span> <span class="p">{</span>
                    <span class="nv">$logError</span> <span class="o">=</span> <span class="s2">&quot;ERROR: &quot;</span><span class="o">.</span><span class="nv">$result</span><span class="p">;</span>
                <span class="p">}</span> <span class="k">elseif</span> <span class="p">(</span><span class="nv">$result</span> <span class="o">==</span> <span class="o">-</span><span class="mi">4</span><span class="p">)</span> <span class="p">{</span>
                    <span class="nv">$logError</span> <span class="o">=</span> <span class="s2">&quot;Wrong response code, no more tries left.&quot;</span><span class="p">;</span>
                <span class="p">}</span> <span class="k">elseif</span> <span class="p">(</span><span class="nv">$result</span> <span class="o">==</span> <span class="o">-</span><span class="mi">3</span><span class="p">)</span> <span class="p">{</span>
                    <span class="nv">$logError</span> <span class="o">=</span> <span class="s2">&quot;Wrong response code, try to reenter.&quot;</span><span class="p">;</span>
                <span class="p">}</span> <span class="k">elseif</span> <span class="p">(</span><span class="nv">$result</span> <span class="o">==</span> <span class="o">-</span><span class="mi">2</span><span class="p">)</span> <span class="p">{</span>
                    <span class="nv">$logError</span> <span class="o">=</span> <span class="s2">&quot;Timeout. The response code is not valid anymore.&quot;</span><span class="p">;</span>
                <span class="p">}</span> <span class="k">elseif</span> <span class="p">(</span><span class="nv">$result</span> <span class="o">==</span> <span class="o">-</span><span class="mi">1</span><span class="p">)</span> <span class="p">{</span>
                    <span class="nv">$logError</span> <span class="o">=</span> <span class="s2">&quot;Security Error. Did you try to verify the response from a different computer?&quot;</span><span class="p">;</span>
                <span class="p">}</span> <span class="k">elseif</span> <span class="p">(</span><span class="nv">$result</span> <span class="o">==</span> <span class="mi">1</span><span class="p">)</span> <span class="p">{</span>
                    <span class="nv">$logError</span> <span class="o">=</span> <span class="s2">&quot;Authentication successful, response code correct.</span>
<span class="s2">                          &lt;br /&gt;&lt;br /&gt;Authentification Method for SecureBrowser updated!&quot;</span><span class="p">;</span>
                    <span class="c1">// Add necessary code here for accessing your Business Application</span>
                <span class="p">}</span>
                <span class="nv">$return</span> <span class="o">=</span> <span class="s2">&quot;agses_error&quot;</span><span class="p">;</span>
                <span class="k">echo</span> <span class="s1">&#39;[{&quot;value&quot; : &quot;&#39;</span><span class="o">.</span><span class="nv">$return</span><span class="o">.</span><span class="s1">&#39;&quot;, &quot;user_admin&quot;:&quot;&#39;</span><span class="p">,</span>
                <span class="nb">isset</span><span class="p">(</span><span class="nv">$_SESSION</span><span class="p">[</span><span class="s1">&#39;user_admin&#39;</span><span class="p">])</span> <span class="o">?</span> <span class="nv">$_SESSION</span><span class="p">[</span><span class="s1">&#39;user_admin&#39;</span><span class="p">]</span> <span class="o">:</span> <span class="s2">&quot;&quot;</span><span class="p">,</span>
                <span class="s1">&#39;&quot;, &quot;initial_url&quot; : &quot;&#39;</span><span class="o">.@</span><span class="nv">$_SESSION</span><span class="p">[</span><span class="s1">&#39;initial_url&#39;</span><span class="p">]</span><span class="o">.</span><span class="s1">&#39;&quot;,</span>
<span class="s1">                &quot;error&quot; : &quot;&#39;</span><span class="o">.</span><span class="nv">$logError</span><span class="o">.</span><span class="s1">&#39;&quot;}]&#39;</span><span class="p">;</span>

                <span class="k">exit</span><span class="p">();</span>
            <span class="p">}</span>
</pre></div>
</div>
</div>
<div class="section" id="case-typo3-structures-sameconditions">
<span id="id341"></span><h4><span class="section-number">5.2.230.2. </span>Typo3<a class="headerlink" href="#case-typo3-structures-sameconditions" title="Permalink to this headline">¶</a></h4>
<p><a class="reference internal" href="Rules.html#same-conditions-in-condition"><span class="std std-ref">Same Conditions In Condition</span></a>, in typo3/sysext/recordlist/Classes/RecordList/DatabaseRecordList.php:1696.</p>
<p><cite>$table == ‘pages</cite> is caught initially, and if it fails, it is tested again in the final else. This won’t happen.</p>
<div class="highlight-php notranslate"><div class="highlight"><pre><span></span><span class="p">}</span> <span class="k">elseif</span> <span class="p">(</span><span class="nv">$table</span> <span class="o">===</span> <span class="s1">&#39;pages&#39;</span><span class="p">)</span> <span class="p">{</span>
                                <span class="nv">$parameters</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;id&#39;</span> <span class="o">=&gt;</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">id</span><span class="p">,</span> <span class="s1">&#39;pagesOnly&#39;</span> <span class="o">=&gt;</span> <span class="mi">1</span><span class="p">,</span> <span class="s1">&#39;returnUrl&#39;</span> <span class="o">=&gt;</span> <span class="nx">GeneralUtility</span><span class="o">::</span><span class="na">getIndpEnv</span><span class="p">(</span><span class="s1">&#39;REQUEST_URI&#39;</span><span class="p">)];</span>
                                <span class="nv">$href</span> <span class="o">=</span> <span class="p">(</span><span class="nx">string</span><span class="p">)</span><span class="nv">$uriBuilder</span><span class="o">-&gt;</span><span class="na">buildUriFromRoute</span><span class="p">(</span><span class="s1">&#39;db_new&#39;</span><span class="p">,</span> <span class="nv">$parameters</span><span class="p">);</span>
                                <span class="nv">$icon</span> <span class="o">=</span> <span class="s1">&#39;&lt;a class=&quot;btn btn-default&quot; href=&quot;&#39;</span> <span class="o">.</span> <span class="nb">htmlspecialchars</span><span class="p">(</span><span class="nv">$href</span><span class="p">)</span> <span class="o">.</span> <span class="s1">&#39;&quot; title=&quot;&#39;</span> <span class="o">.</span> <span class="nb">htmlspecialchars</span><span class="p">(</span><span class="nv">$lang</span><span class="o">-&gt;</span><span class="na">getLL</span><span class="p">(</span><span class="s1">&#39;new&#39;</span><span class="p">))</span> <span class="o">.</span> <span class="s1">&#39;&quot;&gt;&#39;</span>
                                    <span class="o">.</span> <span class="nv">$spriteIcon</span><span class="o">-&gt;</span><span class="na">render</span><span class="p">()</span> <span class="o">.</span> <span class="s1">&#39;&lt;/a&gt;&#39;</span><span class="p">;</span>
                            <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
                                <span class="nv">$params</span> <span class="o">=</span> <span class="s1">&#39;&amp;edit[&#39;</span> <span class="o">.</span> <span class="nv">$table</span> <span class="o">.</span> <span class="s1">&#39;][&#39;</span> <span class="o">.</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">id</span> <span class="o">.</span> <span class="s1">&#39;]=new&#39;</span><span class="p">;</span>
                                <span class="k">if</span> <span class="p">(</span><span class="nv">$table</span> <span class="o">===</span> <span class="s1">&#39;pages&#39;</span><span class="p">)</span> <span class="p">{</span>
                                    <span class="nv">$params</span> <span class="o">.=</span> <span class="s1">&#39;&amp;overrideVals[pages][doktype]=&#39;</span> <span class="o">.</span> <span class="p">(</span><span class="nx">int</span><span class="p">)</span><span class="nv">$this</span><span class="o">-&gt;</span><span class="na">pageRow</span><span class="p">[</span><span class="s1">&#39;doktype&#39;</span><span class="p">];</span>
                                <span class="p">}</span>
                                <span class="nv">$icon</span> <span class="o">=</span> <span class="s1">&#39;&lt;a class=&quot;btn btn-default&quot; href=&quot;#&quot; onclick=&quot;&#39;</span> <span class="o">.</span> <span class="nb">htmlspecialchars</span><span class="p">(</span><span class="nx">BackendUtility</span><span class="o">::</span><span class="na">editOnClick</span><span class="p">(</span><span class="nv">$params</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">))</span>
                                    <span class="o">.</span> <span class="s1">&#39;&quot; title=&quot;&#39;</span> <span class="o">.</span> <span class="nb">htmlspecialchars</span><span class="p">(</span><span class="nv">$lang</span><span class="o">-&gt;</span><span class="na">getLL</span><span class="p">(</span><span class="s1">&#39;new&#39;</span><span class="p">))</span> <span class="o">.</span> <span class="s1">&#39;&quot;&gt;&#39;</span> <span class="o">.</span> <span class="nv">$spriteIcon</span><span class="o">-&gt;</span><span class="na">render</span><span class="p">()</span> <span class="o">.</span> <span class="s1">&#39;&lt;/a&gt;&#39;</span><span class="p">;</span>
                            <span class="p">}</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="should-chain-exception">
<span id="case-should-chain-exception"></span><h3><span class="section-number">5.2.231. </span>Should Chain Exception<a class="headerlink" href="#should-chain-exception" title="Permalink to this headline">¶</a></h3>
<div class="section" id="case-magento-structures-shouldchainexception">
<span id="id342"></span><h4><span class="section-number">5.2.231.1. </span>Magento<a class="headerlink" href="#case-magento-structures-shouldchainexception" title="Permalink to this headline">¶</a></h4>
<p><a class="reference internal" href="Rules.html#should-chain-exception"><span class="std std-ref">Should Chain Exception</span></a>, in lib/Mage/Backup/Filesystem/Rollback/Ftp.php:81.</p>
<p>Instead of using the exception message as an argument, chaining the exception would send the whole exception, including the message, and other interesting information like file and line.</p>
<div class="highlight-php notranslate"><div class="highlight"><pre><span></span><span class="k">protected</span> <span class="k">function</span> <span class="nf">_initFtpClient</span><span class="p">()</span>
    <span class="p">{</span>
        <span class="k">try</span> <span class="p">{</span>
            <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">_ftpClient</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Mage_System_Ftp</span><span class="p">();</span>
            <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">_ftpClient</span><span class="o">-&gt;</span><span class="na">connect</span><span class="p">(</span><span class="nv">$this</span><span class="o">-&gt;</span><span class="na">_snapshot</span><span class="o">-&gt;</span><span class="na">getFtpConnectString</span><span class="p">());</span>
        <span class="p">}</span> <span class="k">catch</span> <span class="p">(</span><span class="nx">Exception</span> <span class="nv">$e</span><span class="p">)</span> <span class="p">{</span>
            <span class="k">throw</span> <span class="k">new</span> <span class="nx">Mage_Backup_Exception_FtpConnectionFailed</span><span class="p">(</span><span class="nv">$e</span><span class="o">-&gt;</span><span class="na">getMessage</span><span class="p">());</span>
        <span class="p">}</span>
    <span class="p">}</span>
</pre></div>
</div>
</div>
<div class="section" id="case-tine20-structures-shouldchainexception">
<span id="id343"></span><h4><span class="section-number">5.2.231.2. </span>Tine20<a class="headerlink" href="#case-tine20-structures-shouldchainexception" title="Permalink to this headline">¶</a></h4>
<p><a class="reference internal" href="Rules.html#should-chain-exception"><span class="std std-ref">Should Chain Exception</span></a>, in tine20/Setup/Controller.php:81.</p>
<p>Here, the new exception gets an hardcoded message. More details about the reasons are already available in the $e exception, but they are not logged, not chained for later processing.</p>
<div class="highlight-php notranslate"><div class="highlight"><pre><span></span><span class="k">try</span> <span class="p">{</span>
            <span class="nv">$dirIterator</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">DirectoryIterator</span><span class="p">(</span><span class="nv">$this</span><span class="o">-&gt;</span><span class="na">_baseDir</span><span class="p">);</span>
        <span class="p">}</span> <span class="k">catch</span> <span class="p">(</span><span class="nx">Exception</span> <span class="nv">$e</span><span class="p">)</span> <span class="p">{</span>
            <span class="nx">Setup_Core</span><span class="o">::</span><span class="na">getLogger</span><span class="p">()</span><span class="o">-&gt;</span><span class="na">warn</span><span class="p">(</span><span class="no">__METHOD__</span> <span class="o">.</span> <span class="s1">&#39;::&#39;</span> <span class="o">.</span> <span class="no">__LINE__</span> <span class="o">.</span> <span class="s1">&#39; Could not open base dir: &#39;</span> <span class="o">.</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">_baseDir</span><span class="p">);</span>
            <span class="k">throw</span> <span class="k">new</span> <span class="nx">Tinebase_Exception_AccessDenied</span><span class="p">(</span><span class="s1">&#39;Could not open Tine 2.0 root directory.&#39;</span><span class="p">);</span>
        <span class="p">}</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="should-make-ternary">
<span id="case-should-make-ternary"></span><h3><span class="section-number">5.2.232. </span>Should Make Ternary<a class="headerlink" href="#should-make-ternary" title="Permalink to this headline">¶</a></h3>
<div class="section" id="case-churchcrm-structures-shouldmaketernary">
<span id="id344"></span><h4><span class="section-number">5.2.232.1. </span>ChurchCRM<a class="headerlink" href="#case-churchcrm-structures-shouldmaketernary" title="Permalink to this headline">¶</a></h4>
<p><a class="reference internal" href="Rules.html#should-make-ternary"><span class="std std-ref">Should Make Ternary</span></a>, in src/CartToFamily.php:57.</p>
<p>$sState could be the receiving part of a ternary operator.</p>
<div class="highlight-php notranslate"><div class="highlight"><pre><span></span><span class="k">if</span> <span class="p">(</span><span class="nv">$sCountry</span> <span class="o">==</span> <span class="s1">&#39;United States&#39;</span> <span class="o">||</span> <span class="nv">$sCountry</span> <span class="o">==</span> <span class="s1">&#39;Canada&#39;</span><span class="p">)</span> <span class="p">{</span>
            <span class="nv">$sState</span> <span class="o">=</span> <span class="nx">InputUtils</span><span class="o">::</span><span class="na">LegacyFilterInput</span><span class="p">(</span><span class="nv">$_POST</span><span class="p">[</span><span class="s1">&#39;State&#39;</span><span class="p">]);</span>
        <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
            <span class="nv">$sState</span> <span class="o">=</span> <span class="nx">InputUtils</span><span class="o">::</span><span class="na">LegacyFilterInput</span><span class="p">(</span><span class="nv">$_POST</span><span class="p">[</span><span class="s1">&#39;StateTextbox&#39;</span><span class="p">]);</span>
        <span class="p">}</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="preprocessable">
<span id="case-preprocessable"></span><h3><span class="section-number">5.2.233. </span>Preprocessable<a class="headerlink" href="#preprocessable" title="Permalink to this headline">¶</a></h3>
<div class="section" id="case-phpadsnew-structures-shouldpreprocess">
<span id="id345"></span><h4><span class="section-number">5.2.233.1. </span>phpadsnew<a class="headerlink" href="#case-phpadsnew-structures-shouldpreprocess" title="Permalink to this headline">¶</a></h4>
<p><a class="reference internal" href="Rules.html#preprocessable"><span class="std std-ref">Preprocessable</span></a>, in phpAdsNew-2.0/adview.php:302.</p>
<p>Each call to chr() may be done before. First, chr() may be replace with the hexadecimal sequence “0x3B”; Secondly, 0x3b is a rather long replacement for a simple semi-colon. The whole pragraph could be stored in a separate file, for easier modifications.</p>
<div class="highlight-php notranslate"><div class="highlight"><pre><span></span><span class="k">echo</span> <span class="nb">chr</span><span class="p">(</span><span class="mh">0x47</span><span class="p">)</span><span class="o">.</span><span class="nb">chr</span><span class="p">(</span><span class="mh">0x49</span><span class="p">)</span><span class="o">.</span><span class="nb">chr</span><span class="p">(</span><span class="mh">0x46</span><span class="p">)</span><span class="o">.</span><span class="nb">chr</span><span class="p">(</span><span class="mh">0x38</span><span class="p">)</span><span class="o">.</span><span class="nb">chr</span><span class="p">(</span><span class="mh">0x39</span><span class="p">)</span><span class="o">.</span><span class="nb">chr</span><span class="p">(</span><span class="mh">0x61</span><span class="p">)</span><span class="o">.</span><span class="nb">chr</span><span class="p">(</span><span class="mh">0x01</span><span class="p">)</span><span class="o">.</span><span class="nb">chr</span><span class="p">(</span><span class="mh">0x00</span><span class="p">)</span><span class="o">.</span>
                 <span class="nb">chr</span><span class="p">(</span><span class="mh">0x01</span><span class="p">)</span><span class="o">.</span><span class="nb">chr</span><span class="p">(</span><span class="mh">0x00</span><span class="p">)</span><span class="o">.</span><span class="nb">chr</span><span class="p">(</span><span class="mh">0x80</span><span class="p">)</span><span class="o">.</span><span class="nb">chr</span><span class="p">(</span><span class="mh">0x00</span><span class="p">)</span><span class="o">.</span><span class="nb">chr</span><span class="p">(</span><span class="mh">0x00</span><span class="p">)</span><span class="o">.</span><span class="nb">chr</span><span class="p">(</span><span class="mh">0x04</span><span class="p">)</span><span class="o">.</span><span class="nb">chr</span><span class="p">(</span><span class="mh">0x02</span><span class="p">)</span><span class="o">.</span><span class="nb">chr</span><span class="p">(</span><span class="mh">0x04</span><span class="p">)</span><span class="o">.</span>
                     <span class="nb">chr</span><span class="p">(</span><span class="mh">0x00</span><span class="p">)</span><span class="o">.</span><span class="nb">chr</span><span class="p">(</span><span class="mh">0x00</span><span class="p">)</span><span class="o">.</span><span class="nb">chr</span><span class="p">(</span><span class="mh">0x00</span><span class="p">)</span><span class="o">.</span><span class="nb">chr</span><span class="p">(</span><span class="mh">0x21</span><span class="p">)</span><span class="o">.</span><span class="nb">chr</span><span class="p">(</span><span class="mh">0xF9</span><span class="p">)</span><span class="o">.</span><span class="nb">chr</span><span class="p">(</span><span class="mh">0x04</span><span class="p">)</span><span class="o">.</span><span class="nb">chr</span><span class="p">(</span><span class="mh">0x01</span><span class="p">)</span><span class="o">.</span><span class="nb">chr</span><span class="p">(</span><span class="mh">0x00</span><span class="p">)</span><span class="o">.</span>
                 <span class="nb">chr</span><span class="p">(</span><span class="mh">0x00</span><span class="p">)</span><span class="o">.</span><span class="nb">chr</span><span class="p">(</span><span class="mh">0x00</span><span class="p">)</span><span class="o">.</span><span class="nb">chr</span><span class="p">(</span><span class="mh">0x00</span><span class="p">)</span><span class="o">.</span><span class="nb">chr</span><span class="p">(</span><span class="mh">0x2C</span><span class="p">)</span><span class="o">.</span><span class="nb">chr</span><span class="p">(</span><span class="mh">0x00</span><span class="p">)</span><span class="o">.</span><span class="nb">chr</span><span class="p">(</span><span class="mh">0x00</span><span class="p">)</span><span class="o">.</span><span class="nb">chr</span><span class="p">(</span><span class="mh">0x00</span><span class="p">)</span><span class="o">.</span><span class="nb">chr</span><span class="p">(</span><span class="mh">0x00</span><span class="p">)</span><span class="o">.</span>
                 <span class="nb">chr</span><span class="p">(</span><span class="mh">0x01</span><span class="p">)</span><span class="o">.</span><span class="nb">chr</span><span class="p">(</span><span class="mh">0x00</span><span class="p">)</span><span class="o">.</span><span class="nb">chr</span><span class="p">(</span><span class="mh">0x01</span><span class="p">)</span><span class="o">.</span><span class="nb">chr</span><span class="p">(</span><span class="mh">0x00</span><span class="p">)</span><span class="o">.</span><span class="nb">chr</span><span class="p">(</span><span class="mh">0x00</span><span class="p">)</span><span class="o">.</span><span class="nb">chr</span><span class="p">(</span><span class="mh">0x02</span><span class="p">)</span><span class="o">.</span><span class="nb">chr</span><span class="p">(</span><span class="mh">0x02</span><span class="p">)</span><span class="o">.</span><span class="nb">chr</span><span class="p">(</span><span class="mh">0x44</span><span class="p">)</span><span class="o">.</span>
                 <span class="nb">chr</span><span class="p">(</span><span class="mh">0x01</span><span class="p">)</span><span class="o">.</span><span class="nb">chr</span><span class="p">(</span><span class="mh">0x00</span><span class="p">)</span><span class="o">.</span><span class="nb">chr</span><span class="p">(</span><span class="mh">0x3B</span><span class="p">);</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="should-use-foreach">
<span id="case-should-use-foreach"></span><h3><span class="section-number">5.2.234. </span>Should Use Foreach<a class="headerlink" href="#should-use-foreach" title="Permalink to this headline">¶</a></h3>
<div class="section" id="case-expressionengine-structures-shoulduseforeach">
<span id="id346"></span><h4><span class="section-number">5.2.234.1. </span>ExpressionEngine<a class="headerlink" href="#case-expressionengine-structures-shoulduseforeach" title="Permalink to this headline">¶</a></h4>
<p><a class="reference internal" href="Rules.html#should-use-foreach"><span class="std std-ref">Should Use Foreach</span></a>, in system/ee/EllisLab/ExpressionEngine/Service/Model/Query/Builder.php:241.</p>
<p>This code could turn the string into an array, with the explode() function, and use foreach(), instead of calculating the length() initially, and then building the loop.</p>
<div class="highlight-php notranslate"><div class="highlight"><pre><span></span><span class="nv">$length</span> <span class="o">=</span> <span class="nb">strlen</span><span class="p">(</span><span class="nv">$str</span><span class="p">);</span>
            <span class="nv">$words</span> <span class="o">=</span> <span class="k">array</span><span class="p">();</span>

            <span class="nv">$word</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span><span class="p">;</span>
            <span class="nv">$quote</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span><span class="p">;</span>
            <span class="nv">$quoted</span> <span class="o">=</span> <span class="k">FALSE</span><span class="p">;</span>

            <span class="k">for</span> <span class="p">(</span><span class="nv">$i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="nv">$i</span> <span class="o">&lt;</span> <span class="nv">$length</span><span class="p">;</span> <span class="nv">$i</span><span class="o">++</span><span class="p">)</span>
            <span class="p">{</span>
                    <span class="nv">$char</span> <span class="o">=</span> <span class="nv">$str</span><span class="p">[</span><span class="nv">$i</span><span class="p">];</span>

                    <span class="k">if</span> <span class="p">((</span><span class="nv">$quoted</span> <span class="o">==</span> <span class="k">FALSE</span> <span class="o">&amp;&amp;</span> <span class="nv">$char</span> <span class="o">==</span> <span class="s1">&#39; &#39;</span><span class="p">)</span> <span class="o">||</span> <span class="p">(</span><span class="nv">$quoted</span> <span class="o">==</span> <span class="k">TRUE</span> <span class="o">&amp;&amp;</span> <span class="nv">$char</span> <span class="o">==</span> <span class="nv">$quote</span><span class="p">))</span>
                    <span class="p">{</span>
                            <span class="k">if</span> <span class="p">(</span><span class="nb">strlen</span><span class="p">(</span><span class="nv">$word</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">2</span><span class="p">)</span>
                            <span class="p">{</span>
                                    <span class="nv">$words</span><span class="p">[]</span> <span class="o">=</span> <span class="nv">$word</span><span class="p">;</span>
                            <span class="p">}</span>

                            <span class="nv">$quoted</span> <span class="o">=</span> <span class="k">FALSE</span><span class="p">;</span>
                            <span class="nv">$quote</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span><span class="p">;</span>
                            <span class="nv">$word</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span><span class="p">;</span>

                            <span class="k">continue</span><span class="p">;</span>
                    <span class="p">}</span>

                    <span class="k">if</span> <span class="p">(</span><span class="nv">$quoted</span> <span class="o">==</span> <span class="k">FALSE</span> <span class="o">&amp;&amp;</span> <span class="p">(</span><span class="nv">$char</span> <span class="o">==</span> <span class="s1">&#39; || $char == &quot;) &amp;&amp; ($word === &#39;&#39; || $word == &#39;</span><span class="o">-</span><span class="err">&#39;</span><span class="p">))</span>
                    <span class="p">{</span>
                            <span class="nv">$quoted</span> <span class="o">=</span> <span class="k">TRUE</span><span class="p">;</span>
                            <span class="nv">$quote</span> <span class="o">=</span> <span class="nv">$char</span><span class="p">;</span>
                            <span class="k">continue</span><span class="p">;</span>
                    <span class="p">}</span>

                    <span class="nv">$word</span> <span class="o">.=</span> <span class="nv">$char</span><span class="p">;</span>
            <span class="p">}</span>
</pre></div>
</div>
</div>
<div class="section" id="case-woocommerce-structures-shoulduseforeach">
<span id="id347"></span><h4><span class="section-number">5.2.234.2. </span>Woocommerce<a class="headerlink" href="#case-woocommerce-structures-shoulduseforeach" title="Permalink to this headline">¶</a></h4>
<p><a class="reference internal" href="Rules.html#should-use-foreach"><span class="std std-ref">Should Use Foreach</span></a>, in includes/libraries/class-wc-eval-math.php:84.</p>
<p>This loops reviews the ‘stack’ and updates its elements. The same loop may leverage foreach and references for more efficient code.</p>
<div class="highlight-php notranslate"><div class="highlight"><pre><span></span><span class="nv">$stack_size</span> <span class="o">=</span> <span class="nb">count</span><span class="p">(</span> <span class="nv">$stack</span> <span class="p">);</span>
                            <span class="k">for</span> <span class="p">(</span> <span class="nv">$i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="nv">$i</span> <span class="o">&lt;</span> <span class="nv">$stack_size</span><span class="p">;</span> <span class="nv">$i</span><span class="o">++</span> <span class="p">)</span> <span class="p">{</span> <span class="c1">// freeze the state of the non-argument variables</span>
                                    <span class="nv">$token</span> <span class="o">=</span> <span class="nv">$stack</span><span class="p">[</span> <span class="nv">$i</span> <span class="p">];</span>
                                    <span class="k">if</span> <span class="p">(</span> <span class="nb">preg_match</span><span class="p">(</span> <span class="s1">&#39;/^[a-z]\w*$/&#39;</span><span class="p">,</span> <span class="nv">$token</span> <span class="p">)</span> <span class="k">and</span> <span class="o">!</span> <span class="nb">in_array</span><span class="p">(</span> <span class="nv">$token</span><span class="p">,</span> <span class="nv">$args</span> <span class="p">)</span> <span class="p">)</span> <span class="p">{</span>
                                            <span class="k">if</span> <span class="p">(</span> <span class="nb">array_key_exists</span><span class="p">(</span> <span class="nv">$token</span><span class="p">,</span> <span class="nx">self</span><span class="o">::</span><span class="nv">$v</span> <span class="p">)</span> <span class="p">)</span> <span class="p">{</span>
                                                    <span class="nv">$stack</span><span class="p">[</span> <span class="nv">$i</span> <span class="p">]</span> <span class="o">=</span> <span class="nx">self</span><span class="o">::</span><span class="nv">$v</span><span class="p">[</span> <span class="nv">$token</span> <span class="p">];</span>
                                            <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
                                                    <span class="k">return</span> <span class="nx">self</span><span class="o">::</span><span class="na">trigger</span><span class="p">(</span> <span class="s2">&quot;undefined variable &#39;</span><span class="si">$token</span><span class="s2">&#39; in function definition&quot;</span> <span class="p">);</span>
                                            <span class="p">}</span>
                                    <span class="p">}</span>
                            <span class="p">}</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="should-use-math">
<span id="case-should-use-math"></span><h3><span class="section-number">5.2.235. </span>Should Use Math<a class="headerlink" href="#should-use-math" title="Permalink to this headline">¶</a></h3>
<div class="section" id="case-openemr-structures-shouldusemath">
<span id="id348"></span><h4><span class="section-number">5.2.235.1. </span>OpenEMR<a class="headerlink" href="#case-openemr-structures-shouldusemath" title="Permalink to this headline">¶</a></h4>
<p><a class="reference internal" href="Rules.html#should-use-math"><span class="std std-ref">Should Use Math</span></a>, in controllers/C_Prescription.class.php:638.</p>
<p>$pdf-&gt;ez[‘leftMargin’] is now 0.</p>
<div class="highlight-php notranslate"><div class="highlight"><pre><span></span><span class="k">function</span> <span class="nf">multiprint_body</span><span class="p">(</span><span class="o">&amp;</span> <span class="nv">$pdf</span><span class="p">,</span> <span class="nv">$p</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="nv">$pdf</span><span class="o">-&gt;</span><span class="na">ez</span><span class="p">[</span><span class="s1">&#39;leftMargin&#39;</span><span class="p">]</span> <span class="o">+=</span> <span class="nv">$pdf</span><span class="o">-&gt;</span><span class="na">ez</span><span class="p">[</span><span class="s1">&#39;leftMargin&#39;</span><span class="p">];</span>
        <span class="nv">$pdf</span><span class="o">-&gt;</span><span class="na">ez</span><span class="p">[</span><span class="s1">&#39;rightMargin&#39;</span><span class="p">]</span> <span class="o">+=</span> <span class="nv">$pdf</span><span class="o">-&gt;</span><span class="na">ez</span><span class="p">[</span><span class="s1">&#39;rightMargin&#39;</span><span class="p">];</span>
        <span class="nv">$d</span> <span class="o">=</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">get_prescription_body_text</span><span class="p">(</span><span class="nv">$p</span><span class="p">);</span>
        <span class="k">if</span> <span class="p">(</span><span class="nv">$pdf</span><span class="o">-&gt;</span><span class="na">ezText</span><span class="p">(</span><span class="nv">$d</span><span class="p">,</span> <span class="mi">10</span><span class="p">,</span> <span class="k">array</span><span class="p">(),</span> <span class="mi">1</span><span class="p">))</span> <span class="p">{</span>
            <span class="nv">$pdf</span><span class="o">-&gt;</span><span class="na">ez</span><span class="p">[</span><span class="s1">&#39;leftMargin&#39;</span><span class="p">]</span> <span class="o">-=</span> <span class="nv">$pdf</span><span class="o">-&gt;</span><span class="na">ez</span><span class="p">[</span><span class="s1">&#39;leftMargin&#39;</span><span class="p">];</span>
            <span class="nv">$pdf</span><span class="o">-&gt;</span><span class="na">ez</span><span class="p">[</span><span class="s1">&#39;rightMargin&#39;</span><span class="p">]</span> <span class="o">-=</span> <span class="nv">$pdf</span><span class="o">-&gt;</span><span class="na">ez</span><span class="p">[</span><span class="s1">&#39;rightMargin&#39;</span><span class="p">];</span>
            <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">multiprint_footer</span><span class="p">(</span><span class="nv">$pdf</span><span class="p">);</span>
            <span class="nv">$pdf</span><span class="o">-&gt;</span><span class="na">ezNewPage</span><span class="p">();</span>
            <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">multiprint_header</span><span class="p">(</span><span class="nv">$pdf</span><span class="p">,</span> <span class="nv">$p</span><span class="p">);</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="should-use-operator">
<span id="case-should-use-operator"></span><h3><span class="section-number">5.2.236. </span>Should Use Operator<a class="headerlink" href="#should-use-operator" title="Permalink to this headline">¶</a></h3>
<div class="section" id="case-zencart-structures-shoulduseoperator">
<span id="id349"></span><h4><span class="section-number">5.2.236.1. </span>Zencart<a class="headerlink" href="#case-zencart-structures-shoulduseoperator" title="Permalink to this headline">¶</a></h4>
<p><a class="reference internal" href="Rules.html#should-use-operator"><span class="std std-ref">Should Use Operator</span></a>, in includes/modules/payment/paypal/paypal_curl.php:378.</p>
<p>Here, $options is merged with $values if it is an array. If it is not an array, it is probably a null value, and may be ignored. Adding a ‘array’ typehint will strengthen the code an catch situations where TransactionSearch() is called with a string, leading to clearer code.</p>
<div class="highlight-php notranslate"><div class="highlight"><pre><span></span><span class="k">function</span> <span class="nf">TransactionSearch</span><span class="p">(</span><span class="nv">$startdate</span><span class="p">,</span> <span class="nv">$txnID</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="nv">$email</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="nv">$options</span><span class="p">)</span> <span class="p">{</span>
    <span class="c1">// several lines of code, no mention of $options</span>
      <span class="k">if</span> <span class="p">(</span><span class="nb">is_array</span><span class="p">(</span><span class="nv">$options</span><span class="p">))</span> <span class="nv">$values</span> <span class="o">=</span> <span class="nb">array_merge</span><span class="p">(</span><span class="nv">$values</span><span class="p">,</span> <span class="nv">$options</span><span class="p">);</span>
    <span class="p">}</span>
    <span class="k">return</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">_request</span><span class="p">(</span><span class="nv">$values</span><span class="p">,</span> <span class="s1">&#39;TransactionSearch&#39;</span><span class="p">);</span>
  <span class="p">}</span>
</pre></div>
</div>
</div>
<div class="section" id="case-sugarcrm-structures-shoulduseoperator">
<span id="id350"></span><h4><span class="section-number">5.2.236.2. </span>SugarCrm<a class="headerlink" href="#case-sugarcrm-structures-shoulduseoperator" title="Permalink to this headline">¶</a></h4>
<p><a class="reference internal" href="Rules.html#should-use-operator"><span class="std std-ref">Should Use Operator</span></a>, in include/utils.php:2093:464.</p>
<p>$override should an an array : if not, it is actually set by default to empty array. Here, a typehint with a default value of ‘array()’ would offset the parameter validation to the calling method.</p>
<div class="highlight-php notranslate"><div class="highlight"><pre><span></span><span class="k">function</span> <span class="nf">sugar_config_union</span><span class="p">(</span> <span class="nv">$default</span><span class="p">,</span> <span class="nv">$override</span> <span class="p">){</span>
    <span class="c1">// a little different then array_merge and array_merge_recursive.  we want</span>
    <span class="c1">// the second array to override the first array if the same value exists,</span>
    <span class="c1">// otherwise merge the unique keys.  it handles arrays of arrays recursively</span>
    <span class="c1">// might be suitable for a generic array_union</span>
    <span class="k">if</span><span class="p">(</span> <span class="o">!</span><span class="nb">is_array</span><span class="p">(</span> <span class="nv">$override</span> <span class="p">)</span> <span class="p">){</span>
            <span class="nv">$override</span> <span class="o">=</span> <span class="k">array</span><span class="p">();</span>
    <span class="p">}</span>
    <span class="k">foreach</span><span class="p">(</span> <span class="nv">$default</span> <span class="k">as</span> <span class="nv">$key</span> <span class="o">=&gt;</span> <span class="nv">$value</span> <span class="p">){</span>
            <span class="k">if</span><span class="p">(</span> <span class="o">!</span><span class="nb">array_key_exists</span><span class="p">(</span><span class="nv">$key</span><span class="p">,</span> <span class="nv">$override</span><span class="p">)</span> <span class="p">){</span>
                    <span class="nv">$override</span><span class="p">[</span><span class="nv">$key</span><span class="p">]</span> <span class="o">=</span> <span class="nv">$value</span><span class="p">;</span>
            <span class="p">}</span>
            <span class="k">else</span> <span class="k">if</span><span class="p">(</span> <span class="nb">is_array</span><span class="p">(</span> <span class="nv">$key</span> <span class="p">)</span> <span class="p">){</span>
                    <span class="nv">$override</span><span class="p">[</span><span class="nv">$key</span><span class="p">]</span> <span class="o">=</span> <span class="nx">sugar_config_union</span><span class="p">(</span> <span class="nv">$value</span><span class="p">,</span> <span class="nv">$override</span><span class="p">[</span><span class="nv">$key</span><span class="p">]</span> <span class="p">);</span>
            <span class="p">}</span>
    <span class="p">}</span>
    <span class="k">return</span><span class="p">(</span> <span class="nv">$override</span> <span class="p">);</span>
<span class="p">}</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="simplify-regex">
<span id="case-simplify-regex"></span><h3><span class="section-number">5.2.237. </span>Simplify Regex<a class="headerlink" href="#simplify-regex" title="Permalink to this headline">¶</a></h3>
<div class="section" id="case-zurmo-structures-simplepreg">
<span id="id351"></span><h4><span class="section-number">5.2.237.1. </span>Zurmo<a class="headerlink" href="#case-zurmo-structures-simplepreg" title="Permalink to this headline">¶</a></h4>
<p><a class="reference internal" href="Rules.html#simplify-regex"><span class="std std-ref">Simplify Regex</span></a>, in app/protected/core/components/Browser.php:73.</p>
<p>Here, strpos() or stripos() is a valid replacement.</p>
<div class="highlight-php notranslate"><div class="highlight"><pre><span></span><span class="nb">preg_match</span><span class="p">(</span><span class="s1">&#39;/opera/&#39;</span><span class="p">,</span> <span class="nv">$userAgent</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="section" id="case-openconf-structures-simplepreg">
<span id="id352"></span><h4><span class="section-number">5.2.237.2. </span>OpenConf<a class="headerlink" href="#case-openconf-structures-simplepreg" title="Permalink to this headline">¶</a></h4>
<p><a class="reference internal" href="Rules.html#simplify-regex"><span class="std std-ref">Simplify Regex</span></a>, in openconf/include.php:964.</p>
<p><cite>%e</cite> is not a special char for PCRE regex, although it look like it. It is a special char for date() or printf(). This preg_replace() may be upgraded to str_replace()</p>
<div class="highlight-php notranslate"><div class="highlight"><pre><span></span><span class="nv">$conv</span> <span class="o">=</span> <span class="nb">iconv</span><span class="p">(</span><span class="nv">$cp</span><span class="p">,</span> <span class="s1">&#39;utf-8&#39;</span><span class="p">,</span> <span class="nb">strftime</span><span class="p">(</span><span class="nb">preg_replace</span><span class="p">(</span><span class="s2">&quot;/\%e/&quot;</span><span class="p">,</span> <span class="s1">&#39;%#d&#39;</span><span class="p">,</span> <span class="nv">$format</span><span class="p">),</span> <span class="nv">$time</span><span class="p">));</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="strpos-like-comparison">
<span id="case-strpos-like-comparison"></span><h3><span class="section-number">5.2.238. </span>Strpos()-like Comparison<a class="headerlink" href="#strpos-like-comparison" title="Permalink to this headline">¶</a></h3>
<div class="section" id="case-piwigo-structures-strposcompare">
<span id="id353"></span><h4><span class="section-number">5.2.238.1. </span>Piwigo<a class="headerlink" href="#case-piwigo-structures-strposcompare" title="Permalink to this headline">¶</a></h4>
<p><a class="reference internal" href="Rules.html#strpos-like-comparison"><span class="std std-ref">Strpos()-like Comparison</span></a>, in admin/include/functions.php:2585.</p>
<p>preg_match may return 0 if not found, and null if the $pattern is erroneous. While hardcoded regex may be checked at compile time, dynamically built regex may fail at execution time. This is particularly important here, since the function may be called with incoming data for maintenance : ‘clear_derivative_cache($_GET[‘type’]);’ is in the /admin/maintenance.php.</p>
<div class="highlight-php notranslate"><div class="highlight"><pre><span></span><span class="k">function</span> <span class="nf">clear_derivative_cache_rec</span><span class="p">(</span><span class="nv">$path</span><span class="p">,</span> <span class="nv">$pattern</span><span class="p">)</span>
<span class="p">{</span>
  <span class="nv">$rmdir</span> <span class="o">=</span> <span class="k">true</span><span class="p">;</span>
  <span class="nv">$rm_index</span> <span class="o">=</span> <span class="k">false</span><span class="p">;</span>

  <span class="k">if</span> <span class="p">(</span><span class="nv">$contents</span> <span class="o">=</span> <span class="nb">opendir</span><span class="p">(</span><span class="nv">$path</span><span class="p">))</span>
  <span class="p">{</span>
    <span class="k">while</span> <span class="p">((</span><span class="nv">$node</span> <span class="o">=</span> <span class="nb">readdir</span><span class="p">(</span><span class="nv">$contents</span><span class="p">))</span> <span class="o">!==</span> <span class="k">false</span><span class="p">)</span>
    <span class="p">{</span>
      <span class="k">if</span> <span class="p">(</span><span class="nv">$node</span> <span class="o">==</span> <span class="s1">&#39;.&#39;</span> <span class="k">or</span> <span class="nv">$node</span> <span class="o">==</span> <span class="s1">&#39;..&#39;</span><span class="p">)</span>
        <span class="k">continue</span><span class="p">;</span>
      <span class="k">if</span> <span class="p">(</span><span class="nb">is_dir</span><span class="p">(</span><span class="nv">$path</span><span class="o">.</span><span class="s1">&#39;/&#39;</span><span class="o">.</span><span class="nv">$node</span><span class="p">))</span>
      <span class="p">{</span>
        <span class="nv">$rmdir</span> <span class="o">&amp;=</span> <span class="nx">clear_derivative_cache_rec</span><span class="p">(</span><span class="nv">$path</span><span class="o">.</span><span class="s1">&#39;/&#39;</span><span class="o">.</span><span class="nv">$node</span><span class="p">,</span> <span class="nv">$pattern</span><span class="p">);</span>
      <span class="p">}</span>
      <span class="k">else</span>
      <span class="p">{</span>
        <span class="k">if</span> <span class="p">(</span><span class="nb">preg_match</span><span class="p">(</span><span class="nv">$pattern</span><span class="p">,</span> <span class="nv">$node</span><span class="p">))</span>
</pre></div>
</div>
</div>
<div class="section" id="case-thelia-structures-strposcompare">
<span id="id354"></span><h4><span class="section-number">5.2.238.2. </span>Thelia<a class="headerlink" href="#case-thelia-structures-strposcompare" title="Permalink to this headline">¶</a></h4>
<p><a class="reference internal" href="Rules.html#strpos-like-comparison"><span class="std std-ref">Strpos()-like Comparison</span></a>, in core/lib/Thelia/Controller/Admin/FileController.php:198.</p>
<p>preg_match is used here to identify files with a forbidden extension. The actual list of extension is provided to the method via the parameter $extBlackList, which is an array. In case of mis-configuration by the user of this array, preg_match may fail : for example, when regex special characters are provided. At that point, the whole filter becomes invalid, and can’t distinguish good files (returning false) and other files (returning NULL). It is safe to use === false in this situation.</p>
<div class="highlight-php notranslate"><div class="highlight"><pre><span></span><span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="k">empty</span><span class="p">(</span><span class="nv">$extBlackList</span><span class="p">))</span> <span class="p">{</span>
            <span class="nv">$regex</span> <span class="o">=</span> <span class="s2">&quot;#^(.+)\.(&quot;</span><span class="o">.</span><span class="nb">implode</span><span class="p">(</span><span class="s2">&quot;|&quot;</span><span class="p">,</span> <span class="nv">$extBlackList</span><span class="p">)</span><span class="o">.</span><span class="s2">&quot;)$#i&quot;</span><span class="p">;</span>

            <span class="k">if</span> <span class="p">(</span><span class="nb">preg_match</span><span class="p">(</span><span class="nv">$regex</span><span class="p">,</span> <span class="nv">$realFileName</span><span class="p">))</span> <span class="p">{</span>
                <span class="nv">$message</span> <span class="o">=</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">getTranslator</span><span class="p">()</span>
                    <span class="o">-&gt;</span><span class="na">trans</span><span class="p">(</span>
                        <span class="s1">&#39;Files with the following extension are not allowed: %extension, please do an archive of the file if you want to upload it&#39;</span><span class="p">,</span>
                        <span class="p">[</span>
                            <span class="s1">&#39;%extension&#39;</span> <span class="o">=&gt;</span> <span class="nv">$fileBeingUploaded</span><span class="o">-&gt;</span><span class="na">getClientOriginalExtension</span><span class="p">(),</span>
                        <span class="p">]</span>
                    <span class="p">);</span>
            <span class="p">}</span>
        <span class="p">}</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="drop-substr-last-arg">
<span id="case-drop-substr-last-arg"></span><h3><span class="section-number">5.2.239. </span>Drop Substr Last Arg<a class="headerlink" href="#drop-substr-last-arg" title="Permalink to this headline">¶</a></h3>
<div class="section" id="case-suitecrm-structures-substrlastarg">
<span id="id355"></span><h4><span class="section-number">5.2.239.1. </span>SuiteCrm<a class="headerlink" href="#case-suitecrm-structures-substrlastarg" title="Permalink to this headline">¶</a></h4>
<p><a class="reference internal" href="Rules.html#drop-substr-last-arg"><span class="std std-ref">Drop Substr Last Arg</span></a>, in modules/UpgradeWizard/uw_utils.php:2422.</p>
<p>substr() is even trying to go beyond the end of the string.</p>
<div class="highlight-php notranslate"><div class="highlight"><pre><span></span><span class="nb">substr</span><span class="p">(</span><span class="nv">$relativeFile</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="nb">strlen</span><span class="p">(</span><span class="nv">$relativeFile</span><span class="p">))</span>
</pre></div>
</div>
</div>
<div class="section" id="case-tine20-structures-substrlastarg">
<span id="id356"></span><h4><span class="section-number">5.2.239.2. </span>Tine20<a class="headerlink" href="#case-tine20-structures-substrlastarg" title="Permalink to this headline">¶</a></h4>
<p><a class="reference internal" href="Rules.html#drop-substr-last-arg"><span class="std std-ref">Drop Substr Last Arg</span></a>, in tine20/Calendar/Frontend/Cli.php:95.</p>
<p>Omitting the last character would yield the same result.</p>
<div class="highlight-php notranslate"><div class="highlight"><pre><span></span><span class="nb">substr</span><span class="p">(</span><span class="nv">$opt</span><span class="p">,</span> <span class="mi">18</span><span class="p">,</span> <span class="nb">strlen</span><span class="p">(</span><span class="nv">$opt</span><span class="p">))</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="suspicious-comparison">
<span id="case-suspicious-comparison"></span><h3><span class="section-number">5.2.240. </span>Suspicious Comparison<a class="headerlink" href="#suspicious-comparison" title="Permalink to this headline">¶</a></h3>
<div class="section" id="case-phpipam-structures-suspiciouscomparison">
<span id="id357"></span><h4><span class="section-number">5.2.240.1. </span>PhpIPAM<a class="headerlink" href="#case-phpipam-structures-suspiciouscomparison" title="Permalink to this headline">¶</a></h4>
<p><a class="reference internal" href="Rules.html#suspicious-comparison"><span class="std std-ref">Suspicious Comparison</span></a>, in app/tools/vrf/index.php:110.</p>
<p>if $subnet[‘description’] is a string, the comparison with 0 turn it into a boolean. false’s length is 0, and true length is 1. PHP saves the day.</p>
<div class="highlight-php notranslate"><div class="highlight"><pre><span></span><span class="nv">$subnet</span><span class="p">[</span><span class="s1">&#39;description&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">strlen</span><span class="p">(</span><span class="nv">$subnet</span><span class="p">[</span><span class="s1">&#39;description&#39;</span><span class="p">]</span><span class="o">==</span><span class="mi">0</span><span class="p">)</span> <span class="o">?</span> <span class="s2">&quot;/&quot;</span> <span class="o">:</span> <span class="nv">$subnet</span><span class="p">[</span><span class="s1">&#39;description&#39;</span><span class="p">];</span>
</pre></div>
</div>
</div>
<div class="section" id="case-expressionengine-structures-suspiciouscomparison">
<span id="id358"></span><h4><span class="section-number">5.2.240.2. </span>ExpressionEngine<a class="headerlink" href="#case-expressionengine-structures-suspiciouscomparison" title="Permalink to this headline">¶</a></h4>
<p><a class="reference internal" href="Rules.html#suspicious-comparison"><span class="std std-ref">Suspicious Comparison</span></a>, in ExpressionEngine_Core2.9.2/system/expressionengine/libraries/simplepie/SimplePie/Misc.php:1925.</p>
<p>If trim($attribs[‘’][‘mode’]) === ‘base64’, then it is set to lowercase (although it is already), and added to the &amp;&amp; logical test. If it is ‘BASE64’, this fails.</p>
<div class="highlight-php notranslate"><div class="highlight"><pre><span></span><span class="k">if</span> <span class="p">(</span><span class="nb">isset</span><span class="p">(</span><span class="nv">$attribs</span><span class="p">[</span><span class="s1">&#39;&#39;</span><span class="p">][</span><span class="s1">&#39;mode&#39;</span><span class="p">])</span> <span class="o">&amp;&amp;</span> <span class="nb">strtolower</span><span class="p">(</span><span class="nb">trim</span><span class="p">(</span><span class="nv">$attribs</span><span class="p">[</span><span class="s1">&#39;&#39;</span><span class="p">][</span><span class="s1">&#39;mode&#39;</span><span class="p">])</span> <span class="o">===</span> <span class="s1">&#39;base64&#39;</span><span class="p">))</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="switch-to-switch">
<span id="case-switch-to-switch"></span><h3><span class="section-number">5.2.241. </span>Switch To Switch<a class="headerlink" href="#switch-to-switch" title="Permalink to this headline">¶</a></h3>
<div class="section" id="case-thelia-structures-switchtoswitch">
<span id="id359"></span><h4><span class="section-number">5.2.241.1. </span>Thelia<a class="headerlink" href="#case-thelia-structures-switchtoswitch" title="Permalink to this headline">¶</a></h4>
<p><a class="reference internal" href="Rules.html#switch-to-switch"><span class="std std-ref">Switch To Switch</span></a>, in core/lib/Thelia/Controller/Admin/TranslationsController.php:100.</p>
<p>The two first comparison may be turned into a case, and the last one could be default, or default with a check on empty().</p>
<div class="highlight-php notranslate"><div class="highlight"><pre><span></span><span class="k">if</span><span class="p">(</span><span class="nv">$modulePart</span> <span class="o">==</span> <span class="s1">&#39;core&#39;</span><span class="p">)</span> <span class="p">{</span> <span class="cm">/**/</span> <span class="p">}</span> <span class="k">elseif</span><span class="p">(</span><span class="nv">$modulePart</span> <span class="o">==</span> <span class="s1">&#39;admin-includes&#39;</span><span class="p">)</span> <span class="p">{</span> <span class="cm">/**/</span> <span class="p">}</span> <span class="k">elseif</span><span class="p">(</span><span class="o">!</span><span class="k">empty</span><span class="p">(</span><span class="nv">$modulePart</span><span class="p">))</span> <span class="p">{</span> <span class="cm">/**/</span> <span class="p">}</span>
</pre></div>
</div>
</div>
<div class="section" id="case-xoops-structures-switchtoswitch">
<span id="id360"></span><h4><span class="section-number">5.2.241.2. </span>XOOPS<a class="headerlink" href="#case-xoops-structures-switchtoswitch" title="Permalink to this headline">¶</a></h4>
<p><a class="reference internal" href="Rules.html#switch-to-switch"><span class="std std-ref">Switch To Switch</span></a>, in htdocs/search.php:74.</p>
<p>Here, converting this structure to switch requires to drop the === usage. Also, no default usage here.</p>
<div class="highlight-php notranslate"><div class="highlight"><pre><span></span><span class="k">if</span><span class="p">(</span><span class="nv">$action</span> <span class="o">===</span> <span class="s1">&#39;results&#39;</span><span class="p">)</span> <span class="p">{</span> <span class="cm">/**/</span> <span class="p">}</span> <span class="k">elseif</span><span class="p">(</span><span class="nv">$action</span> <span class="o">===</span> <span class="s1">&#39;showall&#39;</span><span class="p">)</span> <span class="p">{</span> <span class="cm">/**/</span> <span class="p">}</span> <span class="k">elseif</span><span class="p">(</span><span class="nv">$action</span> <span class="o">===</span> <span class="s1">&#39;showallbyuser&#39;</span><span class="p">)</span> <span class="p">{</span> <span class="cm">/**/</span> <span class="p">}</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="switch-without-default">
<span id="case-switch-without-default"></span><h3><span class="section-number">5.2.242. </span>Switch Without Default<a class="headerlink" href="#switch-without-default" title="Permalink to this headline">¶</a></h3>
<div class="section" id="case-zencart-structures-switchwithoutdefault">
<span id="id361"></span><h4><span class="section-number">5.2.242.1. </span>Zencart<a class="headerlink" href="#case-zencart-structures-switchwithoutdefault" title="Permalink to this headline">¶</a></h4>
<p><a class="reference internal" href="Rules.html#switch-without-default"><span class="std std-ref">Switch Without Default</span></a>, in admin/tax_rates.php:15.</p>
<p>The ‘action’ is collected from $_GET and then, compared with various strings to handle the different actions to be taken. The default behavior is implicit here : if no ‘action’, display the initial form for taxes to be changed. This has to be understood as a general philosophy of ZenCart project, or by reading the rest of the HTML code. Adding a ‘default’ case here would help understand what happens in case ‘action’ is absent or unrecognized.</p>
<div class="highlight-php notranslate"><div class="highlight"><pre><span></span><span class="nv">$action</span> <span class="o">=</span> <span class="p">(</span><span class="nb">isset</span><span class="p">(</span><span class="nv">$_GET</span><span class="p">[</span><span class="s1">&#39;action&#39;</span><span class="p">])</span> <span class="o">?</span> <span class="nv">$_GET</span><span class="p">[</span><span class="s1">&#39;action&#39;</span><span class="p">]</span> <span class="o">:</span> <span class="s1">&#39;&#39;</span><span class="p">);</span>

  <span class="k">if</span> <span class="p">(</span><span class="nx">zen_not_null</span><span class="p">(</span><span class="nv">$action</span><span class="p">))</span> <span class="p">{</span>
    <span class="k">switch</span> <span class="p">(</span><span class="nv">$action</span><span class="p">)</span> <span class="p">{</span>
      <span class="k">case</span> <span class="s1">&#39;insert&#39;</span><span class="o">:</span>
        <span class="c1">// PHP code</span>
        <span class="k">break</span><span class="p">;</span>
      <span class="k">case</span> <span class="s1">&#39;save&#39;</span><span class="o">:</span>
        <span class="c1">// PHP code</span>
        <span class="k">break</span><span class="p">;</span>
      <span class="k">case</span> <span class="s1">&#39;deleteconfirm&#39;</span><span class="o">:</span>
        <span class="c1">// PHP code</span>
        <span class="k">break</span><span class="p">;</span>
    <span class="p">}</span>
  <span class="p">}</span>
<span class="cp">?&gt;</span><span class="x"> .... HTML code</span>
</pre></div>
</div>
</div>
<div class="section" id="case-traq-structures-switchwithoutdefault">
<span id="id362"></span><h4><span class="section-number">5.2.242.2. </span>Traq<a class="headerlink" href="#case-traq-structures-switchwithoutdefault" title="Permalink to this headline">¶</a></h4>
<p><a class="reference internal" href="Rules.html#switch-without-default"><span class="std std-ref">Switch Without Default</span></a>, in src/Helpers/Ticketlist.php:311.</p>
<p>The default case is actually processed after the switch, by the next if/then structure. The structure deals with the customFields, while the else deals with any unknown situations. This if/then could be wrapped in the ‘default’ case of switch, for consistent processing. The if/then condition would be hard to use as a ‘case’ (possible, though).</p>
<div class="highlight-php notranslate"><div class="highlight"><pre><span></span><span class="k">public</span> <span class="k">static</span> <span class="k">function</span> <span class="nf">dataFor</span><span class="p">(</span><span class="nv">$column</span><span class="p">,</span> <span class="nv">$ticket</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="k">switch</span> <span class="p">(</span><span class="nv">$column</span><span class="p">)</span> <span class="p">{</span>
            <span class="c1">// Ticket ID column</span>
            <span class="k">case</span> <span class="s1">&#39;ticket_id&#39;</span><span class="o">:</span>
                <span class="k">return</span> <span class="nv">$ticket</span><span class="p">[</span><span class="s1">&#39;ticket_id&#39;</span><span class="p">];</span>
                <span class="k">break</span><span class="p">;</span>

            <span class="c1">// Status column</span>
            <span class="k">case</span> <span class="s1">&#39;status&#39;</span><span class="o">:</span>
            <span class="k">case</span> <span class="s1">&#39;type&#39;</span><span class="o">:</span>
            <span class="k">case</span> <span class="s1">&#39;component&#39;</span><span class="o">:</span>
            <span class="k">case</span> <span class="s1">&#39;priority&#39;</span><span class="o">:</span>
            <span class="k">case</span> <span class="s1">&#39;severity&#39;</span><span class="o">:</span>
                <span class="k">return</span> <span class="nv">$ticket</span><span class="p">[{</span><span class="nv">$column</span><span class="p">}</span><span class="nx">_name</span><span class="p">];</span>
                <span class="k">break</span><span class="p">;</span>

            <span class="c1">// Votes</span>
            <span class="k">case</span> <span class="s1">&#39;votes&#39;</span><span class="o">:</span>
                <span class="k">return</span> <span class="nv">$ticket</span><span class="p">[</span><span class="s1">&#39;votes&#39;</span><span class="p">];</span>
                <span class="k">break</span><span class="p">;</span>
        <span class="p">}</span>

        <span class="c1">// If we&#39;re still here, it may be a custom field</span>
        <span class="k">if</span> <span class="p">(</span><span class="nv">$value</span> <span class="o">=</span> <span class="nv">$ticket</span><span class="o">-&gt;</span><span class="na">customFieldValue</span><span class="p">(</span><span class="nv">$column</span><span class="p">))</span> <span class="p">{</span>
            <span class="k">return</span> <span class="nv">$value</span><span class="o">-&gt;</span><span class="na">value</span><span class="p">;</span>
        <span class="p">}</span>

        <span class="c1">// Nothing!</span>
        <span class="k">return</span> <span class="s1">&#39;&#39;</span><span class="p">;</span>
    <span class="p">}</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="ternary-in-concat">
<span id="case-ternary-in-concat"></span><h3><span class="section-number">5.2.243. </span>Ternary In Concat<a class="headerlink" href="#ternary-in-concat" title="Permalink to this headline">¶</a></h3>
<div class="section" id="case-teampass-structures-ternaryinconcat">
<span id="id363"></span><h4><span class="section-number">5.2.243.1. </span>TeamPass<a class="headerlink" href="#case-teampass-structures-ternaryinconcat" title="Permalink to this headline">¶</a></h4>
<p><a class="reference internal" href="Rules.html#ternary-in-concat"><span class="std std-ref">Ternary In Concat</span></a>, in includes/libraries/protect/AntiXSS/UTF8.php:5409.</p>
<p>The concatenations in the initial comparison are disguised casting. When $str2 is empty too, the ternary operator yields a 0, leading to a systematic failure.</p>
<div class="highlight-php notranslate"><div class="highlight"><pre><span></span><span class="nv">$str1</span> <span class="o">.</span> <span class="s1">&#39;&#39;</span> <span class="o">===</span> <span class="nv">$str2</span> <span class="o">.</span> <span class="s1">&#39;&#39;</span> <span class="o">?</span> <span class="mi">0</span> <span class="o">:</span> <span class="nb">strnatcmp</span><span class="p">(</span><span class="nx">self</span><span class="o">::</span><span class="na">strtonatfold</span><span class="p">(</span><span class="nv">$str1</span><span class="p">),</span> <span class="nx">self</span><span class="o">::</span><span class="na">strtonatfold</span><span class="p">(</span><span class="nv">$str2</span><span class="p">))</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="test-then-cast">
<span id="case-test-then-cast"></span><h3><span class="section-number">5.2.244. </span>Test Then Cast<a class="headerlink" href="#test-then-cast" title="Permalink to this headline">¶</a></h3>
<div class="section" id="case-dolphin-structures-testthencast">
<span id="id364"></span><h4><span class="section-number">5.2.244.1. </span>Dolphin<a class="headerlink" href="#case-dolphin-structures-testthencast" title="Permalink to this headline">¶</a></h4>
<p><a class="reference internal" href="Rules.html#test-then-cast"><span class="std std-ref">Test Then Cast</span></a>, in wp-admin/includes/misc.php:74.</p>
<p>$aLimits[‘per_page’] is tested for existence and not false. Later, it is cast from string to int : yet, a ‘0.1’ string value would pass the test, and end up filling $aLimits[‘per_page’] with 0.</p>
<div class="highlight-php notranslate"><div class="highlight"><pre><span></span><span class="k">if</span> <span class="p">(</span><span class="nb">isset</span><span class="p">(</span><span class="nv">$aLimits</span><span class="p">[</span><span class="s1">&#39;per_page&#39;</span><span class="p">])</span> <span class="o">&amp;&amp;</span> <span class="nv">$aLimits</span><span class="p">[</span><span class="s1">&#39;per_page&#39;</span><span class="p">]</span> <span class="o">!==</span> <span class="k">false</span><span class="p">)</span>
            <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">aCurrent</span><span class="p">[</span><span class="s1">&#39;paginate&#39;</span><span class="p">][</span><span class="s1">&#39;perPage&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="nx">int</span><span class="p">)</span><span class="nv">$aLimits</span><span class="p">[</span><span class="s1">&#39;per_page&#39;</span><span class="p">];</span>
</pre></div>
</div>
</div>
<div class="section" id="case-suitecrm-structures-testthencast">
<span id="id365"></span><h4><span class="section-number">5.2.244.2. </span>SuiteCrm<a class="headerlink" href="#case-suitecrm-structures-testthencast" title="Permalink to this headline">¶</a></h4>
<p><a class="reference internal" href="Rules.html#test-then-cast"><span class="std std-ref">Test Then Cast</span></a>, in modules/jjwg_Maps/controller.php:1035.</p>
<p>$marker[‘lat’] is compared to the string ‘0’, which actually transtype it to integer, then it is cast to string for map_marker_data_points() needs and finally, it is cast to float, in case of a correction. It would be safer to test it in its string type, since floats are not used as array indices.</p>
<div class="highlight-php notranslate"><div class="highlight"><pre><span></span><span class="k">if</span> <span class="p">(</span><span class="nv">$marker</span><span class="p">[</span><span class="s1">&#39;lat&#39;</span><span class="p">]</span> <span class="o">!=</span> <span class="s1">&#39;0&#39;</span> <span class="o">&amp;&amp;</span> <span class="nv">$marker</span><span class="p">[</span><span class="s1">&#39;lng&#39;</span><span class="p">]</span> <span class="o">!=</span> <span class="s1">&#39;0&#39;</span><span class="p">)</span> <span class="p">{</span>

            <span class="c1">// Check to see if marker point already exists and apply offset if needed</span>
            <span class="c1">// This often occurs when an address is only defined by city, state, zip.</span>
            <span class="nv">$i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
            <span class="k">while</span> <span class="p">(</span><span class="nb">isset</span><span class="p">(</span><span class="nv">$this</span><span class="o">-&gt;</span><span class="na">map_marker_data_points</span><span class="p">[(</span><span class="nx">string</span><span class="p">)</span> <span class="nv">$marker</span><span class="p">[</span><span class="s1">&#39;lat&#39;</span><span class="p">]][(</span><span class="nx">string</span><span class="p">)</span> <span class="nv">$marker</span><span class="p">[</span><span class="s1">&#39;lng&#39;</span><span class="p">]])</span> <span class="o">&amp;&amp;</span>
            <span class="nv">$i</span> <span class="o">&lt;</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">settings</span><span class="p">[</span><span class="s1">&#39;map_markers_limit&#39;</span><span class="p">])</span> <span class="p">{</span>
                <span class="nv">$marker</span><span class="p">[</span><span class="s1">&#39;lat&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="nx">float</span><span class="p">)</span> <span class="nv">$marker</span><span class="p">[</span><span class="s1">&#39;lat&#39;</span><span class="p">]</span> <span class="o">+</span> <span class="p">(</span><span class="nx">float</span><span class="p">)</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">settings</span><span class="p">[</span><span class="s1">&#39;map_duplicate_marker_adjustment&#39;</span><span class="p">];</span>
                <span class="nv">$marker</span><span class="p">[</span><span class="s1">&#39;lng&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="nx">float</span><span class="p">)</span> <span class="nv">$marker</span><span class="p">[</span><span class="s1">&#39;lng&#39;</span><span class="p">]</span> <span class="o">+</span> <span class="p">(</span><span class="nx">float</span><span class="p">)</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">settings</span><span class="p">[</span><span class="s1">&#39;map_duplicate_marker_adjustment&#39;</span><span class="p">];</span>
                <span class="nv">$i</span><span class="o">++</span><span class="p">;</span>
            <span class="p">}</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="timestamp-difference">
<span id="case-timestamp-difference"></span><h3><span class="section-number">5.2.245. </span>Timestamp Difference<a class="headerlink" href="#timestamp-difference" title="Permalink to this headline">¶</a></h3>
<div class="section" id="case-zurmo-structures-timestampdifference">
<span id="id366"></span><h4><span class="section-number">5.2.245.1. </span>Zurmo<a class="headerlink" href="#case-zurmo-structures-timestampdifference" title="Permalink to this headline">¶</a></h4>
<p><a class="reference internal" href="Rules.html#timestamp-difference"><span class="std std-ref">Timestamp Difference</span></a>, in app/protected/modules/import/jobs/ImportCleanupJob.php:73.</p>
<p>This is wrong twice a year, in countries that has day-ligth saving time. One of the weeks will be too short, and the other will be too long.</p>
<div class="highlight-php notranslate"><div class="highlight"><pre><span></span><span class="sd">/**</span>
<span class="sd">         * Get all imports where the modifiedDateTime was more than 1 week ago.  Then</span>
<span class="sd">         * delete the imports.</span>
<span class="sd">         * (non-PHPdoc)</span>
<span class="sd">         * @see BaseJob::run()</span>
<span class="sd">         */</span>
        <span class="k">public</span> <span class="k">function</span> <span class="nf">run</span><span class="p">()</span>
        <span class="p">{</span>
            <span class="nv">$oneWeekAgoTimeStamp</span> <span class="o">=</span> <span class="nx">DateTimeUtil</span><span class="o">::</span><span class="na">convertTimestampToDbFormatDateTime</span><span class="p">(</span><span class="nb">time</span><span class="p">()</span> <span class="o">-</span> <span class="mi">60</span> <span class="o">*</span> <span class="mi">60</span> <span class="o">*</span><span class="mi">24</span> <span class="o">*</span> <span class="mi">7</span><span class="p">);</span>
</pre></div>
</div>
</div>
<div class="section" id="case-shopware-structures-timestampdifference">
<span id="id367"></span><h4><span class="section-number">5.2.245.2. </span>shopware<a class="headerlink" href="#case-shopware-structures-timestampdifference" title="Permalink to this headline">¶</a></h4>
<p><a class="reference internal" href="Rules.html#timestamp-difference"><span class="std std-ref">Timestamp Difference</span></a>, in engine/Shopware/Controllers/Backend/Newsletter.php:150.</p>
<p>When daylight saving strike, the email may suddenly be locked for 1 hour minus 30 seconds ago. The lock will be set for the rest of the hour, until the server catch up.</p>
<div class="highlight-php notranslate"><div class="highlight"><pre><span></span><span class="c1">// Check lock time. Add a buffer of 30 seconds to the lock time (default request time)</span>
            <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="k">empty</span><span class="p">(</span><span class="nv">$mailing</span><span class="p">[</span><span class="s1">&#39;locked&#39;</span><span class="p">])</span> <span class="o">&amp;&amp;</span> <span class="nb">strtotime</span><span class="p">(</span><span class="nv">$mailing</span><span class="p">[</span><span class="s1">&#39;locked&#39;</span><span class="p">])</span> <span class="o">&gt;</span> <span class="nb">time</span><span class="p">()</span> <span class="o">-</span> <span class="mi">30</span><span class="p">)</span> <span class="p">{</span>
                <span class="k">echo</span> <span class="s2">&quot;Current mail: &#39;&quot;</span> <span class="o">.</span> <span class="nv">$subjectCurrentMailing</span> <span class="o">.</span> <span class="s2">&quot;&#39;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">;</span>
                <span class="k">echo</span> <span class="s2">&quot;Wait &quot;</span> <span class="o">.</span> <span class="p">(</span><span class="nb">strtotime</span><span class="p">(</span><span class="nv">$mailing</span><span class="p">[</span><span class="s1">&#39;locked&#39;</span><span class="p">])</span> <span class="o">+</span> <span class="mi">30</span> <span class="o">-</span> <span class="nb">time</span><span class="p">())</span> <span class="o">.</span> <span class="s2">&quot; seconds ...</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">;</span>
                <span class="k">return</span><span class="p">;</span>
            <span class="p">}</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="unconditional-break-in-loop">
<span id="case-unconditional-break-in-loop"></span><h3><span class="section-number">5.2.246. </span>Unconditional Break In Loop<a class="headerlink" href="#unconditional-break-in-loop" title="Permalink to this headline">¶</a></h3>
<div class="section" id="case-livezilla-structures-unconditionloopbreak">
<span id="id368"></span><h4><span class="section-number">5.2.246.1. </span>LiveZilla<a class="headerlink" href="#case-livezilla-structures-unconditionloopbreak" title="Permalink to this headline">¶</a></h4>
<p><a class="reference internal" href="Rules.html#unconditional-break-in-loop"><span class="std std-ref">Unconditional Break In Loop</span></a>, in wp-admin/includes/misc.php:74.</p>
<p>Only one row is read from the DBManager, and the rest is ignored. The result has no more than one result, basedd on the <cite>LIMIT 1</cite> clause in the SQL. The while loop may be removed.</p>
<div class="highlight-php notranslate"><div class="highlight"><pre><span></span><span class="nv">$result</span> <span class="o">=</span> <span class="nx">DBManager</span><span class="o">::</span><span class="na">Execute</span><span class="p">(</span><span class="k">true</span><span class="p">,</span> <span class="s2">&quot;SELECT * FROM `&quot;</span> <span class="o">.</span> <span class="nx">DB_PREFIX</span> <span class="o">.</span> <span class="nx">DATABASE_STATS_AGGS</span> <span class="o">.</span> <span class="s2">&quot;` WHERE `month`&gt;0 AND ((`year`=&#39;&quot;</span> <span class="o">.</span> <span class="nx">DBManager</span><span class="o">::</span><span class="na">RealEscape</span><span class="p">(</span><span class="nb">date</span><span class="p">(</span><span class="s2">&quot;Y&quot;</span><span class="p">))</span> <span class="o">.</span> <span class="s2">&quot;&#39; AND `month`&lt;&#39;&quot;</span> <span class="o">.</span> <span class="nx">DBManager</span><span class="o">::</span><span class="na">RealEscape</span><span class="p">(</span><span class="nb">date</span><span class="p">(</span><span class="s2">&quot;n&quot;</span><span class="p">))</span> <span class="o">.</span> <span class="s2">&quot;&#39;) OR (`year`&lt;&#39;&quot;</span> <span class="o">.</span> <span class="nx">DBManager</span><span class="o">::</span><span class="na">RealEscape</span><span class="p">(</span><span class="nb">date</span><span class="p">(</span><span class="s2">&quot;Y&quot;</span><span class="p">))</span> <span class="o">.</span> <span class="s2">&quot;&#39;)) AND (`aggregated`=0 OR `aggregated`&gt;&quot;</span> <span class="o">.</span> <span class="p">(</span><span class="nb">time</span><span class="p">()</span> <span class="o">-</span> <span class="mi">300</span><span class="p">)</span> <span class="o">.</span> <span class="s2">&quot;) AND `day`=0 ORDER BY `year` ASC,`month` ASC LIMIT 1;&quot;</span><span class="p">);</span>
        <span class="k">if</span> <span class="p">(</span><span class="nv">$result</span><span class="p">)</span>
            <span class="k">while</span> <span class="p">(</span><span class="nv">$row</span> <span class="o">=</span> <span class="nx">DBManager</span><span class="o">::</span><span class="na">FetchArray</span><span class="p">(</span><span class="nv">$result</span><span class="p">))</span> <span class="p">{</span>
                <span class="k">if</span> <span class="p">(</span><span class="k">empty</span><span class="p">(</span><span class="nv">$row</span><span class="p">[</span><span class="s2">&quot;aggregated&quot;</span><span class="p">]))</span> <span class="p">{</span>
                    <span class="nx">DBManager</span><span class="o">::</span><span class="na">Execute</span><span class="p">(</span><span class="k">true</span><span class="p">,</span> <span class="s2">&quot;UPDATE `&quot;</span> <span class="o">.</span> <span class="nx">DB_PREFIX</span> <span class="o">.</span> <span class="nx">DATABASE_STATS_AGGS</span> <span class="o">.</span> <span class="s2">&quot;` SET `aggregated`=&quot;</span> <span class="o">.</span> <span class="nb">time</span><span class="p">()</span> <span class="o">.</span> <span class="s2">&quot; WHERE `year`=&quot;</span> <span class="o">.</span> <span class="nv">$row</span><span class="p">[</span><span class="s2">&quot;year&quot;</span><span class="p">]</span> <span class="o">.</span> <span class="s2">&quot; AND `month`=&quot;</span> <span class="o">.</span> <span class="nv">$row</span><span class="p">[</span><span class="s2">&quot;month&quot;</span><span class="p">]</span> <span class="o">.</span> <span class="s2">&quot; AND `day`=0 LIMIT 1;&quot;</span><span class="p">);</span>
                    <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">AggregateMonth</span><span class="p">(</span><span class="nv">$row</span><span class="p">[</span><span class="s2">&quot;year&quot;</span><span class="p">],</span> <span class="nv">$row</span><span class="p">[</span><span class="s2">&quot;month&quot;</span><span class="p">]);</span>
                <span class="p">}</span>
                <span class="k">return</span> <span class="k">false</span><span class="p">;</span>
            <span class="p">}</span>
</pre></div>
</div>
</div>
<div class="section" id="case-mediawiki-structures-unconditionloopbreak">
<span id="id369"></span><h4><span class="section-number">5.2.246.2. </span>MediaWiki<a class="headerlink" href="#case-mediawiki-structures-unconditionloopbreak" title="Permalink to this headline">¶</a></h4>
<p><a class="reference internal" href="Rules.html#unconditional-break-in-loop"><span class="std std-ref">Unconditional Break In Loop</span></a>, in includes/htmlform/HTMLFormField.php:138.</p>
<p>The final break is useless : the execution has already reached the end of the loop.</p>
<div class="highlight-php notranslate"><div class="highlight"><pre><span></span><span class="k">for</span> <span class="p">(</span> <span class="nv">$i</span> <span class="o">=</span> <span class="nb">count</span><span class="p">(</span> <span class="nv">$thisKeys</span> <span class="p">)</span> <span class="o">-</span> <span class="mi">1</span><span class="p">;</span> <span class="nv">$i</span> <span class="o">&gt;=</span> <span class="mi">0</span><span class="p">;</span> <span class="nv">$i</span><span class="o">--</span> <span class="p">)</span> <span class="p">{</span>
                    <span class="nv">$keys</span> <span class="o">=</span> <span class="nb">array_merge</span><span class="p">(</span> <span class="nb">array_slice</span><span class="p">(</span> <span class="nv">$thisKeys</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="nv">$i</span> <span class="p">),</span> <span class="nv">$nameKeys</span> <span class="p">);</span>
                    <span class="nv">$data</span> <span class="o">=</span> <span class="nv">$alldata</span><span class="p">;</span>
                    <span class="k">foreach</span> <span class="p">(</span> <span class="nv">$keys</span> <span class="k">as</span> <span class="nv">$key</span> <span class="p">)</span> <span class="p">{</span>
                            <span class="k">if</span> <span class="p">(</span> <span class="o">!</span><span class="nb">is_array</span><span class="p">(</span> <span class="nv">$data</span> <span class="p">)</span> <span class="o">||</span> <span class="o">!</span><span class="nb">array_key_exists</span><span class="p">(</span> <span class="nv">$key</span><span class="p">,</span> <span class="nv">$data</span> <span class="p">)</span> <span class="p">)</span> <span class="p">{</span>
                                    <span class="k">continue</span> <span class="mi">2</span><span class="p">;</span>
                            <span class="p">}</span>
                            <span class="nv">$data</span> <span class="o">=</span> <span class="nv">$data</span><span class="p">[</span><span class="nv">$key</span><span class="p">];</span>
                    <span class="p">}</span>
                    <span class="nv">$testValue</span> <span class="o">=</span> <span class="p">(</span><span class="nx">string</span><span class="p">)</span><span class="nv">$data</span><span class="p">;</span>
                    <span class="k">break</span><span class="p">;</span>
            <span class="p">}</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="unpreprocessed-values">
<span id="case-unpreprocessed-values"></span><h3><span class="section-number">5.2.247. </span>Unpreprocessed Values<a class="headerlink" href="#unpreprocessed-values" title="Permalink to this headline">¶</a></h3>
<div class="section" id="case-zurmo-structures-unpreprocessed">
<span id="id370"></span><h4><span class="section-number">5.2.247.1. </span>Zurmo<a class="headerlink" href="#case-zurmo-structures-unpreprocessed" title="Permalink to this headline">¶</a></h4>
<p><a class="reference internal" href="Rules.html#unpreprocessed-values"><span class="std std-ref">Unpreprocessed Values</span></a>, in app/protected/core/utils/ZurmoTranslationServerUtil.php:79.</p>
<p>It seems that a simple concatenation could be used here. There is another call to this expression in the code, and a third that uses ‘PATCH_VERSION’ on top of the two others.</p>
<div class="highlight-php notranslate"><div class="highlight"><pre><span></span><span class="nb">join</span><span class="p">(</span><span class="s1">&#39;.&#39;</span><span class="p">,</span> <span class="k">array</span><span class="p">(</span><span class="nx">MAJOR_VERSION</span><span class="p">,</span> <span class="nx">MINOR_VERSION</span><span class="p">))</span>
</pre></div>
</div>
</div>
<div class="section" id="case-piwigo-structures-unpreprocessed">
<span id="id371"></span><h4><span class="section-number">5.2.247.2. </span>Piwigo<a class="headerlink" href="#case-piwigo-structures-unpreprocessed" title="Permalink to this headline">¶</a></h4>
<p><a class="reference internal" href="Rules.html#unpreprocessed-values"><span class="std std-ref">Unpreprocessed Values</span></a>, in include/random_compat/random.php:34.</p>
<p>PHP_VERSION is actually build with PHP_MAJOR_VERSION, PHP_MINOR_VERSION and PHP_RELEASE_VERSION. There is also a compact version : PHP_VERSION_ID</p>
<div class="highlight-php notranslate"><div class="highlight"><pre><span></span><span class="nb">explode</span><span class="p">(</span><span class="s1">&#39;.&#39;</span><span class="p">,</span> <span class="k">PHP_VERSION</span><span class="p">);</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="unused-global">
<span id="case-unused-global"></span><h3><span class="section-number">5.2.248. </span>Unused Global<a class="headerlink" href="#unused-global" title="Permalink to this headline">¶</a></h3>
<div class="section" id="case-dolphin-structures-unusedglobal">
<span id="id372"></span><h4><span class="section-number">5.2.248.1. </span>Dolphin<a class="headerlink" href="#case-dolphin-structures-unusedglobal" title="Permalink to this headline">¶</a></h4>
<p><a class="reference internal" href="Rules.html#unused-global"><span class="std std-ref">Unused Global</span></a>, in Dolphin-v.7.3.5/modules/boonex/forum/classes/DbForum.php:548.</p>
<p>$gConf is not used in this method, and may be safely avoided.</p>
<div class="highlight-php notranslate"><div class="highlight"><pre><span></span><span class="k">function</span> <span class="nf">getUserPostsList</span> <span class="p">(</span><span class="nv">$user</span><span class="p">,</span> <span class="nv">$sort</span><span class="p">,</span> <span class="nv">$limit</span> <span class="o">=</span> <span class="mi">10</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="k">global</span> <span class="nv">$gConf</span><span class="p">;</span>

        <span class="k">switch</span> <span class="p">(</span><span class="nv">$sort</span><span class="p">)</span> <span class="p">{</span>
            <span class="k">case</span> <span class="s1">&#39;top&#39;</span><span class="o">:</span>
                <span class="nv">$order_by</span> <span class="o">=</span> <span class="s2">&quot; t1.`votes` DESC &quot;</span><span class="p">;</span>
                <span class="k">break</span><span class="p">;</span>
            <span class="k">case</span> <span class="s1">&#39;rnd&#39;</span><span class="o">:</span>
                <span class="nv">$order_by</span> <span class="o">=</span> <span class="s2">&quot; RAND() &quot;</span><span class="p">;</span>
                <span class="k">break</span><span class="p">;</span>
            <span class="k">default</span><span class="o">:</span>
                <span class="nv">$order_by</span> <span class="o">=</span> <span class="s2">&quot; t1.`when` DESC &quot;</span><span class="p">;</span>
        <span class="p">}</span>

        <span class="nv">$sql</span> <span class="o">=</span>  <span class="s2">&quot;</span>
<span class="s2">        SELECT t1.`forum_id`, t1.`topic_id`, t2.`topic_uri`, t2.`topic_title`, t1.`post_id`, t1.`user`, `post_text`, t1.`when`</span>
<span class="s2">            FROM &quot;</span> <span class="o">.</span> <span class="nx">TF_FORUM_POST</span> <span class="o">.</span> <span class="s2">&quot; AS t1</span>
<span class="s2">        INNER JOIN &quot;</span> <span class="o">.</span> <span class="nx">TF_FORUM_TOPIC</span> <span class="o">.</span> <span class="s2">&quot; AS t2</span>
<span class="s2">            ON (t1.`topic_id` = t2.`topic_id`)</span>
<span class="s2">        WHERE  t1.`user` = &#39;</span><span class="si">$user</span><span class="s2">&#39; AND `t2`.`topic_hidden` = &#39;0&#39;</span>
<span class="s2">        ORDER BY &quot;</span> <span class="o">.</span> <span class="nv">$order_by</span> <span class="o">.</span> <span class="s2">&quot;</span>
<span class="s2">        LIMIT </span><span class="si">$limit</span><span class="s2">&quot;</span><span class="p">;</span>

        <span class="nv">$a</span> <span class="o">=</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">getAll</span> <span class="p">(</span><span class="nv">$sql</span><span class="p">);</span>
        <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">_cutPostText</span><span class="p">(</span><span class="nv">$a</span><span class="p">);</span>
        <span class="k">return</span> <span class="nv">$a</span><span class="p">;</span>
    <span class="p">}</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="use-count-recursive">
<span id="case-use-count-recursive"></span><h3><span class="section-number">5.2.249. </span>Use Count Recursive<a class="headerlink" href="#use-count-recursive" title="Permalink to this headline">¶</a></h3>
<div class="section" id="case-wordpress-structures-usecountrecursive">
<span id="id373"></span><h4><span class="section-number">5.2.249.1. </span>WordPress<a class="headerlink" href="#case-wordpress-structures-usecountrecursive" title="Permalink to this headline">¶</a></h4>
<p><a class="reference internal" href="Rules.html#use-count-recursive"><span class="std std-ref">Use Count Recursive</span></a>, in wp-admin/includes/misc.php:74.</p>
<p>This code actually loads the file, join it, then split it again. file() would be sufficient.</p>
<div class="highlight-php notranslate"><div class="highlight"><pre><span></span><span class="nv">$markerdata</span> <span class="o">=</span> <span class="nb">explode</span><span class="p">(</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">,</span> <span class="nb">implode</span><span class="p">(</span> <span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="nb">file</span><span class="p">(</span> <span class="nv">$filename</span> <span class="p">)</span> <span class="p">)</span> <span class="p">);</span>
</pre></div>
</div>
</div>
<div class="section" id="case-prestashop-structures-usecountrecursive">
<span id="id374"></span><h4><span class="section-number">5.2.249.2. </span>PrestaShop<a class="headerlink" href="#case-prestashop-structures-usecountrecursive" title="Permalink to this headline">¶</a></h4>
<p><a class="reference internal" href="Rules.html#use-count-recursive"><span class="std std-ref">Use Count Recursive</span></a>, in controllers/admin/AdminSearchController.php:342.</p>
<p>This could be improved with count() recursive and a array_filter call, to remove empty $list.</p>
<div class="highlight-php notranslate"><div class="highlight"><pre><span></span><span class="nv">$nb_results</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
            <span class="k">foreach</span> <span class="p">(</span><span class="nv">$this</span><span class="o">-&gt;</span><span class="na">_list</span> <span class="k">as</span> <span class="nv">$list</span><span class="p">)</span> <span class="p">{</span>
                <span class="k">if</span> <span class="p">(</span><span class="nv">$list</span> <span class="o">!=</span> <span class="k">false</span><span class="p">)</span> <span class="p">{</span>
                    <span class="nv">$nb_results</span> <span class="o">+=</span> <span class="nb">count</span><span class="p">(</span><span class="nv">$list</span><span class="p">);</span>
                <span class="p">}</span>
            <span class="p">}</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="use-list-with-foreach">
<span id="case-use-list-with-foreach"></span><h3><span class="section-number">5.2.250. </span>Use List With Foreach<a class="headerlink" href="#use-list-with-foreach" title="Permalink to this headline">¶</a></h3>
<div class="section" id="case-mediawiki-structures-uselistwithforeach">
<span id="id375"></span><h4><span class="section-number">5.2.250.1. </span>MediaWiki<a class="headerlink" href="#case-mediawiki-structures-uselistwithforeach" title="Permalink to this headline">¶</a></h4>
<p><a class="reference internal" href="Rules.html#use-list-with-foreach"><span class="std std-ref">Use List With Foreach</span></a>, in includes/parser/LinkHolderArray.php:372.</p>
<p>This foreach reads each element from $entries into entry. $entry, in turn, is written into $pdbk, $title and $displayText for easier reuse. 5 elements are read from $entry, and they could be set in their respective variable in the foreach() with a list call. The only on that can’t be set is ‘query’ which has to be tested.</p>
<div class="highlight-php notranslate"><div class="highlight"><pre><span></span><span class="k">foreach</span> <span class="p">(</span> <span class="nv">$entries</span> <span class="k">as</span> <span class="nv">$index</span> <span class="o">=&gt;</span> <span class="nv">$entry</span> <span class="p">)</span> <span class="p">{</span>
                            <span class="nv">$pdbk</span> <span class="o">=</span> <span class="nv">$entry</span><span class="p">[</span><span class="s1">&#39;pdbk&#39;</span><span class="p">];</span>
                            <span class="nv">$title</span> <span class="o">=</span> <span class="nv">$entry</span><span class="p">[</span><span class="s1">&#39;title&#39;</span><span class="p">];</span>
                            <span class="nv">$query</span> <span class="o">=</span> <span class="nb">isset</span><span class="p">(</span> <span class="nv">$entry</span><span class="p">[</span><span class="s1">&#39;query&#39;</span><span class="p">]</span> <span class="p">)</span> <span class="o">?</span> <span class="nv">$entry</span><span class="p">[</span><span class="s1">&#39;query&#39;</span><span class="p">]</span> <span class="o">:</span> <span class="p">[];</span>
                            <span class="nv">$key</span> <span class="o">=</span> <span class="s2">&quot;</span><span class="si">$ns</span><span class="s2">:</span><span class="si">$index</span><span class="s2">&quot;</span><span class="p">;</span>
                            <span class="nv">$searchkey</span> <span class="o">=</span> <span class="s2">&quot;&lt;!--LINK&#39;</span><span class="se">\$</span><span class="s2">key--&gt;\;</span>
<span class="s2">                            </span><span class="si">$displayText</span><span class="s2"> = </span><span class="si">$entry[&#39;text&#39;]</span><span class="s2">;</span>
<span class="s2">                            if ( isset( </span><span class="si">$entry[&#39;selflink&#39;]</span><span class="s2"> ) ) {</span>
<span class="s2">                                    </span><span class="si">$replacePairs[$searchkey]</span><span class="s2"> = Linker::makeSelfLinkObj( </span><span class="si">$title</span><span class="s2">, </span><span class="si">$displayText</span><span class="s2">, </span><span class="si">$query</span><span class="s2"> );</span>
<span class="s2">                                    continue;</span>
<span class="s2">                            }</span>
<span class="s2">                            if ( </span><span class="si">$displayText</span><span class="s2"> === &#39;&#39; ) {</span>
<span class="s2">                                    </span><span class="si">$displayText</span><span class="s2"> = null;</span>
<span class="s2">                            } else {</span>
<span class="s2">                                    </span><span class="si">$displayText</span><span class="s2"> = new HtmlArmor( </span><span class="si">$displayText</span><span class="s2"> );</span>
<span class="s2">                            }</span>
<span class="s2">                            if ( !isset( </span><span class="si">$colours[$pdbk]</span><span class="s2"> ) ) {</span>
<span class="s2">                                    </span><span class="si">$colours[$pdbk]</span><span class="s2"> = &#39;new&#39;;</span>
<span class="s2">                            }</span>
<span class="s2">                            </span><span class="si">$attribs</span><span class="s2"> = [];</span>
<span class="s2">                            if ( </span><span class="si">$colours[$pdbk]</span><span class="s2"> == &#39;new&#39; ) {</span>
<span class="s2">                                    </span><span class="si">$linkCache-&gt;addBadLinkObj</span><span class="s2">( </span><span class="si">$title</span><span class="s2"> );</span>
<span class="s2">                                    </span><span class="si">$output-&gt;addLink</span><span class="s2">( </span><span class="si">$title</span><span class="s2">, 0 );</span>
<span class="s2">                                    </span><span class="si">$link</span><span class="s2"> = </span><span class="si">$linkRenderer-&gt;makeBrokenLink</span><span class="s2">(</span>
<span class="s2">                                            </span><span class="si">$title</span><span class="s2">, </span><span class="si">$displayText</span><span class="s2">, </span><span class="si">$attribs</span><span class="s2">, </span><span class="si">$query</span><span class="s2"></span>
<span class="s2">                                    );</span>
<span class="s2">                            } else {</span>
<span class="s2">                                    </span><span class="si">$link</span><span class="s2"> = </span><span class="si">$linkRenderer-&gt;makePreloadedLink</span><span class="s2">(</span>
<span class="s2">                                            </span><span class="si">$title</span><span class="s2">, </span><span class="si">$displayText</span><span class="s2">, </span><span class="si">$colours[$pdbk]</span><span class="s2">, </span><span class="si">$attribs</span><span class="s2">, </span><span class="si">$query</span><span class="s2"></span>
<span class="s2">                                    );</span>
<span class="s2">                            }</span>

<span class="s2">                            </span><span class="si">$replacePairs[$searchkey]</span><span class="s2"> = </span><span class="si">$link</span><span class="s2">;</span>
<span class="s2">                    }</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="use-positive-condition">
<span id="case-use-positive-condition"></span><h3><span class="section-number">5.2.251. </span>Use Positive Condition<a class="headerlink" href="#use-positive-condition" title="Permalink to this headline">¶</a></h3>
<div class="section" id="case-spip-structures-usepositivecondition">
<span id="id376"></span><h4><span class="section-number">5.2.251.1. </span>SPIP<a class="headerlink" href="#case-spip-structures-usepositivecondition" title="Permalink to this headline">¶</a></h4>
<p><a class="reference internal" href="Rules.html#use-positive-condition"><span class="std std-ref">Use Positive Condition</span></a>, in ecrire/inc/utils.php:925.</p>
<p>if (isset($time[$t])) { } else { } would put the important case in first place, and be more readable.</p>
<div class="highlight-php notranslate"><div class="highlight"><pre><span></span><span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nb">isset</span><span class="p">(</span><span class="nv">$time</span><span class="p">[</span><span class="nv">$t</span><span class="p">]))</span> <span class="p">{</span>
            <span class="nv">$time</span><span class="p">[</span><span class="nv">$t</span><span class="p">]</span> <span class="o">=</span> <span class="nv">$a</span> <span class="o">+</span> <span class="nv">$b</span><span class="p">;</span>
    <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
            <span class="nv">$p</span> <span class="o">=</span> <span class="p">(</span><span class="nv">$a</span> <span class="o">+</span> <span class="nv">$b</span> <span class="o">-</span> <span class="nv">$time</span><span class="p">[</span><span class="nv">$t</span><span class="p">])</span> <span class="o">*</span> <span class="mi">1000</span><span class="p">;</span>
            <span class="nb">unset</span><span class="p">(</span><span class="nv">$time</span><span class="p">[</span><span class="nv">$t</span><span class="p">]);</span>
<span class="c1">#                   echo &quot;&#39;$p&#39;&quot;;exit;</span>
            <span class="k">if</span> <span class="p">(</span><span class="nv">$raw</span><span class="p">)</span> <span class="p">{</span>
                    <span class="k">return</span> <span class="nv">$p</span><span class="p">;</span>
            <span class="p">}</span>
            <span class="k">if</span> <span class="p">(</span><span class="nv">$p</span> <span class="o">&lt;</span> <span class="mi">1000</span><span class="p">)</span> <span class="p">{</span>
                    <span class="nv">$s</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span><span class="p">;</span>
            <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
                    <span class="nv">$s</span> <span class="o">=</span> <span class="nb">sprintf</span><span class="p">(</span><span class="s2">&quot;%d &quot;</span><span class="p">,</span> <span class="nv">$x</span> <span class="o">=</span> <span class="nb">floor</span><span class="p">(</span><span class="nv">$p</span> <span class="o">/</span> <span class="mi">1000</span><span class="p">));</span>
                    <span class="nv">$p</span> <span class="o">-=</span> <span class="p">(</span><span class="nv">$x</span> <span class="o">*</span> <span class="mi">1000</span><span class="p">);</span>
            <span class="p">}</span>

            <span class="k">return</span> <span class="nv">$s</span> <span class="o">.</span> <span class="nb">sprintf</span><span class="p">(</span><span class="nv">$s</span> <span class="o">?</span> <span class="s2">&quot;%07.3f ms&quot;</span> <span class="o">:</span> <span class="s2">&quot;%.3f ms&quot;</span><span class="p">,</span> <span class="nv">$p</span><span class="p">);</span>
    <span class="p">}</span>
</pre></div>
</div>
</div>
<div class="section" id="case-expressionengine-structures-usepositivecondition">
<span id="id377"></span><h4><span class="section-number">5.2.251.2. </span>ExpressionEngine<a class="headerlink" href="#case-expressionengine-structures-usepositivecondition" title="Permalink to this headline">¶</a></h4>
<p><a class="reference internal" href="Rules.html#use-positive-condition"><span class="std std-ref">Use Positive Condition</span></a>, in system/ee/EllisLab/Addons/forum/mod.forum_core.php:9138.</p>
<p>Let’s be positive, and start processing the presence of $topic first. And let’s call it empty(),  not == ‘’.</p>
<div class="highlight-php notranslate"><div class="highlight"><pre><span></span><span class="k">if</span> <span class="p">(</span><span class="nv">$topic</span> <span class="o">!=</span> <span class="s1">&#39;&#39;</span><span class="p">)</span>
                                            <span class="p">{</span>
                                                    <span class="nv">$sql</span> <span class="o">.=</span> <span class="s1">&#39;(&#39;</span><span class="o">.</span><span class="nb">substr</span><span class="p">(</span><span class="nv">$topic</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="o">-</span><span class="mi">3</span><span class="p">)</span><span class="o">.</span><span class="s1">&#39;) OR &#39;</span><span class="p">;</span>
                                                    <span class="nv">$sql</span> <span class="o">.=</span> <span class="s1">&#39;(&#39;</span><span class="o">.</span><span class="nb">substr</span><span class="p">(</span><span class="nv">$tbody</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="o">-</span><span class="mi">3</span><span class="p">)</span><span class="o">.</span><span class="s1">&#39;) &#39;</span><span class="p">;</span>
                                            <span class="p">}</span>
                                            <span class="k">else</span>
                                            <span class="p">{</span>
                                                    <span class="nv">$sql</span> <span class="o">=</span> <span class="nb">substr</span><span class="p">(</span><span class="nv">$sql</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="o">-</span><span class="mi">3</span><span class="p">);</span>
                                            <span class="p">}</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="useless-brackets">
<span id="case-useless-brackets"></span><h3><span class="section-number">5.2.252. </span>Useless Brackets<a class="headerlink" href="#useless-brackets" title="Permalink to this headline">¶</a></h3>
<div class="section" id="case-churchcrm-structures-uselessbrackets">
<span id="id378"></span><h4><span class="section-number">5.2.252.1. </span>ChurchCRM<a class="headerlink" href="#case-churchcrm-structures-uselessbrackets" title="Permalink to this headline">¶</a></h4>
<p><a class="reference internal" href="Rules.html#useless-brackets"><span class="std std-ref">Useless Brackets</span></a>, in src/Menu.php:72.</p>
<p>Difficut to guess what was before the block here. It doesn’t have any usage for control flow.</p>
<div class="highlight-php notranslate"><div class="highlight"><pre><span></span><span class="nv">$new_row</span> <span class="o">=</span> <span class="k">false</span><span class="p">;</span>
        <span class="nv">$count_people</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>

        <span class="p">{</span>
            <span class="k">foreach</span> <span class="p">(</span><span class="nv">$peopleWithBirthDays</span> <span class="k">as</span> <span class="nv">$peopleWithBirthDay</span><span class="p">)</span> <span class="p">{</span>
                <span class="k">if</span> <span class="p">(</span><span class="nv">$new_row</span> <span class="o">==</span> <span class="k">false</span><span class="p">)</span> <span class="p">{</span>
                    <span class="cp">?&gt;</span><span class="x"></span>

<span class="x">                    &lt;div class=row&gt;</span>
<span class="x">                </span><span class="cp">&lt;?php</span>
                    <span class="nv">$new_row</span> <span class="o">=</span> <span class="k">true</span><span class="p">;</span>
                <span class="p">}</span> <span class="cp">?&gt;</span><span class="x"></span>
<span class="x">                &lt;div class=col-sm-3&gt;</span>
</pre></div>
</div>
</div>
<div class="section" id="case-piwigo-structures-uselessbrackets">
<span id="id379"></span><h4><span class="section-number">5.2.252.2. </span>Piwigo<a class="headerlink" href="#case-piwigo-structures-uselessbrackets" title="Permalink to this headline">¶</a></h4>
<p><a class="reference internal" href="Rules.html#useless-brackets"><span class="std std-ref">Useless Brackets</span></a>, in picture.php:342.</p>
<p>There is no need for block braces with case. In fact, it does give a false sense of break, while the case will still fall over to the next one.</p>
<div class="highlight-php notranslate"><div class="highlight"><pre><span></span><span class="k">case</span> <span class="s1">&#39;rate&#39;</span> <span class="o">:</span>
    <span class="p">{</span>
      <span class="k">include_once</span><span class="p">(</span><span class="nx">PHPWG_ROOT_PATH</span><span class="o">.</span><span class="s1">&#39;include/functions_rate.inc.php&#39;</span><span class="p">);</span>
      <span class="nx">rate_picture</span><span class="p">(</span><span class="nv">$page</span><span class="p">[</span><span class="s1">&#39;image_id&#39;</span><span class="p">],</span> <span class="nv">$_POST</span><span class="p">[</span><span class="s1">&#39;rate&#39;</span><span class="p">]);</span>
      <span class="nx">redirect</span><span class="p">(</span><span class="nv">$url_self</span><span class="p">);</span>
    <span class="p">}</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="useless-type-casting">
<span id="case-useless-type-casting"></span><h3><span class="section-number">5.2.253. </span>Useless Type Casting<a class="headerlink" href="#useless-type-casting" title="Permalink to this headline">¶</a></h3>
<div class="section" id="case-fuelcms-structures-uselesscasting">
<span id="id380"></span><h4><span class="section-number">5.2.253.1. </span>FuelCMS<a class="headerlink" href="#case-fuelcms-structures-uselesscasting" title="Permalink to this headline">¶</a></h4>
<p><a class="reference internal" href="Rules.html#useless-type-casting"><span class="std std-ref">Useless Type Casting</span></a>, in fuel/codeigniter/core/URI.php:214.</p>
<p>substr() always returns a string, so there is no need to enforce this.</p>
<div class="highlight-php notranslate"><div class="highlight"><pre><span></span><span class="k">if</span> <span class="p">(</span><span class="nb">isset</span><span class="p">(</span><span class="nv">$_SERVER</span><span class="p">[</span><span class="s1">&#39;SCRIPT_NAME&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">]))</span>
            <span class="p">{</span>
                    <span class="k">if</span> <span class="p">(</span><span class="nb">strpos</span><span class="p">(</span><span class="nv">$uri</span><span class="p">,</span> <span class="nv">$_SERVER</span><span class="p">[</span><span class="s1">&#39;SCRIPT_NAME&#39;</span><span class="p">])</span> <span class="o">===</span> <span class="mi">0</span><span class="p">)</span>
                    <span class="p">{</span>
                            <span class="nv">$uri</span> <span class="o">=</span> <span class="p">(</span><span class="nx">string</span><span class="p">)</span> <span class="nb">substr</span><span class="p">(</span><span class="nv">$uri</span><span class="p">,</span> <span class="nb">strlen</span><span class="p">(</span><span class="nv">$_SERVER</span><span class="p">[</span><span class="s1">&#39;SCRIPT_NAME&#39;</span><span class="p">]));</span>
                    <span class="p">}</span>
                    <span class="k">elseif</span> <span class="p">(</span><span class="nb">strpos</span><span class="p">(</span><span class="nv">$uri</span><span class="p">,</span> <span class="nb">dirname</span><span class="p">(</span><span class="nv">$_SERVER</span><span class="p">[</span><span class="s1">&#39;SCRIPT_NAME&#39;</span><span class="p">]))</span> <span class="o">===</span> <span class="mi">0</span><span class="p">)</span>
                    <span class="p">{</span>
                            <span class="nv">$uri</span> <span class="o">=</span> <span class="p">(</span><span class="nx">string</span><span class="p">)</span> <span class="nb">substr</span><span class="p">(</span><span class="nv">$uri</span><span class="p">,</span> <span class="nb">strlen</span><span class="p">(</span><span class="nb">dirname</span><span class="p">(</span><span class="nv">$_SERVER</span><span class="p">[</span><span class="s1">&#39;SCRIPT_NAME&#39;</span><span class="p">])));</span>
                    <span class="p">}</span>
            <span class="p">}</span>
</pre></div>
</div>
</div>
<div class="section" id="case-thinkphp-structures-uselesscasting">
<span id="id381"></span><h4><span class="section-number">5.2.253.2. </span>ThinkPHP<a class="headerlink" href="#case-thinkphp-structures-uselesscasting" title="Permalink to this headline">¶</a></h4>
<p><a class="reference internal" href="Rules.html#useless-type-casting"><span class="std std-ref">Useless Type Casting</span></a>, in ThinkPHP/Library/Think/Db/Driver/Sqlsrv.class.php:67.</p>
<p>A comparison always returns a boolean, except for the spaceship operator.</p>
<div class="highlight-php notranslate"><div class="highlight"><pre><span></span><span class="k">foreach</span> <span class="p">(</span><span class="nv">$result</span> <span class="k">as</span> <span class="nv">$key</span> <span class="o">=&gt;</span> <span class="nv">$val</span><span class="p">)</span> <span class="p">{</span>
                <span class="nv">$info</span><span class="p">[</span><span class="nv">$val</span><span class="p">[</span><span class="s1">&#39;column_name&#39;</span><span class="p">]]</span> <span class="o">=</span> <span class="k">array</span><span class="p">(</span>
                    <span class="s1">&#39;name&#39;</span>    <span class="o">=&gt;</span> <span class="nv">$val</span><span class="p">[</span><span class="s1">&#39;column_name&#39;</span><span class="p">],</span>
                    <span class="s1">&#39;type&#39;</span>    <span class="o">=&gt;</span> <span class="nv">$val</span><span class="p">[</span><span class="s1">&#39;data_type&#39;</span><span class="p">],</span>
                    <span class="s1">&#39;notnull&#39;</span> <span class="o">=&gt;</span> <span class="p">(</span><span class="nx">bool</span><span class="p">)</span> <span class="p">(</span><span class="s1">&#39;&#39;</span> <span class="o">===</span> <span class="nv">$val</span><span class="p">[</span><span class="s1">&#39;is_nullable&#39;</span><span class="p">]),</span> <span class="c1">// not null is empty, null is yes</span>
                    <span class="s1">&#39;default&#39;</span> <span class="o">=&gt;</span> <span class="nv">$val</span><span class="p">[</span><span class="s1">&#39;column_default&#39;</span><span class="p">],</span>
                    <span class="s1">&#39;primary&#39;</span> <span class="o">=&gt;</span> <span class="k">false</span><span class="p">,</span>
                    <span class="s1">&#39;autoinc&#39;</span> <span class="o">=&gt;</span> <span class="k">false</span><span class="p">,</span>
                <span class="p">);</span>
            <span class="p">}</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="useless-check">
<span id="case-useless-check"></span><h3><span class="section-number">5.2.254. </span>Useless Check<a class="headerlink" href="#useless-check" title="Permalink to this headline">¶</a></h3>
<div class="section" id="case-magento-structures-uselesscheck">
<span id="id382"></span><h4><span class="section-number">5.2.254.1. </span>Magento<a class="headerlink" href="#case-magento-structures-uselesscheck" title="Permalink to this headline">¶</a></h4>
<p><a class="reference internal" href="Rules.html#useless-check"><span class="std std-ref">Useless Check</span></a>, in wp-admin/includes/misc.php:74.</p>
<p>This code assumes that $delete is an array, then checks if it empty. Foreach will take care of the empty check.</p>
<div class="highlight-php notranslate"><div class="highlight"><pre><span></span><span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="k">empty</span><span class="p">(</span><span class="nv">$delete</span><span class="p">))</span> <span class="p">{</span>
            <span class="k">foreach</span> <span class="p">(</span><span class="nv">$delete</span> <span class="k">as</span> <span class="nv">$categoryId</span><span class="p">)</span> <span class="p">{</span>
                <span class="nv">$where</span> <span class="o">=</span> <span class="k">array</span><span class="p">(</span>
                    <span class="s1">&#39;product_id = ?&#39;</span>  <span class="o">=&gt;</span> <span class="p">(</span><span class="nx">int</span><span class="p">)</span><span class="nv">$object</span><span class="o">-&gt;</span><span class="na">getId</span><span class="p">(),</span>
                    <span class="s1">&#39;category_id = ?&#39;</span> <span class="o">=&gt;</span> <span class="p">(</span><span class="nx">int</span><span class="p">)</span><span class="nv">$categoryId</span><span class="p">,</span>
                <span class="p">);</span>

                <span class="nv">$write</span><span class="o">-&gt;</span><span class="na">delete</span><span class="p">(</span><span class="nv">$this</span><span class="o">-&gt;</span><span class="na">_productCategoryTable</span><span class="p">,</span> <span class="nv">$where</span><span class="p">);</span>
            <span class="p">}</span>
        <span class="p">}</span>
</pre></div>
</div>
</div>
<div class="section" id="case-phinx-structures-uselesscheck">
<span id="id383"></span><h4><span class="section-number">5.2.254.2. </span>Phinx<a class="headerlink" href="#case-phinx-structures-uselesscheck" title="Permalink to this headline">¶</a></h4>
<p><a class="reference internal" href="Rules.html#useless-check"><span class="std std-ref">Useless Check</span></a>, in src/Phinx/Migration/Manager.php:828.</p>
<p>If $dependencies is not empty, foreach() skips the loops.</p>
<div class="highlight-php notranslate"><div class="highlight"><pre><span></span><span class="k">private</span> <span class="k">function</span> <span class="nf">getSeedDependenciesInstances</span><span class="p">(</span><span class="nx">AbstractSeed</span> <span class="nv">$seed</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="nv">$dependenciesInstances</span> <span class="o">=</span> <span class="p">[];</span>
        <span class="nv">$dependencies</span> <span class="o">=</span> <span class="nv">$seed</span><span class="o">-&gt;</span><span class="na">getDependencies</span><span class="p">();</span>
        <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="k">empty</span><span class="p">(</span><span class="nv">$dependencies</span><span class="p">))</span> <span class="p">{</span>
            <span class="k">foreach</span> <span class="p">(</span><span class="nv">$dependencies</span> <span class="k">as</span> <span class="nv">$dependency</span><span class="p">)</span> <span class="p">{</span>
                <span class="k">foreach</span> <span class="p">(</span><span class="nv">$this</span><span class="o">-&gt;</span><span class="na">seeds</span> <span class="k">as</span> <span class="nv">$seed</span><span class="p">)</span> <span class="p">{</span>
                    <span class="k">if</span> <span class="p">(</span><span class="nb">get_class</span><span class="p">(</span><span class="nv">$seed</span><span class="p">)</span> <span class="o">===</span> <span class="nv">$dependency</span><span class="p">)</span> <span class="p">{</span>
                        <span class="nv">$dependenciesInstances</span><span class="p">[</span><span class="nb">get_class</span><span class="p">(</span><span class="nv">$seed</span><span class="p">)]</span> <span class="o">=</span> <span class="nv">$seed</span><span class="p">;</span>
                    <span class="p">}</span>
                <span class="p">}</span>
            <span class="p">}</span>
        <span class="p">}</span>

        <span class="k">return</span> <span class="nv">$dependenciesInstances</span><span class="p">;</span>
    <span class="p">}</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="useless-global">
<span id="case-useless-global"></span><h3><span class="section-number">5.2.255. </span>Useless Global<a class="headerlink" href="#useless-global" title="Permalink to this headline">¶</a></h3>
<div class="section" id="case-zencart-structures-uselessglobal">
<span id="id384"></span><h4><span class="section-number">5.2.255.1. </span>Zencart<a class="headerlink" href="#case-zencart-structures-uselessglobal" title="Permalink to this headline">¶</a></h4>
<p><a class="reference internal" href="Rules.html#useless-global"><span class="std std-ref">Useless Global</span></a>, in admin/includes/modules/newsletters/newsletter.php:25.</p>
<p>$_GET is always a global variable. There is no need to declare it global in any scope.</p>
<div class="highlight-php notranslate"><div class="highlight"><pre><span></span><span class="k">function</span> <span class="nf">choose_audience</span><span class="p">()</span> <span class="p">{</span>
        <span class="k">global</span> <span class="nv">$_GET</span><span class="p">;</span>
</pre></div>
</div>
</div>
<div class="section" id="case-humo-gen-structures-uselessglobal">
<span id="id385"></span><h4><span class="section-number">5.2.255.2. </span>HuMo-Gen<a class="headerlink" href="#case-humo-gen-structures-uselessglobal" title="Permalink to this headline">¶</a></h4>
<p><a class="reference internal" href="Rules.html#useless-global"><span class="std std-ref">Useless Global</span></a>, in relations.php:332.</p>
<p>It is hard to spot that $generY is useless, but this is the only occurrence where $generY is refered to as a global. It is not accessed anywhere else as a global (there are occurrences of $generY being an argument), and it is not even assigned within that function.</p>
<div class="highlight-php notranslate"><div class="highlight"><pre><span></span><span class="k">function</span> <span class="nf">calculate_ancestor</span><span class="p">(</span><span class="nv">$pers</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">global</span> <span class="nv">$db_functions</span><span class="p">,</span> <span class="nv">$reltext</span><span class="p">,</span> <span class="nv">$sexe</span><span class="p">,</span> <span class="nv">$sexe2</span><span class="p">,</span> <span class="nv">$spouse</span><span class="p">,</span> <span class="nv">$special_spouseY</span><span class="p">,</span> <span class="nv">$language</span><span class="p">,</span> <span class="nv">$ancestortext</span><span class="p">,</span> <span class="nv">$dutchtext</span><span class="p">,</span> <span class="nv">$selected_language</span><span class="p">,</span> <span class="nv">$spantext</span><span class="p">,</span> <span class="nv">$generY</span><span class="p">,</span> <span class="nv">$foundY_nr</span><span class="p">,</span> <span class="nv">$rel_arrayY</span><span class="p">;</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="useless-parenthesis">
<span id="case-useless-parenthesis"></span><h3><span class="section-number">5.2.256. </span>Useless Parenthesis<a class="headerlink" href="#useless-parenthesis" title="Permalink to this headline">¶</a></h3>
<div class="section" id="case-mautic-structures-uselessparenthesis">
<span id="id386"></span><h4><span class="section-number">5.2.256.1. </span>Mautic<a class="headerlink" href="#case-mautic-structures-uselessparenthesis" title="Permalink to this headline">¶</a></h4>
<p><a class="reference internal" href="Rules.html#useless-parenthesis"><span class="std std-ref">Useless Parenthesis</span></a>, in code/app/bundles/EmailBundle/Controller/AjaxController.php:85.</p>
<p>Parenthesis are useless around $progress[1], and around the division too.</p>
<div class="highlight-php notranslate"><div class="highlight"><pre><span></span><span class="nv">$dataArray</span><span class="p">[</span><span class="s1">&#39;percent&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="nv">$progress</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span> <span class="o">?</span> <span class="nb">ceil</span><span class="p">((</span><span class="nv">$progress</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">/</span> <span class="nv">$progress</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span> <span class="o">*</span> <span class="mi">100</span><span class="p">)</span> <span class="o">:</span> <span class="mi">100</span><span class="p">;</span>
</pre></div>
</div>
</div>
<div class="section" id="case-woocommerce-structures-uselessparenthesis">
<span id="id387"></span><h4><span class="section-number">5.2.256.2. </span>Woocommerce<a class="headerlink" href="#case-woocommerce-structures-uselessparenthesis" title="Permalink to this headline">¶</a></h4>
<p><a class="reference internal" href="Rules.html#useless-parenthesis"><span class="std std-ref">Useless Parenthesis</span></a>, in includes/class-wc-coupon.php:437.</p>
<p>Parenthesis are useless for calculating $discount_percent, as it is a divisition. Moreover, it is not needed with $discount, (float) applies to the next element, but it does make the expression more readable.</p>
<div class="highlight-php notranslate"><div class="highlight"><pre><span></span><span class="k">if</span> <span class="p">(</span> <span class="nx">wc_prices_include_tax</span><span class="p">()</span> <span class="p">)</span> <span class="p">{</span>
    <span class="nv">$discount_percent</span> <span class="o">=</span> <span class="p">(</span> <span class="nx">wc_get_price_including_tax</span><span class="p">(</span> <span class="nv">$cart_item</span><span class="p">[</span><span class="s1">&#39;data&#39;</span><span class="p">]</span> <span class="p">)</span> <span class="o">*</span> <span class="nv">$cart_item_qty</span> <span class="p">)</span> <span class="o">/</span> <span class="nx">WC</span><span class="p">()</span><span class="o">-&gt;</span><span class="na">cart</span><span class="o">-&gt;</span><span class="na">subtotal</span><span class="p">;</span>
<span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
    <span class="nv">$discount_percent</span> <span class="o">=</span> <span class="p">(</span> <span class="nx">wc_get_price_excluding_tax</span><span class="p">(</span> <span class="nv">$cart_item</span><span class="p">[</span><span class="s1">&#39;data&#39;</span><span class="p">]</span> <span class="p">)</span> <span class="o">*</span> <span class="nv">$cart_item_qty</span> <span class="p">)</span> <span class="o">/</span> <span class="nx">WC</span><span class="p">()</span><span class="o">-&gt;</span><span class="na">cart</span><span class="o">-&gt;</span><span class="na">subtotal_ex_tax</span><span class="p">;</span>
<span class="p">}</span>
<span class="nv">$discount</span> <span class="o">=</span> <span class="p">(</span> <span class="p">(</span><span class="nx">float</span><span class="p">)</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">get_amount</span><span class="p">()</span> <span class="o">*</span> <span class="nv">$discount_percent</span> <span class="p">)</span> <span class="o">/</span> <span class="nv">$cart_item_qty</span><span class="p">;</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="useless-switch">
<span id="case-useless-switch"></span><h3><span class="section-number">5.2.257. </span>Useless Switch<a class="headerlink" href="#useless-switch" title="Permalink to this headline">¶</a></h3>
<div class="section" id="case-phpdocumentor-structures-uselessswitch">
<span id="id388"></span><h4><span class="section-number">5.2.257.1. </span>Phpdocumentor<a class="headerlink" href="#case-phpdocumentor-structures-uselessswitch" title="Permalink to this headline">¶</a></h4>
<p><a class="reference internal" href="Rules.html#useless-switch"><span class="std std-ref">Useless Switch</span></a>, in fuel/modules/fuel/libraries/Inspection.php:349.</p>
<p>This method parses comments. In fact, comments are represented by other tokens, which may be added or removed at time while coding.</p>
<div class="highlight-php notranslate"><div class="highlight"><pre><span></span><span class="k">public</span> <span class="k">function</span> <span class="nf">parse_comments</span><span class="p">(</span><span class="nv">$code</span><span class="p">)</span>
    <span class="p">{</span>
            <span class="nv">$comments</span> <span class="o">=</span> <span class="k">array</span><span class="p">();</span>
            <span class="nv">$tokens</span> <span class="o">=</span> <span class="nb">token_get_all</span><span class="p">(</span><span class="nv">$code</span><span class="p">);</span>

            <span class="k">foreach</span><span class="p">(</span><span class="nv">$tokens</span> <span class="k">as</span> <span class="nv">$token</span><span class="p">)</span>
            <span class="p">{</span>
                    <span class="k">switch</span><span class="p">(</span><span class="nv">$token</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
                    <span class="p">{</span>
                            <span class="k">case</span> <span class="nx">T_DOC_COMMENT</span><span class="o">:</span>
                                    <span class="nv">$comments</span><span class="p">[]</span> <span class="o">=</span> <span class="nv">$token</span><span class="p">[</span><span class="mi">1</span><span class="p">];</span>
                                    <span class="k">break</span><span class="p">;</span>
                <span class="p">}</span>
            <span class="p">}</span>
            <span class="k">return</span> <span class="nv">$comments</span><span class="p">;</span>

    <span class="p">}</span>
</pre></div>
</div>
</div>
<div class="section" id="case-dolphin-structures-uselessswitch">
<span id="id389"></span><h4><span class="section-number">5.2.257.2. </span>Dolphin<a class="headerlink" href="#case-dolphin-structures-uselessswitch" title="Permalink to this headline">¶</a></h4>
<p><a class="reference internal" href="Rules.html#useless-switch"><span class="std std-ref">Useless Switch</span></a>, in Dolphin-v.7.3.5/inc/classes/BxDolModuleDb.php:34.</p>
<p>$aParams is an argument : this code looks like the switch is reserved for future use.</p>
<div class="highlight-php notranslate"><div class="highlight"><pre><span></span><span class="k">function</span> <span class="nf">getModulesBy</span><span class="p">(</span><span class="nv">$aParams</span> <span class="o">=</span> <span class="k">array</span><span class="p">())</span>
    <span class="p">{</span>
            <span class="nv">$sMethod</span> <span class="o">=</span> <span class="s1">&#39;getAll&#39;</span><span class="p">;</span>
        <span class="nv">$sPostfix</span> <span class="o">=</span> <span class="nv">$sWhereClause</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span><span class="p">;</span>

        <span class="nv">$sOrderClause</span> <span class="o">=</span> <span class="s2">&quot;ORDER BY `title`&quot;</span><span class="p">;</span>
        <span class="k">switch</span><span class="p">(</span><span class="nv">$aParams</span><span class="p">[</span><span class="s1">&#39;type&#39;</span><span class="p">])</span> <span class="p">{</span>
            <span class="k">case</span> <span class="s1">&#39;path&#39;</span><span class="o">:</span>
                    <span class="nv">$sMethod</span> <span class="o">=</span> <span class="s1">&#39;getRow&#39;</span><span class="p">;</span>
                <span class="nv">$sPostfix</span> <span class="o">.=</span> <span class="s1">&#39;_path&#39;</span><span class="p">;</span>
                <span class="nv">$sWhereClause</span> <span class="o">.=</span> <span class="s2">&quot;AND `path`=&#39;&quot;</span> <span class="o">.</span> <span class="nv">$aParams</span><span class="p">[</span><span class="s1">&#39;value&#39;</span><span class="p">]</span> <span class="o">.</span> <span class="s2">&quot;&#39;&quot;</span><span class="p">;</span>
                <span class="k">break</span><span class="p">;</span>
        <span class="p">}</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="useless-unset">
<span id="case-useless-unset"></span><h3><span class="section-number">5.2.258. </span>Useless Unset<a class="headerlink" href="#useless-unset" title="Permalink to this headline">¶</a></h3>
<div class="section" id="case-tine20-structures-uselessunset">
<span id="id390"></span><h4><span class="section-number">5.2.258.1. </span>Tine20<a class="headerlink" href="#case-tine20-structures-uselessunset" title="Permalink to this headline">¶</a></h4>
<p><a class="reference internal" href="Rules.html#useless-unset"><span class="std std-ref">Useless Unset</span></a>, in tine20/Felamimail/Controller/Message.php:542.</p>
<p>$_rawContent is unset after being sent to the stream. The variable is a parameter, and will be freed at the end of the call of the method. No need to do it explicitly.</p>
<div class="highlight-php notranslate"><div class="highlight"><pre><span></span><span class="k">protected</span> <span class="k">function</span> <span class="nf">_createMimePart</span><span class="p">(</span><span class="nv">$_rawContent</span><span class="p">,</span> <span class="nv">$_partStructure</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="k">if</span> <span class="p">(</span><span class="nx">Tinebase_Core</span><span class="o">::</span><span class="na">isLogLevel</span><span class="p">(</span><span class="nx">Zend_Log</span><span class="o">::</span><span class="na">TRACE</span><span class="p">))</span> <span class="nx">Tinebase_Core</span><span class="o">::</span><span class="na">getLogger</span><span class="p">()</span><span class="o">-&gt;</span><span class="na">trace</span><span class="p">(</span><span class="no">__METHOD__</span> <span class="o">.</span> <span class="s1">&#39;::&#39;</span> <span class="o">.</span> <span class="no">__LINE__</span> <span class="o">.</span> <span class="s1">&#39; Content: &#39;</span> <span class="o">.</span> <span class="nv">$_rawContent</span><span class="p">);</span>

        <span class="nv">$stream</span> <span class="o">=</span> <span class="nb">fopen</span><span class="p">(</span><span class="nx">php</span><span class="o">://</span><span class="nx">temp</span><span class="p">,</span> <span class="s1">&#39;r+&#39;</span><span class="p">);</span>
        <span class="nb">fputs</span><span class="p">(</span><span class="nv">$stream</span><span class="p">,</span> <span class="nv">$_rawContent</span><span class="p">);</span>
        <span class="nb">rewind</span><span class="p">(</span><span class="nv">$stream</span><span class="p">);</span>

        <span class="nb">unset</span><span class="p">(</span><span class="nv">$_rawContent</span><span class="p">);</span>
        <span class="c1">//..... More code, no usage of $_rawContent</span>
    <span class="p">}</span>
</pre></div>
</div>
</div>
<div class="section" id="case-typo3-structures-uselessunset">
<span id="id391"></span><h4><span class="section-number">5.2.258.2. </span>Typo3<a class="headerlink" href="#case-typo3-structures-uselessunset" title="Permalink to this headline">¶</a></h4>
<p><a class="reference internal" href="Rules.html#useless-unset"><span class="std std-ref">Useless Unset</span></a>, in typo3/sysext/frontend/Classes/Page/PageRepository.php:708.</p>
<p>$row is unset under certain conditions : here, we can read it in the comments. Eventually, the $row will be returned, and turned into a NULL, by default. This will also create a notice in the logs. Here, the best would be to set a null value, instead of unsetting the variable.</p>
<div class="highlight-php notranslate"><div class="highlight"><pre><span></span><span class="k">public</span> <span class="k">function</span> <span class="nf">getRecordOverlay</span><span class="p">(</span><span class="nv">$table</span><span class="p">,</span> <span class="nv">$row</span><span class="p">,</span> <span class="nv">$sys_language_content</span><span class="p">,</span> <span class="nv">$OLmode</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span><span class="p">)</span>
    <span class="p">{</span>
<span class="c1">//....  a lot more code, with usage of $row, and several unset($row)</span>
<span class="c1">//...... Reduced for simplicity</span>
                    <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
                        <span class="c1">// When default language is displayed, we never want to return a record carrying</span>
                        <span class="c1">// another language!</span>
                        <span class="k">if</span> <span class="p">(</span><span class="nv">$row</span><span class="p">[</span><span class="nv">$GLOBALS</span><span class="p">[</span><span class="s1">&#39;TCA&#39;</span><span class="p">][</span><span class="nv">$table</span><span class="p">][</span><span class="s1">&#39;ctrl&#39;</span><span class="p">][</span><span class="s1">&#39;languageField&#39;</span><span class="p">]]</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
                            <span class="nb">unset</span><span class="p">(</span><span class="nv">$row</span><span class="p">);</span>
                        <span class="p">}</span>
                    <span class="p">}</span>
                <span class="p">}</span>
            <span class="p">}</span>
        <span class="p">}</span>
        <span class="k">foreach</span> <span class="p">(</span><span class="nv">$GLOBALS</span><span class="p">[</span><span class="s1">&#39;TYPO3_CONF_VARS&#39;</span><span class="p">][</span><span class="s1">&#39;SC_OPTIONS&#39;</span><span class="p">][</span><span class="s1">&#39;t3lib/class.t3lib_page.php&#39;</span><span class="p">][</span><span class="s1">&#39;getRecordOverlay&#39;</span><span class="p">]</span> <span class="o">??</span> <span class="p">[]</span> <span class="k">as</span> <span class="nv">$className</span><span class="p">)</span> <span class="p">{</span>
            <span class="nv">$hookObject</span> <span class="o">=</span> <span class="nx">GeneralUtility</span><span class="o">::</span><span class="na">makeInstance</span><span class="p">(</span><span class="nv">$className</span><span class="p">);</span>
            <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nv">$hookObject</span> <span class="nx">instanceof</span> <span class="nx">PageRepositoryGetRecordOverlayHookInterface</span><span class="p">)</span> <span class="p">{</span>
                <span class="k">throw</span> <span class="k">new</span> <span class="nx">\UnexpectedValueException</span><span class="p">(</span><span class="nv">$className</span> <span class="o">.</span> <span class="s1">&#39; must implement interface &#39;</span> <span class="o">.</span> <span class="nx">PageRepositoryGetRecordOverlayHookInterface</span><span class="o">::</span><span class="na">class</span><span class="p">,</span> <span class="mi">1269881659</span><span class="p">);</span>
            <span class="p">}</span>
            <span class="nv">$hookObject</span><span class="o">-&gt;</span><span class="na">getRecordOverlay_postProcess</span><span class="p">(</span><span class="nv">$table</span><span class="p">,</span> <span class="nv">$row</span><span class="p">,</span> <span class="nv">$sys_language_content</span><span class="p">,</span> <span class="nv">$OLmode</span><span class="p">,</span> <span class="nv">$this</span><span class="p">);</span>
        <span class="p">}</span>
        <span class="k">return</span> <span class="nv">$row</span><span class="p">;</span>
    <span class="p">}</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="var-dump-usage">
<span id="case-var-dump-usage"></span><h3><span class="section-number">5.2.259. </span>var_dump()… Usage<a class="headerlink" href="#var-dump-usage" title="Permalink to this headline">¶</a></h3>
<div class="section" id="case-tine20-structures-vardumpusage">
<span id="id392"></span><h4><span class="section-number">5.2.259.1. </span>Tine20<a class="headerlink" href="#case-tine20-structures-vardumpusage" title="Permalink to this headline">¶</a></h4>
<p><a class="reference internal" href="Rules.html#var-dump-usage"><span class="std std-ref">var_dump()… Usage</span></a>, in tine20/library/Ajam/Connection.php:122.</p>
<p>Two usage of var_dump(). They are protected by configuration, since the debug property must be set to ‘true’. Yet, it is safer to avoid them altogether, and log the information to an external file.</p>
<div class="highlight-php notranslate"><div class="highlight"><pre><span></span><span class="k">if</span><span class="p">(</span><span class="nv">$this</span><span class="o">-&gt;</span><span class="na">debug</span> <span class="o">===</span> <span class="k">true</span><span class="p">)</span> <span class="p">{</span>
            <span class="nb">var_dump</span><span class="p">(</span><span class="nv">$this</span><span class="o">-&gt;</span><span class="na">getLastRequest</span><span class="p">());</span>
            <span class="nb">var_dump</span><span class="p">(</span><span class="nv">$response</span><span class="p">);</span>
        <span class="p">}</span>
</pre></div>
</div>
</div>
<div class="section" id="case-piwigo-structures-vardumpusage">
<span id="id393"></span><h4><span class="section-number">5.2.259.2. </span>Piwigo<a class="headerlink" href="#case-piwigo-structures-vardumpusage" title="Permalink to this headline">¶</a></h4>
<p><a class="reference internal" href="Rules.html#var-dump-usage"><span class="std std-ref">var_dump()… Usage</span></a>, in include/ws_core.inc.php:273.</p>
<p>This is a hidden debug system : when the response format is not available, the whole object is dumped in the output.</p>
<div class="highlight-php notranslate"><div class="highlight"><pre><span></span><span class="k">function</span> <span class="nf">run</span><span class="p">()</span>
  <span class="p">{</span>
    <span class="k">if</span> <span class="p">(</span> <span class="nb">is_null</span><span class="p">(</span><span class="nv">$this</span><span class="o">-&gt;</span><span class="na">_responseEncoder</span><span class="p">)</span> <span class="p">)</span>
    <span class="p">{</span>
      <span class="nx">set_status_header</span><span class="p">(</span><span class="mi">400</span><span class="p">);</span>
      <span class="o">@</span><span class="nb">header</span><span class="p">(</span><span class="s2">&quot;Content-Type: text/plain&quot;</span><span class="p">);</span>
      <span class="k">echo</span> <span class="p">(</span><span class="s2">&quot;Cannot process your request. Unknown response format.</span>
<span class="s2">Request format: &quot;</span><span class="o">.@</span><span class="nv">$this</span><span class="o">-&gt;</span><span class="na">_requestFormat</span><span class="o">.</span><span class="s2">&quot; Response format: &quot;</span><span class="o">.@</span><span class="nv">$this</span><span class="o">-&gt;</span><span class="na">_responseFormat</span><span class="o">.</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">);</span>
      <span class="nb">var_export</span><span class="p">(</span><span class="nv">$this</span><span class="p">);</span>
      <span class="k">die</span><span class="p">(</span><span class="mi">0</span><span class="p">);</span>
    <span class="p">}</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="while-list-each">
<span id="case-while-list-each"></span><h3><span class="section-number">5.2.260. </span>While(List() = Each())<a class="headerlink" href="#while-list-each" title="Permalink to this headline">¶</a></h3>
<div class="section" id="case-openemr-structures-whilelisteach">
<span id="id394"></span><h4><span class="section-number">5.2.260.1. </span>OpenEMR<a class="headerlink" href="#case-openemr-structures-whilelisteach" title="Permalink to this headline">¶</a></h4>
<p><a class="reference internal" href="Rules.html#while-list-each"><span class="std std-ref">While(List() = Each())</span></a>, in library/report.inc:153.</p>
<p>The first while() is needed, to read the arbitrary long list returned by the SQL query. The second list may be upgraded with a foreach, to read both the key and the value. This is certainly faster to execute and to read.</p>
<div class="highlight-php notranslate"><div class="highlight"><pre><span></span><span class="k">function</span> <span class="nf">getInsuranceReport</span><span class="p">(</span><span class="nv">$pid</span><span class="p">,</span> <span class="nv">$type</span> <span class="o">=</span> <span class="nx">primary</span><span class="p">)</span>
<span class="p">{</span>
    <span class="nv">$sql</span> <span class="o">=</span> <span class="nx">select</span> <span class="o">*</span> <span class="nx">from</span> <span class="nx">insurance_data</span> <span class="nx">where</span> <span class="nx">pid</span><span class="o">=?</span> <span class="k">and</span> <span class="nx">type</span><span class="o">=?</span> <span class="nx">order</span> <span class="nx">by</span> <span class="nb">date</span> <span class="nx">ASC</span><span class="p">;</span>
    <span class="nv">$res</span> <span class="o">=</span> <span class="nx">sqlStatement</span><span class="p">(</span><span class="nv">$sql</span><span class="p">,</span> <span class="k">array</span><span class="p">(</span><span class="nv">$pid</span><span class="p">,</span> <span class="nv">$type</span><span class="p">));</span>
    <span class="k">while</span> <span class="p">(</span><span class="nv">$list</span> <span class="o">=</span> <span class="nx">sqlFetchArray</span><span class="p">(</span><span class="nv">$res</span><span class="p">))</span> <span class="p">{</span>
        <span class="k">while</span> <span class="p">(</span><span class="k">list</span><span class="p">(</span><span class="nv">$key</span><span class="p">,</span> <span class="nv">$value</span><span class="p">)</span> <span class="o">=</span> <span class="nb">each</span><span class="p">(</span><span class="nv">$list</span><span class="p">))</span> <span class="p">{</span>
            <span class="k">if</span> <span class="p">(</span><span class="nv">$ret</span><span class="p">[</span><span class="nv">$key</span><span class="p">][</span><span class="s1">&#39;content&#39;</span><span class="p">]</span> <span class="o">!=</span> <span class="nv">$value</span> <span class="o">&amp;&amp;</span> <span class="nv">$ret</span><span class="p">[</span><span class="nv">$key</span><span class="p">][</span><span class="s1">&#39;date&#39;</span><span class="p">]</span> <span class="o">&lt;</span> <span class="nv">$list</span><span class="p">[</span><span class="s1">&#39;date&#39;</span><span class="p">])</span> <span class="p">{</span>
                <span class="nv">$ret</span><span class="p">[</span><span class="nv">$key</span><span class="p">][</span><span class="s1">&#39;content&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="nv">$value</span><span class="p">;</span>
                <span class="nv">$ret</span><span class="p">[</span><span class="nv">$key</span><span class="p">][</span><span class="s1">&#39;date&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="nv">$list</span><span class="p">[</span><span class="s1">&#39;date&#39;</span><span class="p">];</span>
            <span class="p">}</span>
        <span class="p">}</span>
    <span class="p">}</span>

    <span class="k">return</span> <span class="nv">$ret</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>
</div>
</div>
<div class="section" id="case-dolphin-structures-whilelisteach">
<span id="id395"></span><h4><span class="section-number">5.2.260.2. </span>Dolphin<a class="headerlink" href="#case-dolphin-structures-whilelisteach" title="Permalink to this headline">¶</a></h4>
<p><a class="reference internal" href="Rules.html#while-list-each"><span class="std std-ref">While(List() = Each())</span></a>, in Dolphin-v.7.3.5/modules/boonex/forum/classes/Forum.php:1875.</p>
<p>This clever use of while() and list() is actually a foreach($a as $r) (the keys are ignored)</p>
<div class="highlight-php notranslate"><div class="highlight"><pre><span></span><span class="k">function</span> <span class="nf">getRssUpdatedTopics</span> <span class="p">()</span>
    <span class="p">{</span>
        <span class="k">global</span> <span class="nv">$gConf</span><span class="p">;</span>

        <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">_rssPrepareConf</span> <span class="p">();</span>

        <span class="nv">$a</span> <span class="o">=</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">fdb</span><span class="o">-&gt;</span><span class="na">getRecentTopics</span> <span class="p">(</span><span class="mi">0</span><span class="p">);</span>

        <span class="nv">$items</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span><span class="p">;</span>
        <span class="nv">$lastBuildDate</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span><span class="p">;</span>
        <span class="nv">$ui</span> <span class="o">=</span> <span class="k">array</span><span class="p">();</span>
        <span class="nb">reset</span> <span class="p">(</span><span class="nv">$a</span><span class="p">);</span>
        <span class="k">while</span> <span class="p">(</span> <span class="k">list</span> <span class="p">(,</span><span class="nv">$r</span><span class="p">)</span> <span class="o">=</span> <span class="nb">each</span> <span class="p">(</span><span class="nv">$a</span><span class="p">)</span> <span class="p">)</span> <span class="p">{</span>
            <span class="c1">// acquire user info</span>
            <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nb">isset</span><span class="p">(</span><span class="nv">$ui</span><span class="p">[</span><span class="nv">$r</span><span class="p">[</span><span class="s1">&#39;last_post_user&#39;</span><span class="p">]])</span> <span class="o">&amp;&amp;</span> <span class="p">(</span><span class="nv">$aa</span> <span class="o">=</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">_getUserInfoReadyArray</span> <span class="p">(</span><span class="nv">$r</span><span class="p">[</span><span class="s1">&#39;last_post_user&#39;</span><span class="p">],</span> <span class="k">false</span><span class="p">)))</span>
                <span class="nv">$ui</span><span class="p">[</span><span class="nv">$r</span><span class="p">[</span><span class="s1">&#39;last_post_user&#39;</span><span class="p">]]</span> <span class="o">=</span> <span class="nv">$aa</span><span class="p">;</span>

            <span class="nv">$td</span> <span class="o">=</span> <span class="nx">orca_mb_replace</span><span class="p">(</span><span class="s1">&#39;/#/&#39;</span><span class="p">,</span> <span class="nv">$r</span><span class="p">[</span><span class="s1">&#39;count_posts&#39;</span><span class="p">],</span> <span class="s1">&#39;[L[# posts]]&#39;</span><span class="p">)</span> <span class="o">.</span> <span class="s1">&#39; &amp;#183; &#39;</span> <span class="o">.</span> <span class="nx">orca_mb_replace</span><span class="p">(</span><span class="s1">&#39;/#/&#39;</span><span class="p">,</span> <span class="nv">$ui</span><span class="p">[</span><span class="nv">$r</span><span class="p">[</span><span class="s1">&#39;last_post_user&#39;</span><span class="p">]][</span><span class="s1">&#39;title&#39;</span><span class="p">],</span> <span class="s1">&#39;[L[last reply by #]]&#39;</span><span class="p">)</span> <span class="o">.</span> <span class="s1">&#39; &amp;#183; &#39;</span> <span class="o">.</span> <span class="nv">$r</span><span class="p">[</span><span class="s1">&#39;cat_name&#39;</span><span class="p">]</span> <span class="o">.</span> <span class="s1">&#39; &amp;#187; &#39;</span> <span class="o">.</span> <span class="nv">$r</span><span class="p">[</span><span class="s1">&#39;forum_title&#39;</span><span class="p">];</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="wrong-range-check">
<span id="case-wrong-range-check"></span><h3><span class="section-number">5.2.261. </span>Wrong Range Check<a class="headerlink" href="#wrong-range-check" title="Permalink to this headline">¶</a></h3>
<div class="section" id="case-dolibarr-structures-wrongrange">
<span id="id396"></span><h4><span class="section-number">5.2.261.1. </span>Dolibarr<a class="headerlink" href="#case-dolibarr-structures-wrongrange" title="Permalink to this headline">¶</a></h4>
<p><a class="reference internal" href="Rules.html#wrong-range-check"><span class="std std-ref">Wrong Range Check</span></a>, in htdocs/includes/phpoffice/PhpSpreadsheet/Spreadsheet.php:1484.</p>
<p>When $tabRatio is 1001, then the condition is valid, and the ratio accepted. The right part of the condition is not executed.</p>
<div class="highlight-php notranslate"><div class="highlight"><pre><span></span><span class="k">public</span> <span class="k">function</span> <span class="nf">setTabRatio</span><span class="p">(</span><span class="nv">$tabRatio</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="k">if</span> <span class="p">(</span><span class="nv">$tabRatio</span> <span class="o">&gt;=</span> <span class="mi">0</span> <span class="o">||</span> <span class="nv">$tabRatio</span> <span class="o">&lt;=</span> <span class="mi">1000</span><span class="p">)</span> <span class="p">{</span>
            <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">tabRatio</span> <span class="o">=</span> <span class="p">(</span><span class="nx">int</span><span class="p">)</span> <span class="nv">$tabRatio</span><span class="p">;</span>
        <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
            <span class="k">throw</span> <span class="k">new</span> <span class="nx">Exception</span><span class="p">(</span><span class="s1">&#39;Tab ratio must be between 0 and 1000.&#39;</span><span class="p">);</span>
        <span class="p">}</span>
    <span class="p">}</span>
</pre></div>
</div>
</div>
<div class="section" id="case-wordpress-structures-wrongrange">
<span id="id397"></span><h4><span class="section-number">5.2.261.2. </span>WordPress<a class="headerlink" href="#case-wordpress-structures-wrongrange" title="Permalink to this headline">¶</a></h4>
<p><a class="reference internal" href="Rules.html#wrong-range-check"><span class="std std-ref">Wrong Range Check</span></a>, in wp-includes/formatting.php:3634.</p>
<p>This condition may be easier to read as <cite>$diff &gt;= WEEK_IN_SECONDS &amp;&amp; $diff &lt; MONTH_IN_SECONDS</cite>. When testing for outside this interval, using not is also more readable : <cite>!($diff &gt;= WEEK_IN_SECONDS &amp;&amp; $diff &lt; MONTH_IN_SECONDS)</cite>.</p>
<div class="highlight-php notranslate"><div class="highlight"><pre><span></span><span class="p">}</span> <span class="k">elseif</span> <span class="p">(</span> <span class="nv">$diff</span> <span class="o">&lt;</span> <span class="nx">MONTH_IN_SECONDS</span> <span class="o">&amp;&amp;</span> <span class="nv">$diff</span> <span class="o">&gt;=</span> <span class="nx">WEEK_IN_SECONDS</span> <span class="p">)</span> <span class="p">{</span>
            <span class="nv">$weeks</span> <span class="o">=</span> <span class="nb">round</span><span class="p">(</span> <span class="nv">$diff</span> <span class="o">/</span> <span class="nx">WEEK_IN_SECONDS</span> <span class="p">);</span>
            <span class="k">if</span> <span class="p">(</span> <span class="nv">$weeks</span> <span class="o">&lt;=</span> <span class="mi">1</span> <span class="p">)</span> <span class="p">{</span>
                    <span class="nv">$weeks</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>
            <span class="p">}</span>
            <span class="cm">/* translators: Time difference between two dates, in weeks. %s: Number of weeks */</span>
            <span class="nv">$since</span> <span class="o">=</span> <span class="nb">sprintf</span><span class="p">(</span> <span class="nx">_n</span><span class="p">(</span> <span class="s1">&#39;%s week&#39;</span><span class="p">,</span> <span class="s1">&#39;%s weeks&#39;</span><span class="p">,</span> <span class="nv">$weeks</span> <span class="p">),</span> <span class="nv">$weeks</span> <span class="p">);</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="preg-replace-with-option-e">
<span id="case-preg-replace-with-option-e"></span><h3><span class="section-number">5.2.262. </span>preg_replace With Option e<a class="headerlink" href="#preg-replace-with-option-e" title="Permalink to this headline">¶</a></h3>
<div class="section" id="case-edusoho-structures-pregoptione">
<span id="id398"></span><h4><span class="section-number">5.2.262.1. </span>Edusoho<a class="headerlink" href="#case-edusoho-structures-pregoptione" title="Permalink to this headline">¶</a></h4>
<p><a class="reference internal" href="Rules.html#preg-replace-with-option-e"><span class="std std-ref">preg_replace With Option e</span></a>, in vendor_user/uc_client/lib/uccode.class.php:32.</p>
<p>This call extract text between [code] tags, then process it with $this-&gt;codedisp() and nest it again in the original string. preg_replace_callback() is a drop-in replacement for this piece of code.</p>
<div class="highlight-php notranslate"><div class="highlight"><pre><span></span><span class="nv">$message</span> <span class="o">=</span> <span class="nb">preg_replace</span><span class="p">(</span><span class="s2">&quot;/\s*\[code\](.+?)\[\/code\]\s*/ies&quot;</span><span class="p">,</span> <span class="s2">&quot;</span><span class="si">$this-&gt;codedisp</span><span class="s2">(&#39;</span><span class="se">\1</span><span class="s2">&#39;)&quot;</span><span class="p">,</span> <span class="nv">$message</span><span class="p">);</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="dependant-trait">
<span id="case-dependant-trait"></span><h3><span class="section-number">5.2.263. </span>Dependant Trait<a class="headerlink" href="#dependant-trait" title="Permalink to this headline">¶</a></h3>
<div class="section" id="case-zencart-traits-dependanttrait">
<span id="id399"></span><h4><span class="section-number">5.2.263.1. </span>Zencart<a class="headerlink" href="#case-zencart-traits-dependanttrait" title="Permalink to this headline">¶</a></h4>
<p><a class="reference internal" href="Rules.html#dependant-trait"><span class="std std-ref">Dependant Trait</span></a>, in app/library/zencart/CheckoutFlow/src/AccountFormValidator.php:14.</p>
<p>Note that addressEntries is used, and is also expected to be an array or an object with ArrayAccess. $addressEntries is only defined in a class called ‘Guest’ which is also the only one using that trait. Any other class using the AccountFormValidator trait must define addressEntries.</p>
<div class="highlight-php notranslate"><div class="highlight"><pre><span></span><span class="k">trait</span> <span class="nx">AccountFormValidator</span>
<span class="p">{</span>

    <span class="k">abstract</span> <span class="k">protected</span> <span class="k">function</span> <span class="nf">getAddressFieldValue</span><span class="p">(</span><span class="nv">$fieldName</span><span class="p">);</span>

    <span class="sd">/**</span>
<span class="sd">     * @return bool|int</span>
<span class="sd">     */</span>
    <span class="k">protected</span> <span class="k">function</span> <span class="nf">errorProcessing</span><span class="p">()</span>
    <span class="p">{</span>
        <span class="nv">$error</span> <span class="o">=</span> <span class="k">false</span><span class="p">;</span>
        <span class="k">foreach</span> <span class="p">(</span><span class="nv">$this</span><span class="o">-&gt;</span><span class="na">addressEntries</span> <span class="k">as</span> <span class="nv">$fieldName</span> <span class="o">=&gt;</span> <span class="nv">$fieldDetails</span><span class="p">)</span> <span class="p">{</span>
            <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">addressEntries</span><span class="p">[</span><span class="nv">$fieldName</span><span class="p">][</span><span class="s1">&#39;value&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">getAddressFieldValue</span><span class="p">(</span><span class="nv">$fieldName</span><span class="p">);</span>
            <span class="nv">$fieldError</span> <span class="o">=</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">processFieldValidator</span><span class="p">(</span><span class="nv">$fieldName</span><span class="p">,</span> <span class="nv">$fieldDetails</span><span class="p">);</span>
            <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">addressEntries</span><span class="p">[</span><span class="nv">$fieldName</span><span class="p">][</span><span class="s1">&#39;error&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="nv">$fieldError</span><span class="p">;</span>
            <span class="nv">$error</span> <span class="o">=</span> <span class="nv">$error</span> <span class="o">|</span> <span class="nv">$fieldError</span><span class="p">;</span>
        <span class="p">}</span>
        <span class="k">return</span> <span class="nv">$error</span><span class="p">;</span>
    <span class="p">}</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="multiple-usage-of-same-trait">
<span id="case-multiple-usage-of-same-trait"></span><h3><span class="section-number">5.2.264. </span>Multiple Usage Of Same Trait<a class="headerlink" href="#multiple-usage-of-same-trait" title="Permalink to this headline">¶</a></h3>
<div class="section" id="case-nextcloud-traits-multipleusage">
<span id="id400"></span><h4><span class="section-number">5.2.264.1. </span>NextCloud<a class="headerlink" href="#case-nextcloud-traits-multipleusage" title="Permalink to this headline">¶</a></h4>
<p><a class="reference internal" href="Rules.html#multiple-usage-of-same-trait"><span class="std std-ref">Multiple Usage Of Same Trait</span></a>, in build/integration/features/bootstrap/WebDav.php:41.</p>
<p>WebDav uses Sharing, and Sharing uses Webdav. Once using the other is sufficient.</p>
<div class="highlight-php notranslate"><div class="highlight"><pre><span></span><span class="k">trait</span> <span class="nx">WebDav</span> <span class="p">{</span>
    <span class="k">use</span> <span class="nx">Sharing</span><span class="p">;</span>

<span class="p">}</span>
<span class="c1">//Trait Sharing is in /build/integration/features/bootstrap/Sharing.php:36</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="no-real-comparison">
<span id="case-no-real-comparison"></span><h3><span class="section-number">5.2.265. </span>No Real Comparison<a class="headerlink" href="#no-real-comparison" title="Permalink to this headline">¶</a></h3>
<div class="section" id="case-magento-type-norealcomparison">
<span id="id401"></span><h4><span class="section-number">5.2.265.1. </span>Magento<a class="headerlink" href="#case-magento-type-norealcomparison" title="Permalink to this headline">¶</a></h4>
<p><a class="reference internal" href="Rules.html#no-real-comparison"><span class="std std-ref">No Real Comparison</span></a>, in app/code/core/Mage/XmlConnect/Block/Catalog/Product/Options/Configurable.php:74.</p>
<p>Compare prices and physical quantities with a difference, so as to avoid rounding errors.</p>
<div class="highlight-php notranslate"><div class="highlight"><pre><span></span><span class="k">if</span> <span class="p">((</span><span class="nx">float</span><span class="p">)</span><span class="nv">$option</span><span class="p">[</span><span class="s1">&#39;price&#39;</span><span class="p">]</span> <span class="o">!=</span> <span class="mf">0.00</span><span class="p">)</span> <span class="p">{</span>
                        <span class="nv">$valueNode</span><span class="o">-&gt;</span><span class="na">addAttribute</span><span class="p">(</span><span class="s1">&#39;price&#39;</span><span class="p">,</span> <span class="nv">$option</span><span class="p">[</span><span class="s1">&#39;price&#39;</span><span class="p">]);</span>
                        <span class="nv">$valueNode</span><span class="o">-&gt;</span><span class="na">addAttribute</span><span class="p">(</span><span class="s1">&#39;formated_price&#39;</span><span class="p">,</span> <span class="nv">$option</span><span class="p">[</span><span class="s1">&#39;formated_price&#39;</span><span class="p">]);</span>
                    <span class="p">}</span>
</pre></div>
</div>
</div>
<div class="section" id="case-spip-type-norealcomparison">
<span id="id402"></span><h4><span class="section-number">5.2.265.2. </span>SPIP<a class="headerlink" href="#case-spip-type-norealcomparison" title="Permalink to this headline">¶</a></h4>
<p><a class="reference internal" href="Rules.html#no-real-comparison"><span class="std std-ref">No Real Comparison</span></a>, in ecrire/maj/v017.php:37.</p>
<p>Here, the current version number is stored as a real number. With a string, though a longer value, it may be compared using the version_compare() function.</p>
<div class="highlight-php notranslate"><div class="highlight"><pre><span></span><span class="nv">$version_installee</span> <span class="o">==</span> <span class="mf">1.701</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="one-variable-string">
<span id="case-one-variable-string"></span><h3><span class="section-number">5.2.266. </span>One Variable String<a class="headerlink" href="#one-variable-string" title="Permalink to this headline">¶</a></h3>
<div class="section" id="case-tikiwiki-type-onevariablestrings">
<span id="id403"></span><h4><span class="section-number">5.2.266.1. </span>Tikiwiki<a class="headerlink" href="#case-tikiwiki-type-onevariablestrings" title="Permalink to this headline">¶</a></h4>
<p><a class="reference internal" href="Rules.html#one-variable-string"><span class="std std-ref">One Variable String</span></a>, in lib/wiki-plugins/wikiplugin_addtocart.php:228.</p>
<p>Double-quotes are not needed here. If casting to string is important, the (string) would be more explicit.</p>
<div class="highlight-php notranslate"><div class="highlight"><pre><span></span><span class="k">foreach</span> <span class="p">(</span><span class="nv">$plugininfo</span><span class="p">[</span><span class="s1">&#39;params&#39;</span><span class="p">]</span> <span class="k">as</span> <span class="nv">$key</span> <span class="o">=&gt;</span> <span class="nv">$param</span><span class="p">)</span> <span class="p">{</span>
            <span class="nv">$default</span><span class="p">[</span><span class="s2">&quot;</span><span class="si">$key</span><span class="s2">&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="nv">$param</span><span class="p">[</span><span class="s1">&#39;default&#39;</span><span class="p">];</span>
    <span class="p">}</span>
</pre></div>
</div>
</div>
<div class="section" id="case-nextcloud-type-onevariablestrings">
<span id="id404"></span><h4><span class="section-number">5.2.266.2. </span>NextCloud<a class="headerlink" href="#case-nextcloud-type-onevariablestrings" title="Permalink to this headline">¶</a></h4>
<p><a class="reference internal" href="Rules.html#one-variable-string"><span class="std std-ref">One Variable String</span></a>, in build/integration/features/bootstrap/BasicStructure.php:349.</p>
<p>Both concatenations could be merged, independently. If readability is important, why not put them inside curly brackets?</p>
<div class="highlight-php notranslate"><div class="highlight"><pre><span></span><span class="k">public</span> <span class="k">static</span> <span class="k">function</span> <span class="nf">removeFile</span><span class="p">(</span><span class="nv">$path</span><span class="p">,</span> <span class="nv">$filename</span><span class="p">)</span> <span class="p">{</span>
            <span class="k">if</span> <span class="p">(</span><span class="nb">file_exists</span><span class="p">(</span><span class="s2">&quot;</span><span class="si">$path</span><span class="s2">&quot;</span> <span class="o">.</span> <span class="s2">&quot;</span><span class="si">$filename</span><span class="s2">&quot;</span><span class="p">))</span> <span class="p">{</span>
                    <span class="nb">unlink</span><span class="p">(</span><span class="s2">&quot;</span><span class="si">$path</span><span class="s2">&quot;</span> <span class="o">.</span> <span class="s2">&quot;</span><span class="si">$filename</span><span class="s2">&quot;</span><span class="p">);</span>
            <span class="p">}</span>
    <span class="p">}</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="should-typecast">
<span id="case-should-typecast"></span><h3><span class="section-number">5.2.267. </span>Should Typecast<a class="headerlink" href="#should-typecast" title="Permalink to this headline">¶</a></h3>
<div class="section" id="case-xataface-type-shouldtypecast">
<span id="id405"></span><h4><span class="section-number">5.2.267.1. </span>xataface<a class="headerlink" href="#case-xataface-type-shouldtypecast" title="Permalink to this headline">¶</a></h4>
<p><a class="reference internal" href="Rules.html#should-typecast"><span class="std std-ref">Should Typecast</span></a>, in Dataface/Relationship.php:1612.</p>
<p>This is an exact example. A little further, the same applies to intval($max))</p>
<div class="highlight-php notranslate"><div class="highlight"><pre><span></span><span class="nb">intval</span><span class="p">(</span><span class="nv">$min</span><span class="p">);</span>
</pre></div>
</div>
</div>
<div class="section" id="case-openconf-type-shouldtypecast">
<span id="id406"></span><h4><span class="section-number">5.2.267.2. </span>OpenConf<a class="headerlink" href="#case-openconf-type-shouldtypecast" title="Permalink to this headline">¶</a></h4>
<p><a class="reference internal" href="Rules.html#should-typecast"><span class="std std-ref">Should Typecast</span></a>, in author/upload.php:62.</p>
<p>This is another exact example.</p>
<div class="highlight-php notranslate"><div class="highlight"><pre><span></span><span class="nb">intval</span><span class="p">(</span><span class="nv">$_POST</span><span class="p">[</span><span class="s1">&#39;pid&#39;</span><span class="p">]);</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="silently-cast-integer">
<span id="case-silently-cast-integer"></span><h3><span class="section-number">5.2.268. </span>Silently Cast Integer<a class="headerlink" href="#silently-cast-integer" title="Permalink to this headline">¶</a></h3>
<div class="section" id="case-mediawiki-type-silentlycastinteger">
<span id="id407"></span><h4><span class="section-number">5.2.268.1. </span>MediaWiki<a class="headerlink" href="#case-mediawiki-type-silentlycastinteger" title="Permalink to this headline">¶</a></h4>
<p><a class="reference internal" href="Rules.html#silently-cast-integer"><span class="std std-ref">Silently Cast Integer</span></a>, in includes/debug/logger/monolog/AvroFormatter.php:167.</p>
<p>Too many ff in the masks.</p>
<div class="highlight-php notranslate"><div class="highlight"><pre><span></span><span class="k">private</span> <span class="k">function</span> <span class="nf">encodeLong</span><span class="p">(</span> <span class="nv">$id</span> <span class="p">)</span> <span class="p">{</span>
            <span class="nv">$high</span>   <span class="o">=</span> <span class="p">(</span> <span class="nv">$id</span> <span class="o">&amp;</span> <span class="mh">0xffffffff00000000</span> <span class="p">)</span> <span class="o">&gt;&gt;</span> <span class="mi">32</span><span class="p">;</span>
            <span class="nv">$low</span>    <span class="o">=</span> <span class="nv">$id</span> <span class="o">&amp;</span> <span class="mh">0x00000000ffffffff</span><span class="p">;</span>
            <span class="k">return</span> <span class="nb">pack</span><span class="p">(</span> <span class="s1">&#39;NN&#39;</span><span class="p">,</span> <span class="nv">$high</span><span class="p">,</span> <span class="nv">$low</span> <span class="p">);</span>
    <span class="p">}</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="strings-with-strange-space">
<span id="case-strings-with-strange-space"></span><h3><span class="section-number">5.2.269. </span>Strings With Strange Space<a class="headerlink" href="#strings-with-strange-space" title="Permalink to this headline">¶</a></h3>
<div class="section" id="case-openemr-type-stringwithstrangespace">
<span id="id408"></span><h4><span class="section-number">5.2.269.1. </span>OpenEMR<a class="headerlink" href="#case-openemr-type-stringwithstrangespace" title="Permalink to this headline">¶</a></h4>
<p><a class="reference internal" href="Rules.html#strings-with-strange-space"><span class="std std-ref">Strings With Strange Space</span></a>, in library/globals.inc.php:3270.</p>
<p>The name of the contry contains both an unsecable space (the first, after Tonga), and a normal space (between Tonga and Islands). Translations are stored in a database, which preserves the unbreakable spaces. This also means that fixing the translation must be applied to every piece of data at the same time. The xl() function, which handles the translations, is also a good place to clean the spaces before searching for the right translation.</p>
<div class="highlight-php notranslate"><div class="highlight"><pre><span></span><span class="s1">&#39;to&#39;</span> <span class="o">=&gt;</span> <span class="nx">xl</span><span class="p">(</span><span class="s1">&#39;Tonga (Tonga Islands)&#39;</span><span class="p">),</span>
</pre></div>
</div>
</div>
<div class="section" id="case-thelia-type-stringwithstrangespace">
<span id="id409"></span><h4><span class="section-number">5.2.269.2. </span>Thelia<a class="headerlink" href="#case-thelia-type-stringwithstrangespace" title="Permalink to this headline">¶</a></h4>
<p><a class="reference internal" href="Rules.html#strings-with-strange-space"><span class="std std-ref">Strings With Strange Space</span></a>, in templates/backOffice/default/I18n/fr_FR.php:647.</p>
<p>This is another example with a translation sentence. Here, the unbreakable space is before the question mark : this is a typography rule, that is common to many language. This would be a false positive, unless typography is handled by another part of the software.</p>
<div class="highlight-php notranslate"><div class="highlight"><pre><span></span><span class="s1">&#39;Mot de passe oublié ?&#39;</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="inconsistent-variable-usage">
<span id="case-inconsistent-variable-usage"></span><h3><span class="section-number">5.2.270. </span>Inconsistent Variable Usage<a class="headerlink" href="#inconsistent-variable-usage" title="Permalink to this headline">¶</a></h3>
<div class="section" id="case-wordpress-variables-inconsistentusage">
<span id="id410"></span><h4><span class="section-number">5.2.270.1. </span>WordPress<a class="headerlink" href="#case-wordpress-variables-inconsistentusage" title="Permalink to this headline">¶</a></h4>
<p><a class="reference internal" href="Rules.html#inconsistent-variable-usage"><span class="std std-ref">Inconsistent Variable Usage</span></a>, in wp-includes/IXR/class-IXR-client.php:86.</p>
<p>$request is used successively as an object (IXR_Request), then as a string (The POST). Separatring both usage with different names will help readability.</p>
<div class="highlight-php notranslate"><div class="highlight"><pre><span></span><span class="nv">$request</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">IXR_Request</span><span class="p">(</span><span class="nv">$method</span><span class="p">,</span> <span class="nv">$args</span><span class="p">);</span>
        <span class="nv">$length</span> <span class="o">=</span> <span class="nv">$request</span><span class="o">-&gt;</span><span class="na">getLength</span><span class="p">();</span>
        <span class="nv">$xml</span> <span class="o">=</span> <span class="nv">$request</span><span class="o">-&gt;</span><span class="na">getXml</span><span class="p">();</span>
        <span class="nv">$r</span> <span class="o">=</span> <span class="s2">&quot;</span><span class="se">\r\n</span><span class="s2">&quot;</span><span class="p">;</span>
        <span class="nv">$request</span>  <span class="o">=</span> <span class="s2">&quot;POST </span><span class="si">{</span><span class="nv">$this</span><span class="o">-&gt;</span><span class="na">path</span><span class="si">}</span><span class="s2"> HTTP/1.0</span><span class="si">$r</span><span class="s2">&quot;</span><span class="p">;</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="lost-references">
<span id="case-lost-references"></span><h3><span class="section-number">5.2.271. </span>Lost References<a class="headerlink" href="#lost-references" title="Permalink to this headline">¶</a></h3>
<div class="section" id="case-wordpress-variables-lostreferences">
<span id="id411"></span><h4><span class="section-number">5.2.271.1. </span>WordPress<a class="headerlink" href="#case-wordpress-variables-lostreferences" title="Permalink to this headline">¶</a></h4>
<p><a class="reference internal" href="Rules.html#lost-references"><span class="std std-ref">Lost References</span></a>, in wp-admin/includes/misc.php:74.</p>
<p>This code actually loads the file, join it, then split it again. file() would be sufficient.</p>
<div class="highlight-php notranslate"><div class="highlight"><pre><span></span><span class="nv">$markerdata</span> <span class="o">=</span> <span class="nb">explode</span><span class="p">(</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">,</span> <span class="nb">implode</span><span class="p">(</span> <span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="nb">file</span><span class="p">(</span> <span class="nv">$filename</span> <span class="p">)</span> <span class="p">)</span> <span class="p">);</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="strange-name-for-variables">
<span id="case-strange-name-for-variables"></span><h3><span class="section-number">5.2.272. </span>Strange Name For Variables<a class="headerlink" href="#strange-name-for-variables" title="Permalink to this headline">¶</a></h3>
<div class="section" id="case-fuelcms-variables-strangename">
<span id="id412"></span><h4><span class="section-number">5.2.272.1. </span>FuelCMS<a class="headerlink" href="#case-fuelcms-variables-strangename" title="Permalink to this headline">¶</a></h4>
<p><a class="reference internal" href="Rules.html#strange-name-for-variables"><span class="std std-ref">Strange Name For Variables</span></a>, in fuel/modules/fuel/libraries/parser/dwoo/Dwoo/Adapters/CakePHP/dwoo.php:86.</p>
<p>Three _ is quite a lot for variables. Would they not be parameters but global variables, that would still be quite a lot.</p>
<div class="highlight-php notranslate"><div class="highlight"><pre><span></span><span class="k">public</span> <span class="k">function</span> <span class="nf">_render</span><span class="p">(</span><span class="nv">$___viewFn</span><span class="p">,</span> <span class="nv">$___data_for_view</span><span class="p">,</span> <span class="nv">$___play_safe</span> <span class="o">=</span> <span class="k">true</span><span class="p">,</span> <span class="nv">$loadHelpers</span> <span class="o">=</span> <span class="k">true</span><span class="p">)</span> <span class="p">{</span>
    <span class="cm">/**/</span>
<span class="p">}</span>
</pre></div>
</div>
</div>
<div class="section" id="case-phpipam-variables-strangename">
<span id="id413"></span><h4><span class="section-number">5.2.272.2. </span>PhpIPAM<a class="headerlink" href="#case-phpipam-variables-strangename" title="Permalink to this headline">¶</a></h4>
<p><a class="reference internal" href="Rules.html#strange-name-for-variables"><span class="std std-ref">Strange Name For Variables</span></a>, in app/admin/sections/edit-result.php:56.</p>
<p>$sss is the end-result of a progression, from $subsections (3s) to $ss to $sss. Although it is understandable from the code, a fuller name, like $subsection_subnet or $one_subsection_subnet would make this more readable.</p>
<div class="highlight-php notranslate"><div class="highlight"><pre><span></span><span class="c1">//fetch subsection subnets</span>
            <span class="k">foreach</span><span class="p">(</span><span class="nv">$subsections</span> <span class="k">as</span> <span class="nv">$ss</span><span class="p">)</span> <span class="p">{</span>
                    <span class="nv">$subsection_subnets</span> <span class="o">=</span> <span class="nv">$Subnets</span><span class="o">-&gt;</span><span class="na">fetch_section_subnets</span><span class="p">(</span><span class="nv">$ss</span><span class="o">-&gt;</span><span class="na">id</span><span class="p">);</span> <span class="c1">//fetch all subnets in subsection</span>
                    <span class="k">if</span><span class="p">(</span><span class="nb">sizeof</span><span class="p">(</span><span class="nv">$subsection_subnets</span><span class="p">)</span><span class="o">&gt;</span><span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
                            <span class="k">foreach</span><span class="p">(</span><span class="nv">$subsection_subnets</span> <span class="k">as</span> <span class="nv">$sss</span><span class="p">)</span> <span class="p">{</span>
                                    <span class="nv">$out</span><span class="p">[]</span> <span class="o">=</span> <span class="nv">$sss</span><span class="p">;</span>
                            <span class="p">}</span>
                    <span class="p">}</span>
                    <span class="nv">$num_subnets</span> <span class="o">=</span> <span class="nv">$num_subnets</span> <span class="o">+</span> <span class="nb">sizeof</span><span class="p">(</span><span class="nv">$subsection_subnets</span><span class="p">);</span>
                    <span class="c1">//count all addresses that will be deleted!</span>
                    <span class="nv">$ipcnt</span> <span class="o">=</span> <span class="nv">$Addresses</span><span class="o">-&gt;</span><span class="na">count_addresses_in_multiple_subnets</span><span class="p">(</span><span class="nv">$out</span><span class="p">);</span>
            <span class="p">}</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="non-ascii-variables">
<span id="case-non-ascii-variables"></span><h3><span class="section-number">5.2.273. </span>Non Ascii Variables<a class="headerlink" href="#non-ascii-variables" title="Permalink to this headline">¶</a></h3>
<div class="section" id="case-magento-variables-variablenonascii">
<span id="id414"></span><h4><span class="section-number">5.2.273.1. </span>Magento<a class="headerlink" href="#case-magento-variables-variablenonascii" title="Permalink to this headline">¶</a></h4>
<p><a class="reference internal" href="Rules.html#non-ascii-variables"><span class="std std-ref">Non Ascii Variables</span></a>, in dev/tests/functional/tests/app/Mage/Checkout/Test/Constraint/AssertOrderWithMultishippingSuccessPlacedMessage.php:52.</p>
<p>The initial C is actually a russian C.</p>
<div class="highlight-php notranslate"><div class="highlight"><pre><span></span><span class="nv">$сheckoutMultishippingSuccess</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="used-once-variables">
<span id="case-used-once-variables"></span><h3><span class="section-number">5.2.274. </span>Used Once Variables<a class="headerlink" href="#used-once-variables" title="Permalink to this headline">¶</a></h3>
<div class="section" id="case-shopware-variables-variableusedonce">
<span id="id415"></span><h4><span class="section-number">5.2.274.1. </span>shopware<a class="headerlink" href="#case-shopware-variables-variableusedonce" title="Permalink to this headline">¶</a></h4>
<p><a class="reference internal" href="Rules.html#used-once-variables"><span class="std std-ref">Used Once Variables</span></a>, in _sql/migrations/438-add-email-template-header-footer-fields.php:115.</p>
<p>In the updateEmailTemplate method, $generatedQueries collects all the generated SQL queries. $generatedQueries is not initialized, and never used after initialization.</p>
<div class="highlight-php notranslate"><div class="highlight"><pre><span></span><span class="k">private</span> <span class="k">function</span> <span class="nf">updateEmailTemplate</span><span class="p">(</span><span class="nv">$name</span><span class="p">,</span> <span class="nv">$content</span><span class="p">,</span> <span class="nv">$contentHtml</span> <span class="o">=</span> <span class="k">null</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="nv">$sql</span> <span class="o">=</span> <span class="s">&lt;&lt;&lt;</span><span class="dl">SQL</span><span class="s"></span>
<span class="s">UPDATE `s_core_config_mails` SET `content` = &quot;$content&quot; WHERE `name` = &quot;$name&quot; AND dirty = 0</span>
<span class="dl">SQL</span><span class="p">;</span>
        <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">addSql</span><span class="p">(</span><span class="nv">$sql</span><span class="p">);</span>

        <span class="k">if</span> <span class="p">(</span><span class="nv">$contentHtml</span> <span class="o">!=</span> <span class="k">null</span><span class="p">)</span> <span class="p">{</span>
            <span class="nv">$sql</span> <span class="o">=</span> <span class="s">&lt;&lt;&lt;</span><span class="dl">SQL</span><span class="s"></span>
<span class="s">UPDATE `s_core_config_mails` SET `content` = &quot;$content&quot;, `contentHTML` = &quot;$contentHtml&quot; WHERE `name` = &quot;$name&quot; AND dirty = 0</span>
<span class="dl">SQL</span><span class="p">;</span>
            <span class="nv">$generatedQueries</span><span class="p">[]</span> <span class="o">=</span> <span class="nv">$sql</span><span class="p">;</span>
        <span class="p">}</span>

        <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">addSql</span><span class="p">(</span><span class="nv">$sql</span><span class="p">);</span>
    <span class="p">}</span>
</pre></div>
</div>
</div>
<div class="section" id="case-vanilla-variables-variableusedonce">
<span id="id416"></span><h4><span class="section-number">5.2.274.2. </span>Vanilla<a class="headerlink" href="#case-vanilla-variables-variableusedonce" title="Permalink to this headline">¶</a></h4>
<p><a class="reference internal" href="Rules.html#used-once-variables"><span class="std std-ref">Used Once Variables</span></a>, in library/core/class.configuration.php:1461.</p>
<p>In this code, $cachedConfigData is collected after storing date in the cache. Gdn::cache()-&gt;store() does actual work, so its calling is necessary. The result, collected after execution, is not reused in the rest of the method (long method, not all is shown here). Removing such variable is a needed clean up after development and debug, but also prevents pollution of the variable namespace.</p>
<div class="highlight-php notranslate"><div class="highlight"><pre><span></span><span class="c1">// Save to cache if we&#39;re into that sort of thing</span>
                <span class="nv">$fileKey</span> <span class="o">=</span> <span class="nb">sprintf</span><span class="p">(</span><span class="nx">Gdn_Configuration</span><span class="o">::</span><span class="na">CONFIG_FILE_CACHE_KEY</span><span class="p">,</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">Source</span><span class="p">);</span>
                <span class="k">if</span> <span class="p">(</span><span class="nv">$this</span><span class="o">-&gt;</span><span class="na">Configuration</span> <span class="o">&amp;&amp;</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">Configuration</span><span class="o">-&gt;</span><span class="na">caching</span><span class="p">()</span> <span class="o">&amp;&amp;</span> <span class="nx">Gdn</span><span class="o">::</span><span class="na">cache</span><span class="p">()</span><span class="o">-&gt;</span><span class="na">type</span><span class="p">()</span> <span class="o">==</span> <span class="nx">Gdn_Cache</span><span class="o">::</span><span class="na">CACHE_TYPE_MEMORY</span> <span class="o">&amp;&amp;</span> <span class="nx">Gdn</span><span class="o">::</span><span class="na">cache</span><span class="p">()</span><span class="o">-&gt;</span><span class="na">activeEnabled</span><span class="p">())</span> <span class="p">{</span>
                    <span class="nv">$cachedConfigData</span> <span class="o">=</span> <span class="nx">Gdn</span><span class="o">::</span><span class="na">cache</span><span class="p">()</span><span class="o">-&gt;</span><span class="na">store</span><span class="p">(</span><span class="nv">$fileKey</span><span class="p">,</span> <span class="nv">$data</span><span class="p">,</span> <span class="p">[</span>
                        <span class="nx">Gdn_Cache</span><span class="o">::</span><span class="na">FEATURE_NOPREFIX</span> <span class="o">=&gt;</span> <span class="k">true</span><span class="p">,</span>
                        <span class="nx">Gdn_Cache</span><span class="o">::</span><span class="na">FEATURE_EXPIRY</span> <span class="o">=&gt;</span> <span class="mi">3600</span>
                    <span class="p">]);</span>
                <span class="p">}</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="used-once-variables-in-scope">
<span id="case-used-once-variables-in-scope"></span><h3><span class="section-number">5.2.275. </span>Used Once Variables (In Scope)<a class="headerlink" href="#used-once-variables-in-scope" title="Permalink to this headline">¶</a></h3>
<div class="section" id="case-shopware-variables-variableusedoncebycontext">
<span id="id417"></span><h4><span class="section-number">5.2.275.1. </span>shopware<a class="headerlink" href="#case-shopware-variables-variableusedoncebycontext" title="Permalink to this headline">¶</a></h4>
<p><a class="reference internal" href="Rules.html#used-once-variables-in-scope"><span class="std std-ref">Used Once Variables (In Scope)</span></a>, in _sql/migrations/438-add-email-template-header-footer-fields.php:115.</p>
<p>In the updateEmailTemplate method, $generatedQueries collects all the generated SQL queries. $generatedQueries is not initialized, and never used after initialization.</p>
<div class="highlight-php notranslate"><div class="highlight"><pre><span></span><span class="k">private</span> <span class="k">function</span> <span class="nf">updateEmailTemplate</span><span class="p">(</span><span class="nv">$name</span><span class="p">,</span> <span class="nv">$content</span><span class="p">,</span> <span class="nv">$contentHtml</span> <span class="o">=</span> <span class="k">null</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="nv">$sql</span> <span class="o">=</span> <span class="s">&lt;&lt;&lt;</span><span class="dl">SQL</span><span class="s"></span>
<span class="s">UPDATE `s_core_config_mails` SET `content` = &quot;$content&quot; WHERE `name` = &quot;$name&quot; AND dirty = 0</span>
<span class="dl">SQL</span><span class="p">;</span>
        <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">addSql</span><span class="p">(</span><span class="nv">$sql</span><span class="p">);</span>

        <span class="k">if</span> <span class="p">(</span><span class="nv">$contentHtml</span> <span class="o">!=</span> <span class="k">null</span><span class="p">)</span> <span class="p">{</span>
            <span class="nv">$sql</span> <span class="o">=</span> <span class="s">&lt;&lt;&lt;</span><span class="dl">SQL</span><span class="s"></span>
<span class="s">UPDATE `s_core_config_mails` SET `content` = &quot;$content&quot;, `contentHTML` = &quot;$contentHtml&quot; WHERE `name` = &quot;$name&quot; AND dirty = 0</span>
<span class="dl">SQL</span><span class="p">;</span>
            <span class="nv">$generatedQueries</span><span class="p">[]</span> <span class="o">=</span> <span class="nv">$sql</span><span class="p">;</span>
        <span class="p">}</span>

        <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">addSql</span><span class="p">(</span><span class="nv">$sql</span><span class="p">);</span>
    <span class="p">}</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="written-only-variables">
<span id="case-written-only-variables"></span><h3><span class="section-number">5.2.276. </span>Written Only Variables<a class="headerlink" href="#written-only-variables" title="Permalink to this headline">¶</a></h3>
<div class="section" id="case-dolibarr-variables-writtenonlyvariable">
<span id="id418"></span><h4><span class="section-number">5.2.276.1. </span>Dolibarr<a class="headerlink" href="#case-dolibarr-variables-writtenonlyvariable" title="Permalink to this headline">¶</a></h4>
<p><a class="reference internal" href="Rules.html#written-only-variables"><span class="std std-ref">Written Only Variables</span></a>, in htdocs/ecm/class/ecmdirectory.class.php:692.</p>
<p>$val is only written, as only the keys are used. $val may be skipped by applying the foreach to array_keys($this-&gt;cats), instead of the whole array.</p>
<div class="highlight-php notranslate"><div class="highlight"><pre><span></span><span class="c1">// We add properties fullxxx to all elements</span>
            <span class="k">foreach</span><span class="p">(</span><span class="nv">$this</span><span class="o">-&gt;</span><span class="na">cats</span> <span class="k">as</span> <span class="nv">$key</span> <span class="o">=&gt;</span> <span class="nv">$val</span><span class="p">)</span>
            <span class="p">{</span>
                    <span class="k">if</span> <span class="p">(</span><span class="nb">isset</span><span class="p">(</span><span class="nv">$motherof</span><span class="p">[</span><span class="nv">$key</span><span class="p">]))</span> <span class="k">continue</span><span class="p">;</span>
                    <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">build_path_from_id_categ</span><span class="p">(</span><span class="nv">$key</span><span class="p">,</span> <span class="mi">0</span><span class="p">);</span>
            <span class="p">}</span>
</pre></div>
</div>
</div>
<div class="section" id="case-suitecrm-variables-writtenonlyvariable">
<span id="id419"></span><h4><span class="section-number">5.2.276.2. </span>SuiteCrm<a class="headerlink" href="#case-suitecrm-variables-writtenonlyvariable" title="Permalink to this headline">¶</a></h4>
<p><a class="reference internal" href="Rules.html#written-only-variables"><span class="std std-ref">Written Only Variables</span></a>, in modules/Campaigns/utils.php:820.</p>
<p>$email_health is used later in the method; while $email_components is only set, and never used.</p>
<div class="highlight-php notranslate"><div class="highlight"><pre><span></span><span class="c1">//run query for mail boxes of type &#39;bounce&#39;</span>
        <span class="nv">$email_health</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
        <span class="nv">$email_components</span> <span class="o">=</span> <span class="mi">2</span><span class="p">;</span>
        <span class="nv">$mbox_qry</span> <span class="o">=</span> <span class="s2">&quot;select * from inbound_email where deleted =&#39;0&#39; and mailbox_type = &#39;bounce&#39;&quot;</span><span class="p">;</span>
        <span class="nv">$mbox_res</span> <span class="o">=</span> <span class="nv">$focus</span><span class="o">-&gt;</span><span class="na">db</span><span class="o">-&gt;</span><span class="na">query</span><span class="p">(</span><span class="nv">$mbox_qry</span><span class="p">);</span>

        <span class="nv">$mbox</span> <span class="o">=</span> <span class="k">array</span><span class="p">();</span>
        <span class="k">while</span> <span class="p">(</span><span class="nv">$mbox_row</span> <span class="o">=</span> <span class="nv">$focus</span><span class="o">-&gt;</span><span class="na">db</span><span class="o">-&gt;</span><span class="na">fetchByAssoc</span><span class="p">(</span><span class="nv">$mbox_res</span><span class="p">))</span> <span class="p">{</span>
            <span class="nv">$mbox</span><span class="p">[]</span> <span class="o">=</span> <span class="nv">$mbox_row</span><span class="p">;</span>
        <span class="p">}</span>
</pre></div>
</div>
</div>
</div>
</div>
</div>


           </div>
           
          </div>
          <footer>
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
        <a href="../Administrator/Installation.html" class="btn btn-neutral float-right" title="Installation" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
        <a href="Cobblers.html" class="btn btn-neutral float-left" title="4. Cobblers" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>
        &#169; Copyright 2015-2020, Damien Seguy.

    </p>
  </div>
    
    
    
    Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    
    provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>
        </div>
      </div>

    </section>

  </div>
  

  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
  
    
   

</body>
</html>