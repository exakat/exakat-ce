

<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8" />
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  
  <title>5. Real Code Cases &mdash; Exakat 1 documentation</title>
  

  
  <link rel="stylesheet" href="../_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
  <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
  <link rel="stylesheet" href="../_static/css/theme.css" type="text/css" />

  
  

  
  

  

  
  <!--[if lt IE 9]>
    <script src="../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
    
      <script type="text/javascript" id="documentation_options" data-url_root="../" src="../_static/documentation_options.js"></script>
        <script data-url_root="../" id="documentation_options" src="../_static/documentation_options.js"></script>
        <script src="../_static/jquery.js"></script>
        <script src="../_static/underscore.js"></script>
        <script src="../_static/doctools.js"></script>
    
    <script type="text/javascript" src="../_static/js/theme.js"></script>

    
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="Installation" href="../Administrator/Installation.html" />
    <link rel="prev" title="4. Cobblers" href="Cobblers.html" /> 
</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
          

          
            <a href="../index.html" class="icon icon-home"> Exakat
          

          
          </a>

          
            
            
              <div class="version">
                2.2.2
              </div>
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        
        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <ul>
<li class="toctree-l1"><a class="reference internal" href="../Introduction.html">Introduction</a></li>
<li class="toctree-l1"><a class="reference internal" href="../Changelog.html">Release Note</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">GETTING STARTED</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../Gettingstarted/Bare.html">with a Bare metal installation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../Gettingstarted/Docker.html">with a Docker installation</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">USER GUIDE</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../User/Overview.html">Overview</a></li>
<li class="toctree-l1"><a class="reference internal" href="../User/PHPversion.html">PHP Version</a></li>
<li class="toctree-l1"><a class="reference internal" href="../User/Support.html">Library &amp; Framework Support</a></li>
<li class="toctree-l1"><a class="reference internal" href="../User/Configuration.html">Configuration</a></li>
<li class="toctree-l1"><a class="reference internal" href="../User/Scoping.html">Scoping analysis</a></li>
<li class="toctree-l1"><a class="reference internal" href="../User/Rule.html">Rule</a></li>
<li class="toctree-l1"><a class="reference internal" href="../User/Report.html">Report</a></li>
<li class="toctree-l1"><a class="reference internal" href="../User/Cobbler.html">Cobbler</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">REFERENCE GUIDE</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="Rules.html">1. Rules</a></li>
<li class="toctree-l1"><a class="reference internal" href="Rulesets.html">2. Rulesets</a></li>
<li class="toctree-l1"><a class="reference internal" href="Reports.html">3. Reports</a></li>
<li class="toctree-l1"><a class="reference internal" href="Cobblers.html">4. Cobblers</a></li>
<li class="toctree-l1 current"><a class="current reference internal" href="#">5. Real Code Cases</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#introduction">5.1. Introduction</a></li>
<li class="toctree-l2"><a class="reference internal" href="#list-of-real-code-cases">5.2. List of real code Cases</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#multiple-index-definition">5.2.1. Multiple Index Definition</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#magento">5.2.1.1. Magento</a></li>
<li class="toctree-l4"><a class="reference internal" href="#mediawiki">5.2.1.2. MediaWiki</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#don-t-unset-properties">5.2.2. Don’t Unset Properties</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#vanilla">5.2.2.1. Vanilla</a></li>
<li class="toctree-l4"><a class="reference internal" href="#typo3">5.2.2.2. Typo3</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#forgotten-visibility">5.2.3. Forgotten Visibility</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#fuelcms">5.2.3.1. FuelCMS</a></li>
<li class="toctree-l4"><a class="reference internal" href="#livezilla">5.2.3.2. LiveZilla</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#non-static-methods-called-in-a-static">5.2.4. Non Static Methods Called In A Static</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#dolphin">5.2.4.1. Dolphin</a></li>
<li class="toctree-l4"><a class="reference internal" href="#case-magento-classes-nonstaticmethodscalledstatic">5.2.4.2. Magento</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#redefined-default">5.2.5. Redefined Default</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#piwigo">5.2.5.1. Piwigo</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#static-methods-can-t-contain-this">5.2.6. Static Methods Can’t Contain $this</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#xataface">5.2.6.1. xataface</a></li>
<li class="toctree-l4"><a class="reference internal" href="#sugarcrm">5.2.6.2. SugarCrm</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#wrong-access-style-to-property">5.2.7. Wrong Access Style to Property</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#humo-gen">5.2.7.1. HuMo-Gen</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#undefined-properties">5.2.8. Undefined Properties</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#wordpress">5.2.8.1. WordPress</a></li>
<li class="toctree-l4"><a class="reference internal" href="#case-mediawiki-classes-undefinedproperty">5.2.8.2. MediaWiki</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#use-class-operator">5.2.9. Use ::Class Operator</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#case-typo3-classes-useclassoperator">5.2.9.1. Typo3</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#use-instanceof">5.2.10. Use Instanceof</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#teampass">5.2.10.1. TeamPass</a></li>
<li class="toctree-l4"><a class="reference internal" href="#zencart">5.2.10.2. Zencart</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#use-const">5.2.11. Use const</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#phpmyadmin">5.2.11.1. phpMyAdmin</a></li>
<li class="toctree-l4"><a class="reference internal" href="#case-piwigo-constants-constrecommended">5.2.11.2. Piwigo</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#multiple-constant-definition">5.2.12. Multiple Constant Definition</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#dolibarr">5.2.12.1. Dolibarr</a></li>
<li class="toctree-l4"><a class="reference internal" href="#openconf">5.2.12.2. OpenConf</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#throw-functioncall">5.2.13. Throw Functioncall</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#case-sugarcrm-exceptions-throwfunctioncall">5.2.13.1. SugarCrm</a></li>
<li class="toctree-l4"><a class="reference internal" href="#zurmo">5.2.13.2. Zurmo</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#useless-catch">5.2.14. Useless Catch</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#case-zurmo-exceptions-uselesscatch">5.2.14.1. Zurmo</a></li>
<li class="toctree-l4"><a class="reference internal" href="#prestashop">5.2.14.2. PrestaShop</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#aliases-usage">5.2.15. Aliases Usage</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#cleverstyle">5.2.15.1. Cleverstyle</a></li>
<li class="toctree-l4"><a class="reference internal" href="#case-phpmyadmin-functions-aliasesusage">5.2.15.2. phpMyAdmin</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#callback-function-needs-return">5.2.16. Callback Function Needs Return</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#contao">5.2.16.1. Contao</a></li>
<li class="toctree-l4"><a class="reference internal" href="#phpdocumentor">5.2.16.2. Phpdocumentor</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#deep-definitions">5.2.17. Deep Definitions</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#case-dolphin-functions-deepdefinitions">5.2.17.1. Dolphin</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#unused-inherited-variable-in-closure">5.2.18. Unused Inherited Variable In Closure</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#shopware">5.2.18.1. shopware</a></li>
<li class="toctree-l4"><a class="reference internal" href="#mautic">5.2.18.2. Mautic</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#use-constant-as-arguments">5.2.19. Use Constant As Arguments</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#tikiwiki">5.2.19.1. Tikiwiki</a></li>
<li class="toctree-l4"><a class="reference internal" href="#case-shopware-functions-useconstantasarguments">5.2.19.2. shopware</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#wrong-number-of-arguments">5.2.20. Wrong Number Of Arguments</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#case-xataface-functions-wrongnumberofarguments">5.2.20.1. xataface</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#wrong-optional-parameter">5.2.21. Wrong Optional Parameter</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#case-fuelcms-functions-wrongoptionalparameter">5.2.21.1. FuelCMS</a></li>
<li class="toctree-l4"><a class="reference internal" href="#case-vanilla-functions-wrongoptionalparameter">5.2.21.2. Vanilla</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#undefined-interfaces">5.2.22. Undefined Interfaces</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#case-xataface-interfaces-undefinedinterfaces">5.2.22.1. xataface</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#hidden-use-expression">5.2.23. Hidden Use Expression</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#case-tikiwiki-namespaces-hiddenuse">5.2.23.1. Tikiwiki</a></li>
<li class="toctree-l4"><a class="reference internal" href="#openemr">5.2.23.2. OpenEMR</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#multiple-alias-definitions">5.2.24. Multiple Alias Definitions</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#churchcrm">5.2.24.1. ChurchCRM</a></li>
<li class="toctree-l4"><a class="reference internal" href="#phinx">5.2.24.2. Phinx</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#no-array-merge-in-loops">5.2.25. No array_merge() In Loops</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#tine20">5.2.25.1. Tine20</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#pre-increment">5.2.26. Pre-increment</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#expressionengine">5.2.26.1. ExpressionEngine</a></li>
<li class="toctree-l4"><a class="reference internal" href="#traq">5.2.26.2. Traq</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#strpos-too-much">5.2.27. strpos() Too Much</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#case-wordpress-performances-strpostoomuch">5.2.27.1. WordPress</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#assign-with-and-precedence">5.2.28. Assign With And Precedence</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#case-xataface-php-assignand">5.2.28.1. xataface</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#use-random-int">5.2.29. Use random_int()</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#thelia">5.2.29.1. Thelia</a></li>
<li class="toctree-l4"><a class="reference internal" href="#case-fuelcms-php-betterrand">5.2.29.2. FuelCMS</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#deprecated-php-functions">5.2.30. Deprecated PHP Functions</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#case-dolphin-php-deprecated">5.2.30.1. Dolphin</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#wrong-fopen-mode">5.2.31. Wrong fopen() Mode</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#case-tikiwiki-php-fopenmode">5.2.31.1. Tikiwiki</a></li>
<li class="toctree-l4"><a class="reference internal" href="#case-humo-gen-php-fopenmode">5.2.31.2. HuMo-Gen</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#incompilable-files">5.2.32. Incompilable Files</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#case-xataface-php-incompilable">5.2.32.1. xataface</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#wrong-parameter-type">5.2.33. Wrong Parameter Type</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#case-zencart-php-internalparametertype">5.2.33.1. Zencart</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#logical-should-use-symbolic-operators">5.2.34. Logical Should Use Symbolic Operators</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#case-cleverstyle-php-logicalinletters">5.2.34.1. Cleverstyle</a></li>
<li class="toctree-l4"><a class="reference internal" href="#case-openconf-php-logicalinletters">5.2.34.2. OpenConf</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#possible-missing-subpattern">5.2.35. Possible Missing Subpattern</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#case-phpmyadmin-php-missingsubpattern">5.2.35.1. phpMyAdmin</a></li>
<li class="toctree-l4"><a class="reference internal" href="#spip">5.2.35.2. SPIP</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#no-class-in-global">5.2.36. No Class In Global</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#case-dolphin-php-noclassinglobal">5.2.36.1. Dolphin</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#no-reference-for-ternary">5.2.37. No Reference For Ternary</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#phpadsnew">5.2.37.1. phpadsnew</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#should-use-coalesce">5.2.38. Should Use Coalesce</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#case-churchcrm-php-shouldusecoalesce">5.2.38.1. ChurchCRM</a></li>
<li class="toctree-l4"><a class="reference internal" href="#case-cleverstyle-php-shouldusecoalesce">5.2.38.2. Cleverstyle</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#strtr-arguments">5.2.39. Strtr Arguments</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#suitecrm">5.2.39.1. SuiteCrm</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#use-php-object-api">5.2.40. Use PHP Object API</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#case-wordpress-php-useobjectapi">5.2.40.1. WordPress</a></li>
<li class="toctree-l4"><a class="reference internal" href="#case-prestashop-php-useobjectapi">5.2.40.2. PrestaShop</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#use-pathinfo">5.2.41. Use Pathinfo</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#case-suitecrm-php-usepathinfo">5.2.41.1. SuiteCrm</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#don-t-echo-error">5.2.42. Don’t Echo Error</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#case-churchcrm-security-dontechoerror">5.2.42.1. ChurchCRM</a></li>
<li class="toctree-l4"><a class="reference internal" href="#case-phpdocumentor-security-dontechoerror">5.2.42.2. Phpdocumentor</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#should-use-prepared-statement">5.2.43. Should Use Prepared Statement</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#case-dolibarr-security-shouldusepreparedstatement">5.2.43.1. Dolibarr</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#adding-zero">5.2.44. Adding Zero</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#case-thelia-structures-addzero">5.2.44.1. Thelia</a></li>
<li class="toctree-l4"><a class="reference internal" href="#case-openemr-structures-addzero">5.2.44.2. OpenEMR</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#altering-foreach-without-reference">5.2.45. Altering Foreach Without Reference</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#case-contao-structures-alteringforeachwithoutreference">5.2.45.1. Contao</a></li>
<li class="toctree-l4"><a class="reference internal" href="#case-wordpress-structures-alteringforeachwithoutreference">5.2.45.2. WordPress</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#strict-comparison-with-booleans">5.2.46. Strict Comparison With Booleans</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#case-phinx-structures-booleanstrictcomparison">5.2.46.1. Phinx</a></li>
<li class="toctree-l4"><a class="reference internal" href="#case-typo3-structures-booleanstrictcomparison">5.2.46.2. Typo3</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#check-json">5.2.47. Check JSON</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#woocommerce">5.2.47.1. Woocommerce</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#could-use-dir">5.2.48. Could Use __DIR__</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#case-woocommerce-structures-couldusedir">5.2.48.1. Woocommerce</a></li>
<li class="toctree-l4"><a class="reference internal" href="#case-piwigo-structures-couldusedir">5.2.48.2. Piwigo</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#could-use-short-assignation">5.2.49. Could Use Short Assignation</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#case-churchcrm-structures-coulduseshortassignation">5.2.49.1. ChurchCRM</a></li>
<li class="toctree-l4"><a class="reference internal" href="#case-thelia-structures-coulduseshortassignation">5.2.49.2. Thelia</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#could-use-str-repeat">5.2.50. Could Use str_repeat()</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#case-zencart-structures-couldusestrrepeat">5.2.50.1. Zencart</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#dangling-array-references">5.2.51. Dangling Array References</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#case-typo3-structures-danglingarrayreferences">5.2.51.1. Typo3</a></li>
<li class="toctree-l4"><a class="reference internal" href="#case-sugarcrm-structures-danglingarrayreferences">5.2.51.2. SugarCrm</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#dir-then-slash">5.2.52. __DIR__ Then Slash</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#case-traq-structures-dirthenslash">5.2.52.1. Traq</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#else-if-versus-elseif">5.2.53. Else If Versus Elseif</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#case-teampass-structures-elseifelseif">5.2.53.1. TeamPass</a></li>
<li class="toctree-l4"><a class="reference internal" href="#case-phpdocumentor-structures-elseifelseif">5.2.53.2. Phpdocumentor</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#empty-blocks">5.2.54. Empty Blocks</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#case-cleverstyle-structures-emptyblocks">5.2.54.1. Cleverstyle</a></li>
<li class="toctree-l4"><a class="reference internal" href="#phpipam">5.2.54.2. PhpIPAM</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#error-reporting-with-integers">5.2.55. error_reporting() With Integers</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#case-sugarcrm-structures-errorreportingwithinteger">5.2.55.1. SugarCrm</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#eval-usage">5.2.56. Eval() Usage</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#xoops">5.2.56.1. XOOPS</a></li>
<li class="toctree-l4"><a class="reference internal" href="#case-mautic-structures-evalusage">5.2.56.2. Mautic</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#eval-without-try">5.2.57. eval() Without Try</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#case-fuelcms-structures-evalwithouttry">5.2.57.1. FuelCMS</a></li>
<li class="toctree-l4"><a class="reference internal" href="#case-expressionengine-structures-evalwithouttry">5.2.57.2. ExpressionEngine</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#exit-usage">5.2.58. Exit() Usage</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#case-traq-structures-exitusage">5.2.58.1. Traq</a></li>
<li class="toctree-l4"><a class="reference internal" href="#thinkphp">5.2.58.2. ThinkPHP</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#failed-substr-comparison">5.2.59. Failed Substr Comparison</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#case-zurmo-structures-failingsubstrcomparison">5.2.59.1. Zurmo</a></li>
<li class="toctree-l4"><a class="reference internal" href="#case-mediawiki-structures-failingsubstrcomparison">5.2.59.2. MediaWiki</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#foreach-reference-is-not-modified">5.2.60. Foreach Reference Is Not Modified</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#case-dolibarr-structures-foreachreferenceisnotmodified">5.2.60.1. Dolibarr</a></li>
<li class="toctree-l4"><a class="reference internal" href="#case-vanilla-structures-foreachreferenceisnotmodified">5.2.60.2. Vanilla</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#case-identical-conditions">5.2.61. Identical Conditions</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#case-wordpress-structures-identicalconditions">5.2.61.1. WordPress</a></li>
<li class="toctree-l4"><a class="reference internal" href="#case-dolibarr-structures-identicalconditions">5.2.61.2. Dolibarr</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#case-identical-on-both-sides">5.2.62. Identical On Both Sides</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#case-phpmyadmin-structures-identicalonbothsides">5.2.62.1. phpMyAdmin</a></li>
<li class="toctree-l4"><a class="reference internal" href="#case-humo-gen-structures-identicalonbothsides">5.2.62.2. HuMo-Gen</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#if-with-same-conditions">5.2.63. If With Same Conditions</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#case-phpmyadmin-structures-ifwithsameconditions">5.2.63.1. phpMyAdmin</a></li>
<li class="toctree-l4"><a class="reference internal" href="#case-phpdocumentor-structures-ifwithsameconditions">5.2.63.2. Phpdocumentor</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#indices-are-int-or-string">5.2.64. Indices Are Int Or String</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#case-zencart-structures-indicesareintorstring">5.2.64.1. Zencart</a></li>
<li class="toctree-l4"><a class="reference internal" href="#case-mautic-structures-indicesareintorstring">5.2.64.2. Mautic</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#invalid-regex">5.2.65. Invalid Regex</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#case-sugarcrm-structures-invalidregex">5.2.65.1. SugarCrm</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#is-actually-zero">5.2.66. Is Actually Zero</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#case-dolibarr-structures-iszero">5.2.66.1. Dolibarr</a></li>
<li class="toctree-l4"><a class="reference internal" href="#case-suitecrm-structures-iszero">5.2.66.2. SuiteCrm</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#list-may-omit-variables">5.2.67. list() May Omit Variables</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#case-openconf-structures-listomissions">5.2.67.1. OpenConf</a></li>
<li class="toctree-l4"><a class="reference internal" href="#case-fuelcms-structures-listomissions">5.2.67.2. FuelCMS</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#logical-mistakes">5.2.68. Logical Mistakes</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#case-dolibarr-structures-logicalmistakes">5.2.68.1. Dolibarr</a></li>
<li class="toctree-l4"><a class="reference internal" href="#case-cleverstyle-structures-logicalmistakes">5.2.68.2. Cleverstyle</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#lone-blocks">5.2.69. Lone Blocks</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#case-thinkphp-structures-loneblock">5.2.69.1. ThinkPHP</a></li>
<li class="toctree-l4"><a class="reference internal" href="#case-tine20-structures-loneblock">5.2.69.2. Tine20</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#multiples-identical-case">5.2.70. Multiples Identical Case</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#case-sugarcrm-structures-multipledefinedcase">5.2.70.1. SugarCrm</a></li>
<li class="toctree-l4"><a class="reference internal" href="#case-expressionengine-structures-multipledefinedcase">5.2.70.2. ExpressionEngine</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#multiply-by-one">5.2.71. Multiply By One</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#case-sugarcrm-structures-multiplybyone">5.2.71.1. SugarCrm</a></li>
<li class="toctree-l4"><a class="reference internal" href="#edusoho">5.2.71.2. Edusoho</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#nested-ternary">5.2.72. Nested Ternary</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#case-spip-structures-nestedternary">5.2.72.1. SPIP</a></li>
<li class="toctree-l4"><a class="reference internal" href="#case-zencart-structures-nestedternary">5.2.72.2. Zencart</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#always-positive-comparison">5.2.73. Always Positive Comparison</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#case-magento-structures-nevernegative">5.2.73.1. Magento</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#next-month-trap">5.2.74. Next Month Trap</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#case-contao-structures-nextmonthtrap">5.2.74.1. Contao</a></li>
<li class="toctree-l4"><a class="reference internal" href="#case-edusoho-structures-nextmonthtrap">5.2.74.2. Edusoho</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#no-choice">5.2.75. No Choice</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#nextcloud">5.2.75.1. NextCloud</a></li>
<li class="toctree-l4"><a class="reference internal" href="#case-zencart-structures-nochoice">5.2.75.2. Zencart</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#no-empty-regex">5.2.76. No Empty Regex</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#case-tikiwiki-structures-noemptyregex">5.2.76.1. Tikiwiki</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#no-isset-with-empty">5.2.77. No isset() With empty()</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#case-xoops-structures-noissetwithempty">5.2.77.1. XOOPS</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#no-parenthesis-for-language-construct">5.2.78. No Parenthesis For Language Construct</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#case-phpdocumentor-structures-noparenthesisforlanguageconstruct">5.2.78.1. Phpdocumentor</a></li>
<li class="toctree-l4"><a class="reference internal" href="#case-phpmyadmin-structures-noparenthesisforlanguageconstruct">5.2.78.2. phpMyAdmin</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#avoid-substr-one">5.2.79. Avoid Substr() One</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#case-churchcrm-structures-nosubstrone">5.2.79.1. ChurchCRM</a></li>
<li class="toctree-l4"><a class="reference internal" href="#case-livezilla-structures-nosubstrone">5.2.79.2. LiveZilla</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#operator">5.2.80. &#64; Operator</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#case-phinx-structures-noscream">5.2.80.1. Phinx</a></li>
<li class="toctree-l4"><a class="reference internal" href="#case-phpipam-structures-noscream">5.2.80.2. PhpIPAM</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#not-not">5.2.81. Not Not</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#case-cleverstyle-structures-notnot">5.2.81.1. Cleverstyle</a></li>
<li class="toctree-l4"><a class="reference internal" href="#case-tine20-structures-notnot">5.2.81.2. Tine20</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#objects-don-t-need-references">5.2.82. Objects Don’t Need References</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#case-zencart-structures-objectreferences">5.2.82.1. Zencart</a></li>
<li class="toctree-l4"><a class="reference internal" href="#case-xoops-structures-objectreferences">5.2.82.2. XOOPS</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#include-once-usage">5.2.83. include_once() Usage</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#case-xoops-structures-onceusage">5.2.83.1. XOOPS</a></li>
<li class="toctree-l4"><a class="reference internal" href="#case-tikiwiki-structures-onceusage">5.2.83.2. Tikiwiki</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#or-die">5.2.84. Or Die</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#case-tine20-structures-ordie">5.2.84.1. Tine20</a></li>
<li class="toctree-l4"><a class="reference internal" href="#case-openconf-structures-ordie">5.2.84.2. OpenConf</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#printf-number-of-arguments">5.2.85. Printf Number Of Arguments</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#case-phpipam-structures-printfarguments">5.2.85.1. PhpIPAM</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#repeated-print">5.2.86. Repeated print()</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#case-edusoho-structures-repeatedprint">5.2.86.1. Edusoho</a></li>
<li class="toctree-l4"><a class="reference internal" href="#case-humo-gen-structures-repeatedprint">5.2.86.2. HuMo-Gen</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#repeated-regex">5.2.87. Repeated Regex</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#case-vanilla-structures-repeatedregex">5.2.87.1. Vanilla</a></li>
<li class="toctree-l4"><a class="reference internal" href="#case-tikiwiki-structures-repeatedregex">5.2.87.2. Tikiwiki</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#return-true-false">5.2.88. Return True False</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#case-mautic-structures-returntruefalse">5.2.88.1. Mautic</a></li>
<li class="toctree-l4"><a class="reference internal" href="#case-fuelcms-structures-returntruefalse">5.2.88.2. FuelCMS</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#same-conditions-in-condition">5.2.89. Same Conditions In Condition</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#case-teampass-structures-sameconditions">5.2.89.1. TeamPass</a></li>
<li class="toctree-l4"><a class="reference internal" href="#case-typo3-structures-sameconditions">5.2.89.2. Typo3</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#should-chain-exception">5.2.90. Should Chain Exception</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#case-magento-structures-shouldchainexception">5.2.90.1. Magento</a></li>
<li class="toctree-l4"><a class="reference internal" href="#case-tine20-structures-shouldchainexception">5.2.90.2. Tine20</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#should-make-ternary">5.2.91. Should Make Ternary</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#case-churchcrm-structures-shouldmaketernary">5.2.91.1. ChurchCRM</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#strpos-like-comparison">5.2.92. Strpos()-like Comparison</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#case-piwigo-structures-strposcompare">5.2.92.1. Piwigo</a></li>
<li class="toctree-l4"><a class="reference internal" href="#case-thelia-structures-strposcompare">5.2.92.2. Thelia</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#switch-without-default">5.2.93. Switch Without Default</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#case-zencart-structures-switchwithoutdefault">5.2.93.1. Zencart</a></li>
<li class="toctree-l4"><a class="reference internal" href="#case-traq-structures-switchwithoutdefault">5.2.93.2. Traq</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#ternary-in-concat">5.2.94. Ternary In Concat</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#case-teampass-structures-ternaryinconcat">5.2.94.1. TeamPass</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#timestamp-difference">5.2.95. Timestamp Difference</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#case-zurmo-structures-timestampdifference">5.2.95.1. Zurmo</a></li>
<li class="toctree-l4"><a class="reference internal" href="#case-shopware-structures-timestampdifference">5.2.95.2. shopware</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#unconditional-break-in-loop">5.2.96. Unconditional Break In Loop</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#case-livezilla-structures-unconditionloopbreak">5.2.96.1. LiveZilla</a></li>
<li class="toctree-l4"><a class="reference internal" href="#case-mediawiki-structures-unconditionloopbreak">5.2.96.2. MediaWiki</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#useless-brackets">5.2.97. Useless Brackets</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#case-churchcrm-structures-uselessbrackets">5.2.97.1. ChurchCRM</a></li>
<li class="toctree-l4"><a class="reference internal" href="#case-piwigo-structures-uselessbrackets">5.2.97.2. Piwigo</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#useless-type-casting">5.2.98. Useless Type Casting</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#case-fuelcms-structures-uselesscasting">5.2.98.1. FuelCMS</a></li>
<li class="toctree-l4"><a class="reference internal" href="#case-thinkphp-structures-uselesscasting">5.2.98.2. ThinkPHP</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#useless-check">5.2.99. Useless Check</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#case-magento-structures-uselesscheck">5.2.99.1. Magento</a></li>
<li class="toctree-l4"><a class="reference internal" href="#case-phinx-structures-uselesscheck">5.2.99.2. Phinx</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#useless-parenthesis">5.2.100. Useless Parenthesis</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#case-mautic-structures-uselessparenthesis">5.2.100.1. Mautic</a></li>
<li class="toctree-l4"><a class="reference internal" href="#case-woocommerce-structures-uselessparenthesis">5.2.100.2. Woocommerce</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#useless-unset">5.2.101. Useless Unset</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#case-tine20-structures-uselessunset">5.2.101.1. Tine20</a></li>
<li class="toctree-l4"><a class="reference internal" href="#case-typo3-structures-uselessunset">5.2.101.2. Typo3</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#var-dump-usage">5.2.102. var_dump()… Usage</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#case-tine20-structures-vardumpusage">5.2.102.1. Tine20</a></li>
<li class="toctree-l4"><a class="reference internal" href="#case-piwigo-structures-vardumpusage">5.2.102.2. Piwigo</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#while-list-each">5.2.103. While(List() = Each())</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#case-openemr-structures-whilelisteach">5.2.103.1. OpenEMR</a></li>
<li class="toctree-l4"><a class="reference internal" href="#case-dolphin-structures-whilelisteach">5.2.103.2. Dolphin</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#preg-replace-with-option-e">5.2.104. preg_replace With Option e</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#case-edusoho-structures-pregoptione">5.2.104.1. Edusoho</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#no-real-comparison">5.2.105. No Real Comparison</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#case-magento-type-norealcomparison">5.2.105.1. Magento</a></li>
<li class="toctree-l4"><a class="reference internal" href="#case-spip-type-norealcomparison">5.2.105.2. SPIP</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#one-variable-string">5.2.106. One Variable String</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#case-tikiwiki-type-onevariablestrings">5.2.106.1. Tikiwiki</a></li>
<li class="toctree-l4"><a class="reference internal" href="#case-nextcloud-type-onevariablestrings">5.2.106.2. NextCloud</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#should-typecast">5.2.107. Should Typecast</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#case-xataface-type-shouldtypecast">5.2.107.1. xataface</a></li>
<li class="toctree-l4"><a class="reference internal" href="#case-openconf-type-shouldtypecast">5.2.107.2. OpenConf</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#silently-cast-integer">5.2.108. Silently Cast Integer</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#case-mediawiki-type-silentlycastinteger">5.2.108.1. MediaWiki</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#strings-with-strange-space">5.2.109. Strings With Strange Space</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#case-openemr-type-stringwithstrangespace">5.2.109.1. OpenEMR</a></li>
<li class="toctree-l4"><a class="reference internal" href="#case-thelia-type-stringwithstrangespace">5.2.109.2. Thelia</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#used-once-variables-in-scope">5.2.110. Used Once Variables (In Scope)</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#case-shopware-variables-variableusedoncebycontext">5.2.110.1. shopware</a></li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
</ul>
<p class="caption" role="heading"><span class="caption-text">ADMINISTRATOR GUIDE</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../Administrator/Installation.html">Installation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../Administrator/Upgrading.html">Upgrading</a></li>
<li class="toctree-l1"><a class="reference internal" href="../Administrator/Configuration.html">Configuration</a></li>
<li class="toctree-l1"><a class="reference internal" href="../Administrator/Commands.html">Commands</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">OTHERS</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../FAQ.html">Frequently Asked Questions</a></li>
<li class="toctree-l1"><a class="reference internal" href="../Definitions.html">Glossary</a></li>
<li class="toctree-l1"><a class="reference internal" href="../Annex.html">Annex</a></li>
</ul>

            
          
        </div>
        
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">Exakat</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          

















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="../index.html" class="icon icon-home"></a> &raquo;</li>
        
      <li><span class="section-number">5. </span>Real Code Cases</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
          
            <a href="../_sources/Reference/Cases.rst.txt" rel="nofollow"> View page source</a>
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="real-code-cases">
<span id="cases"></span><h1><span class="section-number">5. </span>Real Code Cases<a class="headerlink" href="#real-code-cases" title="Permalink to this headline">¶</a></h1>
<div class="section" id="introduction">
<h2><span class="section-number">5.1. </span>Introduction<a class="headerlink" href="#introduction" title="Permalink to this headline">¶</a></h2>
<p>All the examples in this section are real code, extracted from major PHP applications.</p>
</div>
<div class="section" id="list-of-real-code-cases">
<h2><span class="section-number">5.2. </span>List of real code Cases<a class="headerlink" href="#list-of-real-code-cases" title="Permalink to this headline">¶</a></h2>
<div class="section" id="multiple-index-definition">
<span id="case-multiple-index-definition"></span><h3><span class="section-number">5.2.1. </span>Multiple Index Definition<a class="headerlink" href="#multiple-index-definition" title="Permalink to this headline">¶</a></h3>
<div class="section" id="magento">
<span id="case-magento-arrays-multipleidenticalkeys"></span><h4><span class="section-number">5.2.1.1. </span>Magento<a class="headerlink" href="#magento" title="Permalink to this headline">¶</a></h4>
<p><a class="reference internal" href="Rules.html#multiple-index-definition"><span class="std std-ref">Multiple Index Definition</span></a>, in app/code/core/Mage/Adminhtml/Block/System/Convert/Gui/Grid.php:80.</p>
<p>‘type’ is defined twice. The first one, ‘options’ is overwritten.</p>
<div class="highlight-php notranslate"><div class="highlight"><pre><span></span><span class="nv">$this</span><span class="o">-&gt;</span><span class="na">addColumn</span><span class="p">(</span><span class="s1">&#39;store_id&#39;</span><span class="p">,</span> <span class="k">array</span><span class="p">(</span>
            <span class="s1">&#39;header&#39;</span>    <span class="o">=&gt;</span> <span class="nx">Mage</span><span class="o">::</span><span class="na">helper</span><span class="p">(</span><span class="s1">&#39;adminhtml&#39;</span><span class="p">)</span><span class="o">-&gt;</span><span class="na">__</span><span class="p">(</span><span class="s1">&#39;Store&#39;</span><span class="p">),</span>
            <span class="s1">&#39;type&#39;</span>      <span class="o">=&gt;</span> <span class="s1">&#39;options&#39;</span><span class="p">,</span>
            <span class="s1">&#39;align&#39;</span>     <span class="o">=&gt;</span> <span class="s1">&#39;center&#39;</span><span class="p">,</span>
            <span class="s1">&#39;index&#39;</span>     <span class="o">=&gt;</span> <span class="s1">&#39;store_id&#39;</span><span class="p">,</span>
            <span class="s1">&#39;type&#39;</span>      <span class="o">=&gt;</span> <span class="s1">&#39;store&#39;</span><span class="p">,</span>
            <span class="s1">&#39;width&#39;</span>     <span class="o">=&gt;</span> <span class="s1">&#39;200px&#39;</span><span class="p">,</span>
        <span class="p">));</span>
</pre></div>
</div>
</div>
<div class="section" id="mediawiki">
<span id="case-mediawiki-arrays-multipleidenticalkeys"></span><h4><span class="section-number">5.2.1.2. </span>MediaWiki<a class="headerlink" href="#mediawiki" title="Permalink to this headline">¶</a></h4>
<p><a class="reference internal" href="Rules.html#multiple-index-definition"><span class="std std-ref">Multiple Index Definition</span></a>, in resources/Resources.php:223.</p>
<p>‘target’ is repeated, though with the same values. This is just dead code.</p>
<div class="highlight-php notranslate"><div class="highlight"><pre><span></span><span class="c1">// inside a big array</span>
    <span class="s1">&#39;jquery.getAttrs&#39;</span> <span class="o">=&gt;</span> <span class="p">[</span>
            <span class="s1">&#39;targets&#39;</span> <span class="o">=&gt;</span> <span class="p">[</span> <span class="s1">&#39;desktop&#39;</span><span class="p">,</span> <span class="s1">&#39;mobile&#39;</span> <span class="p">],</span>
            <span class="s1">&#39;scripts&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;resources/src/jquery/jquery.getAttrs.js&#39;</span><span class="p">,</span>
            <span class="s1">&#39;targets&#39;</span> <span class="o">=&gt;</span> <span class="p">[</span> <span class="s1">&#39;desktop&#39;</span><span class="p">,</span> <span class="s1">&#39;mobile&#39;</span> <span class="p">],</span>
    <span class="p">],</span>
    <span class="c1">// big array continues</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="don-t-unset-properties">
<span id="case-don-t-unset-properties"></span><h3><span class="section-number">5.2.2. </span>Don’t Unset Properties<a class="headerlink" href="#don-t-unset-properties" title="Permalink to this headline">¶</a></h3>
<div class="section" id="vanilla">
<span id="case-vanilla-classes-dontunsetproperties"></span><h4><span class="section-number">5.2.2.1. </span>Vanilla<a class="headerlink" href="#vanilla" title="Permalink to this headline">¶</a></h4>
<p><a class="reference internal" href="Rules.html#don-t-unset-properties"><span class="std std-ref">Don’t Unset Properties</span></a>, in applications/dashboard/models/class.activitymodel.php:1073.</p>
<p>The _NotificationQueue property, in this class, is defined as an array. Here, it is destroyed, then recreated. The unset() is too much, as the assignation is sufficient to reset the array</p>
<div class="highlight-php notranslate"><div class="highlight"><pre><span></span><span class="sd">/**</span>
<span class="sd">     * Clear notification queue.</span>
<span class="sd">     *</span>
<span class="sd">     * @since 2.0.17</span>
<span class="sd">     * @access public</span>
<span class="sd">     */</span>
    <span class="k">public</span> <span class="k">function</span> <span class="nf">clearNotificationQueue</span><span class="p">()</span> <span class="p">{</span>
        <span class="nb">unset</span><span class="p">(</span><span class="nv">$this</span><span class="o">-&gt;</span><span class="na">_NotificationQueue</span><span class="p">);</span>
        <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">_NotificationQueue</span> <span class="o">=</span> <span class="p">[];</span>
    <span class="p">}</span>
</pre></div>
</div>
</div>
<div class="section" id="typo3">
<span id="case-typo3-classes-dontunsetproperties"></span><h4><span class="section-number">5.2.2.2. </span>Typo3<a class="headerlink" href="#typo3" title="Permalink to this headline">¶</a></h4>
<p><a class="reference internal" href="Rules.html#don-t-unset-properties"><span class="std std-ref">Don’t Unset Properties</span></a>, in typo3/sysext/linkvalidator/Classes/Linktype/InternalLinktype.php:73.</p>
<p>The property errorParams is emptied by unsetting it. The property is actually defined in the above class, as an array. Until the next error is added to this list, any access to the error list has to be checked with isset(), or yield an ‘Undefined’ warning.</p>
<div class="highlight-php notranslate"><div class="highlight"><pre><span></span><span class="k">public</span> <span class="k">function</span> <span class="nf">checkLink</span><span class="p">(</span><span class="nv">$url</span><span class="p">,</span> <span class="nv">$softRefEntry</span><span class="p">,</span> <span class="nv">$reference</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="nv">$anchor</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span><span class="p">;</span>
        <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">responseContent</span> <span class="o">=</span> <span class="k">true</span><span class="p">;</span>
        <span class="c1">// Might already contain values - empty it</span>
        <span class="nb">unset</span><span class="p">(</span><span class="nv">$this</span><span class="o">-&gt;</span><span class="na">errorParams</span><span class="p">);</span>
<span class="c1">//....</span>

<span class="k">abstract</span> <span class="k">class</span> <span class="nc">AbstractLinktype</span> <span class="k">implements</span> <span class="nx">LinktypeInterface</span>
<span class="p">{</span>
    <span class="sd">/**</span>
<span class="sd">     * Contains parameters needed for the rendering of the error message</span>
<span class="sd">     *</span>
<span class="sd">     * @var array</span>
<span class="sd">     */</span>
    <span class="k">protected</span> <span class="nv">$errorParams</span> <span class="o">=</span> <span class="p">[];</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="forgotten-visibility">
<span id="case-forgotten-visibility"></span><h3><span class="section-number">5.2.3. </span>Forgotten Visibility<a class="headerlink" href="#forgotten-visibility" title="Permalink to this headline">¶</a></h3>
<div class="section" id="fuelcms">
<span id="case-fuelcms-classes-nonppp"></span><h4><span class="section-number">5.2.3.1. </span>FuelCMS<a class="headerlink" href="#fuelcms" title="Permalink to this headline">¶</a></h4>
<p><a class="reference internal" href="Rules.html#forgotten-visibility"><span class="std std-ref">Forgotten Visibility</span></a>, in /fuel/modules/fuel/controllers/Module.php:713.</p>
<p>Missing visibility for the index() method,and all the methods in the Module class.</p>
<div class="highlight-php notranslate"><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">Module</span> <span class="k">extends</span> <span class="nx">Fuel_base_controller</span> <span class="p">{</span>

    <span class="c1">// --------------------------------------------------------------------</span>

    <span class="sd">/**</span>
<span class="sd">     * Displays the list (table) view</span>
<span class="sd">     *</span>
<span class="sd">     * @access      public</span>
<span class="sd">     * @return      void</span>
<span class="sd">     */</span>
    <span class="k">function</span> <span class="nf">index</span><span class="p">()</span>
    <span class="p">{</span>
            <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">items</span><span class="p">();</span>
    <span class="p">}</span>
</pre></div>
</div>
</div>
<div class="section" id="livezilla">
<span id="case-livezilla-classes-nonppp"></span><h4><span class="section-number">5.2.3.2. </span>LiveZilla<a class="headerlink" href="#livezilla" title="Permalink to this headline">¶</a></h4>
<p><a class="reference internal" href="Rules.html#forgotten-visibility"><span class="std std-ref">Forgotten Visibility</span></a>, in livezilla/_lib/objects.global.users.inc.php:2516.</p>
<p>Static method that could be public.</p>
<div class="highlight-php notranslate"><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">Visitor</span> <span class="k">extends</span> <span class="nx">BaseUser</span>
<span class="p">{</span>
<span class="c1">// Lots of code</span>

    <span class="k">static</span> <span class="k">function</span> <span class="nf">CreateSPAMFilter</span><span class="p">(</span><span class="nv">$_userId</span><span class="p">,</span><span class="nv">$_base64</span><span class="o">=</span><span class="k">true</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="k">if</span><span class="p">(</span><span class="o">!</span><span class="k">empty</span><span class="p">(</span><span class="nx">Server</span><span class="o">::</span><span class="nv">$Configuration</span><span class="o">-&gt;</span><span class="na">File</span><span class="p">[</span><span class="nx">gl_sfa</span><span class="p">]))</span>
        <span class="p">{</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="non-static-methods-called-in-a-static">
<span id="case-non-static-methods-called-in-a-static"></span><h3><span class="section-number">5.2.4. </span>Non Static Methods Called In A Static<a class="headerlink" href="#non-static-methods-called-in-a-static" title="Permalink to this headline">¶</a></h3>
<div class="section" id="dolphin">
<span id="case-dolphin-classes-nonstaticmethodscalledstatic"></span><h4><span class="section-number">5.2.4.1. </span>Dolphin<a class="headerlink" href="#dolphin" title="Permalink to this headline">¶</a></h4>
<p><a class="reference internal" href="Rules.html#non-static-methods-called-in-a-static"><span class="std std-ref">Non Static Methods Called In A Static</span></a>, in Dolphin-v.7.3.5/xmlrpc/BxDolXMLRPCFriends.php:11.</p>
<p>getIdByNickname() is indeed defined in the class ‘BxDolXMLRPCUtil’ and it calls the database. The class relies on functions (not methods) to query the database with the correct connexion.</p>
<div class="highlight-php notranslate"><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">BxDolXMLRPCFriends</span>
<span class="p">{</span>
    <span class="k">function</span> <span class="nf">getFriends</span><span class="p">(</span><span class="nv">$sUser</span><span class="p">,</span> <span class="nv">$sPwd</span><span class="p">,</span> <span class="nv">$sNick</span><span class="p">,</span> <span class="nv">$sLang</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="nv">$iIdProfile</span> <span class="o">=</span> <span class="nx">BxDolXMLRPCUtil</span><span class="o">::</span><span class="na">getIdByNickname</span> <span class="p">(</span><span class="nv">$sNick</span><span class="p">);</span>
</pre></div>
</div>
</div>
<div class="section" id="case-magento-classes-nonstaticmethodscalledstatic">
<span id="id1"></span><h4><span class="section-number">5.2.4.2. </span>Magento<a class="headerlink" href="#case-magento-classes-nonstaticmethodscalledstatic" title="Permalink to this headline">¶</a></h4>
<p><a class="reference internal" href="Rules.html#non-static-methods-called-in-a-static"><span class="std std-ref">Non Static Methods Called In A Static</span></a>, in app/code/core/Mage/Paypal/Model/Payflowlink.php:143.</p>
<p>Mage_Payment_Model_Method_Abstract is an abstract class : this way, it is not possible to instantiate it and then, access its methods. The class is extended, so it could be called from one of the objects. Although, the troubling part is that isAvailable() uses $this, so it can’t be static.</p>
<div class="highlight-php notranslate"><div class="highlight"><pre><span></span><span class="nx">Mage_Payment_Model_Method_Abstract</span><span class="o">::</span><span class="na">isAvailable</span><span class="p">(</span><span class="nv">$quote</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="redefined-default">
<span id="case-redefined-default"></span><h3><span class="section-number">5.2.5. </span>Redefined Default<a class="headerlink" href="#redefined-default" title="Permalink to this headline">¶</a></h3>
<div class="section" id="piwigo">
<span id="case-piwigo-classes-redefineddefault"></span><h4><span class="section-number">5.2.5.1. </span>Piwigo<a class="headerlink" href="#piwigo" title="Permalink to this headline">¶</a></h4>
<p><a class="reference internal" href="Rules.html#redefined-default"><span class="std std-ref">Redefined Default</span></a>, in admin/include/updates.class.php:34.</p>
<p>default_themes is defined as an empty array, then filled with new values. Same for default_plugins. Both may be defined as declaration time, and not during the constructor.</p>
<div class="highlight-php notranslate"><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">updates</span>
<span class="p">{</span>
  <span class="k">var</span> <span class="nv">$types</span> <span class="o">=</span> <span class="k">array</span><span class="p">();</span>
  <span class="k">var</span> <span class="nv">$plugins</span><span class="p">;</span>
  <span class="k">var</span> <span class="nv">$themes</span><span class="p">;</span>
  <span class="k">var</span> <span class="nv">$languages</span><span class="p">;</span>
  <span class="k">var</span> <span class="nv">$missing</span> <span class="o">=</span> <span class="k">array</span><span class="p">();</span>
  <span class="k">var</span> <span class="nv">$default_plugins</span> <span class="o">=</span> <span class="k">array</span><span class="p">();</span>
  <span class="k">var</span> <span class="nv">$default_themes</span> <span class="o">=</span> <span class="k">array</span><span class="p">();</span>
  <span class="k">var</span> <span class="nv">$default_languages</span> <span class="o">=</span> <span class="k">array</span><span class="p">();</span>
  <span class="k">var</span> <span class="nv">$merged_extensions</span> <span class="o">=</span> <span class="k">array</span><span class="p">();</span>
  <span class="k">var</span> <span class="nv">$merged_extension_url</span> <span class="o">=</span> <span class="s1">&#39;http://piwigo.org/download/merged_extensions.txt&#39;</span><span class="p">;</span>

  <span class="k">function</span> <span class="fm">__construct</span><span class="p">(</span><span class="nv">$page</span><span class="o">=</span><span class="s1">&#39;updates&#39;</span><span class="p">)</span>
  <span class="p">{</span>
    <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">types</span> <span class="o">=</span> <span class="k">array</span><span class="p">(</span><span class="s1">&#39;plugins&#39;</span><span class="p">,</span> <span class="s1">&#39;themes&#39;</span><span class="p">,</span> <span class="s1">&#39;languages&#39;</span><span class="p">);</span>

    <span class="k">if</span> <span class="p">(</span><span class="nb">in_array</span><span class="p">(</span><span class="nv">$page</span><span class="p">,</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">types</span><span class="p">))</span>
    <span class="p">{</span>
      <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">types</span> <span class="o">=</span> <span class="k">array</span><span class="p">(</span><span class="nv">$page</span><span class="p">);</span>
    <span class="p">}</span>
    <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">default_themes</span> <span class="o">=</span> <span class="k">array</span><span class="p">(</span><span class="s1">&#39;clear&#39;</span><span class="p">,</span> <span class="s1">&#39;dark&#39;</span><span class="p">,</span> <span class="s1">&#39;Sylvia&#39;</span><span class="p">,</span> <span class="s1">&#39;elegant&#39;</span><span class="p">,</span> <span class="s1">&#39;smartpocket&#39;</span><span class="p">);</span>
    <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">default_plugins</span> <span class="o">=</span> <span class="k">array</span><span class="p">(</span><span class="s1">&#39;AdminTools&#39;</span><span class="p">,</span> <span class="s1">&#39;TakeATour&#39;</span><span class="p">,</span> <span class="s1">&#39;language_switch&#39;</span><span class="p">,</span> <span class="s1">&#39;LocalFilesEditor&#39;</span><span class="p">);</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="static-methods-can-t-contain-this">
<span id="case-static-methods-can-t-contain-this"></span><h3><span class="section-number">5.2.6. </span>Static Methods Can’t Contain $this<a class="headerlink" href="#static-methods-can-t-contain-this" title="Permalink to this headline">¶</a></h3>
<div class="section" id="xataface">
<span id="case-xataface-classes-staticcontainsthis"></span><h4><span class="section-number">5.2.6.1. </span>xataface<a class="headerlink" href="#xataface" title="Permalink to this headline">¶</a></h4>
<p><a class="reference internal" href="Rules.html#static-methods-can-t-contain-this"><span class="std std-ref">Static Methods Can’t Contain $this</span></a>, in Dataface/LanguageTool.php:48.</p>
<p>$this is hidden in the arguments of the static call to the method.</p>
<div class="highlight-php notranslate"><div class="highlight"><pre><span></span><span class="k">public</span> <span class="k">static</span> <span class="k">function</span> <span class="nf">loadRealm</span><span class="p">(</span><span class="nv">$name</span><span class="p">){</span>
            <span class="k">return</span> <span class="nx">self</span><span class="o">::</span><span class="na">getInstance</span><span class="p">(</span><span class="nv">$this</span><span class="o">-&gt;</span><span class="na">app</span><span class="o">-&gt;</span><span class="na">_conf</span><span class="p">[</span><span class="s1">&#39;default_language&#39;</span><span class="p">])</span><span class="o">-&gt;</span><span class="na">loadRealm</span><span class="p">(</span><span class="nv">$name</span><span class="p">);</span>
    <span class="p">}</span>
</pre></div>
</div>
</div>
<div class="section" id="sugarcrm">
<span id="case-sugarcrm-classes-staticcontainsthis"></span><h4><span class="section-number">5.2.6.2. </span>SugarCrm<a class="headerlink" href="#sugarcrm" title="Permalink to this headline">¶</a></h4>
<p><a class="reference internal" href="Rules.html#static-methods-can-t-contain-this"><span class="std std-ref">Static Methods Can’t Contain $this</span></a>, in SugarCE-Full-6.5.26/modules/ACLActions/ACLAction.php:332.</p>
<p>Notice how $this is tested for existence before using it. It seems strange, at first, but we have to remember that if $this is never set when calling a static method, a static method may be called with $this. Confusingly, this static method may be called in two ways.</p>
<div class="highlight-php notranslate"><div class="highlight"><pre><span></span><span class="k">static</span> <span class="k">function</span> <span class="nf">hasAccess</span><span class="p">(</span><span class="nv">$is_owner</span><span class="o">=</span><span class="k">false</span><span class="p">,</span> <span class="nv">$access</span> <span class="o">=</span> <span class="mi">0</span><span class="p">){</span>

        <span class="k">if</span><span class="p">(</span><span class="nv">$access</span> <span class="o">!=</span> <span class="mi">0</span> <span class="o">&amp;&amp;</span> <span class="nv">$access</span> <span class="o">==</span> <span class="nx">ACL_ALLOW_ALL</span> <span class="o">||</span> <span class="p">(</span><span class="nv">$is_owner</span> <span class="o">&amp;&amp;</span> <span class="nv">$access</span> <span class="o">==</span> <span class="nx">ACL_ALLOW_OWNER</span><span class="p">))</span><span class="k">return</span> <span class="k">true</span><span class="p">;</span>
       <span class="c1">//if this exists, then this function is not static, so check the aclaccess parameter</span>
        <span class="k">if</span><span class="p">(</span><span class="nb">isset</span><span class="p">(</span><span class="nv">$this</span><span class="p">)</span> <span class="o">&amp;&amp;</span> <span class="nb">isset</span><span class="p">(</span><span class="nv">$this</span><span class="o">-&gt;</span><span class="na">aclaccess</span><span class="p">)){</span>
            <span class="k">if</span><span class="p">(</span><span class="nv">$this</span><span class="o">-&gt;</span><span class="na">aclaccess</span> <span class="o">==</span> <span class="nx">ACL_ALLOW_ALL</span> <span class="o">||</span> <span class="p">(</span><span class="nv">$is_owner</span> <span class="o">&amp;&amp;</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">aclaccess</span> <span class="o">==</span> <span class="nx">ACL_ALLOW_OWNER</span><span class="p">))</span>
            <span class="k">return</span> <span class="k">true</span><span class="p">;</span>
        <span class="p">}</span>
        <span class="k">return</span> <span class="k">false</span><span class="p">;</span>
    <span class="p">}</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="wrong-access-style-to-property">
<span id="case-wrong-access-style-to-property"></span><h3><span class="section-number">5.2.7. </span>Wrong Access Style to Property<a class="headerlink" href="#wrong-access-style-to-property" title="Permalink to this headline">¶</a></h3>
<div class="section" id="humo-gen">
<span id="case-humo-gen-classes-undeclaredstaticproperty"></span><h4><span class="section-number">5.2.7.1. </span>HuMo-Gen<a class="headerlink" href="#humo-gen" title="Permalink to this headline">¶</a></h4>
<p><a class="reference internal" href="Rules.html#wrong-access-style-to-property"><span class="std std-ref">Wrong Access Style to Property</span></a>, in wp-admin/includes/misc.php:74.</p>
<p>lame_binary_path is a static property, but it is accessed as a normal property in the exception call, while it is checked with a valid syntax.</p>
<div class="highlight-php notranslate"><div class="highlight"><pre><span></span><span class="k">protected</span> <span class="k">function</span> <span class="nf">wavToMp3</span><span class="p">(</span><span class="nv">$data</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nb">file_exists</span><span class="p">(</span><span class="nx">self</span><span class="o">::</span><span class="nv">$lame_binary_path</span><span class="p">)</span> <span class="o">||</span> <span class="o">!</span><span class="nb">is_executable</span><span class="p">(</span><span class="nx">self</span><span class="o">::</span><span class="nv">$lame_binary_path</span><span class="p">))</span> <span class="p">{</span>
            <span class="k">throw</span> <span class="k">new</span> <span class="nx">Exception</span><span class="p">(</span><span class="s1">&#39;Lame binary  . $this-&gt;lame_binary_path .  does not exist or is not executable&#39;</span><span class="p">);</span>
        <span class="p">}</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="undefined-properties">
<span id="case-undefined-properties"></span><h3><span class="section-number">5.2.8. </span>Undefined Properties<a class="headerlink" href="#undefined-properties" title="Permalink to this headline">¶</a></h3>
<div class="section" id="wordpress">
<span id="case-wordpress-classes-undefinedproperty"></span><h4><span class="section-number">5.2.8.1. </span>WordPress<a class="headerlink" href="#wordpress" title="Permalink to this headline">¶</a></h4>
<p><a class="reference internal" href="Rules.html#undefined-properties"><span class="std std-ref">Undefined Properties</span></a>, in wp-admin/includes/misc.php:74.</p>
<p>Properties are not defined, but they are thoroughly initialized when the XML document is parsed. All those definition should be in a property definition, for clear documentation.</p>
<div class="highlight-php notranslate"><div class="highlight"><pre><span></span><span class="nv">$this</span><span class="o">-&gt;</span><span class="na">DeliveryLine1</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span><span class="p">;</span>
        <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">DeliveryLine2</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span><span class="p">;</span>
        <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">City</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span><span class="p">;</span>
        <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">State</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span><span class="p">;</span>
        <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">ZipAddon</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span><span class="p">;</span>
</pre></div>
</div>
</div>
<div class="section" id="case-mediawiki-classes-undefinedproperty">
<span id="id2"></span><h4><span class="section-number">5.2.8.2. </span>MediaWiki<a class="headerlink" href="#case-mediawiki-classes-undefinedproperty" title="Permalink to this headline">¶</a></h4>
<p><a class="reference internal" href="Rules.html#undefined-properties"><span class="std std-ref">Undefined Properties</span></a>, in includes/logging/LogFormatter.php:561.</p>
<p>parsedParametersDeleteLog is an undefined property. Defining the property with a null default value is important here, to keep the code running.</p>
<div class="highlight-php notranslate"><div class="highlight"><pre><span></span><span class="k">protected</span> <span class="k">function</span> <span class="nf">getMessageParameters</span><span class="p">()</span> <span class="p">{</span>
            <span class="k">if</span> <span class="p">(</span> <span class="nb">isset</span><span class="p">(</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">parsedParametersDeleteLog</span> <span class="p">)</span> <span class="p">)</span> <span class="p">{</span>
                    <span class="k">return</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">parsedParametersDeleteLog</span><span class="p">;</span>
            <span class="p">}</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="use-class-operator">
<span id="case-use-class-operator"></span><h3><span class="section-number">5.2.9. </span>Use ::Class Operator<a class="headerlink" href="#use-class-operator" title="Permalink to this headline">¶</a></h3>
<div class="section" id="case-typo3-classes-useclassoperator">
<span id="id3"></span><h4><span class="section-number">5.2.9.1. </span>Typo3<a class="headerlink" href="#case-typo3-classes-useclassoperator" title="Permalink to this headline">¶</a></h4>
<p><a class="reference internal" href="Rules.html#use-class-operator"><span class="std std-ref">Use ::Class Operator</span></a>, in typo3/sysext/install/Configuration/ExtensionScanner/Php/ConstructorArgumentMatcher.php:4.</p>
<p><code class="docutils literal notranslate"><span class="pre">TYPO3\CMS\Core\Package\PackageManager</span></code> could be <code class="docutils literal notranslate"><span class="pre">TYPO3\CMS\Core\Package\PackageManager::class</span></code>.</p>
<div class="highlight-php notranslate"><div class="highlight"><pre><span></span><span class="k">return</span> <span class="p">[</span>
    <span class="s1">&#39;TYPO3\CMS\Core\Package\PackageManager&#39;</span> <span class="o">=&gt;</span> <span class="p">[</span>
        <span class="s1">&#39;required&#39;</span> <span class="o">=&gt;</span> <span class="p">[</span>
            <span class="s1">&#39;numberOfMandatoryArguments&#39;</span> <span class="o">=&gt;</span> <span class="mi">1</span><span class="p">,</span>
            <span class="s1">&#39;maximumNumberOfArguments&#39;</span> <span class="o">=&gt;</span> <span class="mi">1</span><span class="p">,</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="use-instanceof">
<span id="case-use-instanceof"></span><h3><span class="section-number">5.2.10. </span>Use Instanceof<a class="headerlink" href="#use-instanceof" title="Permalink to this headline">¶</a></h3>
<div class="section" id="teampass">
<span id="case-teampass-classes-useinstanceof"></span><h4><span class="section-number">5.2.10.1. </span>TeamPass<a class="headerlink" href="#teampass" title="Permalink to this headline">¶</a></h4>
<p><a class="reference internal" href="Rules.html#use-instanceof"><span class="std std-ref">Use Instanceof</span></a>, in includes/libraries/Database/Meekrodb/db.class.php:506.</p>
<p>In this code, <code class="docutils literal notranslate"><span class="pre">is_object()</span></code> and <code class="docutils literal notranslate"><span class="pre">instanceof</span></code> have the same basic : they both check that $ts is an object. In fact, <code class="docutils literal notranslate"><span class="pre">instanceof</span></code> is more precise, and give more information about the variable.</p>
<div class="highlight-php notranslate"><div class="highlight"><pre><span></span><span class="k">protected</span> <span class="k">function</span> <span class="nf">parseTS</span><span class="p">(</span><span class="nv">$ts</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">if</span> <span class="p">(</span><span class="nb">is_string</span><span class="p">(</span><span class="nv">$ts</span><span class="p">))</span> <span class="k">return</span> <span class="nb">date</span><span class="p">(</span><span class="s1">&#39;Y-m-d H:i:s&#39;</span><span class="p">,</span> <span class="nb">strtotime</span><span class="p">(</span><span class="nv">$ts</span><span class="p">));</span>
    <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="nb">is_object</span><span class="p">(</span><span class="nv">$ts</span><span class="p">)</span> <span class="o">&amp;&amp;</span> <span class="p">(</span><span class="nv">$ts</span> <span class="nx">instanceof</span> <span class="nx">DateTime</span><span class="p">))</span> <span class="k">return</span> <span class="nv">$ts</span><span class="o">-&gt;</span><span class="na">format</span><span class="p">(</span><span class="s1">&#39;Y-m-d H:i:s&#39;</span><span class="p">);</span>
  <span class="p">}</span>
</pre></div>
</div>
</div>
<div class="section" id="zencart">
<span id="case-zencart-classes-useinstanceof"></span><h4><span class="section-number">5.2.10.2. </span>Zencart<a class="headerlink" href="#zencart" title="Permalink to this headline">¶</a></h4>
<p><a class="reference internal" href="Rules.html#use-instanceof"><span class="std std-ref">Use Instanceof</span></a>, in includes/modules/payment/firstdata_hco.php:104.</p>
<p>In this code, <code class="docutils literal notranslate"><span class="pre">is_object()</span></code> is used to check the status of the order. Possibly, $order is false or null in case of incompatible status. Yet, when $object is an object, and in particular being a global that may be assigned anywhere else in the code, it seems that the method ‘update_status’ is magically always available. Here, using instance of to make sure that $order is an ‘paypal’ class, or a ‘storepickup’ or any of the payment class.</p>
<div class="highlight-php notranslate"><div class="highlight"><pre><span></span><span class="k">function</span> <span class="fm">__construct</span><span class="p">()</span> <span class="p">{</span>
    <span class="k">global</span> <span class="nv">$order</span><span class="p">;</span>

    <span class="c1">// more lines, no mention of $order</span>
    <span class="k">if</span> <span class="p">(</span><span class="nb">is_object</span><span class="p">(</span><span class="nv">$order</span><span class="p">))</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">update_status</span><span class="p">();</span>

    <span class="c1">// more code</span>
<span class="p">}</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="use-const">
<span id="case-use-const"></span><h3><span class="section-number">5.2.11. </span>Use const<a class="headerlink" href="#use-const" title="Permalink to this headline">¶</a></h3>
<div class="section" id="phpmyadmin">
<span id="case-phpmyadmin-constants-constrecommended"></span><h4><span class="section-number">5.2.11.1. </span>phpMyAdmin<a class="headerlink" href="#phpmyadmin" title="Permalink to this headline">¶</a></h4>
<p><a class="reference internal" href="Rules.html#use-const"><span class="std std-ref">Use const</span></a>, in error_report.php:17.</p>
<p>This may be turned into a <cite>const</cite> call, with a static expression.</p>
<div class="highlight-php notranslate"><div class="highlight"><pre><span></span><span class="nb">define</span><span class="p">(</span><span class="s1">&#39;ROOT_PATH&#39;</span><span class="p">,</span> <span class="no">__DIR__</span> <span class="o">.</span> <span class="nx">DIRECTORY_SEPARATOR</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="section" id="case-piwigo-constants-constrecommended">
<span id="id4"></span><h4><span class="section-number">5.2.11.2. </span>Piwigo<a class="headerlink" href="#case-piwigo-constants-constrecommended" title="Permalink to this headline">¶</a></h4>
<p><a class="reference internal" href="Rules.html#use-const"><span class="std std-ref">Use const</span></a>, in include/functions_plugins.inc.php:32.</p>
<p>Const works efficiently with literal</p>
<div class="highlight-php notranslate"><div class="highlight"><pre><span></span><span class="nb">define</span><span class="p">(</span><span class="s1">&#39;EVENT_HANDLER_PRIORITY_NEUTRAL&#39;</span><span class="p">,</span> <span class="mi">50</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="multiple-constant-definition">
<span id="case-multiple-constant-definition"></span><h3><span class="section-number">5.2.12. </span>Multiple Constant Definition<a class="headerlink" href="#multiple-constant-definition" title="Permalink to this headline">¶</a></h3>
<div class="section" id="dolibarr">
<span id="case-dolibarr-constants-multipleconstantdefinition"></span><h4><span class="section-number">5.2.12.1. </span>Dolibarr<a class="headerlink" href="#dolibarr" title="Permalink to this headline">¶</a></h4>
<p><a class="reference internal" href="Rules.html#multiple-constant-definition"><span class="std std-ref">Multiple Constant Definition</span></a>, in htdocs/main.inc.php:914.</p>
<p>All is documented here : ‘Constants used to defined number of lines in textarea’. Constants are not changing during an execution, and this allows the script to set values early in the process, and have them used later, in the templates. Yet, building constants dynamically may lead to confusion, when developpers are not aware of the change.</p>
<div class="highlight-php notranslate"><div class="highlight"><pre><span></span><span class="c1">// Constants used to defined number of lines in textarea</span>
<span class="k">if</span> <span class="p">(</span><span class="k">empty</span><span class="p">(</span><span class="nv">$conf</span><span class="o">-&gt;</span><span class="na">browser</span><span class="o">-&gt;</span><span class="na">firefox</span><span class="p">))</span>
<span class="p">{</span>
    <span class="nb">define</span><span class="p">(</span><span class="s1">&#39;ROWS_1&#39;</span><span class="p">,</span><span class="mi">1</span><span class="p">);</span>
    <span class="nb">define</span><span class="p">(</span><span class="s1">&#39;ROWS_2&#39;</span><span class="p">,</span><span class="mi">2</span><span class="p">);</span>
    <span class="nb">define</span><span class="p">(</span><span class="s1">&#39;ROWS_3&#39;</span><span class="p">,</span><span class="mi">3</span><span class="p">);</span>
    <span class="nb">define</span><span class="p">(</span><span class="s1">&#39;ROWS_4&#39;</span><span class="p">,</span><span class="mi">4</span><span class="p">);</span>
    <span class="nb">define</span><span class="p">(</span><span class="s1">&#39;ROWS_5&#39;</span><span class="p">,</span><span class="mi">5</span><span class="p">);</span>
    <span class="nb">define</span><span class="p">(</span><span class="s1">&#39;ROWS_6&#39;</span><span class="p">,</span><span class="mi">6</span><span class="p">);</span>
    <span class="nb">define</span><span class="p">(</span><span class="s1">&#39;ROWS_7&#39;</span><span class="p">,</span><span class="mi">7</span><span class="p">);</span>
    <span class="nb">define</span><span class="p">(</span><span class="s1">&#39;ROWS_8&#39;</span><span class="p">,</span><span class="mi">8</span><span class="p">);</span>
    <span class="nb">define</span><span class="p">(</span><span class="s1">&#39;ROWS_9&#39;</span><span class="p">,</span><span class="mi">9</span><span class="p">);</span>
<span class="p">}</span>
<span class="k">else</span>
<span class="p">{</span>
    <span class="nb">define</span><span class="p">(</span><span class="s1">&#39;ROWS_1&#39;</span><span class="p">,</span><span class="mi">0</span><span class="p">);</span>
    <span class="nb">define</span><span class="p">(</span><span class="s1">&#39;ROWS_2&#39;</span><span class="p">,</span><span class="mi">1</span><span class="p">);</span>
    <span class="nb">define</span><span class="p">(</span><span class="s1">&#39;ROWS_3&#39;</span><span class="p">,</span><span class="mi">2</span><span class="p">);</span>
    <span class="nb">define</span><span class="p">(</span><span class="s1">&#39;ROWS_4&#39;</span><span class="p">,</span><span class="mi">3</span><span class="p">);</span>
    <span class="nb">define</span><span class="p">(</span><span class="s1">&#39;ROWS_5&#39;</span><span class="p">,</span><span class="mi">4</span><span class="p">);</span>
    <span class="nb">define</span><span class="p">(</span><span class="s1">&#39;ROWS_6&#39;</span><span class="p">,</span><span class="mi">5</span><span class="p">);</span>
    <span class="nb">define</span><span class="p">(</span><span class="s1">&#39;ROWS_7&#39;</span><span class="p">,</span><span class="mi">6</span><span class="p">);</span>
    <span class="nb">define</span><span class="p">(</span><span class="s1">&#39;ROWS_8&#39;</span><span class="p">,</span><span class="mi">7</span><span class="p">);</span>
    <span class="nb">define</span><span class="p">(</span><span class="s1">&#39;ROWS_9&#39;</span><span class="p">,</span><span class="mi">8</span><span class="p">);</span>
<span class="p">}</span>
</pre></div>
</div>
</div>
<div class="section" id="openconf">
<span id="case-openconf-constants-multipleconstantdefinition"></span><h4><span class="section-number">5.2.12.2. </span>OpenConf<a class="headerlink" href="#openconf" title="Permalink to this headline">¶</a></h4>
<p><a class="reference internal" href="Rules.html#multiple-constant-definition"><span class="std std-ref">Multiple Constant Definition</span></a>, in modules/request.php:71.</p>
<p>The constant is build according to the situation, in the part of the script (file request.php). This hides the actual origin of the value, but keeps the rest of the code simple. Just keep in mind that this constant may have different values.</p>
<div class="highlight-php notranslate"><div class="highlight"><pre><span></span><span class="k">if</span> <span class="p">(</span><span class="nb">isset</span><span class="p">(</span><span class="nv">$_GET</span><span class="p">[</span><span class="s1">&#39;ocparams&#39;</span><span class="p">])</span> <span class="o">&amp;&amp;</span> <span class="o">!</span><span class="k">empty</span><span class="p">(</span><span class="nv">$_GET</span><span class="p">[</span><span class="s1">&#39;ocparams&#39;</span><span class="p">]))</span> <span class="p">{</span>
            <span class="nv">$params</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span><span class="p">;</span>
            <span class="k">if</span> <span class="p">(</span><span class="nb">preg_match_all</span><span class="p">(</span><span class="s2">&quot;/(\w+)--(\w+)_-/&quot;</span><span class="p">,</span> <span class="nv">$_GET</span><span class="p">[</span><span class="s1">&#39;ocparams&#39;</span><span class="p">],</span> <span class="nv">$matches</span><span class="p">))</span> <span class="p">{</span>
                    <span class="k">foreach</span> <span class="p">(</span><span class="nv">$matches</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="k">as</span> <span class="nv">$idx</span> <span class="o">=&gt;</span> <span class="nv">$m</span><span class="p">)</span> <span class="p">{</span>
                            <span class="k">if</span> <span class="p">((</span><span class="nv">$m</span> <span class="o">!=</span> <span class="s1">&#39;module&#39;</span><span class="p">)</span> <span class="o">&amp;&amp;</span> <span class="p">(</span><span class="nv">$m</span> <span class="o">!=</span> <span class="s1">&#39;action&#39;</span><span class="p">)</span> <span class="o">&amp;&amp;</span> <span class="nb">preg_match</span><span class="p">(</span><span class="s2">&quot;/^[\w-]+$/&quot;</span><span class="p">,</span> <span class="nv">$m</span><span class="p">))</span> <span class="p">{</span>
                                    <span class="nv">$params</span> <span class="o">.=</span> <span class="s1">&#39;&amp;&#39;</span> <span class="o">.</span> <span class="nv">$m</span> <span class="o">.</span> <span class="s1">&#39;=&#39;</span> <span class="o">.</span> <span class="nb">urlencode</span><span class="p">(</span><span class="nv">$matches</span><span class="p">[</span><span class="mi">2</span><span class="p">][</span><span class="nv">$idx</span><span class="p">]);</span>
                                    <span class="nv">$_GET</span><span class="p">[</span><span class="nv">$m</span><span class="p">]</span> <span class="o">=</span> <span class="nv">$matches</span><span class="p">[</span><span class="mi">2</span><span class="p">][</span><span class="nv">$idx</span><span class="p">];</span>
                            <span class="p">}</span>
                    <span class="p">}</span>
            <span class="p">}</span>
            <span class="nb">unset</span><span class="p">(</span><span class="nv">$_GET</span><span class="p">[</span><span class="s1">&#39;ocparams&#39;</span><span class="p">]);</span>
            <span class="nb">define</span><span class="p">(</span><span class="s1">&#39;OCC_SELF&#39;</span><span class="p">,</span> <span class="nv">$_SERVER</span><span class="p">[</span><span class="s1">&#39;PHP_SELF&#39;</span><span class="p">]</span> <span class="o">.</span> <span class="s1">&#39;?module=&#39;</span> <span class="o">.</span> <span class="nv">$_REQUEST</span><span class="p">[</span><span class="s1">&#39;module&#39;</span><span class="p">]</span> <span class="o">.</span> <span class="s1">&#39;&amp;action=&#39;</span> <span class="o">.</span> <span class="nv">$_GET</span><span class="p">[</span><span class="s1">&#39;action&#39;</span><span class="p">]</span> <span class="o">.</span> <span class="nv">$params</span><span class="p">);</span>
    <span class="p">}</span> <span class="k">elseif</span> <span class="p">(</span><span class="nb">isset</span><span class="p">(</span><span class="nv">$_SERVER</span><span class="p">[</span><span class="s1">&#39;REQUEST_URI&#39;</span><span class="p">])</span> <span class="o">&amp;&amp;</span> <span class="nb">strstr</span><span class="p">(</span><span class="nv">$_SERVER</span><span class="p">[</span><span class="s1">&#39;REQUEST_URI&#39;</span><span class="p">],</span> <span class="s1">&#39;?&#39;</span><span class="p">))</span> <span class="p">{</span>
            <span class="nb">define</span><span class="p">(</span><span class="s1">&#39;OCC_SELF&#39;</span><span class="p">,</span> <span class="nb">htmlspecialchars</span><span class="p">(</span><span class="nv">$_SERVER</span><span class="p">[</span><span class="s1">&#39;REQUEST_URI&#39;</span><span class="p">]));</span>
    <span class="p">}</span> <span class="k">elseif</span> <span class="p">(</span><span class="nb">isset</span><span class="p">(</span><span class="nv">$_SERVER</span><span class="p">[</span><span class="s1">&#39;QUERY_STRING&#39;</span><span class="p">])</span> <span class="o">&amp;&amp;</span> <span class="nb">strstr</span><span class="p">(</span><span class="nv">$_SERVER</span><span class="p">[</span><span class="s1">&#39;QUERY_STRING&#39;</span><span class="p">],</span> <span class="s1">&#39;&amp;&#39;</span><span class="p">))</span> <span class="p">{</span>
            <span class="nb">define</span><span class="p">(</span><span class="s1">&#39;OCC_SELF&#39;</span><span class="p">,</span> <span class="nv">$_SERVER</span><span class="p">[</span><span class="s1">&#39;PHP_SELF&#39;</span><span class="p">]</span> <span class="o">.</span> <span class="s1">&#39;?&#39;</span> <span class="o">.</span> <span class="nb">htmlspecialchars</span><span class="p">(</span><span class="nv">$_SERVER</span><span class="p">[</span><span class="s1">&#39;QUERY_STRING&#39;</span><span class="p">]));</span>
    <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
            <span class="nx">err</span><span class="p">(</span><span class="s1">&#39;This server does not support REQUEST_URI or QUERY_STRING&#39;</span><span class="p">,</span><span class="s1">&#39;Error&#39;</span><span class="p">);</span>
    <span class="p">}</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="throw-functioncall">
<span id="case-throw-functioncall"></span><h3><span class="section-number">5.2.13. </span>Throw Functioncall<a class="headerlink" href="#throw-functioncall" title="Permalink to this headline">¶</a></h3>
<div class="section" id="case-sugarcrm-exceptions-throwfunctioncall">
<span id="id5"></span><h4><span class="section-number">5.2.13.1. </span>SugarCrm<a class="headerlink" href="#case-sugarcrm-exceptions-throwfunctioncall" title="Permalink to this headline">¶</a></h4>
<p><a class="reference internal" href="Rules.html#throw-functioncall"><span class="std std-ref">Throw Functioncall</span></a>, in include/externalAPI/cmis_repository_wrapper.php:918.</p>
<p>SugarCRM uses exceptions to fill work in progress. Here, we recognize a forgotten ‘new’ that makes throw call a function named ‘Exception’. This fails with a Fatal Error, and doesn’t issue the right messsage. The same error had propgated in the code by copy and paste : it is available 17 times in that same file.</p>
<div class="highlight-php notranslate"><div class="highlight"><pre><span></span><span class="k">function</span> <span class="nf">getContentChanges</span><span class="p">()</span>
    <span class="p">{</span>
        <span class="k">throw</span> <span class="nx">Exception</span><span class="p">(</span><span class="s2">&quot;Not Implemented&quot;</span><span class="p">);</span>
    <span class="p">}</span>
</pre></div>
</div>
</div>
<div class="section" id="zurmo">
<span id="case-zurmo-exceptions-throwfunctioncall"></span><h4><span class="section-number">5.2.13.2. </span>Zurmo<a class="headerlink" href="#zurmo" title="Permalink to this headline">¶</a></h4>
<p><a class="reference internal" href="Rules.html#throw-functioncall"><span class="std std-ref">Throw Functioncall</span></a>, in app/protected/modules/gamification/rules/collections/GameCollectionRules.php:66.</p>
<p>Other part of the code actually instantiate the exception before throwing it.</p>
<div class="highlight-php notranslate"><div class="highlight"><pre><span></span><span class="k">abstract</span> <span class="k">class</span> <span class="nc">GameCollectionRules</span>
    <span class="p">{</span>
        <span class="sd">/**</span>
<span class="sd">         * @return string</span>
<span class="sd">         * @throws NotImplementedException - Implement in children classes</span>
<span class="sd">         */</span>
        <span class="k">public</span> <span class="k">static</span> <span class="k">function</span> <span class="nf">getType</span><span class="p">()</span>
        <span class="p">{</span>
            <span class="k">throw</span> <span class="nx">NotImplementedException</span><span class="p">();</span>
        <span class="p">}</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="useless-catch">
<span id="case-useless-catch"></span><h3><span class="section-number">5.2.14. </span>Useless Catch<a class="headerlink" href="#useless-catch" title="Permalink to this headline">¶</a></h3>
<div class="section" id="case-zurmo-exceptions-uselesscatch">
<span id="id6"></span><h4><span class="section-number">5.2.14.1. </span>Zurmo<a class="headerlink" href="#case-zurmo-exceptions-uselesscatch" title="Permalink to this headline">¶</a></h4>
<p><a class="reference internal" href="Rules.html#useless-catch"><span class="std std-ref">Useless Catch</span></a>, in app/protected/modules/workflows/forms/attributes/ExplicitReadWriteModelPermissionsWorkflowActionAttributeForm.php:99.</p>
<p>Catch the exception, then return. At least, the comment is honest.</p>
<div class="highlight-php notranslate"><div class="highlight"><pre><span></span><span class="k">try</span>
                <span class="p">{</span>
                    <span class="nv">$group</span> <span class="o">=</span> <span class="nx">Group</span><span class="o">::</span><span class="na">getById</span><span class="p">((</span><span class="nx">int</span><span class="p">)</span><span class="nv">$this</span><span class="o">-&gt;</span><span class="na">type</span><span class="p">);</span>
                    <span class="nv">$explicitReadWriteModelPermissions</span><span class="o">-&gt;</span><span class="na">addReadWritePermitable</span><span class="p">(</span><span class="nv">$group</span><span class="p">);</span>
                <span class="p">}</span>
                <span class="k">catch</span> <span class="p">(</span><span class="nx">NotFoundException</span> <span class="nv">$e</span><span class="p">)</span>
                <span class="p">{</span>
                    <span class="c1">//todo: handle exception better</span>
                    <span class="k">return</span><span class="p">;</span>
                <span class="p">}</span>
</pre></div>
</div>
</div>
<div class="section" id="prestashop">
<span id="case-prestashop-exceptions-uselesscatch"></span><h4><span class="section-number">5.2.14.2. </span>PrestaShop<a class="headerlink" href="#prestashop" title="Permalink to this headline">¶</a></h4>
<p><a class="reference internal" href="Rules.html#useless-catch"><span class="std std-ref">Useless Catch</span></a>, in src/Core/Addon/Module/ModuleManagerBuilder.php:170.</p>
<p>Here, the catch clause will intercept a IO problem while writing element on the disk, and will return false. Since this is a constructor, the returned value will be ignored and the object will be left in a wrong state, since it was not totally inited.</p>
<div class="highlight-php notranslate"><div class="highlight"><pre><span></span><span class="k">private</span> <span class="k">function</span> <span class="fm">__construct</span><span class="p">()</span>
    <span class="p">{</span>
    <span class="c1">// More code......</span>
            <span class="k">try</span> <span class="p">{</span>
                <span class="nv">$filesystem</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Filesystem</span><span class="p">();</span>
                <span class="nv">$filesystem</span><span class="o">-&gt;</span><span class="na">dumpFile</span><span class="p">(</span><span class="nv">$phpConfigFile</span><span class="p">,</span> <span class="s1">&#39;&lt;?php return &#39;</span> <span class="o">.</span> <span class="nb">var_export</span><span class="p">(</span><span class="nv">$config</span><span class="p">,</span> <span class="k">true</span><span class="p">)</span> <span class="o">.</span> <span class="s1">&#39;;&#39;</span> <span class="o">.</span> <span class="nx">\n</span><span class="p">);</span>
            <span class="p">}</span> <span class="k">catch</span> <span class="p">(</span><span class="nx">IOException</span> <span class="nv">$e</span><span class="p">)</span> <span class="p">{</span>
                <span class="k">return</span> <span class="k">false</span><span class="p">;</span>
            <span class="p">}</span>
        <span class="p">}</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="aliases-usage">
<span id="case-aliases-usage"></span><h3><span class="section-number">5.2.15. </span>Aliases Usage<a class="headerlink" href="#aliases-usage" title="Permalink to this headline">¶</a></h3>
<div class="section" id="cleverstyle">
<span id="case-cleverstyle-functions-aliasesusage"></span><h4><span class="section-number">5.2.15.1. </span>Cleverstyle<a class="headerlink" href="#cleverstyle" title="Permalink to this headline">¶</a></h4>
<p><a class="reference internal" href="Rules.html#aliases-usage"><span class="std std-ref">Aliases Usage</span></a>, in modules/HybridAuth/Hybrid/thirdparty/Vimeo/Vimeo.php:422.</p>
<p>is_writeable() should be written is_writable(). No extra ‘e’.</p>
<div class="highlight-php notranslate"><div class="highlight"><pre><span></span><span class="nb">is_writeable</span><span class="p">(</span><span class="nv">$chunk_temp_dir</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="section" id="case-phpmyadmin-functions-aliasesusage">
<span id="id7"></span><h4><span class="section-number">5.2.15.2. </span>phpMyAdmin<a class="headerlink" href="#case-phpmyadmin-functions-aliasesusage" title="Permalink to this headline">¶</a></h4>
<p><a class="reference internal" href="Rules.html#aliases-usage"><span class="std std-ref">Aliases Usage</span></a>, in libraries/classes/Server/Privileges.php:5064.</p>
<p>join() should be written implode()</p>
<div class="highlight-php notranslate"><div class="highlight"><pre><span></span><span class="nb">join</span><span class="p">(</span><span class="s1">&#39;`, `&#39;</span><span class="p">,</span> <span class="nv">$tmp_privs2</span><span class="p">[</span><span class="s1">&#39;Update&#39;</span><span class="p">])</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="callback-function-needs-return">
<span id="case-callback-function-needs-return"></span><h3><span class="section-number">5.2.16. </span>Callback Function Needs Return<a class="headerlink" href="#callback-function-needs-return" title="Permalink to this headline">¶</a></h3>
<div class="section" id="contao">
<span id="case-contao-functions-callbackneedsreturn"></span><h4><span class="section-number">5.2.16.1. </span>Contao<a class="headerlink" href="#contao" title="Permalink to this headline">¶</a></h4>
<p><a class="reference internal" href="Rules.html#callback-function-needs-return"><span class="std std-ref">Callback Function Needs Return</span></a>, in core-bundle/src/Resources/contao/modules/ModuleQuicklink.php:91.</p>
<p>The empty closure returns <cite>null</cite>. The array_flip() array has now all its values set to null, and reset, as intended. A better alternative is to use the array_fill_keys() function, which set a default value to every element of an array, once provided with the expected keys.</p>
<div class="highlight-php notranslate"><div class="highlight"><pre><span></span><span class="nv">$arrPages</span> <span class="o">=</span> <span class="nb">array_map</span><span class="p">(</span><span class="k">function</span> <span class="p">()</span> <span class="p">{},</span> <span class="nb">array_flip</span><span class="p">(</span><span class="nv">$tmp</span><span class="p">));</span>
</pre></div>
</div>
</div>
<div class="section" id="phpdocumentor">
<span id="case-phpdocumentor-functions-callbackneedsreturn"></span><h4><span class="section-number">5.2.16.2. </span>Phpdocumentor<a class="headerlink" href="#phpdocumentor" title="Permalink to this headline">¶</a></h4>
<p><a class="reference internal" href="Rules.html#callback-function-needs-return"><span class="std std-ref">Callback Function Needs Return</span></a>, in src/phpDocumentor/Plugin/ServiceProvider.php:24.</p>
<p>The array_walk() function is called on the plugin’s list. Each element is registered with the application, but is not used directly : this is for later. The error mechanism is to throw an exception : this is the only expected feedback. As such, no return is expected. May be a ‘foreach’ loop would be more appropriate here, but this is syntactic sugar.</p>
<div class="highlight-php notranslate"><div class="highlight"><pre><span></span><span class="nb">array_walk</span><span class="p">(</span>
            <span class="nv">$plugins</span><span class="p">,</span>
            <span class="k">function</span> <span class="p">(</span><span class="nv">$plugin</span><span class="p">)</span> <span class="k">use</span> <span class="p">(</span><span class="nv">$app</span><span class="p">)</span> <span class="p">{</span>
                <span class="sd">/** @var Plugin $plugin */</span>
                <span class="nv">$provider</span> <span class="o">=</span> <span class="p">(</span><span class="nb">strpos</span><span class="p">(</span><span class="nv">$plugin</span><span class="o">-&gt;</span><span class="na">getClassName</span><span class="p">(),</span> <span class="s1">&#39;\&#39;) === false)</span>
<span class="s1">                    ? sprintf(&#39;</span><span class="nx">phpDocumentor\Plugin\</span><span class="o">%</span><span class="nx">s\ServiceProvider</span><span class="s1">&#39;, $plugin-&gt;getClassName())</span>
<span class="s1">                    : $plugin-&gt;getClassName();</span>
<span class="s1">                if (!class_exists($provider)) {</span>
<span class="s1">                    throw new \RuntimeException(&#39;</span><span class="nx">Loading</span> <span class="nx">Service</span> <span class="nx">Provider</span> <span class="k">for</span> <span class="s1">&#39; . $provider . &#39;</span> <span class="nx">failed</span><span class="o">.</span><span class="err">&#39;</span><span class="p">);</span>
                <span class="p">}</span>

                <span class="k">try</span> <span class="p">{</span>
                    <span class="nv">$app</span><span class="o">-&gt;</span><span class="na">register</span><span class="p">(</span><span class="k">new</span> <span class="nv">$provider</span><span class="p">(</span><span class="nv">$plugin</span><span class="p">));</span>
                <span class="p">}</span> <span class="k">catch</span> <span class="p">(</span><span class="nx">\InvalidArgumentException</span> <span class="nv">$e</span><span class="p">)</span> <span class="p">{</span>
                    <span class="k">throw</span> <span class="k">new</span> <span class="nx">\RuntimeException</span><span class="p">(</span><span class="nv">$e</span><span class="o">-&gt;</span><span class="na">getMessage</span><span class="p">());</span>
                <span class="p">}</span>
            <span class="p">}</span>
        <span class="p">);</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="deep-definitions">
<span id="case-deep-definitions"></span><h3><span class="section-number">5.2.17. </span>Deep Definitions<a class="headerlink" href="#deep-definitions" title="Permalink to this headline">¶</a></h3>
<div class="section" id="case-dolphin-functions-deepdefinitions">
<span id="id8"></span><h4><span class="section-number">5.2.17.1. </span>Dolphin<a class="headerlink" href="#case-dolphin-functions-deepdefinitions" title="Permalink to this headline">¶</a></h4>
<p><a class="reference internal" href="Rules.html#deep-definitions"><span class="std std-ref">Deep Definitions</span></a>, in wp-admin/includes/misc.php:74.</p>
<p>The ConstructHiddenValues function builds the ConstructHiddenSubValues function. Thus, ConstructHiddenValues can only be called once.</p>
<div class="highlight-php notranslate"><div class="highlight"><pre><span></span><span class="k">function</span> <span class="nf">ConstructHiddenValues</span><span class="p">(</span><span class="nv">$Values</span><span class="p">)</span>
<span class="p">{</span>
    <span class="sd">/**</span>
<span class="sd">     *    Recursive function, processes multidimensional arrays</span>
<span class="sd">     *</span>
<span class="sd">     * @param string $Name  Full name of array, including all subarrays&#39; names</span>
<span class="sd">     *</span>
<span class="sd">     * @param array  $Value Array of values, can be multidimensional</span>
<span class="sd">     *</span>
<span class="sd">     * @return string    Properly consctructed &lt;input type=&quot;hidden&quot;...&gt; tags</span>
<span class="sd">     */</span>
    <span class="k">function</span> <span class="nf">ConstructHiddenSubValues</span><span class="p">(</span><span class="nv">$Name</span><span class="p">,</span> <span class="nv">$Value</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="k">if</span> <span class="p">(</span><span class="nb">is_array</span><span class="p">(</span><span class="nv">$Value</span><span class="p">))</span> <span class="p">{</span>
            <span class="nv">$Result</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span><span class="p">;</span>
            <span class="k">foreach</span> <span class="p">(</span><span class="nv">$Value</span> <span class="k">as</span> <span class="nv">$KeyName</span> <span class="o">=&gt;</span> <span class="nv">$SubValue</span><span class="p">)</span> <span class="p">{</span>
                <span class="nv">$Result</span> <span class="o">.=</span> <span class="nx">ConstructHiddenSubValues</span><span class="p">(</span><span class="s2">&quot;</span><span class="si">{</span><span class="nv">$Name</span><span class="si">}</span><span class="s2">[</span><span class="si">{</span><span class="nv">$KeyName</span><span class="si">}</span><span class="s2">]&quot;</span><span class="p">,</span> <span class="nv">$SubValue</span><span class="p">);</span>
            <span class="p">}</span>
        <span class="p">}</span> <span class="k">else</span> <span class="c1">// Exit recurse</span>
        <span class="p">{</span>
            <span class="nv">$Result</span> <span class="o">=</span> <span class="s2">&quot;&lt;input type=&quot;</span><span class="nx">hidden</span><span class="s2">&quot; name=</span><span class="se">\&quot;</span><span class="s2">&quot;</span> <span class="o">.</span> <span class="nb">htmlspecialchars</span><span class="p">(</span><span class="nv">$Name</span><span class="p">)</span> <span class="o">.</span> <span class="s2">&quot;</span><span class="se">\&quot;</span><span class="s2"> value=</span><span class="se">\&quot;</span><span class="s2">&quot;</span> <span class="o">.</span> <span class="nb">htmlspecialchars</span><span class="p">(</span><span class="nv">$Value</span><span class="p">)</span> <span class="o">.</span> <span class="s2">&quot;</span><span class="se">\&quot;</span><span class="s2"> /&gt;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">;</span>
        <span class="p">}</span>

        <span class="k">return</span> <span class="nv">$Result</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="cm">/* End of ConstructHiddenSubValues function */</span>

    <span class="nv">$Result</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span><span class="p">;</span>
    <span class="k">if</span> <span class="p">(</span><span class="nb">is_array</span><span class="p">(</span><span class="nv">$Values</span><span class="p">))</span> <span class="p">{</span>
        <span class="k">foreach</span> <span class="p">(</span><span class="nv">$Values</span> <span class="k">as</span> <span class="nv">$KeyName</span> <span class="o">=&gt;</span> <span class="nv">$Value</span><span class="p">)</span> <span class="p">{</span>
            <span class="nv">$Result</span> <span class="o">.=</span> <span class="nx">ConstructHiddenSubValues</span><span class="p">(</span><span class="nv">$KeyName</span><span class="p">,</span> <span class="nv">$Value</span><span class="p">);</span>
        <span class="p">}</span>
    <span class="p">}</span>

    <span class="k">return</span> <span class="nv">$Result</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="unused-inherited-variable-in-closure">
<span id="case-unused-inherited-variable-in-closure"></span><h3><span class="section-number">5.2.18. </span>Unused Inherited Variable In Closure<a class="headerlink" href="#unused-inherited-variable-in-closure" title="Permalink to this headline">¶</a></h3>
<div class="section" id="shopware">
<span id="case-shopware-functions-unusedinheritedvariable"></span><h4><span class="section-number">5.2.18.1. </span>shopware<a class="headerlink" href="#shopware" title="Permalink to this headline">¶</a></h4>
<p><a class="reference internal" href="Rules.html#unused-inherited-variable-in-closure"><span class="std std-ref">Unused Inherited Variable In Closure</span></a>, in recovery/update/src/app.php:129.</p>
<p>In the first closuree, $containere is used as the root for the method calls, but $app is not used. It may be dropped. In fact, some of the following calls to $app-&gt;map() only request one inherited, $container.</p>
<div class="highlight-php notranslate"><div class="highlight"><pre><span></span><span class="nv">$app</span><span class="o">-&gt;</span><span class="na">map</span><span class="p">(</span><span class="s1">&#39;/applyMigrations&#39;</span><span class="p">,</span> <span class="k">function</span> <span class="p">()</span> <span class="k">use</span> <span class="p">(</span><span class="nv">$app</span><span class="p">,</span> <span class="nv">$container</span><span class="p">)</span> <span class="p">{</span>
    <span class="nv">$container</span><span class="o">-&gt;</span><span class="na">get</span><span class="p">(</span><span class="s1">&#39;controller.batch&#39;</span><span class="p">)</span><span class="o">-&gt;</span><span class="na">applyMigrations</span><span class="p">();</span>
<span class="p">})</span><span class="o">-&gt;</span><span class="na">via</span><span class="p">(</span><span class="s1">&#39;GET&#39;</span><span class="p">,</span> <span class="s1">&#39;POST&#39;</span><span class="p">)</span><span class="o">-&gt;</span><span class="na">name</span><span class="p">(</span><span class="s1">&#39;applyMigrations&#39;</span><span class="p">);</span>

<span class="nv">$app</span><span class="o">-&gt;</span><span class="na">map</span><span class="p">(</span><span class="s1">&#39;/importSnippets&#39;</span><span class="p">,</span> <span class="k">function</span> <span class="p">()</span> <span class="k">use</span> <span class="p">(</span><span class="nv">$container</span><span class="p">)</span> <span class="p">{</span>
    <span class="nv">$container</span><span class="o">-&gt;</span><span class="na">get</span><span class="p">(</span><span class="s1">&#39;controller.batch&#39;</span><span class="p">)</span><span class="o">-&gt;</span><span class="na">importSnippets</span><span class="p">();</span>
<span class="p">})</span><span class="o">-&gt;</span><span class="na">via</span><span class="p">(</span><span class="s1">&#39;GET&#39;</span><span class="p">,</span> <span class="s1">&#39;POST&#39;</span><span class="p">)</span><span class="o">-&gt;</span><span class="na">name</span><span class="p">(</span><span class="s1">&#39;importSnippets&#39;</span><span class="p">);</span>
</pre></div>
</div>
</div>
<div class="section" id="mautic">
<span id="case-mautic-functions-unusedinheritedvariable"></span><h4><span class="section-number">5.2.18.2. </span>Mautic<a class="headerlink" href="#mautic" title="Permalink to this headline">¶</a></h4>
<p><a class="reference internal" href="Rules.html#unused-inherited-variable-in-closure"><span class="std std-ref">Unused Inherited Variable In Closure</span></a>, in MauticCrmBundle/Tests/Integration/SalesforceIntegrationTest.php:1202.</p>
<p>$max is relayed to getLeadsToCreate(), while $restart is omitted. It may be dropped, along with its reference.</p>
<div class="highlight-php notranslate"><div class="highlight"><pre><span></span><span class="k">function</span> <span class="p">()</span> <span class="k">use</span> <span class="p">(</span><span class="o">&amp;</span><span class="nv">$restart</span><span class="p">,</span> <span class="nv">$max</span><span class="p">)</span> <span class="p">{</span>
                    <span class="nv">$args</span> <span class="o">=</span> <span class="nb">func_get_args</span><span class="p">();</span>

                    <span class="k">if</span> <span class="p">(</span><span class="k">false</span> <span class="o">===</span> <span class="nv">$args</span><span class="p">[</span><span class="mi">2</span><span class="p">])</span> <span class="p">{</span>
                        <span class="k">return</span> <span class="nv">$max</span><span class="p">;</span>
                    <span class="p">}</span>

                    <span class="nv">$createLeads</span> <span class="o">=</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">getLeadsToCreate</span><span class="p">(</span><span class="nv">$args</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span> <span class="nv">$max</span><span class="p">);</span>

                    <span class="c1">// determine whether to return a count or records</span>
                    <span class="k">if</span> <span class="p">(</span><span class="k">false</span> <span class="o">===</span> <span class="nv">$args</span><span class="p">[</span><span class="mi">2</span><span class="p">])</span> <span class="p">{</span>
                        <span class="k">return</span> <span class="nb">count</span><span class="p">(</span><span class="nv">$createLeads</span><span class="p">);</span>
                    <span class="p">}</span>

                    <span class="k">return</span> <span class="nv">$createLeads</span><span class="p">;</span>
                <span class="p">}</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="use-constant-as-arguments">
<span id="case-use-constant-as-arguments"></span><h3><span class="section-number">5.2.19. </span>Use Constant As Arguments<a class="headerlink" href="#use-constant-as-arguments" title="Permalink to this headline">¶</a></h3>
<div class="section" id="tikiwiki">
<span id="case-tikiwiki-functions-useconstantasarguments"></span><h4><span class="section-number">5.2.19.1. </span>Tikiwiki<a class="headerlink" href="#tikiwiki" title="Permalink to this headline">¶</a></h4>
<p><a class="reference internal" href="Rules.html#use-constant-as-arguments"><span class="std std-ref">Use Constant As Arguments</span></a>, in lib/language/Language.php:112.</p>
<p>E_WARNING is a valid value, but PHP documentation for trigger_error() explains that E_USER constants should be used.</p>
<div class="highlight-php notranslate"><div class="highlight"><pre><span></span><span class="nb">trigger_error</span><span class="p">(</span><span class="s2">&quot;Octal or hexadecimal string &#39;&quot;</span> <span class="o">.</span> <span class="nv">$match</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">.</span> <span class="s2">&quot;&#39; not supported&quot;</span><span class="p">,</span> <span class="k">E_WARNING</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="section" id="case-shopware-functions-useconstantasarguments">
<span id="id9"></span><h4><span class="section-number">5.2.19.2. </span>shopware<a class="headerlink" href="#case-shopware-functions-useconstantasarguments" title="Permalink to this headline">¶</a></h4>
<p><a class="reference internal" href="Rules.html#use-constant-as-arguments"><span class="std std-ref">Use Constant As Arguments</span></a>, in engine/Shopware/Plugins/Default/Core/Debug/Components/EventCollector.php:106.</p>
<p>One example where code review reports errors where unit tests don’t : array_multisort actually requires sort order first (SORT_ASC or SORT_DESC), then sort flags (such as SORT_NUMERIC). Here, with SORT_DESC = 3 and SORT_NUMERIC = 1, PHP understands it as the coders expects it. The same error is repeated six times in the code.</p>
<div class="highlight-php notranslate"><div class="highlight"><pre><span></span><span class="nb">array_multisort</span><span class="p">(</span><span class="nv">$order</span><span class="p">,</span> <span class="nx">SORT_NUMERIC</span><span class="p">,</span> <span class="nx">SORT_DESC</span><span class="p">,</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">results</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="wrong-number-of-arguments">
<span id="case-wrong-number-of-arguments"></span><h3><span class="section-number">5.2.20. </span>Wrong Number Of Arguments<a class="headerlink" href="#wrong-number-of-arguments" title="Permalink to this headline">¶</a></h3>
<div class="section" id="case-xataface-functions-wrongnumberofarguments">
<span id="id10"></span><h4><span class="section-number">5.2.20.1. </span>xataface<a class="headerlink" href="#case-xataface-functions-wrongnumberofarguments" title="Permalink to this headline">¶</a></h4>
<p><a class="reference internal" href="Rules.html#wrong-number-of-arguments"><span class="std std-ref">Wrong Number Of Arguments</span></a>, in actions/existing_related_record.php:130.</p>
<p>df_display() actually requires only 2 arguments, while three are provided. The last argument is completely ignored. df_display() is called in a total of 9 places : this now looks like an API change that left many calls untouched.</p>
<div class="highlight-php notranslate"><div class="highlight"><pre><span></span><span class="nx">df_display</span><span class="p">(</span><span class="nv">$context</span><span class="p">,</span> <span class="nv">$template</span><span class="p">,</span> <span class="k">true</span><span class="p">);</span>

<span class="c1">// in public-api.php :</span>
<span class="k">function</span> <span class="nf">df_display</span><span class="p">(</span><span class="nv">$context</span><span class="p">,</span> <span class="nv">$template_name</span><span class="p">){</span>
    <span class="nx">import</span><span class="p">(</span> <span class="s1">&#39;Dataface/SkinTool.php&#39;</span><span class="p">);</span>
    <span class="nv">$st</span> <span class="o">=</span> <span class="nx">Dataface_SkinTool</span><span class="o">::</span><span class="na">getInstance</span><span class="p">();</span>

    <span class="k">return</span> <span class="nv">$st</span><span class="o">-&gt;</span><span class="na">display</span><span class="p">(</span><span class="nv">$context</span><span class="p">,</span> <span class="nv">$template_name</span><span class="p">);</span>
<span class="p">}</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="wrong-optional-parameter">
<span id="case-wrong-optional-parameter"></span><h3><span class="section-number">5.2.21. </span>Wrong Optional Parameter<a class="headerlink" href="#wrong-optional-parameter" title="Permalink to this headline">¶</a></h3>
<div class="section" id="case-fuelcms-functions-wrongoptionalparameter">
<span id="id11"></span><h4><span class="section-number">5.2.21.1. </span>FuelCMS<a class="headerlink" href="#case-fuelcms-functions-wrongoptionalparameter" title="Permalink to this headline">¶</a></h4>
<p><a class="reference internal" href="Rules.html#wrong-optional-parameter"><span class="std std-ref">Wrong Optional Parameter</span></a>, in fuel/modules/fuel/helpers/validator_helper.php:78.</p>
<p>The $regex parameter should really be first, as it is compulsory. Though, if this is a legacy function, it may be better to give regex a default value, such as empty string or null, and test it before using it.</p>
<div class="highlight-php notranslate"><div class="highlight"><pre><span></span><span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nb">function_exists</span><span class="p">(</span><span class="s1">&#39;regex&#39;</span><span class="p">))</span>
<span class="p">{</span>
    <span class="k">function</span> <span class="nf">regex</span><span class="p">(</span><span class="nv">$var</span> <span class="o">=</span> <span class="k">null</span><span class="p">,</span> <span class="nv">$regex</span><span class="p">)</span>
    <span class="p">{</span>
            <span class="k">return</span> <span class="nb">preg_match</span><span class="p">(</span><span class="s1">&#39;#&#39;</span><span class="o">.</span><span class="nv">$regex</span><span class="o">.</span><span class="s1">&#39;#&#39;</span><span class="p">,</span> <span class="nv">$var</span><span class="p">);</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
</div>
<div class="section" id="case-vanilla-functions-wrongoptionalparameter">
<span id="id12"></span><h4><span class="section-number">5.2.21.2. </span>Vanilla<a class="headerlink" href="#case-vanilla-functions-wrongoptionalparameter" title="Permalink to this headline">¶</a></h4>
<p><a class="reference internal" href="Rules.html#wrong-optional-parameter"><span class="std std-ref">Wrong Optional Parameter</span></a>, in applications/dashboard/modules/class.navmodule.php:99.</p>
<p>Note the second parameter, $dropdown, which has no default value. It is relayed to the addDropdown method, which as no default value too. Since both methods are documented, we can see that they should be an addDropdown : null is probably a good idea, coupled with an explicit check on the actual value.</p>
<div class="highlight-php notranslate"><div class="highlight"><pre><span></span><span class="sd">/**</span>
<span class="sd">     * Add a dropdown to the items array if it satisfies the $isAllowed condition.</span>
<span class="sd">     *</span>
<span class="sd">     * @param bool|string|array $isAllowed Either a boolean to indicate whether to actually add the item</span>
<span class="sd">     * or a permission string or array of permission strings (full match) to check.</span>
<span class="sd">     * @param DropdownModule $dropdown The dropdown menu to add.</span>
<span class="sd">     * @param string $key The item&#39;s key (for sorting and CSS targeting).</span>
<span class="sd">     * @param string $cssClass The dropdown wrapper&#39;s CSS class.</span>
<span class="sd">     * @param array|int $sort Either a numeric sort position or and array in the style: array(&#39;before|after&#39;, &#39;key&#39;).</span>
<span class="sd">     * @return NavModule $this The calling object.</span>
<span class="sd">     */</span>
    <span class="k">public</span> <span class="k">function</span> <span class="nf">addDropdownIf</span><span class="p">(</span><span class="nv">$isAllowed</span> <span class="o">=</span> <span class="k">true</span><span class="p">,</span> <span class="nv">$dropdown</span><span class="p">,</span> <span class="nv">$key</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="nv">$cssClass</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="nv">$sort</span> <span class="o">=</span> <span class="p">[])</span> <span class="p">{</span>
        <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nv">$this</span><span class="o">-&gt;</span><span class="na">isAllowed</span><span class="p">(</span><span class="nv">$isAllowed</span><span class="p">))</span> <span class="p">{</span>
            <span class="k">return</span> <span class="nv">$this</span><span class="p">;</span>
        <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
            <span class="k">return</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">addDropdown</span><span class="p">(</span><span class="nv">$dropdown</span><span class="p">,</span> <span class="nv">$key</span><span class="p">,</span> <span class="nv">$cssClass</span><span class="p">,</span> <span class="nv">$sort</span><span class="p">);</span>
        <span class="p">}</span>
    <span class="p">}</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="undefined-interfaces">
<span id="case-undefined-interfaces"></span><h3><span class="section-number">5.2.22. </span>Undefined Interfaces<a class="headerlink" href="#undefined-interfaces" title="Permalink to this headline">¶</a></h3>
<div class="section" id="case-xataface-interfaces-undefinedinterfaces">
<span id="id13"></span><h4><span class="section-number">5.2.22.1. </span>xataface<a class="headerlink" href="#case-xataface-interfaces-undefinedinterfaces" title="Permalink to this headline">¶</a></h4>
<p><a class="reference internal" href="Rules.html#undefined-interfaces"><span class="std std-ref">Undefined Interfaces</span></a>, in Dataface/Error.php:112.</p>
<p>Exception seems to be a typo, and leads to an always-true expression.</p>
<div class="highlight-php notranslate"><div class="highlight"><pre><span></span><span class="k">public</span> <span class="k">static</span> <span class="k">function</span> <span class="nf">isError</span><span class="p">(</span><span class="nv">$obj</span><span class="p">){</span>
            <span class="k">if</span> <span class="p">(</span> <span class="o">!</span><span class="nx">PEAR</span><span class="o">::</span><span class="na">isError</span><span class="p">(</span><span class="nv">$obj</span><span class="p">)</span> <span class="k">and</span> <span class="o">!</span><span class="p">(</span><span class="nv">$obj</span> <span class="nx">instanceof</span> <span class="nx">Exception_</span><span class="p">)</span> <span class="p">)</span> <span class="k">return</span> <span class="k">false</span><span class="p">;</span>
            <span class="k">return</span> <span class="p">(</span><span class="nv">$obj</span><span class="o">-&gt;</span><span class="na">getCode</span><span class="p">()</span> <span class="o">&gt;=</span> <span class="nx">DATAFACE_E_ERROR</span><span class="p">);</span>
    <span class="p">}</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="hidden-use-expression">
<span id="case-hidden-use-expression"></span><h3><span class="section-number">5.2.23. </span>Hidden Use Expression<a class="headerlink" href="#hidden-use-expression" title="Permalink to this headline">¶</a></h3>
<div class="section" id="case-tikiwiki-namespaces-hiddenuse">
<span id="id14"></span><h4><span class="section-number">5.2.23.1. </span>Tikiwiki<a class="headerlink" href="#case-tikiwiki-namespaces-hiddenuse" title="Permalink to this headline">¶</a></h4>
<p><a class="reference internal" href="Rules.html#hidden-use-expression"><span class="std std-ref">Hidden Use Expression</span></a>, in lib/core/Tiki/Command/DailyReportSendCommand.php:17.</p>
<p>Sneaky error_reporting, hidden among the use calls.</p>
<div class="highlight-php notranslate"><div class="highlight"><pre><span></span><span class="k">namespace</span> <span class="nx">Tiki\Command</span><span class="p">;</span>

<span class="k">use</span> <span class="nx">Symfony\Component\Console\Command\Command</span><span class="p">;</span>
<span class="k">use</span> <span class="nx">Symfony\Component\Console\Input\InputArgument</span><span class="p">;</span>
<span class="k">use</span> <span class="nx">Symfony\Component\Console\Input\InputInterface</span><span class="p">;</span>
<span class="k">use</span> <span class="nx">Symfony\Component\Console\Input\InputOption</span><span class="p">;</span>
<span class="k">use</span> <span class="nx">Symfony\Component\Console\Output\OutputInterface</span><span class="p">;</span>
<span class="nb">error_reporting</span><span class="p">(</span><span class="k">E_ALL</span><span class="p">);</span>
<span class="k">use</span> <span class="nx">TikiLib</span><span class="p">;</span>
<span class="k">use</span> <span class="nx">Reports_Factory</span><span class="p">;</span>
</pre></div>
</div>
</div>
<div class="section" id="openemr">
<span id="case-openemr-namespaces-hiddenuse"></span><h4><span class="section-number">5.2.23.2. </span>OpenEMR<a class="headerlink" href="#openemr" title="Permalink to this headline">¶</a></h4>
<p><a class="reference internal" href="Rules.html#hidden-use-expression"><span class="std std-ref">Hidden Use Expression</span></a>, in interface/patient_file/summary/browse.php:23.</p>
<p>Use expression is only reached when the csrf token is checked. This probably save some CPU when no csrf is available, but it breaks the readability of the file.</p>
<div class="highlight-php notranslate"><div class="highlight"><pre><span></span><span class="o">&lt;?</span><span class="nx">php</span>
<span class="sd">/**</span>
<span class="sd"> * Patient selector for insurance gui</span>
<span class="sd"> *</span>
<span class="sd"> * @package   OpenEMR</span>
<span class="sd"> * @link      http://www.open-emr.org</span>
<span class="sd"> * @author    Brady Miller &lt;brady.g.miller@gmail.com&gt;</span>
<span class="sd"> * @copyright Copyright (c) 2018 Brady Miller &lt;brady.g.miller@gmail.com&gt;</span>
<span class="sd"> * @license   https://github.com/openemr/openemr/blob/master/LICENSE GNU General Public License 3</span>
<span class="sd"> */</span>


<span class="k">require_once</span><span class="p">(</span><span class="o">../../</span><span class="nx">globals</span><span class="o">.</span><span class="nx">php</span><span class="p">);</span>
<span class="k">require_once</span><span class="p">(</span><span class="nv">$srcdir</span><span class="o">/</span><span class="nx">patient</span><span class="o">.</span><span class="nx">inc</span><span class="p">);</span>
<span class="k">require_once</span><span class="p">(</span><span class="nv">$srcdir</span><span class="o">/</span><span class="nx">options</span><span class="o">.</span><span class="nx">inc</span><span class="o">.</span><span class="nx">php</span><span class="p">);</span>

<span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="k">empty</span><span class="p">(</span><span class="nv">$_POST</span><span class="p">))</span> <span class="p">{</span>
    <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nx">verifyCsrfToken</span><span class="p">(</span><span class="nv">$_POST</span><span class="p">[</span><span class="nx">csrf_token_form</span><span class="p">]))</span> <span class="p">{</span>
        <span class="nx">csrfNotVerified</span><span class="p">();</span>
    <span class="p">}</span>
<span class="p">}</span>

<span class="k">use</span> <span class="nx">OpenEMR\Core\Header</span><span class="p">;</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="multiple-alias-definitions">
<span id="case-multiple-alias-definitions"></span><h3><span class="section-number">5.2.24. </span>Multiple Alias Definitions<a class="headerlink" href="#multiple-alias-definitions" title="Permalink to this headline">¶</a></h3>
<div class="section" id="churchcrm">
<span id="case-churchcrm-namespaces-multiplealiasdefinitions"></span><h4><span class="section-number">5.2.24.1. </span>ChurchCRM<a class="headerlink" href="#churchcrm" title="Permalink to this headline">¶</a></h4>
<p><a class="reference internal" href="Rules.html#multiple-alias-definitions"><span class="std std-ref">Multiple Alias Definitions</span></a>, in Various files:–.</p>
<p>It is actually surprising to find FamilyQuery defined as ChurchCRMBaseFamilyQuery only once, while all other reference are for ChurchCRMFamilyQuery. That lone use is actually useful in the code, so it is not a forgotten refactorisation.</p>
<div class="highlight-php notranslate"><div class="highlight"><pre><span></span><span class="k">use</span> <span class="nx">ChurchCRM\Base\FamilyQuery</span>      <span class="c1">// in /src/MapUsingGoogle.php:7</span>

<span class="k">use</span> <span class="nx">ChurchCRM\FamilyQuery</span>   <span class="c1">// in /src/ChurchCRM/Dashboard/EventsDashboardItem.php:8</span>
                            <span class="c1">// and 29 other files</span>
</pre></div>
</div>
</div>
<div class="section" id="phinx">
<span id="case-phinx-namespaces-multiplealiasdefinitions"></span><h4><span class="section-number">5.2.24.2. </span>Phinx<a class="headerlink" href="#phinx" title="Permalink to this headline">¶</a></h4>
<p><a class="reference internal" href="Rules.html#multiple-alias-definitions"><span class="std std-ref">Multiple Alias Definitions</span></a>, in Various files too:–.</p>
<p>One ‘Command’ is refering to a local Command class, while the other is refering to an imported class. They are all in a similar name space ConsoleCommand.</p>
<div class="highlight-php notranslate"><div class="highlight"><pre><span></span><span class="k">use</span> <span class="nx">Phinx\Console\Command</span>                       <span class="c1">//in file /src/Phinx/Console/PhinxApplication.php:34</span>
<span class="k">use</span> <span class="nx">Symfony\Component\Console\Command\Command</span>       <span class="c1">//in file /src/Phinx/Console/Command/Init.php:31</span>
<span class="k">use</span> <span class="nx">Symfony\Component\Console\Command\Command</span>       <span class="c1">//in file /src/Phinx/Console/Command/AbstractCommand.php:32</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="no-array-merge-in-loops">
<span id="case-no-array-merge-in-loops"></span><h3><span class="section-number">5.2.25. </span>No array_merge() In Loops<a class="headerlink" href="#no-array-merge-in-loops" title="Permalink to this headline">¶</a></h3>
<div class="section" id="tine20">
<span id="case-tine20-performances-arraymergeinloops"></span><h4><span class="section-number">5.2.25.1. </span>Tine20<a class="headerlink" href="#tine20" title="Permalink to this headline">¶</a></h4>
<p><a class="reference internal" href="Rules.html#no-array-merge-in-loops"><span class="std std-ref">No array_merge() In Loops</span></a>, in tine20/Tinebase/User/Ldap.php:670.</p>
<p>Classic example of array_merge() in loop : here, the attributures should be collected in a local variable, and then merged in one operation, at the end. That includes the attributes provided before the loop, and the array provided after the loop.
Note that the order of merge will be the same when merging than when collecting the arrays.</p>
<div class="highlight-php notranslate"><div class="highlight"><pre><span></span><span class="nv">$attributes</span> <span class="o">=</span> <span class="nb">array_values</span><span class="p">(</span><span class="nv">$this</span><span class="o">-&gt;</span><span class="na">_rowNameMapping</span><span class="p">);</span>
        <span class="k">foreach</span> <span class="p">(</span><span class="nv">$this</span><span class="o">-&gt;</span><span class="na">_ldapPlugins</span> <span class="k">as</span> <span class="nv">$plugin</span><span class="p">)</span> <span class="p">{</span>
            <span class="nv">$attributes</span> <span class="o">=</span> <span class="nb">array_merge</span><span class="p">(</span><span class="nv">$attributes</span><span class="p">,</span> <span class="nv">$plugin</span><span class="o">-&gt;</span><span class="na">getSupportedAttributes</span><span class="p">());</span>
        <span class="p">}</span>

        <span class="nv">$attributes</span> <span class="o">=</span> <span class="nb">array_merge</span><span class="p">(</span><span class="nv">$attributes</span><span class="p">,</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">_additionalLdapAttributesToFetch</span><span class="p">);</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="pre-increment">
<span id="case-pre-increment"></span><h3><span class="section-number">5.2.26. </span>Pre-increment<a class="headerlink" href="#pre-increment" title="Permalink to this headline">¶</a></h3>
<div class="section" id="expressionengine">
<span id="case-expressionengine-performances-prepostincrement"></span><h4><span class="section-number">5.2.26.1. </span>ExpressionEngine<a class="headerlink" href="#expressionengine" title="Permalink to this headline">¶</a></h4>
<p><a class="reference internal" href="Rules.html#pre-increment"><span class="std std-ref">Pre-increment</span></a>, in system/ee/EllisLab/ExpressionEngine/Controller/Utilities/Communicate.php:650.</p>
<p>Using preincrement in for() loops is safe and straightforward.</p>
<div class="highlight-php notranslate"><div class="highlight"><pre><span></span><span class="k">for</span> <span class="p">(</span><span class="nv">$x</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="nv">$x</span> <span class="o">&lt;</span> <span class="nv">$number_to_send</span><span class="p">;</span> <span class="nv">$x</span><span class="o">++</span><span class="p">)</span>
            <span class="p">{</span>
                    <span class="nv">$email_address</span> <span class="o">=</span> <span class="nb">array_shift</span><span class="p">(</span><span class="nv">$recipient_array</span><span class="p">);</span>

                    <span class="k">if</span> <span class="p">(</span> <span class="o">!</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">deliverEmail</span><span class="p">(</span><span class="nv">$email</span><span class="p">,</span> <span class="nv">$email_address</span><span class="p">))</span>
                    <span class="p">{</span>
                            <span class="nv">$email</span><span class="o">-&gt;</span><span class="na">delete</span><span class="p">();</span>

                            <span class="nv">$debug_msg</span> <span class="o">=</span> <span class="nx">ee</span><span class="p">()</span><span class="o">-&gt;</span><span class="na">email</span><span class="o">-&gt;</span><span class="na">print_debugger</span><span class="p">(</span><span class="k">array</span><span class="p">());</span>

                            <span class="nx">show_error</span><span class="p">(</span><span class="nx">lang</span><span class="p">(</span><span class="s1">&#39;error_sending_email&#39;</span><span class="p">)</span><span class="o">.</span><span class="nx">BR</span><span class="o">.</span><span class="nx">BR</span><span class="o">.</span><span class="nv">$debug_msg</span><span class="p">);</span>
                    <span class="p">}</span>
                    <span class="nv">$email</span><span class="o">-&gt;</span><span class="na">total_sent</span><span class="o">++</span><span class="p">;</span>
            <span class="p">}</span>
</pre></div>
</div>
</div>
<div class="section" id="traq">
<span id="case-traq-performances-prepostincrement"></span><h4><span class="section-number">5.2.26.2. </span>Traq<a class="headerlink" href="#traq" title="Permalink to this headline">¶</a></h4>
<p><a class="reference internal" href="Rules.html#pre-increment"><span class="std std-ref">Pre-increment</span></a>, in src/Controllers/Tickets.php:84.</p>
<p>$this-&gt;currentProject-&gt;next_ticket_id value is ignored by the code. It may be turned into a preincrement.</p>
<div class="highlight-php notranslate"><div class="highlight"><pre><span></span><span class="nx">TimelineModel</span><span class="o">::</span><span class="na">newTicketEvent</span><span class="p">(</span><span class="nv">$this</span><span class="o">-&gt;</span><span class="na">currentUser</span><span class="p">,</span> <span class="nv">$ticket</span><span class="p">)</span><span class="o">-&gt;</span><span class="na">save</span><span class="p">();</span>

            <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">currentProject</span><span class="o">-&gt;</span><span class="na">next_ticket_id</span><span class="o">++</span><span class="p">;</span>
            <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">currentProject</span><span class="o">-&gt;</span><span class="na">save</span><span class="p">();</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="strpos-too-much">
<span id="case-strpos-too-much"></span><h3><span class="section-number">5.2.27. </span>strpos() Too Much<a class="headerlink" href="#strpos-too-much" title="Permalink to this headline">¶</a></h3>
<div class="section" id="case-wordpress-performances-strpostoomuch">
<span id="id15"></span><h4><span class="section-number">5.2.27.1. </span>WordPress<a class="headerlink" href="#case-wordpress-performances-strpostoomuch" title="Permalink to this headline">¶</a></h4>
<p><a class="reference internal" href="Rules.html#strpos-too-much"><span class="std std-ref">strpos() Too Much</span></a>, in core/traits/Request/Server.php:127.</p>
<p>Instead of searching for <code class="docutils literal notranslate"><span class="pre">HTTP_</span></code>, it is faster to compare the first 5 chars to the literal <code class="docutils literal notranslate"><span class="pre">HTTP_</span></code>. In case of absence, this solution returns faster.</p>
<div class="highlight-php notranslate"><div class="highlight"><pre><span></span><span class="k">if</span> <span class="p">(</span><span class="nb">strpos</span><span class="p">(</span><span class="nv">$header</span><span class="p">,</span> <span class="s1">&#39;HTTP_&#39;</span><span class="p">)</span> <span class="o">===</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
                            <span class="nv">$header</span> <span class="o">=</span> <span class="nb">substr</span><span class="p">(</span><span class="nv">$header</span><span class="p">,</span> <span class="mi">5</span><span class="p">);</span>
                    <span class="p">}</span> <span class="k">elseif</span> <span class="p">(</span><span class="nb">strpos</span><span class="p">(</span><span class="nv">$header</span><span class="p">,</span> <span class="s1">&#39;CONTENT_&#39;</span><span class="p">)</span> <span class="o">!==</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
                            <span class="k">continue</span><span class="p">;</span>
                    <span class="p">}</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="assign-with-and-precedence">
<span id="case-assign-with-and-precedence"></span><h3><span class="section-number">5.2.28. </span>Assign With And Precedence<a class="headerlink" href="#assign-with-and-precedence" title="Permalink to this headline">¶</a></h3>
<div class="section" id="case-xataface-php-assignand">
<span id="id16"></span><h4><span class="section-number">5.2.28.1. </span>xataface<a class="headerlink" href="#case-xataface-php-assignand" title="Permalink to this headline">¶</a></h4>
<p><a class="reference internal" href="Rules.html#assign-with-and-precedence"><span class="std std-ref">Assign With And Precedence</span></a>, in Dataface/LanguageTool.php:265.</p>
<p>The usage of ‘and’ here is a workaround for PHP version that have no support for the coalesce. $autosubmit receives the value of $params[‘autosubmit’] only if the latter is set. Yet, with = having higher precedence over ‘and’, $autosubmit is mistaken with the existence of $params[‘autosubmit’] : its value is actually omitted.</p>
<div class="highlight-php notranslate"><div class="highlight"><pre><span></span><span class="nv">$autosubmit</span> <span class="o">=</span> <span class="nb">isset</span><span class="p">(</span><span class="nv">$params</span><span class="p">[</span><span class="s1">&#39;autosubmit&#39;</span><span class="p">])</span> <span class="k">and</span> <span class="nv">$params</span><span class="p">[</span><span class="s1">&#39;autosubmit&#39;</span><span class="p">];</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="use-random-int">
<span id="case-use-random-int"></span><h3><span class="section-number">5.2.29. </span>Use random_int()<a class="headerlink" href="#use-random-int" title="Permalink to this headline">¶</a></h3>
<div class="section" id="thelia">
<span id="case-thelia-php-betterrand"></span><h4><span class="section-number">5.2.29.1. </span>Thelia<a class="headerlink" href="#thelia" title="Permalink to this headline">¶</a></h4>
<p><a class="reference internal" href="Rules.html#use-random-int"><span class="std std-ref">Use random_int()</span></a>, in core/lib/Thelia/Tools/TokenProvider.php:151.</p>
<p>The whole function may be replaced by random_int(), as it generates random tokens. This needs an extra layer of hashing, to get a long and string results.</p>
<div class="highlight-php notranslate"><div class="highlight"><pre><span></span><span class="sd">/**</span>
<span class="sd">     * @return string</span>
<span class="sd">     */</span>
    <span class="k">protected</span> <span class="k">static</span> <span class="k">function</span> <span class="nf">getComplexRandom</span><span class="p">()</span>
    <span class="p">{</span>
        <span class="nv">$firstValue</span> <span class="o">=</span> <span class="p">(</span><span class="nx">float</span><span class="p">)</span> <span class="p">(</span><span class="nb">mt_rand</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mh">0xFFFF</span><span class="p">)</span> <span class="o">*</span> <span class="nb">rand</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mh">0x10001</span><span class="p">));</span>
        <span class="nv">$secondValues</span> <span class="o">=</span> <span class="p">(</span><span class="nx">float</span><span class="p">)</span> <span class="p">(</span><span class="nb">rand</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mh">0xFFFF</span><span class="p">)</span> <span class="o">*</span> <span class="nb">mt_rand</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mh">0x10001</span><span class="p">));</span>

        <span class="k">return</span> <span class="nb">microtime</span><span class="p">()</span> <span class="o">.</span> <span class="nb">ceil</span><span class="p">(</span><span class="nv">$firstValue</span> <span class="o">/</span> <span class="nv">$secondValues</span><span class="p">)</span> <span class="o">.</span> <span class="nb">uniqid</span><span class="p">();</span>
    <span class="p">}</span>
</pre></div>
</div>
</div>
<div class="section" id="case-fuelcms-php-betterrand">
<span id="id17"></span><h4><span class="section-number">5.2.29.2. </span>FuelCMS<a class="headerlink" href="#case-fuelcms-php-betterrand" title="Permalink to this headline">¶</a></h4>
<p><a class="reference internal" href="Rules.html#use-random-int"><span class="std std-ref">Use random_int()</span></a>, in fuel/modules/fuel/libraries/Fuel.php:235.</p>
<p>Security tokens should be build with a CSPRNG source. uniqid() is based on time, and though it changes anytime (sic), it is easy to guess. Those days, it looks like ‘5b1262e74dbb9’;</p>
<div class="highlight-php notranslate"><div class="highlight"><pre><span></span><span class="nv">$this</span><span class="o">-&gt;</span><span class="na">installer</span><span class="o">-&gt;</span><span class="na">change_config</span><span class="p">(</span><span class="s1">&#39;config&#39;</span><span class="p">,</span> <span class="s1">&#39;$config[\&#39;encryption_key\&#39;] = \&#39;\&#39;;&#39;</span><span class="p">,</span> <span class="s1">&#39;$config[\&#39;encryption_key\&#39;] = \&#39;&#39;</span><span class="o">.</span><span class="nb">md5</span><span class="p">(</span><span class="nb">uniqid</span><span class="p">())</span><span class="o">.</span><span class="s1">&#39;\&#39;;&#39;</span><span class="p">);</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="deprecated-php-functions">
<span id="case-deprecated-php-functions"></span><h3><span class="section-number">5.2.30. </span>Deprecated PHP Functions<a class="headerlink" href="#deprecated-php-functions" title="Permalink to this headline">¶</a></h3>
<div class="section" id="case-dolphin-php-deprecated">
<span id="id18"></span><h4><span class="section-number">5.2.30.1. </span>Dolphin<a class="headerlink" href="#case-dolphin-php-deprecated" title="Permalink to this headline">¶</a></h4>
<p><a class="reference internal" href="Rules.html#deprecated-php-functions"><span class="std std-ref">Deprecated PHP Functions</span></a>, in Dolphin-v.7.3.5/inc/classes/BxDolAdminSettings.php:270.</p>
<p>Split() was abandonned in PHP 7.0</p>
<div class="highlight-php notranslate"><div class="highlight"><pre><span></span><span class="nb">split</span><span class="p">(</span><span class="s1">&#39;,&#39;</span><span class="p">,</span> <span class="nv">$aItem</span><span class="p">[</span><span class="s1">&#39;extra&#39;</span><span class="p">]);</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="wrong-fopen-mode">
<span id="case-wrong-fopen-mode"></span><h3><span class="section-number">5.2.31. </span>Wrong fopen() Mode<a class="headerlink" href="#wrong-fopen-mode" title="Permalink to this headline">¶</a></h3>
<div class="section" id="case-tikiwiki-php-fopenmode">
<span id="id19"></span><h4><span class="section-number">5.2.31.1. </span>Tikiwiki<a class="headerlink" href="#case-tikiwiki-php-fopenmode" title="Permalink to this headline">¶</a></h4>
<p><a class="reference internal" href="Rules.html#wrong-fopen-mode"><span class="std std-ref">Wrong fopen() Mode</span></a>, in lib/tikilib.php:6777.</p>
<p>This fopen() mode doesn’t exists. Use ‘w’ instead.</p>
<div class="highlight-php notranslate"><div class="highlight"><pre><span></span><span class="nb">fopen</span><span class="p">(</span><span class="s1">&#39;php://temp&#39;</span><span class="p">,</span> <span class="s1">&#39;rw&#39;</span><span class="p">);</span>
</pre></div>
</div>
</div>
<div class="section" id="case-humo-gen-php-fopenmode">
<span id="id20"></span><h4><span class="section-number">5.2.31.2. </span>HuMo-Gen<a class="headerlink" href="#case-humo-gen-php-fopenmode" title="Permalink to this headline">¶</a></h4>
<p><a class="reference internal" href="Rules.html#wrong-fopen-mode"><span class="std std-ref">Wrong fopen() Mode</span></a>, in include/phprtflite/lib/PHPRtfLite/StreamOutput.php:77.</p>
<p>This fopen() mode doesn’t exists. Use ‘w’ instead.</p>
<div class="highlight-php notranslate"><div class="highlight"><pre><span></span><span class="nb">fopen</span><span class="p">(</span><span class="nv">$this</span><span class="o">-&gt;</span><span class="na">_filename</span><span class="p">,</span> <span class="s1">&#39;wr&#39;</span><span class="p">,</span> <span class="k">false</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="incompilable-files">
<span id="case-incompilable-files"></span><h3><span class="section-number">5.2.32. </span>Incompilable Files<a class="headerlink" href="#incompilable-files" title="Permalink to this headline">¶</a></h3>
<div class="section" id="case-xataface-php-incompilable">
<span id="id21"></span><h4><span class="section-number">5.2.32.1. </span>xataface<a class="headerlink" href="#case-xataface-php-incompilable" title="Permalink to this headline">¶</a></h4>
<p><a class="reference internal" href="Rules.html#incompilable-files"><span class="std std-ref">Incompilable Files</span></a>, in lib/XML/Tree.php:289.</p>
<p>Compilation error with PHP 7.2 version.</p>
<div class="highlight-php notranslate"><div class="highlight"><pre><span></span><span class="nx">syntax</span> <span class="nx">error</span><span class="p">,</span> <span class="nx">unexpected</span> <span class="s1">&#39;new&#39;</span> <span class="p">(</span><span class="nx">T_NEW</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="wrong-parameter-type">
<span id="case-wrong-parameter-type"></span><h3><span class="section-number">5.2.33. </span>Wrong Parameter Type<a class="headerlink" href="#wrong-parameter-type" title="Permalink to this headline">¶</a></h3>
<div class="section" id="case-zencart-php-internalparametertype">
<span id="id22"></span><h4><span class="section-number">5.2.33.1. </span>Zencart<a class="headerlink" href="#case-zencart-php-internalparametertype" title="Permalink to this headline">¶</a></h4>
<p><a class="reference internal" href="Rules.html#wrong-parameter-type"><span class="std std-ref">Wrong Parameter Type</span></a>, in admin/includes/header.php:180.</p>
<p>setlocale() may be called with null or ‘’ (empty string), and will set values from the environment. When called with “0” (the string), it only reports the current setting. Using an integer is probably undocumented behavior, and falls back to the zero string.</p>
<div class="highlight-php notranslate"><div class="highlight"><pre><span></span><span class="nv">$loc</span> <span class="o">=</span> <span class="nb">setlocale</span><span class="p">(</span><span class="nx">LC_TIME</span><span class="p">,</span> <span class="mi">0</span><span class="p">);</span>
        <span class="k">if</span> <span class="p">(</span><span class="nv">$loc</span> <span class="o">!==</span> <span class="k">FALSE</span><span class="p">)</span> <span class="k">echo</span> <span class="s1">&#39; - &#39;</span> <span class="o">.</span> <span class="nv">$loc</span><span class="p">;</span> <span class="c1">//what is the locale in use?</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="logical-should-use-symbolic-operators">
<span id="case-logical-should-use-symbolic-operators"></span><h3><span class="section-number">5.2.34. </span>Logical Should Use Symbolic Operators<a class="headerlink" href="#logical-should-use-symbolic-operators" title="Permalink to this headline">¶</a></h3>
<div class="section" id="case-cleverstyle-php-logicalinletters">
<span id="id23"></span><h4><span class="section-number">5.2.34.1. </span>Cleverstyle<a class="headerlink" href="#case-cleverstyle-php-logicalinletters" title="Permalink to this headline">¶</a></h4>
<p><a class="reference internal" href="Rules.html#logical-should-use-symbolic-operators"><span class="std std-ref">Logical Should Use Symbolic Operators</span></a>, in modules/Uploader/Mime/Mime.php:171.</p>
<p>$extension is assigned with the results of pathinfo($reference_name, PATHINFO_EXTENSION) and ignores static::hasExtension($extension). The same expression, placed in a condition (like an if), would assign a value to $extension and use another for the condition itself. Here, this code is only an expression in the flow.</p>
<div class="highlight-php notranslate"><div class="highlight"><pre><span></span><span class="nv">$extension</span> <span class="o">=</span> <span class="nb">pathinfo</span><span class="p">(</span><span class="nv">$reference_name</span><span class="p">,</span> <span class="nx">PATHINFO_EXTENSION</span><span class="p">)</span> <span class="k">and</span> <span class="k">static</span><span class="o">::</span><span class="na">hasExtension</span><span class="p">(</span><span class="nv">$extension</span><span class="p">);</span>
</pre></div>
</div>
</div>
<div class="section" id="case-openconf-php-logicalinletters">
<span id="id24"></span><h4><span class="section-number">5.2.34.2. </span>OpenConf<a class="headerlink" href="#case-openconf-php-logicalinletters" title="Permalink to this headline">¶</a></h4>
<p><a class="reference internal" href="Rules.html#logical-should-use-symbolic-operators"><span class="std std-ref">Logical Should Use Symbolic Operators</span></a>, in chair/export.inc:143.</p>
<p>In this context, the priority of execution is used on purpose; $coreFile only collect the temporary name of the export file, and when this name is empty, then the second operand of OR is executed, though never collected. Since this second argument is a ‘die’, its return value is lost, but the initial assignation is never used anyway.</p>
<div class="highlight-php notranslate"><div class="highlight"><pre><span></span><span class="nv">$coreFile</span> <span class="o">=</span> <span class="nb">tempnam</span><span class="p">(</span><span class="s1">&#39;/tmp/&#39;</span><span class="p">,</span> <span class="s1">&#39;ocexport&#39;</span><span class="p">)</span> <span class="k">or</span> <span class="k">die</span><span class="p">(</span><span class="s1">&#39;could not generate Excel file (6)&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="possible-missing-subpattern">
<span id="case-possible-missing-subpattern"></span><h3><span class="section-number">5.2.35. </span>Possible Missing Subpattern<a class="headerlink" href="#possible-missing-subpattern" title="Permalink to this headline">¶</a></h3>
<div class="section" id="case-phpmyadmin-php-missingsubpattern">
<span id="id25"></span><h4><span class="section-number">5.2.35.1. </span>phpMyAdmin<a class="headerlink" href="#case-phpmyadmin-php-missingsubpattern" title="Permalink to this headline">¶</a></h4>
<p><a class="reference internal" href="Rules.html#possible-missing-subpattern"><span class="std std-ref">Possible Missing Subpattern</span></a>, in libraries/classes/Advisor.php:557.</p>
<p>The last capturing subpattern is <code class="docutils literal notranslate"><span class="pre">(</span> <span class="pre">\[(.*)\])?</span></code> and it is optional. Indeed, when the pattern succeed, the captured values are stored in <code class="docutils literal notranslate"><span class="pre">$match</span></code>. Yet, the code checks for the existence of <code class="docutils literal notranslate"><span class="pre">$match[3]</span></code> before using it.</p>
<div class="highlight-php notranslate"><div class="highlight"><pre><span></span><span class="k">if</span> <span class="p">(</span><span class="nb">preg_match</span><span class="p">(</span><span class="s2">&quot;/rule\s&#39;(.*)&#39;( \[(.*)\])?$/&quot;</span><span class="p">,</span> <span class="nv">$line</span><span class="p">,</span> <span class="nv">$match</span><span class="p">))</span> <span class="p">{</span>
                    <span class="nv">$ruleLine</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>
                    <span class="nv">$ruleNo</span><span class="o">++</span><span class="p">;</span>
                    <span class="nv">$rules</span><span class="p">[</span><span class="nv">$ruleNo</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;name&#39;</span> <span class="o">=&gt;</span> <span class="nv">$match</span><span class="p">[</span><span class="mi">1</span><span class="p">]];</span>
                    <span class="nv">$lines</span><span class="p">[</span><span class="nv">$ruleNo</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;name&#39;</span> <span class="o">=&gt;</span> <span class="nv">$i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">];</span>
                    <span class="k">if</span> <span class="p">(</span><span class="nb">isset</span><span class="p">(</span><span class="nv">$match</span><span class="p">[</span><span class="mi">3</span><span class="p">]))</span> <span class="p">{</span>
                        <span class="nv">$rules</span><span class="p">[</span><span class="nv">$ruleNo</span><span class="p">][</span><span class="s1">&#39;precondition&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="nv">$match</span><span class="p">[</span><span class="mi">3</span><span class="p">];</span>
                        <span class="nv">$lines</span><span class="p">[</span><span class="nv">$ruleNo</span><span class="p">][</span><span class="s1">&#39;precondition&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="nv">$i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">;</span>
                    <span class="p">}</span>
</pre></div>
</div>
</div>
<div class="section" id="spip">
<span id="case-spip-php-missingsubpattern"></span><h4><span class="section-number">5.2.35.2. </span>SPIP<a class="headerlink" href="#spip" title="Permalink to this headline">¶</a></h4>
<p><a class="reference internal" href="Rules.html#possible-missing-subpattern"><span class="std std-ref">Possible Missing Subpattern</span></a>, in ecrire/inc/filtres_dates.php:73.</p>
<p>This code avoid the PHP notice by padding the resulting array (see comment in French : eviter === avoid)</p>
<div class="highlight-php notranslate"><div class="highlight"><pre><span></span><span class="k">if</span> <span class="p">(</span><span class="nb">preg_match</span><span class="p">(</span><span class="s2">&quot;#^([12][0-9]{3}[-/][01]?[0-9])([-/]00)?( [-0-9:]+)?$#&quot;</span><span class="p">,</span> <span class="nv">$date</span><span class="p">,</span> <span class="nv">$regs</span><span class="p">))</span> <span class="p">{</span>
                            <span class="nv">$regs</span> <span class="o">=</span> <span class="nb">array_pad</span><span class="p">(</span><span class="nv">$regs</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="k">null</span><span class="p">);</span> <span class="c1">// eviter notice php</span>
                            <span class="nv">$date</span> <span class="o">=</span> <span class="nb">preg_replace</span><span class="p">(</span><span class="s2">&quot;@/@&quot;</span><span class="p">,</span> <span class="s2">&quot;-&quot;</span><span class="p">,</span> <span class="nv">$regs</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span> <span class="o">.</span> <span class="s2">&quot;-00&quot;</span> <span class="o">.</span> <span class="nv">$regs</span><span class="p">[</span><span class="mi">3</span><span class="p">];</span>
                    <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
                            <span class="nv">$date</span> <span class="o">=</span> <span class="nb">date</span><span class="p">(</span><span class="s2">&quot;Y-m-d H:i:s&quot;</span><span class="p">,</span> <span class="nb">strtotime</span><span class="p">(</span><span class="nv">$date</span><span class="p">));</span>
                    <span class="p">}</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="no-class-in-global">
<span id="case-no-class-in-global"></span><h3><span class="section-number">5.2.36. </span>No Class In Global<a class="headerlink" href="#no-class-in-global" title="Permalink to this headline">¶</a></h3>
<div class="section" id="case-dolphin-php-noclassinglobal">
<span id="id26"></span><h4><span class="section-number">5.2.36.1. </span>Dolphin<a class="headerlink" href="#case-dolphin-php-noclassinglobal" title="Permalink to this headline">¶</a></h4>
<p><a class="reference internal" href="Rules.html#no-class-in-global"><span class="std std-ref">No Class In Global</span></a>, in Dolphin-v.7.3.5/inc/classes/BxDolXml.php:10.</p>
<p>This class should be put away in a ‘dolphin’ or ‘boonex’ namespace.</p>
<div class="highlight-php notranslate"><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">BxDolXml</span> <span class="p">{</span>
    <span class="cm">/* class BxDolXML code */</span>
<span class="p">}</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="no-reference-for-ternary">
<span id="case-no-reference-for-ternary"></span><h3><span class="section-number">5.2.37. </span>No Reference For Ternary<a class="headerlink" href="#no-reference-for-ternary" title="Permalink to this headline">¶</a></h3>
<div class="section" id="phpadsnew">
<span id="case-phpadsnew-php-noreferenceforternary"></span><h4><span class="section-number">5.2.37.1. </span>phpadsnew<a class="headerlink" href="#phpadsnew" title="Permalink to this headline">¶</a></h4>
<p><a class="reference internal" href="Rules.html#no-reference-for-ternary"><span class="std std-ref">No Reference For Ternary</span></a>, in lib/OA/Admin/Menu/Section.php334:334.</p>
<p>The reference should be removed from the function definition. Either this method returns null, which is never a reference, or it returns $this, which is always a reference, or the results of a methodcall. The latter may or may not be a reference, but the Ternary operator will drop it and return by value.</p>
<div class="highlight-php notranslate"><div class="highlight"><pre><span></span><span class="k">function</span> <span class="o">&amp;</span><span class="nf">getParentOrSelf</span><span class="p">(</span><span class="nv">$type</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="k">if</span> <span class="p">(</span><span class="nv">$this</span><span class="o">-&gt;</span><span class="na">type</span> <span class="o">==</span> <span class="nv">$type</span><span class="p">)</span> <span class="p">{</span>
            <span class="k">return</span> <span class="nv">$this</span><span class="p">;</span>
        <span class="p">}</span>
        <span class="k">else</span> <span class="p">{</span>
            <span class="k">return</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">parentSection</span> <span class="o">!=</span> <span class="k">null</span> <span class="o">?</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">parentSection</span><span class="o">-&gt;</span><span class="na">getParentOrSelf</span><span class="p">(</span><span class="nv">$type</span><span class="p">)</span> <span class="o">:</span> <span class="k">null</span><span class="p">;</span>
        <span class="p">}</span>
    <span class="p">}</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="should-use-coalesce">
<span id="case-should-use-coalesce"></span><h3><span class="section-number">5.2.38. </span>Should Use Coalesce<a class="headerlink" href="#should-use-coalesce" title="Permalink to this headline">¶</a></h3>
<div class="section" id="case-churchcrm-php-shouldusecoalesce">
<span id="id27"></span><h4><span class="section-number">5.2.38.1. </span>ChurchCRM<a class="headerlink" href="#case-churchcrm-php-shouldusecoalesce" title="Permalink to this headline">¶</a></h4>
<p><a class="reference internal" href="Rules.html#should-use-coalesce"><span class="std std-ref">Should Use Coalesce</span></a>, in src/ChurchCRM/Service/FinancialService.php:597.</p>
<p>ChurchCRM features 5 old style ternary operators, which are all in this SQL query. ChurchCRM requires PHP 7.0, so a simple code review could remove them all.</p>
<div class="highlight-php notranslate"><div class="highlight"><pre><span></span><span class="nv">$sSQL</span> <span class="o">=</span> <span class="s2">&quot;INSERT INTO pledge_plg</span>
<span class="s2">                    (plg_famID,</span>
<span class="s2">                    plg_FYID,</span>
<span class="s2">                    plg_date,</span>
<span class="s2">                    plg_amount,</span>
<span class="s2">                    plg_schedule,</span>
<span class="s2">                    plg_method,</span>
<span class="s2">                    plg_comment,</span>
<span class="s2">                    plg_DateLastEdited,</span>
<span class="s2">                    plg_EditedBy,</span>
<span class="s2">                    plg_PledgeOrPayment,</span>
<span class="s2">                    plg_fundID,</span>
<span class="s2">                    plg_depID,</span>
<span class="s2">                    plg_CheckNo,</span>
<span class="s2">                    plg_scanString,</span>
<span class="s2">                    plg_aut_ID,</span>
<span class="s2">                    plg_NonDeductible,</span>
<span class="s2">                    plg_GroupKey)</span>
<span class="s2">                    VALUES (&#39;&quot;</span><span class="o">.</span>
          <span class="nv">$payment</span><span class="o">-&gt;</span><span class="na">FamilyID</span><span class="o">.</span><span class="s2">&quot;&#39;,&#39;&quot;</span><span class="o">.</span>
          <span class="nv">$payment</span><span class="o">-&gt;</span><span class="na">FYID</span><span class="o">.</span><span class="s2">&quot;&#39;,&#39;&quot;</span><span class="o">.</span>
          <span class="nv">$payment</span><span class="o">-&gt;</span><span class="na">Date</span><span class="o">.</span><span class="s2">&quot;&#39;,&#39;&quot;</span><span class="o">.</span>
          <span class="nv">$Fund</span><span class="o">-&gt;</span><span class="na">Amount</span><span class="o">.</span><span class="s2">&quot;&#39;,&#39;&quot;</span><span class="o">.</span>
          <span class="p">(</span><span class="nb">isset</span><span class="p">(</span><span class="nv">$payment</span><span class="o">-&gt;</span><span class="na">schedule</span><span class="p">)</span> <span class="o">?</span> <span class="nv">$payment</span><span class="o">-&gt;</span><span class="na">schedule</span> <span class="o">:</span> <span class="s1">&#39;NULL&#39;</span><span class="p">)</span><span class="o">.</span><span class="s2">&quot;&#39;,&#39;&quot;</span><span class="o">.</span>
          <span class="nv">$payment</span><span class="o">-&gt;</span><span class="na">iMethod</span><span class="o">.</span><span class="s2">&quot;&#39;,&#39;&quot;</span><span class="o">.</span>
          <span class="nv">$Fund</span><span class="o">-&gt;</span><span class="na">Comment</span><span class="o">.</span><span class="s2">&quot;&#39;,&#39;&quot;</span><span class="o">.</span>
          <span class="nb">date</span><span class="p">(</span><span class="s1">&#39;YmdHis&#39;</span><span class="p">)</span><span class="o">.</span><span class="s2">&quot;&#39;,&quot;</span><span class="o">.</span>
          <span class="nv">$_SESSION</span><span class="p">[</span><span class="s1">&#39;user&#39;</span><span class="p">]</span><span class="o">-&gt;</span><span class="na">getId</span><span class="p">()</span><span class="o">.</span><span class="s2">&quot;,&#39;&quot;</span><span class="o">.</span>
          <span class="nv">$payment</span><span class="o">-&gt;</span><span class="na">type</span><span class="o">.</span><span class="s2">&quot;&#39;,&quot;</span><span class="o">.</span>
          <span class="nv">$Fund</span><span class="o">-&gt;</span><span class="na">FundID</span><span class="o">.</span><span class="s1">&#39;,&#39;</span><span class="o">.</span>
          <span class="nv">$payment</span><span class="o">-&gt;</span><span class="na">DepositID</span><span class="o">.</span><span class="s1">&#39;,&#39;</span><span class="o">.</span>
          <span class="p">(</span><span class="nb">isset</span><span class="p">(</span><span class="nv">$payment</span><span class="o">-&gt;</span><span class="na">iCheckNo</span><span class="p">)</span> <span class="o">?</span> <span class="nv">$payment</span><span class="o">-&gt;</span><span class="na">iCheckNo</span> <span class="o">:</span> <span class="s1">&#39;NULL&#39;</span><span class="p">)</span><span class="o">.</span><span class="s2">&quot;,&#39;&quot;</span><span class="o">.</span>
          <span class="p">(</span><span class="nb">isset</span><span class="p">(</span><span class="nv">$payment</span><span class="o">-&gt;</span><span class="na">tScanString</span><span class="p">)</span> <span class="o">?</span> <span class="nv">$payment</span><span class="o">-&gt;</span><span class="na">tScanString</span> <span class="o">:</span> <span class="s1">&#39;NULL&#39;</span><span class="p">)</span><span class="o">.</span><span class="s2">&quot;&#39;,&#39;&quot;</span><span class="o">.</span>
          <span class="p">(</span><span class="nb">isset</span><span class="p">(</span><span class="nv">$payment</span><span class="o">-&gt;</span><span class="na">iAutID</span><span class="p">)</span> <span class="o">?</span> <span class="nv">$payment</span><span class="o">-&gt;</span><span class="na">iAutID</span> <span class="o">:</span> <span class="s1">&#39;NULL&#39;</span><span class="p">)</span><span class="o">.</span><span class="s2">&quot;&#39;,&#39;&quot;</span><span class="o">.</span>
          <span class="p">(</span><span class="nb">isset</span><span class="p">(</span><span class="nv">$Fund</span><span class="o">-&gt;</span><span class="na">NonDeductible</span><span class="p">)</span> <span class="o">?</span> <span class="nv">$Fund</span><span class="o">-&gt;</span><span class="na">NonDeductible</span> <span class="o">:</span> <span class="s1">&#39;NULL&#39;</span><span class="p">)</span><span class="o">.</span><span class="s2">&quot;&#39;,&#39;&quot;</span><span class="o">.</span>
          <span class="nv">$sGroupKey</span><span class="o">.</span><span class="s2">&quot;&#39;)&quot;</span><span class="p">;</span>
</pre></div>
</div>
</div>
<div class="section" id="case-cleverstyle-php-shouldusecoalesce">
<span id="id28"></span><h4><span class="section-number">5.2.38.2. </span>Cleverstyle<a class="headerlink" href="#case-cleverstyle-php-shouldusecoalesce" title="Permalink to this headline">¶</a></h4>
<p><a class="reference internal" href="Rules.html#should-use-coalesce"><span class="std std-ref">Should Use Coalesce</span></a>, in modules/Feedback/index.php:37.</p>
<p>Cleverstyle nests ternary operators when selecting default values. Here, moving some of them to ?? will reduce the code complexity and make it more readable. Cleverstyle requires PHP 7.0 or more recent.</p>
<div class="highlight-php notranslate"><div class="highlight"><pre><span></span><span class="nv">$Page</span><span class="o">-&gt;</span><span class="na">content</span><span class="p">(</span>
    <span class="nx">h</span><span class="o">::</span><span class="p">{</span><span class="s1">&#39;cs-form form&#39;</span><span class="p">}(</span>
            <span class="nx">h</span><span class="o">::</span><span class="p">{</span><span class="s1">&#39;section.cs-feedback-form article&#39;</span><span class="p">}(</span>
                    <span class="nx">h</span><span class="o">::</span><span class="p">{</span><span class="s1">&#39;header h2.cs-text-center&#39;</span><span class="p">}(</span><span class="nv">$L</span><span class="o">-&gt;</span><span class="na">Feedback</span><span class="p">)</span><span class="o">.</span>
                    <span class="nx">h</span><span class="o">::</span><span class="p">{</span><span class="s1">&#39;table.cs-table[center] tr| td&#39;</span><span class="p">}(</span>
                            <span class="p">[</span>
                                    <span class="nx">h</span><span class="o">::</span><span class="p">{</span><span class="s1">&#39;cs-input-text input[name=name][required]&#39;</span><span class="p">}(</span>
                                            <span class="p">[</span>
                                                    <span class="s1">&#39;placeholder&#39;</span> <span class="o">=&gt;</span> <span class="nv">$L</span><span class="o">-&gt;</span><span class="na">feedback_name</span><span class="p">,</span>
                                                    <span class="s1">&#39;value&#39;</span>       <span class="o">=&gt;</span> <span class="nv">$User</span><span class="o">-&gt;</span><span class="na">user</span><span class="p">()</span> <span class="o">?</span> <span class="nv">$User</span><span class="o">-&gt;</span><span class="na">username</span><span class="p">()</span> <span class="o">:</span> <span class="p">(</span><span class="nb">isset</span><span class="p">(</span><span class="nv">$_POST</span><span class="p">[</span><span class="s1">&#39;name&#39;</span><span class="p">])</span> <span class="o">?</span> <span class="nv">$_POST</span><span class="p">[</span><span class="s1">&#39;name&#39;</span><span class="p">]</span> <span class="o">:</span> <span class="s1">&#39;&#39;</span><span class="p">)</span>
                                            <span class="p">]</span>
                                    <span class="p">),</span>
                                    <span class="nx">h</span><span class="o">::</span><span class="p">{</span><span class="s1">&#39;cs-input-text input[type=email][name=email][required]&#39;</span><span class="p">}(</span>
                                            <span class="p">[</span>
                                                    <span class="s1">&#39;placeholder&#39;</span> <span class="o">=&gt;</span> <span class="nv">$L</span><span class="o">-&gt;</span><span class="na">feedback_email</span><span class="p">,</span>
                                                    <span class="s1">&#39;value&#39;</span>       <span class="o">=&gt;</span> <span class="nv">$User</span><span class="o">-&gt;</span><span class="na">user</span><span class="p">()</span> <span class="o">?</span> <span class="nv">$User</span><span class="o">-&gt;</span><span class="na">email</span> <span class="o">:</span> <span class="p">(</span><span class="nb">isset</span><span class="p">(</span><span class="nv">$_POST</span><span class="p">[</span><span class="s1">&#39;email&#39;</span><span class="p">])</span> <span class="o">?</span> <span class="nv">$_POST</span><span class="p">[</span><span class="s1">&#39;email&#39;</span><span class="p">]</span> <span class="o">:</span> <span class="s1">&#39;&#39;</span><span class="p">)</span>
                                            <span class="p">]</span>
                                    <span class="p">),</span>
                                    <span class="nx">h</span><span class="o">::</span><span class="p">{</span><span class="s1">&#39;cs-textarea[autosize] textarea[name=text][required]&#39;</span><span class="p">}(</span>
                                            <span class="p">[</span>
                                                    <span class="s1">&#39;placeholder&#39;</span> <span class="o">=&gt;</span> <span class="nv">$L</span><span class="o">-&gt;</span><span class="na">feedback_text</span><span class="p">,</span>
                                                    <span class="s1">&#39;value&#39;</span>       <span class="o">=&gt;</span> <span class="nb">isset</span><span class="p">(</span><span class="nv">$_POST</span><span class="p">[</span><span class="s1">&#39;text&#39;</span><span class="p">])</span> <span class="o">?</span> <span class="nv">$_POST</span><span class="p">[</span><span class="s1">&#39;text&#39;</span><span class="p">]</span> <span class="o">:</span> <span class="s1">&#39;&#39;</span>
                                            <span class="p">]</span>
                                    <span class="p">),</span>
                                    <span class="nx">h</span><span class="o">::</span><span class="p">{</span><span class="s1">&#39;cs-button button[type=submit]&#39;</span><span class="p">}(</span><span class="nv">$L</span><span class="o">-&gt;</span><span class="na">feedback_send</span><span class="p">)</span>
                            <span class="p">]</span>
                    <span class="p">)</span>
            <span class="p">)</span>
    <span class="p">)</span>
<span class="p">);</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="strtr-arguments">
<span id="case-strtr-arguments"></span><h3><span class="section-number">5.2.39. </span>Strtr Arguments<a class="headerlink" href="#strtr-arguments" title="Permalink to this headline">¶</a></h3>
<div class="section" id="suitecrm">
<span id="case-suitecrm-php-strtrarguments"></span><h4><span class="section-number">5.2.39.1. </span>SuiteCrm<a class="headerlink" href="#suitecrm" title="Permalink to this headline">¶</a></h4>
<p><a class="reference internal" href="Rules.html#strtr-arguments"><span class="std std-ref">Strtr Arguments</span></a>, in includes/vCard.php:221.</p>
<p>This code prepares incoming ‘$values’ for extraction. The keys are cleaned then split with explode(). The ‘=’ sign would stay, as strtr() can’t remove it. This means that such keys won’t be recognized later in the code, and gets omitted.</p>
<div class="highlight-php notranslate"><div class="highlight"><pre><span></span><span class="nv">$values</span> <span class="o">=</span> <span class="nb">explode</span><span class="p">(</span><span class="s1">&#39;;&#39;</span><span class="p">,</span> <span class="nv">$value</span><span class="p">);</span>
                    <span class="nv">$key</span> <span class="o">=</span> <span class="nb">strtoupper</span><span class="p">(</span><span class="nv">$keyvalue</span><span class="p">[</span><span class="mi">0</span><span class="p">]);</span>
                    <span class="nv">$key</span> <span class="o">=</span> <span class="nb">strtr</span><span class="p">(</span><span class="nv">$key</span><span class="p">,</span> <span class="s1">&#39;=&#39;</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">);</span>
                    <span class="nv">$key</span> <span class="o">=</span> <span class="nb">strtr</span><span class="p">(</span><span class="nv">$key</span><span class="p">,</span> <span class="s1">&#39;,&#39;</span><span class="p">,</span> <span class="s1">&#39;;&#39;</span><span class="p">);</span>
                    <span class="nv">$keys</span> <span class="o">=</span> <span class="nb">explode</span><span class="p">(</span><span class="s1">&#39;;&#39;</span><span class="p">,</span> <span class="nv">$key</span><span class="p">);</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="use-php-object-api">
<span id="case-use-php-object-api"></span><h3><span class="section-number">5.2.40. </span>Use PHP Object API<a class="headerlink" href="#use-php-object-api" title="Permalink to this headline">¶</a></h3>
<div class="section" id="case-wordpress-php-useobjectapi">
<span id="id29"></span><h4><span class="section-number">5.2.40.1. </span>WordPress<a class="headerlink" href="#case-wordpress-php-useobjectapi" title="Permalink to this headline">¶</a></h4>
<p><a class="reference internal" href="Rules.html#use-php-object-api"><span class="std std-ref">Use PHP Object API</span></a>, in wp-includes/functions.php:2558.</p>
<p>Finfo has also a class, with the same name.</p>
<div class="highlight-php notranslate"><div class="highlight"><pre><span></span><span class="nb">finfo_open</span><span class="p">(</span><span class="nx">FILEINFO_MIME_TYPE</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="section" id="case-prestashop-php-useobjectapi">
<span id="id30"></span><h4><span class="section-number">5.2.40.2. </span>PrestaShop<a class="headerlink" href="#case-prestashop-php-useobjectapi" title="Permalink to this headline">¶</a></h4>
<p><a class="reference internal" href="Rules.html#use-php-object-api"><span class="std std-ref">Use PHP Object API</span></a>, in admin-dev/filemanager/include/utils.php:174.</p>
<p>transliterator_transliterate() has also a class named Transliterator</p>
<div class="highlight-php notranslate"><div class="highlight"><pre><span></span><span class="nx">transliterator_transliterate</span><span class="p">(</span><span class="s1">&#39;Accents-Any&#39;</span><span class="p">,</span> <span class="nv">$str</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="use-pathinfo">
<span id="case-use-pathinfo"></span><h3><span class="section-number">5.2.41. </span>Use Pathinfo<a class="headerlink" href="#use-pathinfo" title="Permalink to this headline">¶</a></h3>
<div class="section" id="case-suitecrm-php-usepathinfo">
<span id="id31"></span><h4><span class="section-number">5.2.41.1. </span>SuiteCrm<a class="headerlink" href="#case-suitecrm-php-usepathinfo" title="Permalink to this headline">¶</a></h4>
<p><a class="reference internal" href="Rules.html#use-pathinfo"><span class="std std-ref">Use Pathinfo</span></a>, in include/utils/file_utils.php:441.</p>
<p>Looking for the extension ? Use pathinfo() and PATHINFO_EXTENSION</p>
<div class="highlight-php notranslate"><div class="highlight"><pre><span></span><span class="nv">$exp</span> <span class="o">=</span> <span class="nb">explode</span><span class="p">(</span><span class="s1">&#39;.&#39;</span><span class="p">,</span> <span class="nv">$filename</span><span class="p">);</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="don-t-echo-error">
<span id="case-don-t-echo-error"></span><h3><span class="section-number">5.2.42. </span>Don’t Echo Error<a class="headerlink" href="#don-t-echo-error" title="Permalink to this headline">¶</a></h3>
<div class="section" id="case-churchcrm-security-dontechoerror">
<span id="id32"></span><h4><span class="section-number">5.2.42.1. </span>ChurchCRM<a class="headerlink" href="#case-churchcrm-security-dontechoerror" title="Permalink to this headline">¶</a></h4>
<p><a class="reference internal" href="Rules.html#don-t-echo-error"><span class="std std-ref">Don’t Echo Error</span></a>, in wp-admin/includes/misc.php:74.</p>
<p>This is classic debugging code that should never reach production. mysqli_error() and mysqli_errno() provide valuable information is case of an error, and may be exploited by intruders.</p>
<div class="highlight-php notranslate"><div class="highlight"><pre><span></span><span class="k">if</span> <span class="p">(</span><span class="nx">mysqli_error</span><span class="p">(</span><span class="nv">$cnInfoCentral</span><span class="p">)</span> <span class="o">!=</span> <span class="s1">&#39;&#39;</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">echo</span> <span class="nb">gettext</span><span class="p">(</span><span class="s1">&#39;An error occured: &#39;</span><span class="p">)</span><span class="o">.</span><span class="nx">mysqli_errno</span><span class="p">(</span><span class="nv">$cnInfoCentral</span><span class="p">)</span><span class="o">.</span><span class="s1">&#39;--&#39;</span><span class="o">.</span><span class="nx">mysqli_error</span><span class="p">(</span><span class="nv">$cnInfoCentral</span><span class="p">);</span>
    <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
</pre></div>
</div>
</div>
<div class="section" id="case-phpdocumentor-security-dontechoerror">
<span id="id33"></span><h4><span class="section-number">5.2.42.2. </span>Phpdocumentor<a class="headerlink" href="#case-phpdocumentor-security-dontechoerror" title="Permalink to this headline">¶</a></h4>
<p><a class="reference internal" href="Rules.html#don-t-echo-error"><span class="std std-ref">Don’t Echo Error</span></a>, in src/phpDocumentor/Plugin/Graphs/Writer/Graph.php:77.</p>
<p>Default development behavior : display the caught exception. Production behavior should not display that message, but log it for later review. Also, the return in the catch should be moved to the main code sequence.</p>
<div class="highlight-php notranslate"><div class="highlight"><pre><span></span><span class="k">public</span> <span class="k">function</span> <span class="nf">processClass</span><span class="p">(</span><span class="nx">ProjectDescriptor</span> <span class="nv">$project</span><span class="p">,</span> <span class="nx">Transformation</span> <span class="nv">$transformation</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="k">try</span> <span class="p">{</span>
            <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">checkIfGraphVizIsInstalled</span><span class="p">();</span>
        <span class="p">}</span> <span class="k">catch</span> <span class="p">(</span><span class="nx">\Exception</span> <span class="nv">$e</span><span class="p">)</span> <span class="p">{</span>
            <span class="k">echo</span> <span class="nv">$e</span><span class="o">-&gt;</span><span class="na">getMessage</span><span class="p">();</span>

            <span class="k">return</span><span class="p">;</span>
        <span class="p">}</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="should-use-prepared-statement">
<span id="case-should-use-prepared-statement"></span><h3><span class="section-number">5.2.43. </span>Should Use Prepared Statement<a class="headerlink" href="#should-use-prepared-statement" title="Permalink to this headline">¶</a></h3>
<div class="section" id="case-dolibarr-security-shouldusepreparedstatement">
<span id="id34"></span><h4><span class="section-number">5.2.43.1. </span>Dolibarr<a class="headerlink" href="#case-dolibarr-security-shouldusepreparedstatement" title="Permalink to this headline">¶</a></h4>
<p><a class="reference internal" href="Rules.html#should-use-prepared-statement"><span class="std std-ref">Should Use Prepared Statement</span></a>, in htdocs/product/admin/price_rules.php:76.</p>
<p>This code is well escaped, as the integer type cast will prevent any special chars to be used. Here, a prepared statement would apply a modern approach to securing this query.</p>
<div class="highlight-php notranslate"><div class="highlight"><pre><span></span><span class="nv">$db</span><span class="o">-&gt;</span><span class="na">query</span><span class="p">(</span><span class="s2">&quot;DELETE FROM &quot;</span> <span class="o">.</span> <span class="nx">MAIN_DB_PREFIX</span> <span class="o">.</span> <span class="s2">&quot;product_pricerules WHERE level = &quot;</span> <span class="o">.</span> <span class="p">(</span><span class="nx">int</span><span class="p">)</span> <span class="nv">$i</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="adding-zero">
<span id="case-adding-zero"></span><h3><span class="section-number">5.2.44. </span>Adding Zero<a class="headerlink" href="#adding-zero" title="Permalink to this headline">¶</a></h3>
<div class="section" id="case-thelia-structures-addzero">
<span id="id35"></span><h4><span class="section-number">5.2.44.1. </span>Thelia<a class="headerlink" href="#case-thelia-structures-addzero" title="Permalink to this headline">¶</a></h4>
<p><a class="reference internal" href="Rules.html#adding-zero"><span class="std std-ref">Adding Zero</span></a>, in core/lib/Thelia/Model/Map/ProfileResourceTableMap.php:250.</p>
<p>This return statement is doing quite a lot, including a buried ‘0 + $offset’. This call is probably an echo to ‘1 + $offset’, which is a little later in the expression.</p>
<div class="highlight-php notranslate"><div class="highlight"><pre><span></span><span class="k">return</span> <span class="nb">serialize</span><span class="p">(</span><span class="k">array</span><span class="p">((</span><span class="nx">string</span><span class="p">)</span> <span class="nv">$row</span><span class="p">[</span><span class="nx">TableMap</span><span class="o">::</span><span class="na">TYPE_NUM</span> <span class="o">==</span> <span class="nv">$indexType</span> <span class="o">?</span> <span class="mi">0</span> <span class="o">+</span> <span class="nv">$offset</span> <span class="o">:</span> <span class="k">static</span><span class="o">::</span><span class="na">translateFieldName</span><span class="p">(</span><span class="s1">&#39;ProfileId&#39;</span><span class="p">,</span> <span class="nx">TableMap</span><span class="o">::</span><span class="na">TYPE_PHPNAME</span><span class="p">,</span> <span class="nv">$indexType</span><span class="p">)],</span> <span class="p">(</span><span class="nx">string</span><span class="p">)</span> <span class="nv">$row</span><span class="p">[</span><span class="nx">TableMap</span><span class="o">::</span><span class="na">TYPE_NUM</span> <span class="o">==</span> <span class="nv">$indexType</span> <span class="o">?</span> <span class="mi">1</span> <span class="o">+</span> <span class="nv">$offset</span> <span class="o">:</span> <span class="k">static</span><span class="o">::</span><span class="na">translateFieldName</span><span class="p">(</span><span class="s1">&#39;ResourceId&#39;</span><span class="p">,</span> <span class="nx">TableMap</span><span class="o">::</span><span class="na">TYPE_PHPNAME</span><span class="p">,</span> <span class="nv">$indexType</span><span class="p">)]));</span>
</pre></div>
</div>
</div>
<div class="section" id="case-openemr-structures-addzero">
<span id="id36"></span><h4><span class="section-number">5.2.44.2. </span>OpenEMR<a class="headerlink" href="#case-openemr-structures-addzero" title="Permalink to this headline">¶</a></h4>
<p><a class="reference internal" href="Rules.html#adding-zero"><span class="std std-ref">Adding Zero</span></a>, in interface/forms/fee_sheet/new.php:466:534.</p>
<p>$main_provid is filtered as an integer. $main_supid is then filtered twice : one with the sufficent (int) and then, added with 0.</p>
<div class="highlight-php notranslate"><div class="highlight"><pre><span></span><span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nv">$alertmsg</span> <span class="o">&amp;&amp;</span> <span class="p">(</span><span class="nv">$_POST</span><span class="p">[</span><span class="s1">&#39;bn_save&#39;</span><span class="p">]</span> <span class="o">||</span> <span class="nv">$_POST</span><span class="p">[</span><span class="s1">&#39;bn_save_close&#39;</span><span class="p">]</span> <span class="o">||</span> <span class="nv">$_POST</span><span class="p">[</span><span class="s1">&#39;bn_save_stay&#39;</span><span class="p">]))</span> <span class="p">{</span>
    <span class="nv">$main_provid</span> <span class="o">=</span> <span class="mi">0</span> <span class="o">+</span> <span class="nv">$_POST</span><span class="p">[</span><span class="s1">&#39;ProviderID&#39;</span><span class="p">];</span>
    <span class="nv">$main_supid</span>  <span class="o">=</span> <span class="mi">0</span> <span class="o">+</span> <span class="p">(</span><span class="nx">int</span><span class="p">)</span><span class="nv">$_POST</span><span class="p">[</span><span class="s1">&#39;SupervisorID&#39;</span><span class="p">];</span>
    <span class="c1">//.....</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="altering-foreach-without-reference">
<span id="case-altering-foreach-without-reference"></span><h3><span class="section-number">5.2.45. </span>Altering Foreach Without Reference<a class="headerlink" href="#altering-foreach-without-reference" title="Permalink to this headline">¶</a></h3>
<div class="section" id="case-contao-structures-alteringforeachwithoutreference">
<span id="id37"></span><h4><span class="section-number">5.2.45.1. </span>Contao<a class="headerlink" href="#case-contao-structures-alteringforeachwithoutreference" title="Permalink to this headline">¶</a></h4>
<p><a class="reference internal" href="Rules.html#altering-foreach-without-reference"><span class="std std-ref">Altering Foreach Without Reference</span></a>, in core-bundle/src/Resources/contao/classes/Theme.php:613.</p>
<p>$tmp[$kk] is &amp;$vv.</p>
<div class="highlight-php notranslate"><div class="highlight"><pre><span></span><span class="k">foreach</span> <span class="p">(</span><span class="nv">$tmp</span> <span class="k">as</span> <span class="nv">$kk</span><span class="o">=&gt;</span><span class="nv">$vv</span><span class="p">)</span>
                                                            <span class="p">{</span>
                                                                    <span class="c1">// Do not use the FilesModel here – tables are locked!</span>
                                                                    <span class="nv">$objFile</span> <span class="o">=</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">Database</span><span class="o">-&gt;</span><span class="na">prepare</span><span class="p">(</span><span class="nx">SELECT</span> <span class="nx">uuid</span> <span class="nx">FROM</span> <span class="nx">tl_files</span> <span class="nx">WHERE</span> <span class="nx">path</span><span class="o">=?</span><span class="p">)</span>
                                                                                                                      <span class="o">-&gt;</span><span class="na">limit</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
                                                                                                                      <span class="o">-&gt;</span><span class="na">execute</span><span class="p">(</span><span class="nv">$this</span><span class="o">-&gt;</span><span class="na">customizeUploadPath</span><span class="p">(</span><span class="nv">$vv</span><span class="p">));</span>

                                                                    <span class="nv">$tmp</span><span class="p">[</span><span class="nv">$kk</span><span class="p">]</span> <span class="o">=</span> <span class="nv">$objFile</span><span class="o">-&gt;</span><span class="na">uuid</span><span class="p">;</span>
                                                            <span class="p">}</span>
</pre></div>
</div>
</div>
<div class="section" id="case-wordpress-structures-alteringforeachwithoutreference">
<span id="id38"></span><h4><span class="section-number">5.2.45.2. </span>WordPress<a class="headerlink" href="#case-wordpress-structures-alteringforeachwithoutreference" title="Permalink to this headline">¶</a></h4>
<p><a class="reference internal" href="Rules.html#altering-foreach-without-reference"><span class="std std-ref">Altering Foreach Without Reference</span></a>, in wp-admin/includes/misc.php:74.</p>
<p>$ids[$index] is &amp;$rrid.</p>
<div class="highlight-php notranslate"><div class="highlight"><pre><span></span><span class="k">foreach</span><span class="p">(</span><span class="nv">$ids</span> <span class="k">as</span> <span class="nv">$index</span> <span class="o">=&gt;</span> <span class="nv">$rrid</span><span class="p">)</span>
                <span class="p">{</span>
                    <span class="k">if</span><span class="p">(</span><span class="nv">$rrid</span> <span class="o">==</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">Id</span><span class="p">)</span>
                    <span class="p">{</span>
                        <span class="nv">$ids</span><span class="p">[</span><span class="nv">$index</span><span class="p">]</span> <span class="o">=</span> <span class="nv">$_id</span><span class="p">;</span>
                        <span class="nv">$write</span> <span class="o">=</span> <span class="k">true</span><span class="p">;</span>
                        <span class="k">break</span><span class="p">;</span>
                    <span class="p">}</span>
                <span class="p">}</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="strict-comparison-with-booleans">
<span id="case-strict-comparison-with-booleans"></span><h3><span class="section-number">5.2.46. </span>Strict Comparison With Booleans<a class="headerlink" href="#strict-comparison-with-booleans" title="Permalink to this headline">¶</a></h3>
<div class="section" id="case-phinx-structures-booleanstrictcomparison">
<span id="id39"></span><h4><span class="section-number">5.2.46.1. </span>Phinx<a class="headerlink" href="#case-phinx-structures-booleanstrictcomparison" title="Permalink to this headline">¶</a></h4>
<p><a class="reference internal" href="Rules.html#strict-comparison-with-booleans"><span class="std std-ref">Strict Comparison With Booleans</span></a>, in src/Phinx/Db/Adapter/MysqlAdapter.php:1131.</p>
<p><cite>ìsNull( )`</cite> always returns a boolean : it may be only be <code class="docutils literal notranslate"><span class="pre">true</span></code> or <code class="docutils literal notranslate"><span class="pre">false</span></code>. Until typehinted properties or return typehint are used, isNull() may return anything else.</p>
<div class="highlight-php notranslate"><div class="highlight"><pre><span></span><span class="nv">$column</span><span class="o">-&gt;</span><span class="na">isNull</span><span class="p">(</span> <span class="p">)</span> <span class="o">==</span> <span class="k">false</span>
</pre></div>
</div>
</div>
<div class="section" id="case-typo3-structures-booleanstrictcomparison">
<span id="id40"></span><h4><span class="section-number">5.2.46.2. </span>Typo3<a class="headerlink" href="#case-typo3-structures-booleanstrictcomparison" title="Permalink to this headline">¶</a></h4>
<p><a class="reference internal" href="Rules.html#strict-comparison-with-booleans"><span class="std std-ref">Strict Comparison With Booleans</span></a>, in typo3/sysext/lowlevel/Classes/Command/FilesWithMultipleReferencesCommand.php:90.</p>
<p>When <code class="docutils literal notranslate"><span class="pre">dry-run</span></code> is not defined, the getOption() method actually returns a <code class="docutils literal notranslate"><span class="pre">null</span></code> value. So, comparing the result of getOption() to false is actually wrong : using a constant to prevent values to be inconsistent is recommended here.</p>
<div class="highlight-php notranslate"><div class="highlight"><pre><span></span><span class="nv">$input</span><span class="o">-&gt;</span><span class="na">getOption</span><span class="p">(</span><span class="s1">&#39;dry-run&#39;</span><span class="p">)</span> <span class="o">!=</span> <span class="k">false</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="check-json">
<span id="case-check-json"></span><h3><span class="section-number">5.2.47. </span>Check JSON<a class="headerlink" href="#check-json" title="Permalink to this headline">¶</a></h3>
<div class="section" id="woocommerce">
<span id="case-woocommerce-structures-checkjson"></span><h4><span class="section-number">5.2.47.1. </span>Woocommerce<a class="headerlink" href="#woocommerce" title="Permalink to this headline">¶</a></h4>
<p><a class="reference internal" href="Rules.html#check-json"><span class="std std-ref">Check JSON</span></a>, in includes/admin/helper/class-wc-helper-plugin-info.php:66.</p>
<p>In case the body is an empty string, this will be correctly decoded, but will yield an object with an empty-named property.</p>
<div class="highlight-php notranslate"><div class="highlight"><pre><span></span><span class="nv">$results</span> <span class="o">=</span> <span class="nb">json_decode</span><span class="p">(</span> <span class="nx">wp_remote_retrieve_body</span><span class="p">(</span> <span class="nv">$request</span> <span class="p">),</span> <span class="k">true</span> <span class="p">);</span>
            <span class="k">if</span> <span class="p">(</span> <span class="o">!</span> <span class="k">empty</span><span class="p">(</span> <span class="nv">$results</span> <span class="p">)</span> <span class="p">)</span> <span class="p">{</span>
                    <span class="nv">$response</span> <span class="o">=</span> <span class="p">(</span><span class="nx">object</span><span class="p">)</span> <span class="nv">$results</span><span class="p">;</span>
            <span class="p">}</span>

            <span class="k">return</span> <span class="nv">$response</span><span class="p">;</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="could-use-dir">
<span id="case-could-use-dir"></span><h3><span class="section-number">5.2.48. </span>Could Use __DIR__<a class="headerlink" href="#could-use-dir" title="Permalink to this headline">¶</a></h3>
<div class="section" id="case-woocommerce-structures-couldusedir">
<span id="id41"></span><h4><span class="section-number">5.2.48.1. </span>Woocommerce<a class="headerlink" href="#case-woocommerce-structures-couldusedir" title="Permalink to this headline">¶</a></h4>
<p><a class="reference internal" href="Rules.html#could-use-dir"><span class="std std-ref">Could Use __DIR__</span></a>, in includes/class-wc-api.php:162.</p>
<p>All the 120 occurrences use <cite>dirname( __FILE__ )</cite>, and could be upgraded to __DIR__ if backward compatibility to PHP 5.2 is not critical.</p>
<div class="highlight-php notranslate"><div class="highlight"><pre><span></span><span class="k">private</span> <span class="k">function</span> <span class="nf">rest_api_includes</span><span class="p">()</span> <span class="p">{</span>
            <span class="c1">// Exception handler.</span>
            <span class="k">include_once</span> <span class="nb">dirname</span><span class="p">(</span> <span class="no">__FILE__</span> <span class="p">)</span> <span class="o">.</span> <span class="s1">&#39;/api/class-wc-rest-exception.php&#39;</span><span class="p">;</span>

            <span class="c1">// Authentication.</span>
            <span class="k">include_once</span> <span class="nb">dirname</span><span class="p">(</span> <span class="no">__FILE__</span> <span class="p">)</span> <span class="o">.</span> <span class="s1">&#39;/api/class-wc-rest-authentication.php&#39;</span><span class="p">;</span>
</pre></div>
</div>
</div>
<div class="section" id="case-piwigo-structures-couldusedir">
<span id="id42"></span><h4><span class="section-number">5.2.48.2. </span>Piwigo<a class="headerlink" href="#case-piwigo-structures-couldusedir" title="Permalink to this headline">¶</a></h4>
<p><a class="reference internal" href="Rules.html#could-use-dir"><span class="std std-ref">Could Use __DIR__</span></a>, in include/random_compat/random.php:50.</p>
<p><cite>dirname( __FILE__ )</cite> is cached into $RandomCompatDIR, then reused three times. Using __DIR__ would save that detour.</p>
<div class="highlight-php notranslate"><div class="highlight"><pre><span></span><span class="nv">$RandomCompatDIR</span> <span class="o">=</span> <span class="nb">dirname</span><span class="p">(</span><span class="no">__FILE__</span><span class="p">);</span>

    <span class="k">require_once</span> <span class="nv">$RandomCompatDIR</span><span class="o">.</span><span class="s1">&#39;/byte_safe_strings.php&#39;</span><span class="p">;</span>
    <span class="k">require_once</span> <span class="nv">$RandomCompatDIR</span><span class="o">.</span><span class="s1">&#39;/cast_to_int.php&#39;</span><span class="p">;</span>
    <span class="k">require_once</span> <span class="nv">$RandomCompatDIR</span><span class="o">.</span><span class="s1">&#39;/error_polyfill.php&#39;</span><span class="p">;</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="could-use-short-assignation">
<span id="case-could-use-short-assignation"></span><h3><span class="section-number">5.2.49. </span>Could Use Short Assignation<a class="headerlink" href="#could-use-short-assignation" title="Permalink to this headline">¶</a></h3>
<div class="section" id="case-churchcrm-structures-coulduseshortassignation">
<span id="id43"></span><h4><span class="section-number">5.2.49.1. </span>ChurchCRM<a class="headerlink" href="#case-churchcrm-structures-coulduseshortassignation" title="Permalink to this headline">¶</a></h4>
<p><a class="reference internal" href="Rules.html#could-use-short-assignation"><span class="std std-ref">Could Use Short Assignation</span></a>, in src/ChurchCRM/utils/GeoUtils.php:74.</p>
<p>Sometimes, the variable is on the other side of the operator.</p>
<div class="highlight-php notranslate"><div class="highlight"><pre><span></span><span class="nv">$distance</span> <span class="o">=</span> <span class="mf">0.6213712</span> <span class="o">*</span> <span class="nv">$distance</span><span class="p">;</span>
</pre></div>
</div>
</div>
<div class="section" id="case-thelia-structures-coulduseshortassignation">
<span id="id44"></span><h4><span class="section-number">5.2.49.2. </span>Thelia<a class="headerlink" href="#case-thelia-structures-coulduseshortassignation" title="Permalink to this headline">¶</a></h4>
<p><a class="reference internal" href="Rules.html#could-use-short-assignation"><span class="std std-ref">Could Use Short Assignation</span></a>, in local/modules/Tinymce/Resources/js/tinymce/filemanager/include/utils.php:70.</p>
<p>/= is rare, but it definitely could be used here.</p>
<div class="highlight-php notranslate"><div class="highlight"><pre><span></span><span class="nv">$size</span> <span class="o">=</span> <span class="nv">$size</span> <span class="o">/</span> <span class="mi">1024</span><span class="p">;</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="could-use-str-repeat">
<span id="case-could-use-str-repeat"></span><h3><span class="section-number">5.2.50. </span>Could Use str_repeat()<a class="headerlink" href="#could-use-str-repeat" title="Permalink to this headline">¶</a></h3>
<div class="section" id="case-zencart-structures-couldusestrrepeat">
<span id="id45"></span><h4><span class="section-number">5.2.50.1. </span>Zencart<a class="headerlink" href="#case-zencart-structures-couldusestrrepeat" title="Permalink to this headline">¶</a></h4>
<p><a class="reference internal" href="Rules.html#could-use-str-repeat"><span class="std std-ref">Could Use str_repeat()</span></a>, in includes/functions/functions_general.php:1234.</p>
<p>That’s a 45 repeat of &amp;nbsp;</p>
<div class="highlight-php notranslate"><div class="highlight"><pre><span></span><span class="k">if</span> <span class="p">(</span> <span class="p">(</span><span class="o">!</span><span class="nx">zen_browser_detect</span><span class="p">(</span><span class="s1">&#39;MSIE&#39;</span><span class="p">))</span> <span class="o">&amp;&amp;</span> <span class="p">(</span><span class="nx">zen_browser_detect</span><span class="p">(</span><span class="s1">&#39;Mozilla/4&#39;</span><span class="p">))</span> <span class="p">)</span> <span class="p">{</span>
      <span class="k">for</span> <span class="p">(</span><span class="nv">$i</span><span class="o">=</span><span class="mi">0</span><span class="p">;</span> <span class="nv">$i</span><span class="o">&lt;</span><span class="mi">45</span><span class="p">;</span> <span class="nv">$i</span><span class="o">++</span><span class="p">)</span> <span class="nv">$pre</span> <span class="o">.=</span> <span class="s1">&#39;&amp;nbsp;&#39;</span><span class="p">;</span>
    <span class="p">}</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="dangling-array-references">
<span id="case-dangling-array-references"></span><h3><span class="section-number">5.2.51. </span>Dangling Array References<a class="headerlink" href="#dangling-array-references" title="Permalink to this headline">¶</a></h3>
<div class="section" id="case-typo3-structures-danglingarrayreferences">
<span id="id46"></span><h4><span class="section-number">5.2.51.1. </span>Typo3<a class="headerlink" href="#case-typo3-structures-danglingarrayreferences" title="Permalink to this headline">¶</a></h4>
<p><a class="reference internal" href="Rules.html#dangling-array-references"><span class="std std-ref">Dangling Array References</span></a>, in typo3/sysext/impexp/Classes/ImportExport.php:322.</p>
<p>foreach() reads $lines into $r, and augment those lines. By the end, the $r variable is not unset. Yet, several lines later, in the same method but with different conditions, another loop reuse the variable $r. If is_array($this-&gt;dat[‘header’][‘pagetree’] and is_array($this-&gt;remainHeader[‘records’]) are arrays at the same moment, then both loops are called, and they share the same reference. Values of the latter array will end up in the formar.</p>
<div class="highlight-php notranslate"><div class="highlight"><pre><span></span><span class="k">if</span> <span class="p">(</span><span class="nb">is_array</span><span class="p">(</span><span class="nv">$this</span><span class="o">-&gt;</span><span class="na">dat</span><span class="p">[</span><span class="s1">&#39;header&#39;</span><span class="p">][</span><span class="s1">&#39;pagetree&#39;</span><span class="p">]))</span> <span class="p">{</span>
    <span class="nb">reset</span><span class="p">(</span><span class="nv">$this</span><span class="o">-&gt;</span><span class="na">dat</span><span class="p">[</span><span class="s1">&#39;header&#39;</span><span class="p">][</span><span class="s1">&#39;pagetree&#39;</span><span class="p">]);</span>
    <span class="nv">$lines</span> <span class="o">=</span> <span class="p">[];</span>
    <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">traversePageTree</span><span class="p">(</span><span class="nv">$this</span><span class="o">-&gt;</span><span class="na">dat</span><span class="p">[</span><span class="s1">&#39;header&#39;</span><span class="p">][</span><span class="s1">&#39;pagetree&#39;</span><span class="p">],</span> <span class="nv">$lines</span><span class="p">);</span>

    <span class="nv">$viewData</span><span class="p">[</span><span class="s1">&#39;dat&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">dat</span><span class="p">;</span>
    <span class="nv">$viewData</span><span class="p">[</span><span class="s1">&#39;update&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">update</span><span class="p">;</span>
    <span class="nv">$viewData</span><span class="p">[</span><span class="s1">&#39;showDiff&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">showDiff</span><span class="p">;</span>
    <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="k">empty</span><span class="p">(</span><span class="nv">$lines</span><span class="p">))</span> <span class="p">{</span>
        <span class="k">foreach</span> <span class="p">(</span><span class="nv">$lines</span> <span class="k">as</span> <span class="o">&amp;</span><span class="nv">$r</span><span class="p">)</span> <span class="p">{</span>
            <span class="nv">$r</span><span class="p">[</span><span class="s1">&#39;controls&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">renderControls</span><span class="p">(</span><span class="nv">$r</span><span class="p">);</span>
            <span class="nv">$r</span><span class="p">[</span><span class="s1">&#39;fileSize&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="nx">GeneralUtility</span><span class="o">::</span><span class="na">formatSize</span><span class="p">(</span><span class="nv">$r</span><span class="p">[</span><span class="s1">&#39;size&#39;</span><span class="p">]);</span>
            <span class="nv">$r</span><span class="p">[</span><span class="s1">&#39;message&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="nv">$r</span><span class="p">[</span><span class="s1">&#39;msg&#39;</span><span class="p">]</span> <span class="o">&amp;&amp;</span> <span class="o">!</span><span class="nv">$this</span><span class="o">-&gt;</span><span class="na">doesImport</span> <span class="o">?</span> <span class="s1">&#39;&lt;span class=text-danger&gt;&#39;</span> <span class="o">.</span> <span class="nb">htmlspecialchars</span><span class="p">(</span><span class="nv">$r</span><span class="p">[</span><span class="s1">&#39;msg&#39;</span><span class="p">])</span> <span class="o">.</span> <span class="s1">&#39;&lt;/span&gt;&#39;</span> <span class="o">:</span> <span class="s1">&#39;&#39;</span><span class="p">);</span>
        <span class="p">}</span>
        <span class="nv">$viewData</span><span class="p">[</span><span class="s1">&#39;pagetreeLines&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="nv">$lines</span><span class="p">;</span>
    <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
        <span class="nv">$viewData</span><span class="p">[</span><span class="s1">&#39;pagetreeLines&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[];</span>
    <span class="p">}</span>
<span class="p">}</span>
<span class="c1">// Print remaining records that were not contained inside the page tree:</span>
<span class="k">if</span> <span class="p">(</span><span class="nb">is_array</span><span class="p">(</span><span class="nv">$this</span><span class="o">-&gt;</span><span class="na">remainHeader</span><span class="p">[</span><span class="s1">&#39;records&#39;</span><span class="p">]))</span> <span class="p">{</span>
    <span class="nv">$lines</span> <span class="o">=</span> <span class="p">[];</span>
    <span class="k">if</span> <span class="p">(</span><span class="nb">is_array</span><span class="p">(</span><span class="nv">$this</span><span class="o">-&gt;</span><span class="na">remainHeader</span><span class="p">[</span><span class="s1">&#39;records&#39;</span><span class="p">][</span><span class="s1">&#39;pages&#39;</span><span class="p">]))</span> <span class="p">{</span>
        <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">traversePageRecords</span><span class="p">(</span><span class="nv">$this</span><span class="o">-&gt;</span><span class="na">remainHeader</span><span class="p">[</span><span class="s1">&#39;records&#39;</span><span class="p">][</span><span class="s1">&#39;pages&#39;</span><span class="p">],</span> <span class="nv">$lines</span><span class="p">);</span>
    <span class="p">}</span>
    <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">traverseAllRecords</span><span class="p">(</span><span class="nv">$this</span><span class="o">-&gt;</span><span class="na">remainHeader</span><span class="p">[</span><span class="s1">&#39;records&#39;</span><span class="p">],</span> <span class="nv">$lines</span><span class="p">);</span>
    <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="k">empty</span><span class="p">(</span><span class="nv">$lines</span><span class="p">))</span> <span class="p">{</span>
        <span class="k">foreach</span> <span class="p">(</span><span class="nv">$lines</span> <span class="k">as</span> <span class="o">&amp;</span><span class="nv">$r</span><span class="p">)</span> <span class="p">{</span>
            <span class="nv">$r</span><span class="p">[</span><span class="s1">&#39;controls&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">renderControls</span><span class="p">(</span><span class="nv">$r</span><span class="p">);</span>
            <span class="nv">$r</span><span class="p">[</span><span class="s1">&#39;fileSize&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="nx">GeneralUtility</span><span class="o">::</span><span class="na">formatSize</span><span class="p">(</span><span class="nv">$r</span><span class="p">[</span><span class="s1">&#39;size&#39;</span><span class="p">]);</span>
            <span class="nv">$r</span><span class="p">[</span><span class="s1">&#39;message&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="nv">$r</span><span class="p">[</span><span class="s1">&#39;msg&#39;</span><span class="p">]</span> <span class="o">&amp;&amp;</span> <span class="o">!</span><span class="nv">$this</span><span class="o">-&gt;</span><span class="na">doesImport</span> <span class="o">?</span> <span class="s1">&#39;&lt;span class=text-danger&gt;&#39;</span> <span class="o">.</span> <span class="nb">htmlspecialchars</span><span class="p">(</span><span class="nv">$r</span><span class="p">[</span><span class="s1">&#39;msg&#39;</span><span class="p">])</span> <span class="o">.</span> <span class="s1">&#39;&lt;/span&gt;&#39;</span> <span class="o">:</span> <span class="s1">&#39;&#39;</span><span class="p">);</span>
        <span class="p">}</span>
        <span class="nv">$viewData</span><span class="p">[</span><span class="s1">&#39;remainingRecords&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="nv">$lines</span><span class="p">;</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
</div>
<div class="section" id="case-sugarcrm-structures-danglingarrayreferences">
<span id="id47"></span><h4><span class="section-number">5.2.51.2. </span>SugarCrm<a class="headerlink" href="#case-sugarcrm-structures-danglingarrayreferences" title="Permalink to this headline">¶</a></h4>
<p><a class="reference internal" href="Rules.html#dangling-array-references"><span class="std std-ref">Dangling Array References</span></a>, in SugarCE-Full-6.5.26/modules/Import/CsvAutoDetect.php:165.</p>
<p>There are two nested foreach here : they both have referenced blind variables. The second one uses $data, but never changes it. Yet, it is reused the next round in the first loop, leading to pollution from the first rows of $this-&gt;_parser-&gt;data into the lasts. This may happen even if $data is not modified explicitely : in fact, it will be modified the next call to foreach($row as …), for each element in $row.</p>
<div class="highlight-php notranslate"><div class="highlight"><pre><span></span><span class="k">foreach</span> <span class="p">(</span><span class="nv">$this</span><span class="o">-&gt;</span><span class="na">_parser</span><span class="o">-&gt;</span><span class="na">data</span> <span class="k">as</span> <span class="o">&amp;</span><span class="nv">$row</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">foreach</span> <span class="p">(</span><span class="nv">$row</span> <span class="k">as</span> <span class="o">&amp;</span><span class="nv">$data</span><span class="p">)</span> <span class="p">{</span>
        <span class="nv">$len</span> <span class="o">=</span> <span class="nb">strlen</span><span class="p">(</span><span class="nv">$data</span><span class="p">);</span>
        <span class="c1">// check if it begins and ends with single quotes</span>
        <span class="c1">// if it does, then it double quotes may not be the enclosure</span>
        <span class="k">if</span> <span class="p">(</span><span class="nv">$len</span><span class="o">&gt;=</span><span class="mi">2</span> <span class="o">&amp;&amp;</span> <span class="nv">$data</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot; &amp;&amp; </span><span class="si">$data[$len-1]</span><span class="s2"> == &quot;</span><span class="p">)</span> <span class="p">{</span>
            <span class="nv">$beginEndWithSingle</span> <span class="o">=</span> <span class="k">true</span><span class="p">;</span>
            <span class="k">break</span><span class="p">;</span>
        <span class="p">}</span>
    <span class="p">}</span>
    <span class="k">if</span> <span class="p">(</span><span class="nv">$beginEndWithSingle</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">break</span><span class="p">;</span>
    <span class="p">}</span>
    <span class="nv">$depth</span><span class="o">++</span><span class="p">;</span>
    <span class="k">if</span> <span class="p">(</span><span class="nv">$depth</span> <span class="o">&gt;</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">_max_depth</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">break</span><span class="p">;</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="dir-then-slash">
<span id="case-dir-then-slash"></span><h3><span class="section-number">5.2.52. </span>__DIR__ Then Slash<a class="headerlink" href="#dir-then-slash" title="Permalink to this headline">¶</a></h3>
<div class="section" id="case-traq-structures-dirthenslash">
<span id="id48"></span><h4><span class="section-number">5.2.52.1. </span>Traq<a class="headerlink" href="#case-traq-structures-dirthenslash" title="Permalink to this headline">¶</a></h4>
<p><a class="reference internal" href="Rules.html#dir-then-slash"><span class="std std-ref">__DIR__ Then Slash</span></a>, in src/Kernel.php:60.</p>
<p>When executed in a path ‘/a/b/c’, this code will require ‘/a../../vendor/autoload.php.</p>
<div class="highlight-php notranslate"><div class="highlight"><pre><span></span><span class="k">static</span><span class="o">::</span><span class="nv">$loader</span> <span class="o">=</span> <span class="k">require</span> <span class="no">__DIR__</span><span class="o">.</span><span class="s1">&#39;../../vendor/autoload.php&#39;</span><span class="p">;</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="else-if-versus-elseif">
<span id="case-else-if-versus-elseif"></span><h3><span class="section-number">5.2.53. </span>Else If Versus Elseif<a class="headerlink" href="#else-if-versus-elseif" title="Permalink to this headline">¶</a></h3>
<div class="section" id="case-teampass-structures-elseifelseif">
<span id="id49"></span><h4><span class="section-number">5.2.53.1. </span>TeamPass<a class="headerlink" href="#case-teampass-structures-elseifelseif" title="Permalink to this headline">¶</a></h4>
<p><a class="reference internal" href="Rules.html#else-if-versus-elseif"><span class="std std-ref">Else If Versus Elseif</span></a>, in items.php:819.</p>
<p>This code could be turned into a switch() structure.</p>
<div class="highlight-php notranslate"><div class="highlight"><pre><span></span><span class="k">if</span> <span class="p">(</span><span class="nv">$field</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span> <span class="o">===</span> <span class="s1">&#39;text&#39;</span><span class="p">)</span> <span class="p">{</span>
                <span class="k">echo</span> <span class="s1">&#39;</span>
<span class="s1">                        &lt;input type=text id=edit_field_.$field[0]._.$elem[0]. class=edit_item_field input_text text ui-widget-content ui-corner-all size=40 data-field-type=.$field[3]. data-field-masked=.$field[4]. data-field-is-mandatory=.$field[5]. data-template-id=.$templateID.&gt;&#39;</span><span class="p">;</span>
            <span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="nv">$field</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span> <span class="o">===</span> <span class="s1">&#39;textarea&#39;</span><span class="p">)</span> <span class="p">{</span>
                <span class="k">echo</span> <span class="s1">&#39;</span>
<span class="s1">                        &lt;textarea id=edit_field_.$field[0]._.$elem[0]. class=edit_item_field input_text text ui-widget-content ui-corner-all colums=40 rows=5 data-field-type=.$field[&quot;3&quot;]. data-field-masked=.$field[4]. data-field-is-mandatory=.$field[5]. data-template-id=.$templateID.&gt;&lt;/textarea&gt;&#39;</span><span class="p">;</span>
            <span class="p">}</span>
</pre></div>
</div>
</div>
<div class="section" id="case-phpdocumentor-structures-elseifelseif">
<span id="id50"></span><h4><span class="section-number">5.2.53.2. </span>Phpdocumentor<a class="headerlink" href="#case-phpdocumentor-structures-elseifelseif" title="Permalink to this headline">¶</a></h4>
<p><a class="reference internal" href="Rules.html#else-if-versus-elseif"><span class="std std-ref">Else If Versus Elseif</span></a>, in src/phpDocumentor/Plugin/Core/Transformer/Writer/Xsl.php:112.</p>
<p>The first then block is long and complex. The else block, on the other hand, only contains a single if/then/else. Both conditions are distinct at first sight, so a if / elseif / then structure would be the best.</p>
<div class="highlight-php notranslate"><div class="highlight"><pre><span></span><span class="k">if</span> <span class="p">(</span><span class="nv">$transformation</span><span class="o">-&gt;</span><span class="na">getQuery</span><span class="p">()</span> <span class="o">!==</span> <span class="s1">&#39;&#39;</span><span class="p">)</span> <span class="p">{</span>
<span class="sd">/** Long then block **/</span>
        <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
            <span class="k">if</span> <span class="p">(</span><span class="nb">substr</span><span class="p">(</span><span class="nv">$transformation</span><span class="o">-&gt;</span><span class="na">getArtifact</span><span class="p">(),</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span> <span class="o">==</span> <span class="s1">&#39;$&#39;</span><span class="p">)</span> <span class="p">{</span>
                <span class="c1">// not a file, it must become a variable!</span>
                <span class="nv">$variable_name</span> <span class="o">=</span> <span class="nb">substr</span><span class="p">(</span><span class="nv">$transformation</span><span class="o">-&gt;</span><span class="na">getArtifact</span><span class="p">(),</span> <span class="mi">1</span><span class="p">);</span>
                <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">xsl_variables</span><span class="p">[</span><span class="nv">$variable_name</span><span class="p">]</span> <span class="o">=</span> <span class="nv">$proc</span><span class="o">-&gt;</span><span class="na">transformToXml</span><span class="p">(</span><span class="nv">$structure</span><span class="p">);</span>
            <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
                <span class="nv">$relativeFileName</span> <span class="o">=</span> <span class="nb">substr</span><span class="p">(</span><span class="nv">$artifact</span><span class="p">,</span> <span class="nb">strlen</span><span class="p">(</span><span class="nv">$transformation</span><span class="o">-&gt;</span><span class="na">getTransformer</span><span class="p">()</span><span class="o">-&gt;</span><span class="na">getTarget</span><span class="p">())</span> <span class="o">+</span> <span class="mi">1</span><span class="p">);</span>
                <span class="nv">$proc</span><span class="o">-&gt;</span><span class="na">setParameter</span><span class="p">(</span><span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="s1">&#39;root&#39;</span><span class="p">,</span> <span class="nb">str_repeat</span><span class="p">(</span><span class="s1">&#39;../&#39;</span><span class="p">,</span> <span class="nb">substr_count</span><span class="p">(</span><span class="nv">$relativeFileName</span><span class="p">,</span> <span class="s1">&#39;/&#39;</span><span class="p">)));</span>

                <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">writeToFile</span><span class="p">(</span><span class="nv">$artifact</span><span class="p">,</span> <span class="nv">$proc</span><span class="p">,</span> <span class="nv">$structure</span><span class="p">);</span>
            <span class="p">}</span>
        <span class="p">}</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="empty-blocks">
<span id="case-empty-blocks"></span><h3><span class="section-number">5.2.54. </span>Empty Blocks<a class="headerlink" href="#empty-blocks" title="Permalink to this headline">¶</a></h3>
<div class="section" id="case-cleverstyle-structures-emptyblocks">
<span id="id51"></span><h4><span class="section-number">5.2.54.1. </span>Cleverstyle<a class="headerlink" href="#case-cleverstyle-structures-emptyblocks" title="Permalink to this headline">¶</a></h4>
<p><a class="reference internal" href="Rules.html#empty-blocks"><span class="std std-ref">Empty Blocks</span></a>, in modules/Blogs/api/Controller.php:44.</p>
<p>Else is empty, but commented.</p>
<div class="highlight-php notranslate"><div class="highlight"><pre><span></span><span class="k">public</span> <span class="k">static</span> <span class="k">function</span> <span class="nf">posts_get</span> <span class="p">(</span><span class="nv">$Request</span><span class="p">)</span> <span class="p">{</span>
            <span class="nv">$id</span> <span class="o">=</span> <span class="nv">$Request</span><span class="o">-&gt;</span><span class="na">route_ids</span><span class="p">(</span><span class="mi">0</span><span class="p">);</span>
            <span class="k">if</span> <span class="p">(</span><span class="nv">$id</span><span class="p">)</span> <span class="p">{</span>
                    <span class="nv">$post</span> <span class="o">=</span> <span class="nx">Posts</span><span class="o">::</span><span class="na">instance</span><span class="p">()</span><span class="o">-&gt;</span><span class="na">get</span><span class="p">(</span><span class="nv">$id</span><span class="p">);</span>
                    <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nv">$post</span><span class="p">)</span> <span class="p">{</span>
                            <span class="k">throw</span> <span class="k">new</span> <span class="nx">ExitException</span><span class="p">(</span><span class="mi">404</span><span class="p">);</span>
                    <span class="p">}</span>
                    <span class="k">return</span> <span class="nv">$post</span><span class="p">;</span>
            <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
                    <span class="c1">// TODO: implement latest posts</span>
            <span class="p">}</span>
    <span class="p">}</span>
</pre></div>
</div>
</div>
<div class="section" id="phpipam">
<span id="case-phpipam-structures-emptyblocks"></span><h4><span class="section-number">5.2.54.2. </span>PhpIPAM<a class="headerlink" href="#phpipam" title="Permalink to this headline">¶</a></h4>
<p><a class="reference internal" href="Rules.html#empty-blocks"><span class="std std-ref">Empty Blocks</span></a>, in wp-admin/includes/misc.php:74.</p>
<p>The <code class="docutils literal notranslate"><span class="pre">then</span></code> block is empty and commented : yet, it may have been clearer to make the condition != and omitted the whole empty block.</p>
<div class="highlight-php notranslate"><div class="highlight"><pre><span></span><span class="cm">/* checks */</span>
<span class="k">if</span><span class="p">(</span><span class="nv">$_POST</span><span class="p">[</span><span class="s1">&#39;action&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="nx">delete</span><span class="p">)</span> <span class="p">{</span>
    <span class="c1"># no cecks</span>
<span class="p">}</span>
<span class="k">else</span> <span class="p">{</span>
    <span class="c1"># remove spaces</span>
    <span class="nv">$_POST</span><span class="p">[</span><span class="s1">&#39;name&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">trim</span><span class="p">(</span><span class="nv">$_POST</span><span class="p">[</span><span class="s1">&#39;name&#39;</span><span class="p">]);</span>

    <span class="c1"># length &gt; 4 and &lt; 12</span>
    <span class="k">if</span><span class="p">(</span> <span class="p">(</span><span class="nb">mb_strlen</span><span class="p">(</span><span class="nv">$_POST</span><span class="p">[</span><span class="s1">&#39;name&#39;</span><span class="p">])</span> <span class="o">&lt;</span> <span class="mi">2</span><span class="p">)</span> <span class="o">||</span> <span class="p">(</span><span class="nb">mb_strlen</span><span class="p">(</span><span class="nv">$_POST</span><span class="p">[</span><span class="s1">&#39;name&#39;</span><span class="p">])</span> <span class="o">&gt;</span> <span class="mi">24</span><span class="p">)</span> <span class="p">)</span>       <span class="p">{</span> <span class="nv">$errors</span><span class="p">[]</span> <span class="o">=</span> <span class="nx">_</span><span class="p">(</span><span class="s1">&#39;Name must be between 4 and 24 characters&#39;</span><span class="p">);</span> <span class="p">}</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="error-reporting-with-integers">
<span id="case-error-reporting-with-integers"></span><h3><span class="section-number">5.2.55. </span>error_reporting() With Integers<a class="headerlink" href="#error-reporting-with-integers" title="Permalink to this headline">¶</a></h3>
<div class="section" id="case-sugarcrm-structures-errorreportingwithinteger">
<span id="id52"></span><h4><span class="section-number">5.2.55.1. </span>SugarCrm<a class="headerlink" href="#case-sugarcrm-structures-errorreportingwithinteger" title="Permalink to this headline">¶</a></h4>
<p><a class="reference internal" href="Rules.html#error-reporting-with-integers"><span class="std std-ref">error_reporting() With Integers</span></a>, in modules/UpgradeWizard/silentUpgrade_step1.php:436.</p>
<p>This only displays E_ERROR, the highest level of error reporting. It should be checked, as it happens in the ‘silentUpgrade’ script.</p>
<div class="highlight-php notranslate"><div class="highlight"><pre><span></span><span class="nb">ini_set</span><span class="p">(</span><span class="s1">&#39;error_reporting&#39;</span><span class="p">,</span> <span class="mi">1</span><span class="p">);</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="eval-usage">
<span id="case-eval-usage"></span><h3><span class="section-number">5.2.56. </span>Eval() Usage<a class="headerlink" href="#eval-usage" title="Permalink to this headline">¶</a></h3>
<div class="section" id="xoops">
<span id="case-xoops-structures-evalusage"></span><h4><span class="section-number">5.2.56.1. </span>XOOPS<a class="headerlink" href="#xoops" title="Permalink to this headline">¶</a></h4>
<p><a class="reference internal" href="Rules.html#eval-usage"><span class="std std-ref">Eval() Usage</span></a>, in htdocs/modules/system/class/block.php:266.</p>
<p>eval() execute code that was arbitrarily stored in $this, in one of the properties. Then, it is sent to output, but collected before reaching the browser, and put again in $content. May be the echo/ob_get_contents() could have been skipped.</p>
<div class="highlight-php notranslate"><div class="highlight"><pre><span></span><span class="nb">ob_start</span><span class="p">();</span>
                    <span class="k">echo</span> <span class="k">eval</span><span class="p">(</span><span class="nv">$this</span><span class="o">-&gt;</span><span class="na">getVar</span><span class="p">(</span><span class="s1">&#39;content&#39;</span><span class="p">,</span> <span class="s1">&#39;n&#39;</span><span class="p">));</span>
                    <span class="nv">$content</span> <span class="o">=</span> <span class="nb">ob_get_contents</span><span class="p">();</span>
                    <span class="nb">ob_end_clean</span><span class="p">();</span>
</pre></div>
</div>
</div>
<div class="section" id="case-mautic-structures-evalusage">
<span id="id53"></span><h4><span class="section-number">5.2.56.2. </span>Mautic<a class="headerlink" href="#case-mautic-structures-evalusage" title="Permalink to this headline">¶</a></h4>
<p><a class="reference internal" href="Rules.html#eval-usage"><span class="std std-ref">Eval() Usage</span></a>, in app/bundles/InstallBundle/Configurator/Step/CheckStep.php:238.</p>
<p>create_function() is actually an eval() in disguise : replace it with a closure for code modernization</p>
<div class="highlight-php notranslate"><div class="highlight"><pre><span></span><span class="nb">create_function</span><span class="p">(</span><span class="s1">&#39;$cfgValue&#39;</span><span class="p">,</span> <span class="s1">&#39;return $cfgValue &gt; 100;&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="eval-without-try">
<span id="case-eval-without-try"></span><h3><span class="section-number">5.2.57. </span>eval() Without Try<a class="headerlink" href="#eval-without-try" title="Permalink to this headline">¶</a></h3>
<div class="section" id="case-fuelcms-structures-evalwithouttry">
<span id="id54"></span><h4><span class="section-number">5.2.57.1. </span>FuelCMS<a class="headerlink" href="#case-fuelcms-structures-evalwithouttry" title="Permalink to this headline">¶</a></h4>
<p><a class="reference internal" href="Rules.html#eval-without-try"><span class="std std-ref">eval() Without Try</span></a>, in fuel/modules/fuel/controllers/Blocks.php:268.</p>
<p>The &#64; will prevent any error, while the try/catch allows the processing of certain types of error, namely the Fatal ones.</p>
<div class="highlight-php notranslate"><div class="highlight"><pre><span></span><span class="o">@</span><span class="k">eval</span><span class="p">(</span><span class="nv">$_name_var_eval</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="section" id="case-expressionengine-structures-evalwithouttry">
<span id="id55"></span><h4><span class="section-number">5.2.57.2. </span>ExpressionEngine<a class="headerlink" href="#case-expressionengine-structures-evalwithouttry" title="Permalink to this headline">¶</a></h4>
<p><a class="reference internal" href="Rules.html#eval-without-try"><span class="std std-ref">eval() Without Try</span></a>, in system/ee/EllisLab/Addons/member/mod.member_memberlist.php:637.</p>
<p>$cond is build from values extracted from the $fields array. Although it is probably reasonably safe, a try/catch here will collect any unexpected situation cleaningly.</p>
<div class="highlight-php notranslate"><div class="highlight"><pre><span></span><span class="k">elseif</span> <span class="p">(</span><span class="nb">isset</span><span class="p">(</span><span class="nv">$fields</span><span class="p">[</span><span class="nv">$val</span><span class="p">[</span><span class="s1">&#39;3&#39;</span><span class="p">]]))</span>
                                    <span class="p">{</span>
                                            <span class="k">if</span> <span class="p">(</span><span class="nb">array_key_exists</span><span class="p">(</span><span class="s1">&#39;m_field_id_&#39;</span><span class="o">.</span><span class="nv">$fields</span><span class="p">[</span><span class="nv">$val</span><span class="p">[</span><span class="s1">&#39;3&#39;</span><span class="p">]],</span> <span class="nv">$row</span><span class="p">))</span>
                                            <span class="p">{</span>
                                                    <span class="nv">$v</span> <span class="o">=</span> <span class="nv">$row</span><span class="p">[</span><span class="s1">&#39;m_field_id_&#39;</span><span class="o">.</span><span class="nv">$fields</span><span class="p">[</span><span class="nv">$val</span><span class="p">[</span><span class="s1">&#39;3&#39;</span><span class="p">]]];</span>

                                                    <span class="nv">$lcond</span> <span class="o">=</span> <span class="nb">str_replace</span><span class="p">(</span><span class="nv">$val</span><span class="p">[</span><span class="s1">&#39;3&#39;</span><span class="p">],</span> <span class="s2">&quot;</span><span class="si">$v</span><span class="s2">&quot;</span><span class="p">,</span> <span class="nv">$lcond</span><span class="p">);</span>
                                                    <span class="nv">$cond</span> <span class="o">=</span> <span class="nv">$lcond</span><span class="o">.</span><span class="s1">&#39; &#39;</span><span class="o">.</span><span class="nv">$rcond</span><span class="p">;</span>
                                                    <span class="nv">$cond</span> <span class="o">=</span> <span class="nb">str_replace</span><span class="p">(</span><span class="s2">&quot;\|&quot;</span><span class="p">,</span> <span class="s2">&quot;|&quot;</span><span class="p">,</span> <span class="nv">$cond</span><span class="p">);</span>

                                                    <span class="k">eval</span><span class="p">(</span><span class="s2">&quot;</span><span class="si">$result</span><span class="s2"> = &quot;</span><span class="o">.</span><span class="nv">$cond</span><span class="o">.</span><span class="s2">&quot;;&quot;</span><span class="p">);</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="exit-usage">
<span id="case-exit-usage"></span><h3><span class="section-number">5.2.58. </span>Exit() Usage<a class="headerlink" href="#exit-usage" title="Permalink to this headline">¶</a></h3>
<div class="section" id="case-traq-structures-exitusage">
<span id="id56"></span><h4><span class="section-number">5.2.58.1. </span>Traq<a class="headerlink" href="#case-traq-structures-exitusage" title="Permalink to this headline">¶</a></h4>
<p><a class="reference internal" href="Rules.html#exit-usage"><span class="std std-ref">Exit() Usage</span></a>, in src/Controllers/attachments.php:75.</p>
<p>This acts as a view. The final ‘exit’ is meant to ensure that no other piece of data is emitted, potentially polluting the view. This also prevent any code cleaning to happen.</p>
<div class="highlight-php notranslate"><div class="highlight"><pre><span></span><span class="sd">/**</span>
<span class="sd">     * View attachment page</span>
<span class="sd">     *</span>
<span class="sd">     * @param integer $attachment_id</span>
<span class="sd">     */</span>
    <span class="k">public</span> <span class="k">function</span> <span class="nf">action_view</span><span class="p">(</span><span class="nv">$attachment_id</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="c1">// Don&#39;t try to load a view</span>
        <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">render</span><span class="p">[</span><span class="s1">&#39;view&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="k">false</span><span class="p">;</span>

        <span class="nb">header</span><span class="p">(</span><span class="nx">Content</span><span class="o">-</span><span class="nx">type</span><span class="o">:</span> <span class="p">{</span><span class="nv">$this</span><span class="o">-&gt;</span><span class="na">attachment</span><span class="o">-&gt;</span><span class="na">type</span><span class="p">});</span>
        <span class="nv">$content_type</span> <span class="o">=</span> <span class="nb">explode</span><span class="p">(</span><span class="s1">&#39;/&#39;</span><span class="p">,</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">attachment</span><span class="o">-&gt;</span><span class="na">type</span><span class="p">);</span>

        <span class="c1">// Check what type of file we&#39;re dealing with.</span>
        <span class="k">if</span><span class="p">(</span><span class="nv">$content_type</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;text&#39;</span> <span class="k">or</span> <span class="nv">$content_type</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;image&#39;</span><span class="p">)</span> <span class="p">{</span>
            <span class="c1">// If the mime-type is text, we can just display it</span>
            <span class="c1">// as plain text. I hate having to download files.</span>
            <span class="k">if</span> <span class="p">(</span><span class="nv">$content_type</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;text&#39;</span><span class="p">)</span> <span class="p">{</span>
                <span class="nb">header</span><span class="p">(</span><span class="nx">Content</span><span class="o">-</span><span class="nx">type</span><span class="o">:</span> <span class="nx">text</span><span class="o">/</span><span class="nx">plain</span><span class="p">);</span>
            <span class="p">}</span>
            <span class="nb">header</span><span class="p">(</span><span class="s2">&quot;Content-Disposition: filename=</span><span class="se">\&quot;</span><span class="si">{</span><span class="nv">$this</span><span class="o">-&gt;</span><span class="na">attachment</span><span class="o">-&gt;</span><span class="na">name</span><span class="si">}</span><span class="se">\&quot;</span><span class="s2">&quot;</span><span class="p">);</span>
        <span class="p">}</span>
        <span class="c1">// Anything else should be downloaded</span>
        <span class="k">else</span> <span class="p">{</span>
            <span class="nb">header</span><span class="p">(</span><span class="s2">&quot;Content-Disposition: attachment; filename=</span><span class="se">\&quot;</span><span class="si">{</span><span class="nv">$this</span><span class="o">-&gt;</span><span class="na">attachment</span><span class="o">-&gt;</span><span class="na">name</span><span class="si">}</span><span class="se">\&quot;</span><span class="s2">&quot;</span><span class="p">);</span>
        <span class="p">}</span>

        <span class="c1">// Decode the contents and display it</span>
        <span class="k">print</span><span class="p">(</span><span class="nb">base64_decode</span><span class="p">(</span><span class="nv">$this</span><span class="o">-&gt;</span><span class="na">attachment</span><span class="o">-&gt;</span><span class="na">contents</span><span class="p">));</span>
        <span class="k">exit</span><span class="p">;</span>
    <span class="p">}</span>
</pre></div>
</div>
</div>
<div class="section" id="thinkphp">
<span id="case-thinkphp-structures-exitusage"></span><h4><span class="section-number">5.2.58.2. </span>ThinkPHP<a class="headerlink" href="#thinkphp" title="Permalink to this headline">¶</a></h4>
<p><a class="reference internal" href="Rules.html#exit-usage"><span class="std std-ref">Exit() Usage</span></a>, in ThinkPHP/Library/Vendor/EaseTemplate/template.core.php:60.</p>
<p>Here, exit is used as a rudimentary error management. When the version is not correctly provided via EaseTemplateVer, the application stop totally.</p>
<div class="highlight-php notranslate"><div class="highlight"><pre><span></span><span class="nv">$this</span><span class="o">-&gt;</span><span class="na">version</span>              <span class="o">=</span> <span class="p">(</span><span class="nb">trim</span><span class="p">(</span><span class="nv">$_GET</span><span class="p">[</span><span class="s1">&#39;EaseTemplateVer&#39;</span><span class="p">]))</span><span class="o">?</span><span class="k">die</span><span class="p">(</span><span class="s1">&#39;Ease Templae E3!&#39;</span><span class="p">)</span><span class="o">:</span><span class="s1">&#39;&#39;</span><span class="p">;</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="failed-substr-comparison">
<span id="case-failed-substr-comparison"></span><h3><span class="section-number">5.2.59. </span>Failed Substr Comparison<a class="headerlink" href="#failed-substr-comparison" title="Permalink to this headline">¶</a></h3>
<div class="section" id="case-zurmo-structures-failingsubstrcomparison">
<span id="id57"></span><h4><span class="section-number">5.2.59.1. </span>Zurmo<a class="headerlink" href="#case-zurmo-structures-failingsubstrcomparison" title="Permalink to this headline">¶</a></h4>
<p><a class="reference internal" href="Rules.html#failed-substr-comparison"><span class="std std-ref">Failed Substr Comparison</span></a>, in app/protected/modules/zurmo/modules/SecurableModule.php:117.</p>
<p>filterAuditEvent compares a six char string with ‘AUDIT_EVENT_’ which contains 10 chars. This method returns only FALSE. Although it is used only once, the whole block that calls this method is now dead code.</p>
<div class="highlight-php notranslate"><div class="highlight"><pre><span></span><span class="k">private</span> <span class="k">static</span> <span class="k">function</span> <span class="nf">filterAuditEvent</span><span class="p">(</span><span class="nv">$s</span><span class="p">)</span>
        <span class="p">{</span>
            <span class="k">return</span> <span class="nb">substr</span><span class="p">(</span><span class="nv">$s</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">6</span><span class="p">)</span> <span class="o">==</span> <span class="s1">&#39;AUDIT_EVENT_&#39;</span><span class="p">;</span>
        <span class="p">}</span>
</pre></div>
</div>
</div>
<div class="section" id="case-mediawiki-structures-failingsubstrcomparison">
<span id="id58"></span><h4><span class="section-number">5.2.59.2. </span>MediaWiki<a class="headerlink" href="#case-mediawiki-structures-failingsubstrcomparison" title="Permalink to this headline">¶</a></h4>
<p><a class="reference internal" href="Rules.html#failed-substr-comparison"><span class="std std-ref">Failed Substr Comparison</span></a>, in includes/media/DjVu.php:263.</p>
<p>$metadata contains data that may be in different formats. When it is a pure XML file, it is ‘Old style’. The comment helps understanding that this is not the modern way to go : the Old Style is actually never called, due to a failing condition.</p>
<div class="highlight-php notranslate"><div class="highlight"><pre><span></span><span class="k">private</span> <span class="k">function</span> <span class="nf">getUnserializedMetadata</span><span class="p">(</span> <span class="nx">File</span> <span class="nv">$file</span> <span class="p">)</span> <span class="p">{</span>
            <span class="nv">$metadata</span> <span class="o">=</span> <span class="nv">$file</span><span class="o">-&gt;</span><span class="na">getMetadata</span><span class="p">();</span>
            <span class="k">if</span> <span class="p">(</span> <span class="nb">substr</span><span class="p">(</span> <span class="nv">$metadata</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">3</span> <span class="p">)</span> <span class="o">===</span> <span class="s1">&#39;&lt;?xml&#39;</span> <span class="p">)</span> <span class="p">{</span>
                    <span class="c1">// Old style. Not serialized but instead just a raw string of XML.</span>
                    <span class="k">return</span> <span class="nv">$metadata</span><span class="p">;</span>
            <span class="p">}</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="foreach-reference-is-not-modified">
<span id="case-foreach-reference-is-not-modified"></span><h3><span class="section-number">5.2.60. </span>Foreach Reference Is Not Modified<a class="headerlink" href="#foreach-reference-is-not-modified" title="Permalink to this headline">¶</a></h3>
<div class="section" id="case-dolibarr-structures-foreachreferenceisnotmodified">
<span id="id59"></span><h4><span class="section-number">5.2.60.1. </span>Dolibarr<a class="headerlink" href="#case-dolibarr-structures-foreachreferenceisnotmodified" title="Permalink to this headline">¶</a></h4>
<p><a class="reference internal" href="Rules.html#foreach-reference-is-not-modified"><span class="std std-ref">Foreach Reference Is Not Modified</span></a>, in htdocs/product/reassort.php:364.</p>
<p>$wh is an array, and is read for its index ‘id’, but it is not modified. The reference sign is too much.</p>
<div class="highlight-php notranslate"><div class="highlight"><pre><span></span><span class="k">if</span><span class="p">(</span><span class="nv">$nb_warehouse</span><span class="o">&gt;</span><span class="mi">1</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">foreach</span><span class="p">(</span><span class="nv">$warehouses_list</span> <span class="k">as</span> <span class="o">&amp;</span><span class="nv">$wh</span><span class="p">)</span> <span class="p">{</span>

        <span class="k">print</span> <span class="s1">&#39;&lt;td class=right&gt;&#39;</span><span class="p">;</span>
        <span class="k">print</span> <span class="k">empty</span><span class="p">(</span><span class="nv">$product</span><span class="o">-&gt;</span><span class="na">stock_warehouse</span><span class="p">[</span><span class="nv">$wh</span><span class="p">[</span><span class="s1">&#39;id&#39;</span><span class="p">]]</span><span class="o">-&gt;</span><span class="na">real</span><span class="p">)</span> <span class="o">?</span> <span class="s1">&#39;0&#39;</span> <span class="o">:</span> <span class="nv">$product</span><span class="o">-&gt;</span><span class="na">stock_warehouse</span><span class="p">[</span><span class="nv">$wh</span><span class="p">[</span><span class="s1">&#39;id&#39;</span><span class="p">]]</span><span class="o">-&gt;</span><span class="na">real</span><span class="p">;</span>
        <span class="k">print</span> <span class="s1">&#39;&lt;/td&gt;&#39;</span><span class="p">;</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
</div>
<div class="section" id="case-vanilla-structures-foreachreferenceisnotmodified">
<span id="id60"></span><h4><span class="section-number">5.2.60.2. </span>Vanilla<a class="headerlink" href="#case-vanilla-structures-foreachreferenceisnotmodified" title="Permalink to this headline">¶</a></h4>
<p><a class="reference internal" href="Rules.html#foreach-reference-is-not-modified"><span class="std std-ref">Foreach Reference Is Not Modified</span></a>, in applications/vanilla/models/class.discussionmodel.php:944.</p>
<p>$discussion is also an object : it doesn’t need any reference to be modified. And, it is not modified, but only read.</p>
<div class="highlight-php notranslate"><div class="highlight"><pre><span></span><span class="k">foreach</span> <span class="p">(</span><span class="nv">$result</span> <span class="k">as</span> <span class="nv">$key</span> <span class="o">=&gt;</span> <span class="o">&amp;</span><span class="nv">$discussion</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">if</span> <span class="p">(</span><span class="nb">isset</span><span class="p">(</span><span class="nv">$this</span><span class="o">-&gt;</span><span class="na">_AnnouncementIDs</span><span class="p">))</span> <span class="p">{</span>
        <span class="k">if</span> <span class="p">(</span><span class="nb">in_array</span><span class="p">(</span><span class="nv">$discussion</span><span class="o">-&gt;</span><span class="na">DiscussionID</span><span class="p">,</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">_AnnouncementIDs</span><span class="p">))</span> <span class="p">{</span>
            <span class="nb">unset</span><span class="p">(</span><span class="nv">$result</span><span class="p">[</span><span class="nv">$key</span><span class="p">]);</span>
            <span class="nv">$unset</span> <span class="o">=</span> <span class="k">true</span><span class="p">;</span>
        <span class="p">}</span>
    <span class="p">}</span> <span class="k">elseif</span> <span class="p">(</span><span class="nv">$discussion</span><span class="o">-&gt;</span><span class="na">Announce</span> <span class="o">&amp;&amp;</span> <span class="nv">$discussion</span><span class="o">-&gt;</span><span class="na">Dismissed</span> <span class="o">==</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
        <span class="c1">// Unset discussions that are announced and not dismissed</span>
        <span class="nb">unset</span><span class="p">(</span><span class="nv">$result</span><span class="p">[</span><span class="nv">$key</span><span class="p">]);</span>
        <span class="nv">$unset</span> <span class="o">=</span> <span class="k">true</span><span class="p">;</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="case-identical-conditions">
<span id="identical-conditions"></span><h3><span class="section-number">5.2.61. </span>Identical Conditions<a class="headerlink" href="#case-identical-conditions" title="Permalink to this headline">¶</a></h3>
<div class="section" id="case-wordpress-structures-identicalconditions">
<span id="id61"></span><h4><span class="section-number">5.2.61.1. </span>WordPress<a class="headerlink" href="#case-wordpress-structures-identicalconditions" title="Permalink to this headline">¶</a></h4>
<p><a class="reference internal" href="Rules.html#identical-conditions"><span class="std std-ref">Identical Conditions</span></a>, in wp-admin/theme-editor.php:247.</p>
<p>The condition checks first if $has_templates or $theme-&gt;parent(), and one of the two is sufficient to be valid. Then, it checks again that $theme-&gt;parent() is activated with &amp;&amp;. This condition may be reduced by calling $theme-&gt;parent(), as $has_template is unused here.</p>
<div class="highlight-php notranslate"><div class="highlight"><pre><span></span><span class="o">&lt;?</span><span class="nx">php</span> <span class="k">if</span> <span class="p">(</span> <span class="p">(</span> <span class="nv">$has_templates</span> <span class="o">||</span> <span class="nv">$theme</span><span class="o">-&gt;</span><span class="na">parent</span><span class="p">()</span> <span class="p">)</span> <span class="o">&amp;&amp;</span> <span class="nv">$theme</span><span class="o">-&gt;</span><span class="na">parent</span><span class="p">()</span> <span class="p">)</span> <span class="o">:</span> <span class="cp">?&gt;</span><span class="x"></span>
</pre></div>
</div>
</div>
<div class="section" id="case-dolibarr-structures-identicalconditions">
<span id="id62"></span><h4><span class="section-number">5.2.61.2. </span>Dolibarr<a class="headerlink" href="#case-dolibarr-structures-identicalconditions" title="Permalink to this headline">¶</a></h4>
<p><a class="reference internal" href="Rules.html#identical-conditions"><span class="std std-ref">Identical Conditions</span></a>, in htdocs/core/lib/files.lib.php:2052.</p>
<p>Better check twice that $modulepart is really ‘apercusupplier_invoice’.</p>
<div class="highlight-php notranslate"><div class="highlight"><pre><span></span><span class="nv">$modulepart</span> <span class="o">==</span> <span class="s1">&#39;apercusupplier_invoice&#39;</span> <span class="o">||</span> <span class="nv">$modulepart</span> <span class="o">==</span> <span class="s1">&#39;apercusupplier_invoice&#39;</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="case-identical-on-both-sides">
<span id="identical-on-both-sides"></span><h3><span class="section-number">5.2.62. </span>Identical On Both Sides<a class="headerlink" href="#case-identical-on-both-sides" title="Permalink to this headline">¶</a></h3>
<div class="section" id="case-phpmyadmin-structures-identicalonbothsides">
<span id="id63"></span><h4><span class="section-number">5.2.62.1. </span>phpMyAdmin<a class="headerlink" href="#case-phpmyadmin-structures-identicalonbothsides" title="Permalink to this headline">¶</a></h4>
<p><a class="reference internal" href="Rules.html#identical-on-both-sides"><span class="std std-ref">Identical On Both Sides</span></a>, in libraries/classes/DatabaseInterface.php:323.</p>
<p>This code looks like <code class="docutils literal notranslate"><span class="pre">($options</span> <span class="pre">&amp;</span> <span class="pre">DatabaseInterface::QUERY_STORE)</span> <span class="pre">==</span> <span class="pre">DatabaseInterface::QUERY_STORE</span></code>, which would make sense. But PHP precedence is actually executing <code class="docutils literal notranslate"><span class="pre">$options</span> <span class="pre">&amp;</span> <span class="pre">(DatabaseInterface::QUERY_STORE</span> <span class="pre">==</span> <span class="pre">DatabaseInterface::QUERY_STORE)</span></code>, which then doesn’t depends on QUERY_STORE but only on $options.</p>
<div class="highlight-php notranslate"><div class="highlight"><pre><span></span><span class="k">if</span> <span class="p">(</span><span class="nv">$options</span> <span class="o">&amp;</span> <span class="nx">DatabaseInterface</span><span class="o">::</span><span class="na">QUERY_STORE</span> <span class="o">==</span> <span class="nx">DatabaseInterface</span><span class="o">::</span><span class="na">QUERY_STORE</span><span class="p">)</span> <span class="p">{</span>
    <span class="nv">$tmp</span> <span class="o">=</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">_extension</span><span class="o">-&gt;</span><span class="na">realQuery</span><span class="p">(</span><span class="s1">&#39;</span>
<span class="s1">        SHOW COUNT(*) WARNINGS&#39;</span><span class="p">,</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">_links</span><span class="p">[</span><span class="nv">$link</span><span class="p">],</span> <span class="nx">DatabaseInterface</span><span class="o">::</span><span class="na">QUERY_STORE</span>
    <span class="p">);</span>
    <span class="nv">$warnings</span> <span class="o">=</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">fetchRow</span><span class="p">(</span><span class="nv">$tmp</span><span class="p">);</span>
<span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
    <span class="nv">$warnings</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>
</div>
</div>
<div class="section" id="case-humo-gen-structures-identicalonbothsides">
<span id="id64"></span><h4><span class="section-number">5.2.62.2. </span>HuMo-Gen<a class="headerlink" href="#case-humo-gen-structures-identicalonbothsides" title="Permalink to this headline">¶</a></h4>
<p><a class="reference internal" href="Rules.html#identical-on-both-sides"><span class="std std-ref">Identical On Both Sides</span></a>, in include/person_cls.php:73.</p>
<p>In that long logical expression, $personDb-&gt;pers_cal_date is tested twice</p>
<div class="highlight-php notranslate"><div class="highlight"><pre><span></span><span class="c1">// *** Filter person&#39;s WITHOUT any date&#39;s ***</span>
                    <span class="k">if</span> <span class="p">(</span><span class="nv">$user</span><span class="p">[</span><span class="nx">group_filter_date</span><span class="p">]</span><span class="o">==</span><span class="s1">&#39;j&#39;</span><span class="p">){</span>
                            <span class="k">if</span> <span class="p">(</span><span class="nv">$personDb</span><span class="o">-&gt;</span><span class="na">pers_birth_date</span><span class="o">==</span><span class="s1">&#39;&#39;</span> <span class="k">AND</span> <span class="nv">$personDb</span><span class="o">-&gt;</span><span class="na">pers_bapt_date</span><span class="o">==</span><span class="s1">&#39;&#39;</span>
                            <span class="k">AND</span> <span class="nv">$personDb</span><span class="o">-&gt;</span><span class="na">pers_death_date</span><span class="o">==</span><span class="s1">&#39;&#39;</span> <span class="k">AND</span> <span class="nv">$personDb</span><span class="o">-&gt;</span><span class="na">pers_buried_date</span><span class="o">==</span><span class="s1">&#39;&#39;</span>
                            <span class="k">AND</span> <span class="nv">$personDb</span><span class="o">-&gt;</span><span class="na">pers_cal_date</span><span class="o">==</span><span class="s1">&#39;&#39;</span> <span class="k">AND</span> <span class="nv">$personDb</span><span class="o">-&gt;</span><span class="na">pers_cal_date</span><span class="o">==</span><span class="s1">&#39;&#39;</span>
                            <span class="p">){</span>
                                    <span class="nv">$privacy_person</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">;</span>
                            <span class="p">}</span>
                    <span class="p">}</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="if-with-same-conditions">
<span id="case-if-with-same-conditions"></span><h3><span class="section-number">5.2.63. </span>If With Same Conditions<a class="headerlink" href="#if-with-same-conditions" title="Permalink to this headline">¶</a></h3>
<div class="section" id="case-phpmyadmin-structures-ifwithsameconditions">
<span id="id65"></span><h4><span class="section-number">5.2.63.1. </span>phpMyAdmin<a class="headerlink" href="#case-phpmyadmin-structures-ifwithsameconditions" title="Permalink to this headline">¶</a></h4>
<p><a class="reference internal" href="Rules.html#if-with-same-conditions"><span class="std std-ref">If With Same Conditions</span></a>, in libraries/classes/Response.php:345.</p>
<p>The first test on $this-&gt;_isSuccess settles the situation with _JSON. Then, a second check is made. Both could be merged, also the second one is fairly long (not shown).</p>
<div class="highlight-php notranslate"><div class="highlight"><pre><span></span><span class="k">if</span> <span class="p">(</span><span class="nv">$this</span><span class="o">-&gt;</span><span class="na">_isSuccess</span><span class="p">)</span> <span class="p">{</span>
            <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">_JSON</span><span class="p">[</span><span class="s1">&#39;success&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="k">true</span><span class="p">;</span>
        <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
            <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">_JSON</span><span class="p">[</span><span class="s1">&#39;success&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="k">false</span><span class="p">;</span>
            <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">_JSON</span><span class="p">[</span><span class="s1">&#39;error&#39;</span><span class="p">]</span>   <span class="o">=</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">_JSON</span><span class="p">[</span><span class="s1">&#39;message&#39;</span><span class="p">];</span>
            <span class="nb">unset</span><span class="p">(</span><span class="nv">$this</span><span class="o">-&gt;</span><span class="na">_JSON</span><span class="p">[</span><span class="s1">&#39;message&#39;</span><span class="p">]);</span>
        <span class="p">}</span>

        <span class="k">if</span> <span class="p">(</span><span class="nv">$this</span><span class="o">-&gt;</span><span class="na">_isSuccess</span><span class="p">)</span> <span class="p">{</span>
</pre></div>
</div>
</div>
<div class="section" id="case-phpdocumentor-structures-ifwithsameconditions">
<span id="id66"></span><h4><span class="section-number">5.2.63.2. </span>Phpdocumentor<a class="headerlink" href="#case-phpdocumentor-structures-ifwithsameconditions" title="Permalink to this headline">¶</a></h4>
<p><a class="reference internal" href="Rules.html#if-with-same-conditions"><span class="std std-ref">If With Same Conditions</span></a>, in src/phpDocumentor/Transformer/Command/Project/TransformCommand.php:239.</p>
<p>$templates is extracted from $input. If it is empty, a second source is polled. Finally, if nothing has worked, a default value is used (‘clean’). In this case, each attempt is an alternative solution to the previous failing call. The second test could be reported on $templatesFromConfig, and not $templates.</p>
<div class="highlight-php notranslate"><div class="highlight"><pre><span></span><span class="nv">$templates</span> <span class="o">=</span> <span class="nv">$input</span><span class="o">-&gt;</span><span class="na">getOption</span><span class="p">(</span><span class="s1">&#39;template&#39;</span><span class="p">);</span>
        <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nv">$templates</span><span class="p">)</span> <span class="p">{</span>
            <span class="sd">/** @var Template[] $templatesFromConfig */</span>
            <span class="nv">$templatesFromConfig</span> <span class="o">=</span> <span class="nv">$configurationHelper</span><span class="o">-&gt;</span><span class="na">getConfigValueFromPath</span><span class="p">(</span><span class="s1">&#39;transformations/templates&#39;</span><span class="p">);</span>
            <span class="k">foreach</span> <span class="p">(</span><span class="nv">$templatesFromConfig</span> <span class="k">as</span> <span class="nv">$template</span><span class="p">)</span> <span class="p">{</span>
                <span class="nv">$templates</span><span class="p">[]</span> <span class="o">=</span> <span class="nv">$template</span><span class="o">-&gt;</span><span class="na">getName</span><span class="p">();</span>
            <span class="p">}</span>
        <span class="p">}</span>

        <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nv">$templates</span><span class="p">)</span> <span class="p">{</span>
            <span class="nv">$templates</span> <span class="o">=</span> <span class="k">array</span><span class="p">(</span><span class="s1">&#39;clean&#39;</span><span class="p">);</span>
        <span class="p">}</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="indices-are-int-or-string">
<span id="case-indices-are-int-or-string"></span><h3><span class="section-number">5.2.64. </span>Indices Are Int Or String<a class="headerlink" href="#indices-are-int-or-string" title="Permalink to this headline">¶</a></h3>
<div class="section" id="case-zencart-structures-indicesareintorstring">
<span id="id67"></span><h4><span class="section-number">5.2.64.1. </span>Zencart<a class="headerlink" href="#case-zencart-structures-indicesareintorstring" title="Permalink to this headline">¶</a></h4>
<p><a class="reference internal" href="Rules.html#indices-are-int-or-string"><span class="std std-ref">Indices Are Int Or String</span></a>, in includes/modules/payment/paypaldp.php:2523.</p>
<p>All those strings ends up as integers.</p>
<div class="highlight-php notranslate"><div class="highlight"><pre><span></span><span class="c1">// Build Currency format table</span>
    <span class="nv">$curFormat</span> <span class="o">=</span> <span class="k">Array</span><span class="p">();</span>
    <span class="nv">$curFormat</span><span class="p">[</span><span class="mo">036</span><span class="p">]</span><span class="o">=</span><span class="mi">2</span><span class="p">;</span>
    <span class="nv">$curFormat</span><span class="p">[</span><span class="mi">124</span><span class="p">]</span><span class="o">=</span><span class="mi">2</span><span class="p">;</span>
    <span class="nv">$curFormat</span><span class="p">[</span><span class="mi">203</span><span class="p">]</span><span class="o">=</span><span class="mi">2</span><span class="p">;</span>
    <span class="nv">$curFormat</span><span class="p">[</span><span class="mi">208</span><span class="p">]</span><span class="o">=</span><span class="mi">2</span><span class="p">;</span>
    <span class="nv">$curFormat</span><span class="p">[</span><span class="mi">348</span><span class="p">]</span><span class="o">=</span><span class="mi">2</span><span class="p">;</span>
    <span class="nv">$curFormat</span><span class="p">[</span><span class="mi">392</span><span class="p">]</span><span class="o">=</span><span class="mi">0</span><span class="p">;</span>
    <span class="nv">$curFormat</span><span class="p">[</span><span class="mi">554</span><span class="p">]</span><span class="o">=</span><span class="mi">2</span><span class="p">;</span>
    <span class="nv">$curFormat</span><span class="p">[</span><span class="mi">578</span><span class="p">]</span><span class="o">=</span><span class="mi">2</span><span class="p">;</span>
    <span class="nv">$curFormat</span><span class="p">[</span><span class="mi">702</span><span class="p">]</span><span class="o">=</span><span class="mi">2</span><span class="p">;</span>
    <span class="nv">$curFormat</span><span class="p">[</span><span class="mi">752</span><span class="p">]</span><span class="o">=</span><span class="mi">2</span><span class="p">;</span>
    <span class="nv">$curFormat</span><span class="p">[</span><span class="mi">756</span><span class="p">]</span><span class="o">=</span><span class="mi">2</span><span class="p">;</span>
    <span class="nv">$curFormat</span><span class="p">[</span><span class="mi">826</span><span class="p">]</span><span class="o">=</span><span class="mi">2</span><span class="p">;</span>
    <span class="nv">$curFormat</span><span class="p">[</span><span class="mi">840</span><span class="p">]</span><span class="o">=</span><span class="mi">2</span><span class="p">;</span>
    <span class="nv">$curFormat</span><span class="p">[</span><span class="mi">978</span><span class="p">]</span><span class="o">=</span><span class="mi">2</span><span class="p">;</span>
    <span class="nv">$curFormat</span><span class="p">[</span><span class="mi">985</span><span class="p">]</span><span class="o">=</span><span class="mi">2</span><span class="p">;</span>
</pre></div>
</div>
</div>
<div class="section" id="case-mautic-structures-indicesareintorstring">
<span id="id68"></span><h4><span class="section-number">5.2.64.2. </span>Mautic<a class="headerlink" href="#case-mautic-structures-indicesareintorstring" title="Permalink to this headline">¶</a></h4>
<p><a class="reference internal" href="Rules.html#indices-are-int-or-string"><span class="std std-ref">Indices Are Int Or String</span></a>, in app/bundles/CoreBundle/Entity/CommonRepository.php:315.</p>
<p>$baseCols has 1 and 0 (respectively) for index.</p>
<div class="highlight-php notranslate"><div class="highlight"><pre><span></span><span class="k">foreach</span> <span class="p">(</span><span class="nv">$metadata</span><span class="o">-&gt;</span><span class="na">getAssociationMappings</span><span class="p">()</span> <span class="k">as</span> <span class="nv">$field</span> <span class="o">=&gt;</span> <span class="nv">$association</span><span class="p">)</span> <span class="p">{</span>
                    <span class="k">if</span> <span class="p">(</span><span class="nb">in_array</span><span class="p">(</span><span class="nv">$association</span><span class="p">[</span><span class="s1">&#39;type&#39;</span><span class="p">],</span> <span class="p">[</span><span class="nx">ClassMetadataInfo</span><span class="o">::</span><span class="na">ONE_TO_ONE</span><span class="p">,</span> <span class="nx">ClassMetadataInfo</span><span class="o">::</span><span class="na">MANY_TO_ONE</span><span class="p">]))</span> <span class="p">{</span>
                        <span class="nv">$baseCols</span><span class="p">[</span><span class="k">true</span><span class="p">][</span><span class="nv">$entityClass</span><span class="p">][]</span>  <span class="o">=</span> <span class="nv">$association</span><span class="p">[</span><span class="s1">&#39;joinColumns&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">][</span><span class="s1">&#39;name&#39;</span><span class="p">];</span>
                        <span class="nv">$baseCols</span><span class="p">[</span><span class="k">false</span><span class="p">][</span><span class="nv">$entityClass</span><span class="p">][]</span> <span class="o">=</span> <span class="nv">$field</span><span class="p">;</span>
                    <span class="p">}</span>
                <span class="p">}</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="invalid-regex">
<span id="case-invalid-regex"></span><h3><span class="section-number">5.2.65. </span>Invalid Regex<a class="headerlink" href="#invalid-regex" title="Permalink to this headline">¶</a></h3>
<div class="section" id="case-sugarcrm-structures-invalidregex">
<span id="id69"></span><h4><span class="section-number">5.2.65.1. </span>SugarCrm<a class="headerlink" href="#case-sugarcrm-structures-invalidregex" title="Permalink to this headline">¶</a></h4>
<p><a class="reference internal" href="Rules.html#invalid-regex"><span class="std std-ref">Invalid Regex</span></a>, in SugarCE-Full-6.5.26/include/utils/file_utils.php:513.</p>
<p>This yields an error at execution time : <a href="#id70"><span class="problematic" id="id71">``</span></a>Compilation failed: invalid range in character class at offset 4 <a href="#id72"><span class="problematic" id="id73">``</span></a>.</p>
<div class="highlight-php notranslate"><div class="highlight"><pre><span></span><span class="nb">preg_replace</span><span class="p">(</span><span class="s1">&#39;/[^\w-._]+/i&#39;</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="nv">$name</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="is-actually-zero">
<span id="case-is-actually-zero"></span><h3><span class="section-number">5.2.66. </span>Is Actually Zero<a class="headerlink" href="#is-actually-zero" title="Permalink to this headline">¶</a></h3>
<div class="section" id="case-dolibarr-structures-iszero">
<span id="id74"></span><h4><span class="section-number">5.2.66.1. </span>Dolibarr<a class="headerlink" href="#case-dolibarr-structures-iszero" title="Permalink to this headline">¶</a></h4>
<p><a class="reference internal" href="Rules.html#is-actually-zero"><span class="std std-ref">Is Actually Zero</span></a>, in htdocs/compta/ajaxpayment.php:99.</p>
<p>Here, the $amountToBreakDown is either $currentRemain or $result.</p>
<div class="highlight-php notranslate"><div class="highlight"><pre><span></span><span class="nv">$amountToBreakdown</span> <span class="o">=</span> <span class="p">(</span><span class="nv">$result</span> <span class="o">-</span> <span class="nv">$currentRemain</span> <span class="o">&gt;=</span> <span class="mi">0</span> <span class="o">?</span>
                                                                            <span class="nv">$currentRemain</span> <span class="o">:</span>                                                                <span class="c1">// Remain can be fully paid</span>
                                                                            <span class="nv">$currentRemain</span> <span class="o">+</span> <span class="p">(</span><span class="nv">$result</span> <span class="o">-</span> <span class="nv">$currentRemain</span><span class="p">));</span>   <span class="c1">// Remain can only partially be paid</span>
</pre></div>
</div>
</div>
<div class="section" id="case-suitecrm-structures-iszero">
<span id="id75"></span><h4><span class="section-number">5.2.66.2. </span>SuiteCrm<a class="headerlink" href="#case-suitecrm-structures-iszero" title="Permalink to this headline">¶</a></h4>
<p><a class="reference internal" href="Rules.html#is-actually-zero"><span class="std std-ref">Is Actually Zero</span></a>, in modules/AOR_Charts/lib/pChart/class/pDraw.class.php:523.</p>
<p>$Xa may only amount to $iX2, though the expression looks weird.</p>
<div class="highlight-php notranslate"><div class="highlight"><pre><span></span><span class="k">if</span> <span class="p">(</span> <span class="nv">$X</span> <span class="o">&gt;</span> <span class="nv">$iX2</span> <span class="p">)</span> <span class="p">{</span> <span class="nv">$Xa</span> <span class="o">=</span> <span class="nv">$X</span><span class="o">-</span><span class="p">(</span><span class="nv">$X</span><span class="o">-</span><span class="nv">$iX2</span><span class="p">);</span> <span class="nv">$Ya</span> <span class="o">=</span> <span class="nv">$iY1</span><span class="o">+</span><span class="p">(</span><span class="nv">$X</span><span class="o">-</span><span class="nv">$iX2</span><span class="p">);</span> <span class="p">}</span> <span class="k">else</span> <span class="p">{</span> <span class="nv">$Xa</span> <span class="o">=</span> <span class="nv">$X</span><span class="p">;</span> <span class="nv">$Ya</span> <span class="o">=</span> <span class="nv">$iY1</span><span class="p">;</span> <span class="p">}</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="list-may-omit-variables">
<span id="case-list-may-omit-variables"></span><h3><span class="section-number">5.2.67. </span>list() May Omit Variables<a class="headerlink" href="#list-may-omit-variables" title="Permalink to this headline">¶</a></h3>
<div class="section" id="case-openconf-structures-listomissions">
<span id="id76"></span><h4><span class="section-number">5.2.67.1. </span>OpenConf<a class="headerlink" href="#case-openconf-structures-listomissions" title="Permalink to this headline">¶</a></h4>
<p><a class="reference internal" href="Rules.html#list-may-omit-variables"><span class="std std-ref">list() May Omit Variables</span></a>, in openconf/author/privacy.php:29.</p>
<p>The first variable in the list(), $none, isn’t reused anywhere in the script. In fact, its name convey the meaning that is it useless, but is in the array nonetheless.</p>
<div class="highlight-php notranslate"><div class="highlight"><pre><span></span><span class="k">list</span><span class="p">(</span><span class="nv">$none</span><span class="p">,</span> <span class="nv">$OC_privacy_policy</span><span class="p">)</span> <span class="o">=</span> <span class="nx">oc_getTemplate</span><span class="p">(</span><span class="s1">&#39;privacy_policy&#39;</span><span class="p">);</span>
</pre></div>
</div>
</div>
<div class="section" id="case-fuelcms-structures-listomissions">
<span id="id77"></span><h4><span class="section-number">5.2.67.2. </span>FuelCMS<a class="headerlink" href="#case-fuelcms-structures-listomissions" title="Permalink to this headline">¶</a></h4>
<p><a class="reference internal" href="Rules.html#list-may-omit-variables"><span class="std std-ref">list() May Omit Variables</span></a>, in wp-admin/includes/misc.php:74.</p>
<p>$a is never reused again. $b, on the other hand is. Not assigning any value to $a saves some memory, and avoid polluting the local variable space.</p>
<div class="highlight-php notranslate"><div class="highlight"><pre><span></span><span class="k">list</span><span class="p">(</span><span class="nv">$b</span><span class="p">,</span> <span class="nv">$a</span><span class="p">)</span> <span class="o">=</span> <span class="k">array</span><span class="p">(</span><span class="nb">reset</span><span class="p">(</span><span class="nv">$params</span><span class="o">-&gt;</span><span class="na">me</span><span class="p">),</span> <span class="nb">key</span><span class="p">(</span><span class="nv">$params</span><span class="o">-&gt;</span><span class="na">me</span><span class="p">));</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="logical-mistakes">
<span id="case-logical-mistakes"></span><h3><span class="section-number">5.2.68. </span>Logical Mistakes<a class="headerlink" href="#logical-mistakes" title="Permalink to this headline">¶</a></h3>
<div class="section" id="case-dolibarr-structures-logicalmistakes">
<span id="id78"></span><h4><span class="section-number">5.2.68.1. </span>Dolibarr<a class="headerlink" href="#case-dolibarr-structures-logicalmistakes" title="Permalink to this headline">¶</a></h4>
<p><a class="reference internal" href="Rules.html#logical-mistakes"><span class="std std-ref">Logical Mistakes</span></a>, in htdocs/core/lib/admin.lib.php:1165.</p>
<p>This expression is always true. When <cite>$nbtabsql</cite> is <cite>$nbtablib</cite>, the left part is true; When <cite>$nbtabsql</cite> is <cite>$nbtabsqlsort</cite>, the right part is true; When any other value is provided, both operands are true.</p>
<div class="highlight-php notranslate"><div class="highlight"><pre><span></span><span class="nv">$nbtablib</span> <span class="o">!=</span> <span class="nv">$nbtabsql</span> <span class="o">||</span> <span class="nv">$nbtabsql</span> <span class="o">!=</span> <span class="nv">$nbtabsqlsort</span>
</pre></div>
</div>
</div>
<div class="section" id="case-cleverstyle-structures-logicalmistakes">
<span id="id79"></span><h4><span class="section-number">5.2.68.2. </span>Cleverstyle<a class="headerlink" href="#case-cleverstyle-structures-logicalmistakes" title="Permalink to this headline">¶</a></h4>
<p><a class="reference internal" href="Rules.html#logical-mistakes"><span class="std std-ref">Logical Mistakes</span></a>, in modules/HybridAuth/Hybrid/Providers/DigitalOcean.php:123.</p>
<p>This expression is always false. When <cite>$data-&gt;account-&gt;email_verified</cite> is <cite>true</cite>, the right part is false; When <cite>$data-&gt;account-&gt;email_verified</cite> is <cite>$data-&gt;account-&gt;email</cite>, the right part is false; The only viable solution is to have ` $data-&gt;account-&gt;email`true : this is may be the intend it, though it is not easy to understand.</p>
<div class="highlight-php notranslate"><div class="highlight"><pre><span></span><span class="k">TRUE</span> <span class="o">==</span> <span class="nv">$data</span><span class="o">-&gt;</span><span class="na">account</span><span class="o">-&gt;</span><span class="na">email_verified</span> <span class="k">and</span> <span class="nv">$data</span><span class="o">-&gt;</span><span class="na">account</span><span class="o">-&gt;</span><span class="na">email</span> <span class="o">==</span> <span class="nv">$data</span><span class="o">-&gt;</span><span class="na">account</span><span class="o">-&gt;</span><span class="na">email_verified</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="lone-blocks">
<span id="case-lone-blocks"></span><h3><span class="section-number">5.2.69. </span>Lone Blocks<a class="headerlink" href="#lone-blocks" title="Permalink to this headline">¶</a></h3>
<div class="section" id="case-thinkphp-structures-loneblock">
<span id="id80"></span><h4><span class="section-number">5.2.69.1. </span>ThinkPHP<a class="headerlink" href="#case-thinkphp-structures-loneblock" title="Permalink to this headline">¶</a></h4>
<p><a class="reference internal" href="Rules.html#lone-blocks"><span class="std std-ref">Lone Blocks</span></a>, in ThinkPHP/Library/Vendor/Hprose/HproseReader.php:163.</p>
<p>There is no need for block in a case/default clause. PHP executes all command in order, until a break or the end of the switch. There is another occurrence of that situation in this code : it seems to be a coding convention, while only applied to a few switch statements.</p>
<div class="highlight-php notranslate"><div class="highlight"><pre><span></span><span class="k">for</span> <span class="p">(</span><span class="nv">$i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="nv">$i</span> <span class="o">&lt;</span> <span class="nv">$len</span><span class="p">;</span> <span class="o">++</span><span class="nv">$i</span><span class="p">)</span> <span class="p">{</span>
            <span class="k">switch</span> <span class="p">(</span><span class="nb">ord</span><span class="p">(</span><span class="nv">$this</span><span class="o">-&gt;</span><span class="na">stream</span><span class="o">-&gt;</span><span class="na">getc</span><span class="p">())</span> <span class="o">&gt;&gt;</span> <span class="mi">4</span><span class="p">)</span> <span class="p">{</span>
                <span class="k">case</span> <span class="mi">0</span><span class="o">:</span>
                <span class="k">case</span> <span class="mi">1</span><span class="o">:</span>
                <span class="k">case</span> <span class="mi">2</span><span class="o">:</span>
                <span class="k">case</span> <span class="mi">3</span><span class="o">:</span>
                <span class="k">case</span> <span class="mi">4</span><span class="o">:</span>
                <span class="k">case</span> <span class="mi">5</span><span class="o">:</span>
                <span class="k">case</span> <span class="mi">6</span><span class="o">:</span>
                <span class="k">case</span> <span class="mi">7</span><span class="o">:</span> <span class="p">{</span>
                    <span class="c1">// 0xxx xxxx</span>
                    <span class="nv">$utf8len</span><span class="o">++</span><span class="p">;</span>
                    <span class="k">break</span><span class="p">;</span>
                <span class="p">}</span>
                <span class="k">case</span> <span class="mi">12</span><span class="o">:</span>
                <span class="k">case</span> <span class="mi">13</span><span class="o">:</span> <span class="p">{</span>
                    <span class="c1">// 110x xxxx   10xx xxxx</span>
                    <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">stream</span><span class="o">-&gt;</span><span class="na">skip</span><span class="p">(</span><span class="mi">1</span><span class="p">);</span>
                    <span class="nv">$utf8len</span> <span class="o">+=</span> <span class="mi">2</span><span class="p">;</span>
                    <span class="k">break</span><span class="p">;</span>
                <span class="p">}</span>
</pre></div>
</div>
</div>
<div class="section" id="case-tine20-structures-loneblock">
<span id="id81"></span><h4><span class="section-number">5.2.69.2. </span>Tine20<a class="headerlink" href="#case-tine20-structures-loneblock" title="Permalink to this headline">¶</a></h4>
<p><a class="reference internal" href="Rules.html#lone-blocks"><span class="std std-ref">Lone Blocks</span></a>, in tine20/Addressbook/Convert/Contact/VCard/Abstract.php:199.</p>
<p>A case of empty case, with empty blocks. This is useless code. Event the curly brackets with the final case are useless.</p>
<div class="highlight-php notranslate"><div class="highlight"><pre><span></span><span class="k">switch</span> <span class="p">(</span> <span class="nv">$property</span><span class="p">[</span><span class="s1">&#39;TYPE&#39;</span><span class="p">]</span> <span class="p">)</span> <span class="p">{</span>
                        <span class="k">case</span> <span class="s1">&#39;JPG&#39;</span> <span class="o">:</span> <span class="p">{}</span>
                        <span class="k">case</span> <span class="s1">&#39;jpg&#39;</span> <span class="o">:</span> <span class="p">{}</span>
                        <span class="k">case</span> <span class="s1">&#39;Jpg&#39;</span> <span class="o">:</span> <span class="p">{}</span>
                        <span class="k">case</span> <span class="s1">&#39;Jpeg&#39;</span> <span class="o">:</span> <span class="p">{}</span>
                        <span class="k">case</span> <span class="s1">&#39;jpeg&#39;</span> <span class="o">:</span> <span class="p">{}</span>
                        <span class="k">case</span> <span class="s1">&#39;PNG&#39;</span> <span class="o">:</span> <span class="p">{}</span>
                        <span class="k">case</span> <span class="s1">&#39;png&#39;</span> <span class="o">:</span> <span class="p">{}</span>
                        <span class="k">case</span> <span class="s1">&#39;JPEG&#39;</span> <span class="o">:</span> <span class="p">{</span>
                            <span class="k">if</span> <span class="p">(</span><span class="nx">Tinebase_Core</span><span class="o">::</span><span class="na">isLogLevel</span><span class="p">(</span><span class="nx">Zend_Log</span><span class="o">::</span><span class="na">DEBUG</span><span class="p">))</span>
                                <span class="nx">Tinebase_Core</span><span class="o">::</span><span class="na">getLogger</span><span class="p">()</span><span class="o">-&gt;</span><span class="na">warn</span><span class="p">(</span><span class="no">__METHOD__</span> <span class="o">.</span> <span class="s1">&#39;::&#39;</span> <span class="o">.</span> <span class="no">__LINE__</span> <span class="o">.</span> <span class="s1">&#39; Photo: passing on invalid &#39;</span> <span class="o">.</span> <span class="nv">$property</span><span class="p">[</span><span class="s1">&#39;TYPE&#39;</span><span class="p">]</span> <span class="o">.</span> <span class="s1">&#39; image as is (&#39;</span> <span class="o">.</span> <span class="nb">strlen</span><span class="p">(</span><span class="nv">$property</span><span class="o">-&gt;</span><span class="na">getValue</span><span class="p">())</span> <span class="o">.</span><span class="s1">&#39;)&#39;</span> <span class="p">);</span>
                            <span class="nv">$jpegphoto</span> <span class="o">=</span> <span class="nv">$property</span><span class="o">-&gt;</span><span class="na">getValue</span><span class="p">();</span>
                            <span class="k">break</span><span class="p">;</span>
                        <span class="p">}</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="multiples-identical-case">
<span id="case-multiples-identical-case"></span><h3><span class="section-number">5.2.70. </span>Multiples Identical Case<a class="headerlink" href="#multiples-identical-case" title="Permalink to this headline">¶</a></h3>
<div class="section" id="case-sugarcrm-structures-multipledefinedcase">
<span id="id82"></span><h4><span class="section-number">5.2.70.1. </span>SugarCrm<a class="headerlink" href="#case-sugarcrm-structures-multipledefinedcase" title="Permalink to this headline">¶</a></h4>
<p><a class="reference internal" href="Rules.html#multiples-identical-case"><span class="std std-ref">Multiples Identical Case</span></a>, in modules/ModuleBuilder/MB/MBPackage.php:439.</p>
<p>It takes a while to find the double ‘required’ case, but the executed code is actually the same, so this is dead code at worst.</p>
<div class="highlight-php notranslate"><div class="highlight"><pre><span></span><span class="k">switch</span> <span class="p">(</span><span class="nv">$col</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">case</span> <span class="s1">&#39;custom_module&#39;</span><span class="o">:</span>
            <span class="nv">$installdefs</span><span class="p">[</span><span class="s1">&#39;custom_fields&#39;</span><span class="p">][</span><span class="nv">$name</span><span class="p">][</span><span class="s1">&#39;module&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="nv">$res</span><span class="p">;</span>
            <span class="k">break</span><span class="p">;</span>
    <span class="k">case</span> <span class="s1">&#39;required&#39;</span><span class="o">:</span>
            <span class="nv">$installdefs</span><span class="p">[</span><span class="s1">&#39;custom_fields&#39;</span><span class="p">][</span><span class="nv">$name</span><span class="p">][</span><span class="s1">&#39;require_option&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="nv">$res</span><span class="p">;</span>
            <span class="k">break</span><span class="p">;</span>
    <span class="k">case</span> <span class="s1">&#39;vname&#39;</span><span class="o">:</span>
            <span class="nv">$installdefs</span><span class="p">[</span><span class="s1">&#39;custom_fields&#39;</span><span class="p">][</span><span class="nv">$name</span><span class="p">][</span><span class="s1">&#39;label&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="nv">$res</span><span class="p">;</span>
            <span class="k">break</span><span class="p">;</span>
    <span class="k">case</span> <span class="s1">&#39;required&#39;</span><span class="o">:</span>
            <span class="nv">$installdefs</span><span class="p">[</span><span class="s1">&#39;custom_fields&#39;</span><span class="p">][</span><span class="nv">$name</span><span class="p">][</span><span class="s1">&#39;require_option&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="nv">$res</span><span class="p">;</span>
            <span class="k">break</span><span class="p">;</span>
    <span class="k">case</span> <span class="s1">&#39;massupdate&#39;</span><span class="o">:</span>
            <span class="nv">$installdefs</span><span class="p">[</span><span class="s1">&#39;custom_fields&#39;</span><span class="p">][</span><span class="nv">$name</span><span class="p">][</span><span class="s1">&#39;mass_update&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="nv">$res</span><span class="p">;</span>
            <span class="k">break</span><span class="p">;</span>
    <span class="k">case</span> <span class="s1">&#39;comments&#39;</span><span class="o">:</span>
            <span class="nv">$installdefs</span><span class="p">[</span><span class="s1">&#39;custom_fields&#39;</span><span class="p">][</span><span class="nv">$name</span><span class="p">][</span><span class="s1">&#39;comments&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="nv">$res</span><span class="p">;</span>
            <span class="k">break</span><span class="p">;</span>
    <span class="k">case</span> <span class="s1">&#39;help&#39;</span><span class="o">:</span>
            <span class="nv">$installdefs</span><span class="p">[</span><span class="s1">&#39;custom_fields&#39;</span><span class="p">][</span><span class="nv">$name</span><span class="p">][</span><span class="s1">&#39;help&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="nv">$res</span><span class="p">;</span>
            <span class="k">break</span><span class="p">;</span>
    <span class="k">case</span> <span class="s1">&#39;len&#39;</span><span class="o">:</span>
            <span class="nv">$installdefs</span><span class="p">[</span><span class="s1">&#39;custom_fields&#39;</span><span class="p">][</span><span class="nv">$name</span><span class="p">][</span><span class="s1">&#39;max_size&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="nv">$res</span><span class="p">;</span>
            <span class="k">break</span><span class="p">;</span>
    <span class="k">default</span><span class="o">:</span>
            <span class="nv">$installdefs</span><span class="p">[</span><span class="s1">&#39;custom_fields&#39;</span><span class="p">][</span><span class="nv">$name</span><span class="p">][</span><span class="nv">$col</span><span class="p">]</span> <span class="o">=</span> <span class="nv">$res</span><span class="p">;</span>
<span class="p">}</span><span class="c1">//switch</span>
</pre></div>
</div>
</div>
<div class="section" id="case-expressionengine-structures-multipledefinedcase">
<span id="id83"></span><h4><span class="section-number">5.2.70.2. </span>ExpressionEngine<a class="headerlink" href="#case-expressionengine-structures-multipledefinedcase" title="Permalink to this headline">¶</a></h4>
<p><a class="reference internal" href="Rules.html#multiples-identical-case"><span class="std std-ref">Multiples Identical Case</span></a>, in ExpressionEngine_Core2.9.2/system/expressionengine/controllers/cp/admin_content.php:577.</p>
<p>‘deft_status’ is doubled, with a fallthrough. This looks like some forgotten copy/paste.</p>
<div class="highlight-php notranslate"><div class="highlight"><pre><span></span><span class="k">switch</span> <span class="p">(</span><span class="nv">$key</span><span class="p">){</span>
                                                            <span class="k">case</span> <span class="s1">&#39;cat_group&#39;</span><span class="o">:</span>
                                                                <span class="c1">//PHP code</span>
                                                                    <span class="k">break</span><span class="p">;</span>
                                                            <span class="k">case</span> <span class="s1">&#39;status_group&#39;</span><span class="o">:</span>
                                                            <span class="k">case</span> <span class="s1">&#39;field_group&#39;</span><span class="o">:</span>
                                                                <span class="c1">//PHP code</span>
                                                                    <span class="k">break</span><span class="p">;</span>
                                                            <span class="k">case</span> <span class="s1">&#39;deft_status&#39;</span><span class="o">:</span>
                                                            <span class="k">case</span> <span class="s1">&#39;deft_status&#39;</span><span class="o">:</span>
                                                                <span class="c1">//PHP code</span>
                                                                    <span class="k">break</span><span class="p">;</span>
                                                            <span class="k">case</span> <span class="s1">&#39;search_excerpt&#39;</span><span class="o">:</span>
                                                                <span class="c1">//PHP code</span>
                                                                    <span class="k">break</span><span class="p">;</span>
                                                            <span class="k">case</span> <span class="s1">&#39;deft_category&#39;</span><span class="o">:</span>
                                                                <span class="c1">//PHP code</span>
                                                                    <span class="k">break</span><span class="p">;</span>
                                                            <span class="k">case</span> <span class="s1">&#39;blog_url&#39;</span><span class="o">:</span>
                                                            <span class="k">case</span> <span class="s1">&#39;comment_url&#39;</span><span class="o">:</span>
                                                            <span class="k">case</span> <span class="s1">&#39;search_results_url&#39;</span><span class="o">:</span>
                                                            <span class="k">case</span> <span class="s1">&#39;rss_url&#39;</span><span class="o">:</span>
                                                                <span class="c1">//PHP code</span>
                                                                    <span class="k">break</span><span class="p">;</span>
                                                            <span class="k">default</span> <span class="o">:</span>
                                                                <span class="c1">//PHP code</span>
                                                                    <span class="k">break</span><span class="p">;</span>
                                                    <span class="p">}</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="multiply-by-one">
<span id="case-multiply-by-one"></span><h3><span class="section-number">5.2.71. </span>Multiply By One<a class="headerlink" href="#multiply-by-one" title="Permalink to this headline">¶</a></h3>
<div class="section" id="case-sugarcrm-structures-multiplybyone">
<span id="id84"></span><h4><span class="section-number">5.2.71.1. </span>SugarCrm<a class="headerlink" href="#case-sugarcrm-structures-multiplybyone" title="Permalink to this headline">¶</a></h4>
<p><a class="reference internal" href="Rules.html#multiply-by-one"><span class="std std-ref">Multiply By One</span></a>, in SugarCE-Full-6.5.26/modules/Relationships/views/view.editfields.php:74.</p>
<p>Here, ‘$count % 1’ is always true, after the first loop of the foreach. There is no need for % usage.</p>
<div class="highlight-php notranslate"><div class="highlight"><pre><span></span><span class="nv">$count</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
        <span class="k">foreach</span><span class="p">(</span><span class="nv">$this</span><span class="o">-&gt;</span><span class="na">fields</span> <span class="k">as</span> <span class="nv">$def</span><span class="p">)</span>
        <span class="p">{</span>
            <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="k">empty</span><span class="p">(</span><span class="nv">$def</span><span class="p">[</span><span class="s1">&#39;relationship_field&#39;</span><span class="p">]))</span> <span class="p">{</span>
                <span class="nv">$label</span> <span class="o">=</span> <span class="o">!</span><span class="k">empty</span><span class="p">(</span><span class="nv">$def</span><span class="p">[</span><span class="s1">&#39;vname&#39;</span><span class="p">])</span> <span class="o">?</span> <span class="nv">$def</span><span class="p">[</span><span class="s1">&#39;vname&#39;</span><span class="p">]</span> <span class="o">:</span> <span class="nv">$def</span><span class="p">[</span><span class="s1">&#39;name&#39;</span><span class="p">];</span>
                <span class="k">echo</span> <span class="o">&lt;</span><span class="nx">td</span><span class="o">&gt;</span> <span class="o">.</span> <span class="nx">translate</span><span class="p">(</span><span class="nv">$label</span><span class="p">,</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">module</span><span class="p">)</span> <span class="o">.</span> <span class="o">:&lt;/</span><span class="nx">td</span><span class="o">&gt;</span>
                   <span class="o">.</span> <span class="o">&lt;</span><span class="nx">td</span><span class="o">&gt;&lt;</span><span class="nx">input</span> <span class="nx">id</span><span class="o">=</span><span class="s1">&#39;{$def[&#39;</span><span class="nx">name</span><span class="s1">&#39;]}&#39;</span> <span class="nx">name</span><span class="o">=</span><span class="s1">&#39;{$def[&#39;</span><span class="nx">name</span><span class="s1">&#39;]}&#39;</span><span class="o">&gt;</span>  <span class="p">;</span>

                <span class="k">if</span> <span class="p">(</span><span class="nv">$count</span><span class="o">%</span><span class="mi">1</span><span class="p">)</span>
                    <span class="k">echo</span> <span class="o">&lt;/</span><span class="nx">tr</span><span class="o">&gt;&lt;</span><span class="nx">tr</span><span class="o">&gt;</span><span class="p">;</span>
                <span class="nv">$count</span><span class="o">++</span><span class="p">;</span>
            <span class="p">}</span>
        <span class="p">}</span>
        <span class="k">echo</span> <span class="o">&lt;/</span><span class="nx">tr</span><span class="o">&gt;&lt;/</span><span class="nx">table</span><span class="o">&gt;&lt;/</span><span class="nx">form</span><span class="o">&gt;</span><span class="p">;</span>
</pre></div>
</div>
</div>
<div class="section" id="edusoho">
<span id="case-edusoho-structures-multiplybyone"></span><h4><span class="section-number">5.2.71.2. </span>Edusoho<a class="headerlink" href="#edusoho" title="Permalink to this headline">¶</a></h4>
<p><a class="reference internal" href="Rules.html#multiply-by-one"><span class="std std-ref">Multiply By One</span></a>, in wp-admin/includes/misc.php:74.</p>
<p>1 is useless here, since 24 * 3600 is already an integer. And, of course, a day is not 24 * 3600… at least every day.</p>
<div class="highlight-php notranslate"><div class="highlight"><pre><span></span><span class="s1">&#39;yesterdayStart&#39;</span> <span class="o">=&gt;</span> <span class="nb">date</span><span class="p">(</span><span class="s1">&#39;Y-m-d&#39;</span><span class="p">,</span> <span class="nb">strtotime</span><span class="p">(</span><span class="nb">date</span><span class="p">(</span><span class="s1">&#39;Y-m-d&#39;</span><span class="p">,</span> <span class="nb">time</span><span class="p">()))</span> <span class="o">-</span> <span class="mi">1</span> <span class="o">*</span> <span class="mi">24</span> <span class="o">*</span> <span class="mi">3600</span><span class="p">),</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="nested-ternary">
<span id="case-nested-ternary"></span><h3><span class="section-number">5.2.72. </span>Nested Ternary<a class="headerlink" href="#nested-ternary" title="Permalink to this headline">¶</a></h3>
<div class="section" id="case-spip-structures-nestedternary">
<span id="id85"></span><h4><span class="section-number">5.2.72.1. </span>SPIP<a class="headerlink" href="#case-spip-structures-nestedternary" title="Permalink to this headline">¶</a></h4>
<p><a class="reference internal" href="Rules.html#nested-ternary"><span class="std std-ref">Nested Ternary</span></a>, in ecrire/inc/utils.php:2648.</p>
<p>Interesting usage of both if/then, for the flow control, and ternary, for data process. Even on multiple lines, nested ternaries are quite hard to read.</p>
<div class="highlight-php notranslate"><div class="highlight"><pre><span></span><span class="c1">// le script de l&#39;espace prive</span>
    <span class="c1">// Mettre a &quot;index.php&quot; si DirectoryIndex ne le fait pas ou pb connexes:</span>
    <span class="c1">// les anciens IIS n&#39;acceptent pas les POST sur ecrire/ (#419)</span>
    <span class="c1">// meme pb sur thttpd cf. http://forum.spip.net/fr_184153.html</span>
    <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nb">defined</span><span class="p">(</span><span class="s1">&#39;_SPIP_ECRIRE_SCRIPT&#39;</span><span class="p">))</span> <span class="p">{</span>
            <span class="nb">define</span><span class="p">(</span><span class="s1">&#39;_SPIP_ECRIRE_SCRIPT&#39;</span><span class="p">,</span> <span class="p">(</span><span class="k">empty</span><span class="p">(</span><span class="nv">$_SERVER</span><span class="p">[</span><span class="s1">&#39;SERVER_SOFTWARE&#39;</span><span class="p">])</span> <span class="o">?</span> <span class="s1">&#39;&#39;</span> <span class="o">:</span>
                    <span class="nb">preg_match</span><span class="p">(</span><span class="s1">&#39;,IIS|thttpd,&#39;</span><span class="p">,</span> <span class="nv">$_SERVER</span><span class="p">[</span><span class="s1">&#39;SERVER_SOFTWARE&#39;</span><span class="p">])</span> <span class="o">?</span>
                            <span class="s1">&#39;index.php&#39;</span> <span class="o">:</span> <span class="s1">&#39;&#39;</span><span class="p">));</span>
    <span class="p">}</span>
</pre></div>
</div>
</div>
<div class="section" id="case-zencart-structures-nestedternary">
<span id="id86"></span><h4><span class="section-number">5.2.72.2. </span>Zencart<a class="headerlink" href="#case-zencart-structures-nestedternary" title="Permalink to this headline">¶</a></h4>
<p><a class="reference internal" href="Rules.html#nested-ternary"><span class="std std-ref">Nested Ternary</span></a>, in app/library/zencart/ListingQueryAndOutput/src/formatters/TabularProduct.php:143.</p>
<p>No more than one level of nesting for this ternary call, yet it feels a lot more, thanks to the usage of arrayed properties, constants, and functioncalls.</p>
<div class="highlight-php notranslate"><div class="highlight"><pre><span></span><span class="nv">$lc_text</span> <span class="o">.=</span> <span class="s1">&#39;&lt;br /&gt;&#39;</span> <span class="o">.</span> <span class="p">(</span><span class="nx">zen_get_show_product_switch</span><span class="p">(</span><span class="nv">$listing</span><span class="o">-&gt;</span><span class="na">fields</span><span class="p">[</span><span class="s1">&#39;products_id&#39;</span><span class="p">],</span> <span class="s1">&#39;ALWAYS_FREE_SHIPPING_IMAGE_SWITCH&#39;</span><span class="p">)</span> <span class="o">?</span> <span class="p">(</span><span class="nx">zen_get_product_is_always_free_shipping</span><span class="p">(</span><span class="nv">$listing</span><span class="o">-&gt;</span><span class="na">fields</span><span class="p">[</span><span class="s1">&#39;products_id&#39;</span><span class="p">])</span> <span class="o">?</span> <span class="nx">TEXT_PRODUCT_FREE_SHIPPING_ICON</span> <span class="o">.</span> <span class="s1">&#39;&lt;br /&gt;&#39;</span> <span class="o">:</span> <span class="s1">&#39;&#39;</span><span class="p">)</span> <span class="o">:</span> <span class="s1">&#39;&#39;</span><span class="p">);</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="always-positive-comparison">
<span id="case-always-positive-comparison"></span><h3><span class="section-number">5.2.73. </span>Always Positive Comparison<a class="headerlink" href="#always-positive-comparison" title="Permalink to this headline">¶</a></h3>
<div class="section" id="case-magento-structures-nevernegative">
<span id="id87"></span><h4><span class="section-number">5.2.73.1. </span>Magento<a class="headerlink" href="#case-magento-structures-nevernegative" title="Permalink to this headline">¶</a></h4>
<p><a class="reference internal" href="Rules.html#always-positive-comparison"><span class="std std-ref">Always Positive Comparison</span></a>, in app/code/core/Mage/Dataflow/Model/Profile.php:85.</p>
<p>strlen(($actiosXML) will never be negative, and hence, is always false. This exception is never thrown.</p>
<div class="highlight-php notranslate"><div class="highlight"><pre><span></span><span class="k">if</span> <span class="p">(</span><span class="nb">strlen</span><span class="p">(</span><span class="nv">$actionsXML</span><span class="p">)</span> <span class="o">&lt;</span> <span class="mi">0</span> <span class="o">&amp;&amp;</span>
        <span class="o">@</span><span class="nb">simplexml_load_string</span><span class="p">(</span><span class="s1">&#39;&lt;data&gt;&#39;</span> <span class="o">.</span> <span class="nv">$actionsXML</span> <span class="o">.</span> <span class="s1">&#39;&lt;/data&gt;&#39;</span><span class="p">,</span> <span class="k">null</span><span class="p">,</span> <span class="nx">LIBXML_NOERROR</span><span class="p">)</span> <span class="o">===</span> <span class="k">false</span><span class="p">)</span> <span class="p">{</span>
            <span class="nx">Mage</span><span class="o">::</span><span class="na">throwException</span><span class="p">(</span><span class="nx">Mage</span><span class="o">::</span><span class="na">helper</span><span class="p">(</span><span class="s1">&#39;dataflow&#39;</span><span class="p">)</span><span class="o">-&gt;</span><span class="na">__</span><span class="p">(</span><span class="s2">&quot;Actions XML is not valid.&quot;</span><span class="p">));</span>
        <span class="p">}</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="next-month-trap">
<span id="case-next-month-trap"></span><h3><span class="section-number">5.2.74. </span>Next Month Trap<a class="headerlink" href="#next-month-trap" title="Permalink to this headline">¶</a></h3>
<div class="section" id="case-contao-structures-nextmonthtrap">
<span id="id88"></span><h4><span class="section-number">5.2.74.1. </span>Contao<a class="headerlink" href="#case-contao-structures-nextmonthtrap" title="Permalink to this headline">¶</a></h4>
<p><a class="reference internal" href="Rules.html#next-month-trap"><span class="std std-ref">Next Month Trap</span></a>, in system/modules/calendar/classes/Events.php:515.</p>
<p>This code is wrong on August 29,th 30th and 31rst : 6 months before is caculated here as February 31rst, so march 2. Of course, this depends on the leap years.</p>
<div class="highlight-php notranslate"><div class="highlight"><pre><span></span><span class="k">case</span> <span class="s1">&#39;past_180&#39;</span><span class="o">:</span>
                            <span class="k">return</span> <span class="k">array</span><span class="p">(</span><span class="nb">strtotime</span><span class="p">(</span><span class="s1">&#39;-6 months&#39;</span><span class="p">),</span> <span class="nb">time</span><span class="p">(),</span> <span class="nv">$GLOBALS</span><span class="p">[</span><span class="s1">&#39;TL_LANG&#39;</span><span class="p">][</span><span class="s1">&#39;MSC&#39;</span><span class="p">][</span><span class="s1">&#39;cal_empty&#39;</span><span class="p">]);</span>
</pre></div>
</div>
</div>
<div class="section" id="case-edusoho-structures-nextmonthtrap">
<span id="id89"></span><h4><span class="section-number">5.2.74.2. </span>Edusoho<a class="headerlink" href="#case-edusoho-structures-nextmonthtrap" title="Permalink to this headline">¶</a></h4>
<p><a class="reference internal" href="Rules.html#next-month-trap"><span class="std std-ref">Next Month Trap</span></a>, in src/AppBundle/Controller/Admin/AnalysisController.php:1426.</p>
<p>The last month is wrong 8 times a year : on 31rst, and by the end of March.</p>
<div class="highlight-php notranslate"><div class="highlight"><pre><span></span><span class="s1">&#39;lastMonthStart&#39;</span> <span class="o">=&gt;</span> <span class="nb">date</span><span class="p">(</span><span class="s1">&#39;Y-m-d&#39;</span><span class="p">,</span> <span class="nb">strtotime</span><span class="p">(</span><span class="nb">date</span><span class="p">(</span><span class="s1">&#39;Y-m&#39;</span><span class="p">,</span> <span class="nb">strtotime</span><span class="p">(</span><span class="s1">&#39;-1 month&#39;</span><span class="p">)))),</span>
            <span class="s1">&#39;lastMonthEnd&#39;</span> <span class="o">=&gt;</span> <span class="nb">date</span><span class="p">(</span><span class="s1">&#39;Y-m-d&#39;</span><span class="p">,</span> <span class="nb">strtotime</span><span class="p">(</span><span class="nb">date</span><span class="p">(</span><span class="s1">&#39;Y-m&#39;</span><span class="p">,</span> <span class="nb">time</span><span class="p">()))</span> <span class="o">-</span> <span class="mi">24</span> <span class="o">*</span> <span class="mi">3600</span><span class="p">),</span>
            <span class="s1">&#39;lastThreeMonthsStart&#39;</span> <span class="o">=&gt;</span> <span class="nb">date</span><span class="p">(</span><span class="s1">&#39;Y-m-d&#39;</span><span class="p">,</span> <span class="nb">strtotime</span><span class="p">(</span><span class="nb">date</span><span class="p">(</span><span class="s1">&#39;Y-m&#39;</span><span class="p">,</span> <span class="nb">strtotime</span><span class="p">(</span><span class="s1">&#39;-2 month&#39;</span><span class="p">)))),</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="no-choice">
<span id="case-no-choice"></span><h3><span class="section-number">5.2.75. </span>No Choice<a class="headerlink" href="#no-choice" title="Permalink to this headline">¶</a></h3>
<div class="section" id="nextcloud">
<span id="case-nextcloud-structures-nochoice"></span><h4><span class="section-number">5.2.75.1. </span>NextCloud<a class="headerlink" href="#nextcloud" title="Permalink to this headline">¶</a></h4>
<p><a class="reference internal" href="Rules.html#no-choice"><span class="std std-ref">No Choice</span></a>, in build/integration/features/bootstrap/FilesDropContext.php:71.</p>
<p>Token is checked, but processed in the same way each time. This actual check is done twice, in the same class, in the method droppingFileWith().</p>
<div class="highlight-php notranslate"><div class="highlight"><pre><span></span><span class="k">public</span> <span class="k">function</span> <span class="nf">creatingFolderInDrop</span><span class="p">(</span><span class="nv">$folder</span><span class="p">)</span> <span class="p">{</span>
            <span class="nv">$client</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Client</span><span class="p">();</span>
            <span class="nv">$options</span> <span class="o">=</span> <span class="p">[];</span>
            <span class="k">if</span> <span class="p">(</span><span class="nb">count</span><span class="p">(</span><span class="nv">$this</span><span class="o">-&gt;</span><span class="na">lastShareData</span><span class="o">-&gt;</span><span class="na">data</span><span class="o">-&gt;</span><span class="na">element</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">){</span>
                    <span class="nv">$token</span> <span class="o">=</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">lastShareData</span><span class="o">-&gt;</span><span class="na">data</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">-&gt;</span><span class="na">token</span><span class="p">;</span>
            <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
                    <span class="nv">$token</span> <span class="o">=</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">lastShareData</span><span class="o">-&gt;</span><span class="na">data</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">-&gt;</span><span class="na">token</span><span class="p">;</span>
            <span class="p">}</span>
            <span class="nv">$base</span> <span class="o">=</span> <span class="nb">substr</span><span class="p">(</span><span class="nv">$this</span><span class="o">-&gt;</span><span class="na">baseUrl</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="o">-</span><span class="mi">4</span><span class="p">);</span>
            <span class="nv">$fullUrl</span> <span class="o">=</span> <span class="nv">$base</span> <span class="o">.</span> <span class="s1">&#39;/public.php/webdav/&#39;</span> <span class="o">.</span> <span class="nv">$folder</span><span class="p">;</span>

            <span class="nv">$options</span><span class="p">[</span><span class="s1">&#39;auth&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="nv">$token</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">];</span>
</pre></div>
</div>
</div>
<div class="section" id="case-zencart-structures-nochoice">
<span id="id90"></span><h4><span class="section-number">5.2.75.2. </span>Zencart<a class="headerlink" href="#case-zencart-structures-nochoice" title="Permalink to this headline">¶</a></h4>
<p><a class="reference internal" href="Rules.html#no-choice"><span class="std std-ref">No Choice</span></a>, in admin/includes/functions/html_output.php:179.</p>
<p>At least, it always choose the most secure way : use SSL.</p>
<div class="highlight-php notranslate"><div class="highlight"><pre><span></span><span class="k">if</span> <span class="p">(</span><span class="nv">$usessl</span><span class="p">)</span> <span class="p">{</span>
        <span class="nv">$form</span> <span class="o">.=</span> <span class="nx">zen_href_link</span><span class="p">(</span><span class="nv">$action</span><span class="p">,</span> <span class="nv">$parameters</span><span class="p">,</span> <span class="s1">&#39;NONSSL&#39;</span><span class="p">);</span>
      <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
        <span class="nv">$form</span> <span class="o">.=</span> <span class="nx">zen_href_link</span><span class="p">(</span><span class="nv">$action</span><span class="p">,</span> <span class="nv">$parameters</span><span class="p">,</span> <span class="s1">&#39;NONSSL&#39;</span><span class="p">);</span>
      <span class="p">}</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="no-empty-regex">
<span id="case-no-empty-regex"></span><h3><span class="section-number">5.2.76. </span>No Empty Regex<a class="headerlink" href="#no-empty-regex" title="Permalink to this headline">¶</a></h3>
<div class="section" id="case-tikiwiki-structures-noemptyregex">
<span id="id91"></span><h4><span class="section-number">5.2.76.1. </span>Tikiwiki<a class="headerlink" href="#case-tikiwiki-structures-noemptyregex" title="Permalink to this headline">¶</a></h4>
<p><a class="reference internal" href="Rules.html#no-empty-regex"><span class="std std-ref">No Empty Regex</span></a>, in lib/sheet/excel/writer/worksheet.php:1925.</p>
<p>The initial ‘s’ seems to be too much. May be a typo ?</p>
<div class="highlight-php notranslate"><div class="highlight"><pre><span></span><span class="c1">// Strip URL type</span>
        <span class="nv">$url</span> <span class="o">=</span> <span class="nb">preg_replace</span><span class="p">(</span><span class="s1">&#39;s[^internal:]&#39;</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="nv">$url</span><span class="p">);</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="no-isset-with-empty">
<span id="case-no-isset-with-empty"></span><h3><span class="section-number">5.2.77. </span>No isset() With empty()<a class="headerlink" href="#no-isset-with-empty" title="Permalink to this headline">¶</a></h3>
<div class="section" id="case-xoops-structures-noissetwithempty">
<span id="id92"></span><h4><span class="section-number">5.2.77.1. </span>XOOPS<a class="headerlink" href="#case-xoops-structures-noissetwithempty" title="Permalink to this headline">¶</a></h4>
<p><a class="reference internal" href="Rules.html#no-isset-with-empty"><span class="std std-ref">No isset() With empty()</span></a>, in htdocs/class/tree.php:297.</p>
<p>Too much vlaidation</p>
<div class="highlight-php notranslate"><div class="highlight"><pre><span></span><span class="nb">isset</span><span class="p">(</span><span class="nv">$this</span><span class="o">-&gt;</span><span class="na">tree</span><span class="p">[</span><span class="nv">$key</span><span class="p">][</span><span class="s1">&#39;child&#39;</span><span class="p">])</span> <span class="o">&amp;&amp;</span> <span class="o">!</span><span class="k">empty</span><span class="p">(</span><span class="nv">$this</span><span class="o">-&gt;</span><span class="na">tree</span><span class="p">[</span><span class="nv">$key</span><span class="p">][</span><span class="s1">&#39;child&#39;</span><span class="p">]);</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="no-parenthesis-for-language-construct">
<span id="case-no-parenthesis-for-language-construct"></span><h3><span class="section-number">5.2.78. </span>No Parenthesis For Language Construct<a class="headerlink" href="#no-parenthesis-for-language-construct" title="Permalink to this headline">¶</a></h3>
<div class="section" id="case-phpdocumentor-structures-noparenthesisforlanguageconstruct">
<span id="id93"></span><h4><span class="section-number">5.2.78.1. </span>Phpdocumentor<a class="headerlink" href="#case-phpdocumentor-structures-noparenthesisforlanguageconstruct" title="Permalink to this headline">¶</a></h4>
<p><a class="reference internal" href="Rules.html#no-parenthesis-for-language-construct"><span class="std std-ref">No Parenthesis For Language Construct</span></a>, in src/Application/Renderer/Router/StandardRouter.php:55.</p>
<p>No need for parenthesis with require(). instanceof has a higher precedence than return anyway.</p>
<div class="highlight-php notranslate"><div class="highlight"><pre><span></span><span class="nv">$this</span><span class="p">[]</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Rule</span><span class="p">(</span><span class="k">function</span> <span class="p">(</span><span class="nv">$node</span><span class="p">)</span> <span class="p">{</span> <span class="k">return</span> <span class="p">(</span><span class="nv">$node</span> <span class="nx">instanceof</span> <span class="nx">NamespaceDescriptor</span><span class="p">);</span> <span class="p">},</span> <span class="nv">$namespaceGenerator</span><span class="p">);</span>
</pre></div>
</div>
</div>
<div class="section" id="case-phpmyadmin-structures-noparenthesisforlanguageconstruct">
<span id="id94"></span><h4><span class="section-number">5.2.78.2. </span>phpMyAdmin<a class="headerlink" href="#case-phpmyadmin-structures-noparenthesisforlanguageconstruct" title="Permalink to this headline">¶</a></h4>
<p><a class="reference internal" href="Rules.html#no-parenthesis-for-language-construct"><span class="std std-ref">No Parenthesis For Language Construct</span></a>, in db_datadict.php:170.</p>
<p>Not only echo() doesn’t use any parenthesis, but this syntax gives the illusion that echo() only accepts one argument, while it actually accepts an arbitrary number of argument.</p>
<div class="highlight-php notranslate"><div class="highlight"><pre><span></span><span class="k">echo</span> <span class="p">((</span><span class="nv">$row</span><span class="p">[</span><span class="s1">&#39;Null&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;NO&#39;</span><span class="p">)</span> <span class="o">?</span> <span class="nx">__</span><span class="p">(</span><span class="s1">&#39;No&#39;</span><span class="p">)</span> <span class="o">:</span> <span class="nx">__</span><span class="p">(</span><span class="s1">&#39;Yes&#39;</span><span class="p">))</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="avoid-substr-one">
<span id="case-avoid-substr-one"></span><h3><span class="section-number">5.2.79. </span>Avoid Substr() One<a class="headerlink" href="#avoid-substr-one" title="Permalink to this headline">¶</a></h3>
<div class="section" id="case-churchcrm-structures-nosubstrone">
<span id="id95"></span><h4><span class="section-number">5.2.79.1. </span>ChurchCRM<a class="headerlink" href="#case-churchcrm-structures-nosubstrone" title="Permalink to this headline">¶</a></h4>
<p><a class="reference internal" href="Rules.html#avoid-substr-one"><span class="std std-ref">Avoid Substr() One</span></a>, in src/Login.php:141.</p>
<p>No need to call substr() to get only one char.</p>
<div class="highlight-php notranslate"><div class="highlight"><pre><span></span><span class="k">if</span> <span class="p">(</span><span class="nb">substr</span><span class="p">(</span><span class="nv">$LocationFromGet</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span> <span class="o">==</span> <span class="s2">&quot;/&quot;</span><span class="p">)</span> <span class="p">{</span>
    <span class="nv">$LocationFromGet</span> <span class="o">=</span> <span class="nb">substr</span><span class="p">(</span><span class="nv">$LocationFromGet</span><span class="p">,</span> <span class="mi">1</span><span class="p">);</span>
<span class="p">}</span>
</pre></div>
</div>
</div>
<div class="section" id="case-livezilla-structures-nosubstrone">
<span id="id96"></span><h4><span class="section-number">5.2.79.2. </span>LiveZilla<a class="headerlink" href="#case-livezilla-structures-nosubstrone" title="Permalink to this headline">¶</a></h4>
<p><a class="reference internal" href="Rules.html#avoid-substr-one"><span class="std std-ref">Avoid Substr() One</span></a>, in livezilla/_lib/objects.global.inc.php:2243.</p>
<p>No need to call substr() to get only one char.</p>
<div class="highlight-php notranslate"><div class="highlight"><pre><span></span><span class="nv">$_hex</span> <span class="o">=</span> <span class="nb">str_replace</span><span class="p">(</span><span class="s2">&quot;#&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">,</span> <span class="nv">$_hex</span><span class="p">);</span>
            <span class="k">if</span><span class="p">(</span><span class="nb">strlen</span><span class="p">(</span><span class="nv">$_hex</span><span class="p">)</span> <span class="o">==</span> <span class="mi">3</span><span class="p">)</span> <span class="p">{</span>
            <span class="nv">$r</span> <span class="o">=</span> <span class="nb">hexdec</span><span class="p">(</span><span class="nb">substr</span><span class="p">(</span><span class="nv">$_hex</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">)</span><span class="o">.</span><span class="nb">substr</span><span class="p">(</span><span class="nv">$_hex</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">));</span>
            <span class="nv">$g</span> <span class="o">=</span> <span class="nb">hexdec</span><span class="p">(</span><span class="nb">substr</span><span class="p">(</span><span class="nv">$_hex</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">)</span><span class="o">.</span><span class="nb">substr</span><span class="p">(</span><span class="nv">$_hex</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">));</span>
            <span class="nv">$b</span> <span class="o">=</span> <span class="nb">hexdec</span><span class="p">(</span><span class="nb">substr</span><span class="p">(</span><span class="nv">$_hex</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">1</span><span class="p">)</span><span class="o">.</span><span class="nb">substr</span><span class="p">(</span><span class="nv">$_hex</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">1</span><span class="p">));</span>
        <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
            <span class="nv">$r</span> <span class="o">=</span> <span class="nb">hexdec</span><span class="p">(</span><span class="nb">substr</span><span class="p">(</span><span class="nv">$_hex</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">2</span><span class="p">));</span>
            <span class="nv">$g</span> <span class="o">=</span> <span class="nb">hexdec</span><span class="p">(</span><span class="nb">substr</span><span class="p">(</span><span class="nv">$_hex</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">2</span><span class="p">));</span>
            <span class="nv">$b</span> <span class="o">=</span> <span class="nb">hexdec</span><span class="p">(</span><span class="nb">substr</span><span class="p">(</span><span class="nv">$_hex</span><span class="p">,</span><span class="mi">4</span><span class="p">,</span><span class="mi">2</span><span class="p">));</span>
        <span class="p">}</span>
        <span class="nv">$rgb</span> <span class="o">=</span> <span class="k">array</span><span class="p">(</span><span class="nv">$r</span><span class="p">,</span> <span class="nv">$g</span><span class="p">,</span> <span class="nv">$b</span><span class="p">);</span>
        <span class="k">return</span> <span class="nv">$rgb</span><span class="p">;</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="operator">
<span id="case-operator"></span><h3><span class="section-number">5.2.80. </span>&#64; Operator<a class="headerlink" href="#operator" title="Permalink to this headline">¶</a></h3>
<div class="section" id="case-phinx-structures-noscream">
<span id="id97"></span><h4><span class="section-number">5.2.80.1. </span>Phinx<a class="headerlink" href="#case-phinx-structures-noscream" title="Permalink to this headline">¶</a></h4>
<p><a class="reference internal" href="Rules.html#operator"><span class="std std-ref">&#64; Operator</span></a>, in src/Phinx/Util/Util.php:239.</p>
<p>fopen() may be tested for existence, readability before using it. Although, it actually emits some errors on Windows, with network volumes.</p>
<div class="highlight-php notranslate"><div class="highlight"><pre><span></span><span class="nv">$isReadable</span> <span class="o">=</span> <span class="o">@</span><span class="nx">\fopen</span><span class="p">(</span><span class="nv">$filePath</span><span class="p">,</span> <span class="s1">&#39;r&#39;</span><span class="p">)</span> <span class="o">!==</span> <span class="k">false</span><span class="p">;</span>

        <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nv">$filePath</span> <span class="o">||</span> <span class="o">!</span><span class="nv">$isReadable</span><span class="p">)</span> <span class="p">{</span>
            <span class="k">throw</span> <span class="k">new</span> <span class="nx">\Exception</span><span class="p">(</span><span class="nb">sprintf</span><span class="p">(</span><span class="nx">Cannot</span> <span class="nx">open</span> <span class="nb">file</span> <span class="o">%</span><span class="nx">s</span> <span class="nx">\n</span><span class="p">,</span> <span class="nv">$filename</span><span class="p">));</span>
        <span class="p">}</span>
</pre></div>
</div>
</div>
<div class="section" id="case-phpipam-structures-noscream">
<span id="id98"></span><h4><span class="section-number">5.2.80.2. </span>PhpIPAM<a class="headerlink" href="#case-phpipam-structures-noscream" title="Permalink to this headline">¶</a></h4>
<p><a class="reference internal" href="Rules.html#operator"><span class="std std-ref">&#64; Operator</span></a>, in functions/classes/class.Log.php:322.</p>
<p>Variable and index existence should always be tested with isset() : it is faster than using <code class="docutils literal notranslate"><span class="pre">&#64;</span></code>.</p>
<div class="highlight-php notranslate"><div class="highlight"><pre><span></span><span class="nv">$_SESSION</span><span class="p">[</span><span class="s1">&#39;ipamusername&#39;</span><span class="p">]</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="not-not">
<span id="case-not-not"></span><h3><span class="section-number">5.2.81. </span>Not Not<a class="headerlink" href="#not-not" title="Permalink to this headline">¶</a></h3>
<div class="section" id="case-cleverstyle-structures-notnot">
<span id="id99"></span><h4><span class="section-number">5.2.81.1. </span>Cleverstyle<a class="headerlink" href="#case-cleverstyle-structures-notnot" title="Permalink to this headline">¶</a></h4>
<p><a class="reference internal" href="Rules.html#not-not"><span class="std std-ref">Not Not</span></a>, in modules/OAuth2/OAuth2.php:190.</p>
<p>This double-call returns <code class="docutils literal notranslate"><span class="pre">$results</span></code> as a boolean, preventing a spill of data to the calling method. The <code class="docutils literal notranslate"><span class="pre">(bool)</span></code> operator would be clearer here.</p>
<div class="highlight-php notranslate"><div class="highlight"><pre><span></span><span class="nv">$result</span> <span class="o">=</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">db_prime</span><span class="p">()</span><span class="o">-&gt;</span><span class="na">q</span><span class="p">(</span>
                    <span class="p">[</span>
                            <span class="nx">DELETE</span> <span class="nx">FROM</span> <span class="sb">`[prefix]oauth2_clients`</span>
                            <span class="nx">WHERE</span> <span class="sb">`id`</span> <span class="o">=</span> <span class="s1">&#39;%s&#39;</span><span class="p">,</span>
                            <span class="nx">DELETE</span> <span class="nx">FROM</span> <span class="sb">`[prefix]oauth2_clients_grant_access`</span>
                            <span class="nx">WHERE</span> <span class="sb">`id`</span>      <span class="o">=</span> <span class="s1">&#39;%s&#39;</span><span class="p">,</span>
                            <span class="nx">DELETE</span> <span class="nx">FROM</span> <span class="sb">`[prefix]oauth2_clients_sessions`</span>
                            <span class="nx">WHERE</span> <span class="sb">`id`</span>      <span class="o">=</span> <span class="s1">&#39;%s&#39;</span>
                    <span class="p">],</span>
                    <span class="nv">$id</span>
            <span class="p">);</span>
            <span class="nb">unset</span><span class="p">(</span><span class="nv">$this</span><span class="o">-&gt;</span><span class="na">cache</span><span class="o">-&gt;</span><span class="p">{</span><span class="s1">&#39;/&#39;</span><span class="p">});</span>
            <span class="k">return</span> <span class="o">!!</span><span class="nv">$result</span><span class="p">;</span>
</pre></div>
</div>
</div>
<div class="section" id="case-tine20-structures-notnot">
<span id="id100"></span><h4><span class="section-number">5.2.81.2. </span>Tine20<a class="headerlink" href="#case-tine20-structures-notnot" title="Permalink to this headline">¶</a></h4>
<p><a class="reference internal" href="Rules.html#not-not"><span class="std std-ref">Not Not</span></a>, in tine20/Calendar/Controller/MSEventFacade.php:392.</p>
<p>It seems that !! is almost superfluous, as a property called ‘is_deleted’ should already be a boolean.</p>
<div class="highlight-php notranslate"><div class="highlight"><pre><span></span><span class="k">foreach</span> <span class="p">(</span><span class="nv">$exceptions</span> <span class="k">as</span> <span class="nv">$exception</span><span class="p">)</span> <span class="p">{</span>
                <span class="nv">$exception</span><span class="o">-&gt;</span><span class="na">assertAttendee</span><span class="p">(</span><span class="nv">$this</span><span class="o">-&gt;</span><span class="na">getCalendarUser</span><span class="p">());</span>
                <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">_prepareException</span><span class="p">(</span><span class="nv">$savedEvent</span><span class="p">,</span> <span class="nv">$exception</span><span class="p">);</span>
                <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">_preserveMetaData</span><span class="p">(</span><span class="nv">$savedEvent</span><span class="p">,</span> <span class="nv">$exception</span><span class="p">,</span> <span class="k">true</span><span class="p">);</span>
                <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">_eventController</span><span class="o">-&gt;</span><span class="na">createRecurException</span><span class="p">(</span><span class="nv">$exception</span><span class="p">,</span> <span class="o">!!</span><span class="nv">$exception</span><span class="o">-&gt;</span><span class="na">is_deleted</span><span class="p">);</span>
            <span class="p">}</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="objects-don-t-need-references">
<span id="case-objects-don-t-need-references"></span><h3><span class="section-number">5.2.82. </span>Objects Don’t Need References<a class="headerlink" href="#objects-don-t-need-references" title="Permalink to this headline">¶</a></h3>
<div class="section" id="case-zencart-structures-objectreferences">
<span id="id101"></span><h4><span class="section-number">5.2.82.1. </span>Zencart<a class="headerlink" href="#case-zencart-structures-objectreferences" title="Permalink to this headline">¶</a></h4>
<p><a class="reference internal" href="Rules.html#objects-don-t-need-references"><span class="std std-ref">Objects Don’t Need References</span></a>, in includes/library/illuminate/support/helpers.php:484.</p>
<p>No need for &amp; operator when $class is only used for a method call.</p>
<div class="highlight-php notranslate"><div class="highlight"><pre><span></span><span class="sd">/**</span>
<span class="sd">     * @param $class</span>
<span class="sd">     * @param $eventID</span>
<span class="sd">     * @param array $paramsArray</span>
<span class="sd">     */</span>
    <span class="k">public</span> <span class="k">function</span> <span class="nf">updateNotifyCheckoutflowFinishedManageSuccessOrderLinkEnd</span><span class="p">(</span><span class="o">&amp;</span><span class="nv">$class</span><span class="p">,</span> <span class="nv">$eventID</span><span class="p">,</span> <span class="nv">$paramsArray</span> <span class="o">=</span> <span class="k">array</span><span class="p">())</span>
    <span class="p">{</span>
        <span class="nv">$class</span><span class="o">-&gt;</span><span class="na">getView</span><span class="p">()</span><span class="o">-&gt;</span><span class="na">getTplVarManager</span><span class="p">()</span><span class="o">-&gt;</span><span class="na">se</span><span class="p">(</span><span class="s1">&#39;flag_show_order_link&#39;</span><span class="p">,</span> <span class="k">false</span><span class="p">);</span>
    <span class="p">}</span>
</pre></div>
</div>
</div>
<div class="section" id="case-xoops-structures-objectreferences">
<span id="id102"></span><h4><span class="section-number">5.2.82.2. </span>XOOPS<a class="headerlink" href="#case-xoops-structures-objectreferences" title="Permalink to this headline">¶</a></h4>
<p><a class="reference internal" href="Rules.html#objects-don-t-need-references"><span class="std std-ref">Objects Don’t Need References</span></a>, in htdocs/class/theme_blocks.phps:221.</p>
<p>Here, $template is modified, when its properties are modified. When only the properties are modified, or read, then &amp; is not necessary.</p>
<div class="highlight-php notranslate"><div class="highlight"><pre><span></span><span class="k">public</span> <span class="k">function</span> <span class="nf">buildBlock</span><span class="p">(</span><span class="nv">$xobject</span><span class="p">,</span> <span class="o">&amp;</span><span class="nv">$template</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="c1">// The lame type workaround will change</span>
        <span class="c1">// bid is added temporarily as workaround for specific block manipulation</span>
        <span class="nv">$block</span> <span class="o">=</span> <span class="k">array</span><span class="p">(</span>
            <span class="s1">&#39;id&#39;</span>      <span class="o">=&gt;</span> <span class="nv">$xobject</span><span class="o">-&gt;</span><span class="na">getVar</span><span class="p">(</span><span class="s1">&#39;bid&#39;</span><span class="p">),</span>
            <span class="s1">&#39;module&#39;</span>  <span class="o">=&gt;</span> <span class="nv">$xobject</span><span class="o">-&gt;</span><span class="na">getVar</span><span class="p">(</span><span class="s1">&#39;dirname&#39;</span><span class="p">),</span>
            <span class="s1">&#39;title&#39;</span>   <span class="o">=&gt;</span> <span class="nv">$xobject</span><span class="o">-&gt;</span><span class="na">getVar</span><span class="p">(</span><span class="s1">&#39;title&#39;</span><span class="p">),</span>
            <span class="c1">// &#39;name&#39;        =&gt; strtolower( preg_replace( &#39;/[^0-9a-zA-Z_]/&#39;, &#39;&#39;, str_replace( &#39; &#39;, &#39;_&#39;, $xobject-&gt;getVar( &#39;name&#39; ) ) ) ),</span>
            <span class="s1">&#39;weight&#39;</span>  <span class="o">=&gt;</span> <span class="nv">$xobject</span><span class="o">-&gt;</span><span class="na">getVar</span><span class="p">(</span><span class="s1">&#39;weight&#39;</span><span class="p">),</span>
            <span class="s1">&#39;lastmod&#39;</span> <span class="o">=&gt;</span> <span class="nv">$xobject</span><span class="o">-&gt;</span><span class="na">getVar</span><span class="p">(</span><span class="s1">&#39;last_modified&#39;</span><span class="p">));</span>

        <span class="nv">$bcachetime</span> <span class="o">=</span> <span class="p">(</span><span class="nx">int</span><span class="p">)</span><span class="nv">$xobject</span><span class="o">-&gt;</span><span class="na">getVar</span><span class="p">(</span><span class="s1">&#39;bcachetime&#39;</span><span class="p">);</span>
        <span class="k">if</span> <span class="p">(</span><span class="k">empty</span><span class="p">(</span><span class="nv">$bcachetime</span><span class="p">))</span> <span class="p">{</span>
            <span class="nv">$template</span><span class="o">-&gt;</span><span class="na">caching</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
        <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
            <span class="nv">$template</span><span class="o">-&gt;</span><span class="na">caching</span>        <span class="o">=</span> <span class="mi">2</span><span class="p">;</span>
            <span class="nv">$template</span><span class="o">-&gt;</span><span class="na">cache_lifetime</span> <span class="o">=</span> <span class="nv">$bcachetime</span><span class="p">;</span>
        <span class="p">}</span>
        <span class="nv">$template</span><span class="o">-&gt;</span><span class="na">setCompileId</span><span class="p">(</span><span class="nv">$xobject</span><span class="o">-&gt;</span><span class="na">getVar</span><span class="p">(</span><span class="s1">&#39;dirname&#39;</span><span class="p">,</span> <span class="s1">&#39;n&#39;</span><span class="p">));</span>
        <span class="nv">$tplName</span> <span class="o">=</span> <span class="p">(</span><span class="nv">$tplName</span> <span class="o">=</span> <span class="nv">$xobject</span><span class="o">-&gt;</span><span class="na">getVar</span><span class="p">(</span><span class="s1">&#39;template&#39;</span><span class="p">))</span> <span class="o">?</span> <span class="nx">db</span><span class="o">:</span><span class="nv">$tplName</span> <span class="o">:</span> <span class="s1">&#39;db:system_block_dummy.tpl&#39;</span><span class="p">;</span>
        <span class="nv">$cacheid</span> <span class="o">=</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">generateCacheId</span><span class="p">(</span><span class="s1">&#39;blk_&#39;</span> <span class="o">.</span> <span class="nv">$xobject</span><span class="o">-&gt;</span><span class="na">getVar</span><span class="p">(</span><span class="s1">&#39;bid&#39;</span><span class="p">));</span>
<span class="c1">// more code to the end of the method</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="include-once-usage">
<span id="case-include-once-usage"></span><h3><span class="section-number">5.2.83. </span>include_once() Usage<a class="headerlink" href="#include-once-usage" title="Permalink to this headline">¶</a></h3>
<div class="section" id="case-xoops-structures-onceusage">
<span id="id103"></span><h4><span class="section-number">5.2.83.1. </span>XOOPS<a class="headerlink" href="#case-xoops-structures-onceusage" title="Permalink to this headline">¶</a></h4>
<p><a class="reference internal" href="Rules.html#include-once-usage"><span class="std std-ref">include_once() Usage</span></a>, in /htdocs/xoops_lib/modules/protector/admin/center.php:5.</p>
<p>Loading() classes should be down with autoload(). autload() may be build in several distinct functions, using spl_autoload_register().</p>
<div class="highlight-php notranslate"><div class="highlight"><pre><span></span><span class="k">require_once</span> <span class="nb">dirname</span><span class="p">(</span><span class="no">__DIR__</span><span class="p">)</span> <span class="o">.</span> <span class="s1">&#39;class/gtickets.php&#39;</span>
</pre></div>
</div>
</div>
<div class="section" id="case-tikiwiki-structures-onceusage">
<span id="id104"></span><h4><span class="section-number">5.2.83.2. </span>Tikiwiki<a class="headerlink" href="#case-tikiwiki-structures-onceusage" title="Permalink to this headline">¶</a></h4>
<p><a class="reference internal" href="Rules.html#include-once-usage"><span class="std std-ref">include_once() Usage</span></a>, in tiki-mytiki_shared.php :140.</p>
<p>Turn the code from tiki-mytiki_shared.php into a function or a method, and call it when needed.</p>
<div class="highlight-php notranslate"><div class="highlight"><pre><span></span><span class="k">include_once</span><span class="p">(</span><span class="s1">&#39;tiki-mytiki_shared.php&#39;</span><span class="p">);</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="or-die">
<span id="case-or-die"></span><h3><span class="section-number">5.2.84. </span>Or Die<a class="headerlink" href="#or-die" title="Permalink to this headline">¶</a></h3>
<div class="section" id="case-tine20-structures-ordie">
<span id="id105"></span><h4><span class="section-number">5.2.84.1. </span>Tine20<a class="headerlink" href="#case-tine20-structures-ordie" title="Permalink to this headline">¶</a></h4>
<p><a class="reference internal" href="Rules.html#or-die"><span class="std std-ref">Or Die</span></a>, in scripts/addgrant.php:34.</p>
<p>Typical error handling, which also displays the MySQL error message, and leaks informations about the system. One may also note that mysql_connect is not supported anymore, and was replaced with mysqli and pdo : this may be a backward compatibile file.</p>
<div class="highlight-php notranslate"><div class="highlight"><pre><span></span><span class="nv">$link</span> <span class="o">=</span> <span class="nb">mysql_connect</span><span class="p">(</span><span class="nv">$host</span><span class="p">,</span> <span class="nv">$user</span><span class="p">,</span> <span class="nv">$pass</span><span class="p">)</span> <span class="k">or</span> <span class="k">die</span><span class="p">(</span><span class="s2">&quot;No connection: &quot;</span> <span class="o">.</span> <span class="nb">mysql_error</span><span class="p">(</span> <span class="p">))</span>
</pre></div>
</div>
</div>
<div class="section" id="case-openconf-structures-ordie">
<span id="id106"></span><h4><span class="section-number">5.2.84.2. </span>OpenConf<a class="headerlink" href="#case-openconf-structures-ordie" title="Permalink to this headline">¶</a></h4>
<p><a class="reference internal" href="Rules.html#or-die"><span class="std std-ref">Or Die</span></a>, in openconf/chair/export.inc:143.</p>
<p>or die() is also applied to many situations, where a blocking situation arise. Here, with the creation of a temporary file.</p>
<div class="highlight-php notranslate"><div class="highlight"><pre><span></span><span class="nv">$coreFile</span> <span class="o">=</span> <span class="nb">tempnam</span><span class="p">(</span><span class="s1">&#39;/tmp/&#39;</span><span class="p">,</span> <span class="s1">&#39;ocexport&#39;</span><span class="p">)</span> <span class="k">or</span> <span class="k">die</span><span class="p">(</span><span class="s1">&#39;could not generate Excel file (6)&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="printf-number-of-arguments">
<span id="case-printf-number-of-arguments"></span><h3><span class="section-number">5.2.85. </span>Printf Number Of Arguments<a class="headerlink" href="#printf-number-of-arguments" title="Permalink to this headline">¶</a></h3>
<div class="section" id="case-phpipam-structures-printfarguments">
<span id="id107"></span><h4><span class="section-number">5.2.85.1. </span>PhpIPAM<a class="headerlink" href="#case-phpipam-structures-printfarguments" title="Permalink to this headline">¶</a></h4>
<p><a class="reference internal" href="Rules.html#printf-number-of-arguments"><span class="std std-ref">Printf Number Of Arguments</span></a>, in functions/classes/class.Common.php:1174.</p>
<p>16 will not be displayed.</p>
<div class="highlight-php notranslate"><div class="highlight"><pre><span></span><span class="nb">sprintf</span><span class="p">(</span><span class="s1">&#39;%032s&#39;</span><span class="p">,</span> <span class="nb">gmp_strval</span><span class="p">(</span><span class="nb">gmp_init</span><span class="p">(</span><span class="nv">$ipv6long</span><span class="p">,</span> <span class="mi">10</span><span class="p">),</span> <span class="mi">16</span><span class="p">);</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="repeated-print">
<span id="case-repeated-print"></span><h3><span class="section-number">5.2.86. </span>Repeated print()<a class="headerlink" href="#repeated-print" title="Permalink to this headline">¶</a></h3>
<div class="section" id="case-edusoho-structures-repeatedprint">
<span id="id108"></span><h4><span class="section-number">5.2.86.1. </span>Edusoho<a class="headerlink" href="#case-edusoho-structures-repeatedprint" title="Permalink to this headline">¶</a></h4>
<p><a class="reference internal" href="Rules.html#repeated-print"><span class="std std-ref">Repeated print()</span></a>, in app/check.php:71.</p>
<p>All echo may be merged into one : do this by turning the ; and . into ‘,’, and removing the superfluous echo. Also, echo_style may be turned into a non-display function, returning the build style, rather than echoing it to the output.</p>
<div class="highlight-php notranslate"><div class="highlight"><pre><span></span><span class="k">echo</span> <span class="nx">PHP_EOL</span><span class="p">;</span>
<span class="nx">echo_style</span><span class="p">(</span><span class="s1">&#39;title&#39;</span><span class="p">,</span> <span class="s1">&#39;Note&#39;</span><span class="p">);</span>
<span class="k">echo</span> <span class="s1">&#39;  The command console could use a different php.ini file&#39;</span><span class="o">.</span><span class="nx">PHP_EOL</span><span class="p">;</span>
<span class="nx">echo_style</span><span class="p">(</span><span class="s1">&#39;title&#39;</span><span class="p">,</span> <span class="s1">&#39;~~~~&#39;</span><span class="p">);</span>
<span class="k">echo</span> <span class="s1">&#39;  than the one used with your web server. To be on the&#39;</span><span class="o">.</span><span class="nx">PHP_EOL</span><span class="p">;</span>
<span class="k">echo</span> <span class="s1">&#39;      safe side, please check the requirements from your web&#39;</span><span class="o">.</span><span class="nx">PHP_EOL</span><span class="p">;</span>
<span class="k">echo</span> <span class="s1">&#39;      server using the &#39;</span><span class="p">;</span>
<span class="nx">echo_style</span><span class="p">(</span><span class="s1">&#39;yellow&#39;</span><span class="p">,</span> <span class="s1">&#39;web/config.php&#39;</span><span class="p">);</span>
<span class="k">echo</span> <span class="s1">&#39; script.&#39;</span><span class="o">.</span><span class="nx">PHP_EOL</span><span class="p">;</span>
<span class="k">echo</span> <span class="nx">PHP_EOL</span><span class="p">;</span>
</pre></div>
</div>
</div>
<div class="section" id="case-humo-gen-structures-repeatedprint">
<span id="id109"></span><h4><span class="section-number">5.2.86.2. </span>HuMo-Gen<a class="headerlink" href="#case-humo-gen-structures-repeatedprint" title="Permalink to this headline">¶</a></h4>
<p><a class="reference internal" href="Rules.html#repeated-print"><span class="std std-ref">Repeated print()</span></a>, in menu.php:71.</p>
<p>Simply calling print once is better than three times. Here too, echo usage would reduce the amount of memory allocation due to concatenation prior display.</p>
<div class="highlight-php notranslate"><div class="highlight"><pre><span></span><span class="k">print</span> <span class="s1">&#39;&lt;input type=text name=quicksearch value=.$quicksearch. size=10 &#39;</span><span class="o">.</span><span class="nv">$pattern</span><span class="o">.</span><span class="s1">&#39; title=.__(Minimum:).$min_chars.__(characters).&gt;&#39;</span><span class="p">;</span>
                    <span class="k">print</span> <span class="s1">&#39; &lt;input type=submit value=.__(Search).&gt;&#39;</span><span class="p">;</span>
            <span class="k">print</span> <span class="o">&lt;/</span><span class="nx">form</span><span class="o">&gt;</span><span class="p">;</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="repeated-regex">
<span id="case-repeated-regex"></span><h3><span class="section-number">5.2.87. </span>Repeated Regex<a class="headerlink" href="#repeated-regex" title="Permalink to this headline">¶</a></h3>
<div class="section" id="case-vanilla-structures-repeatedregex">
<span id="id110"></span><h4><span class="section-number">5.2.87.1. </span>Vanilla<a class="headerlink" href="#case-vanilla-structures-repeatedregex" title="Permalink to this headline">¶</a></h4>
<p><a class="reference internal" href="Rules.html#repeated-regex"><span class="std std-ref">Repeated Regex</span></a>, in library/core/class.pluginmanager.php:1200.</p>
<p>This regex is actually repeated 4 times across the Vanilla database, including this variation : ‘#^(https?:)?//#i’.</p>
<div class="highlight-php notranslate"><div class="highlight"><pre><span></span><span class="s1">&#39;`^https?://`&#39;</span>
</pre></div>
</div>
</div>
<div class="section" id="case-tikiwiki-structures-repeatedregex">
<span id="id111"></span><h4><span class="section-number">5.2.87.2. </span>Tikiwiki<a class="headerlink" href="#case-tikiwiki-structures-repeatedregex" title="Permalink to this headline">¶</a></h4>
<p><a class="reference internal" href="Rules.html#repeated-regex"><span class="std std-ref">Repeated Regex</span></a>, in tiki-login.php:369.</p>
<p>This regex is use twice, identically, in the same file, with a few line of distance. It may be federated at the file level.</p>
<div class="highlight-php notranslate"><div class="highlight"><pre><span></span><span class="nb">preg_match</span><span class="p">(</span><span class="s1">&#39;/(tiki-register|tiki-login_validate|tiki-login_scr)\.php/&#39;</span><span class="p">,</span> <span class="nv">$url</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="return-true-false">
<span id="case-return-true-false"></span><h3><span class="section-number">5.2.88. </span>Return True False<a class="headerlink" href="#return-true-false" title="Permalink to this headline">¶</a></h3>
<div class="section" id="case-mautic-structures-returntruefalse">
<span id="id112"></span><h4><span class="section-number">5.2.88.1. </span>Mautic<a class="headerlink" href="#case-mautic-structures-returntruefalse" title="Permalink to this headline">¶</a></h4>
<p><a class="reference internal" href="Rules.html#return-true-false"><span class="std std-ref">Return True False</span></a>, in app/bundles/LeadBundle/Model/ListModel.php:125.</p>
<p>$isNew could be a typecast.</p>
<div class="highlight-php notranslate"><div class="highlight"><pre><span></span><span class="nv">$isNew</span> <span class="o">=</span> <span class="p">(</span><span class="nv">$entity</span><span class="o">-&gt;</span><span class="na">getId</span><span class="p">())</span> <span class="o">?</span> <span class="k">false</span> <span class="o">:</span> <span class="k">true</span><span class="p">;</span>
</pre></div>
</div>
</div>
<div class="section" id="case-fuelcms-structures-returntruefalse">
<span id="id113"></span><h4><span class="section-number">5.2.88.2. </span>FuelCMS<a class="headerlink" href="#case-fuelcms-structures-returntruefalse" title="Permalink to this headline">¶</a></h4>
<p><a class="reference internal" href="Rules.html#return-true-false"><span class="std std-ref">Return True False</span></a>, in fuel/modules/fuel/helpers/validator_helper.php:254.</p>
<p>If/then is a lot of code to produce a boolean.</p>
<div class="highlight-php notranslate"><div class="highlight"><pre><span></span><span class="k">function</span> <span class="nf">length_min</span><span class="p">(</span><span class="nv">$str</span><span class="p">,</span> <span class="nv">$limit</span> <span class="o">=</span> <span class="mi">1</span><span class="p">)</span>
    <span class="p">{</span>
            <span class="k">if</span> <span class="p">(</span><span class="nb">strlen</span><span class="p">(</span><span class="nb">strval</span><span class="p">(</span><span class="nv">$str</span><span class="p">))</span> <span class="o">&lt;</span> <span class="nv">$limit</span><span class="p">)</span>
            <span class="p">{</span>
                    <span class="k">return</span> <span class="k">FALSE</span><span class="p">;</span>
            <span class="p">}</span>
            <span class="k">else</span>
            <span class="p">{</span>
                    <span class="k">return</span> <span class="k">TRUE</span><span class="p">;</span>
            <span class="p">}</span>
    <span class="p">}</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="same-conditions-in-condition">
<span id="case-same-conditions-in-condition"></span><h3><span class="section-number">5.2.89. </span>Same Conditions In Condition<a class="headerlink" href="#same-conditions-in-condition" title="Permalink to this headline">¶</a></h3>
<div class="section" id="case-teampass-structures-sameconditions">
<span id="id114"></span><h4><span class="section-number">5.2.89.1. </span>TeamPass<a class="headerlink" href="#case-teampass-structures-sameconditions" title="Permalink to this headline">¶</a></h4>
<p><a class="reference internal" href="Rules.html#same-conditions-in-condition"><span class="std std-ref">Same Conditions In Condition</span></a>, in sources/identify.php:1096.</p>
<p><cite>$result == 1</cite> is use once in the main if/then, then again the second if/then/elseif structure. Both are incompatible, since, in the else, <cite>$result</cite> will be different from 1.</p>
<div class="highlight-php notranslate"><div class="highlight"><pre><span></span><span class="k">if</span> <span class="p">(</span><span class="nv">$result</span> <span class="o">==</span> <span class="mi">1</span><span class="p">)</span> <span class="p">{</span>
                <span class="nv">$return</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span><span class="p">;</span>
                <span class="nv">$logError</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span><span class="p">;</span>
                <span class="nv">$proceedIdentification</span> <span class="o">=</span> <span class="k">true</span><span class="p">;</span>
                <span class="nv">$userPasswordVerified</span> <span class="o">=</span> <span class="k">false</span><span class="p">;</span>
                <span class="nb">unset</span><span class="p">(</span><span class="nv">$_SESSION</span><span class="p">[</span><span class="s1">&#39;hedgeId&#39;</span><span class="p">]);</span>
                <span class="nb">unset</span><span class="p">(</span><span class="nv">$_SESSION</span><span class="p">[</span><span class="s1">&#39;flickercode&#39;</span><span class="p">]);</span>
            <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
                <span class="k">if</span> <span class="p">(</span><span class="nv">$result</span> <span class="o">&lt;</span> <span class="o">-</span><span class="mi">10</span><span class="p">)</span> <span class="p">{</span>
                    <span class="nv">$logError</span> <span class="o">=</span> <span class="s2">&quot;ERROR: &quot;</span><span class="o">.</span><span class="nv">$result</span><span class="p">;</span>
                <span class="p">}</span> <span class="k">elseif</span> <span class="p">(</span><span class="nv">$result</span> <span class="o">==</span> <span class="o">-</span><span class="mi">4</span><span class="p">)</span> <span class="p">{</span>
                    <span class="nv">$logError</span> <span class="o">=</span> <span class="s2">&quot;Wrong response code, no more tries left.&quot;</span><span class="p">;</span>
                <span class="p">}</span> <span class="k">elseif</span> <span class="p">(</span><span class="nv">$result</span> <span class="o">==</span> <span class="o">-</span><span class="mi">3</span><span class="p">)</span> <span class="p">{</span>
                    <span class="nv">$logError</span> <span class="o">=</span> <span class="s2">&quot;Wrong response code, try to reenter.&quot;</span><span class="p">;</span>
                <span class="p">}</span> <span class="k">elseif</span> <span class="p">(</span><span class="nv">$result</span> <span class="o">==</span> <span class="o">-</span><span class="mi">2</span><span class="p">)</span> <span class="p">{</span>
                    <span class="nv">$logError</span> <span class="o">=</span> <span class="s2">&quot;Timeout. The response code is not valid anymore.&quot;</span><span class="p">;</span>
                <span class="p">}</span> <span class="k">elseif</span> <span class="p">(</span><span class="nv">$result</span> <span class="o">==</span> <span class="o">-</span><span class="mi">1</span><span class="p">)</span> <span class="p">{</span>
                    <span class="nv">$logError</span> <span class="o">=</span> <span class="s2">&quot;Security Error. Did you try to verify the response from a different computer?&quot;</span><span class="p">;</span>
                <span class="p">}</span> <span class="k">elseif</span> <span class="p">(</span><span class="nv">$result</span> <span class="o">==</span> <span class="mi">1</span><span class="p">)</span> <span class="p">{</span>
                    <span class="nv">$logError</span> <span class="o">=</span> <span class="s2">&quot;Authentication successful, response code correct.</span>
<span class="s2">                          &lt;br /&gt;&lt;br /&gt;Authentification Method for SecureBrowser updated!&quot;</span><span class="p">;</span>
                    <span class="c1">// Add necessary code here for accessing your Business Application</span>
                <span class="p">}</span>
                <span class="nv">$return</span> <span class="o">=</span> <span class="s2">&quot;agses_error&quot;</span><span class="p">;</span>
                <span class="k">echo</span> <span class="s1">&#39;[{&quot;value&quot; : &quot;&#39;</span><span class="o">.</span><span class="nv">$return</span><span class="o">.</span><span class="s1">&#39;&quot;, &quot;user_admin&quot;:&quot;&#39;</span><span class="p">,</span>
                <span class="nb">isset</span><span class="p">(</span><span class="nv">$_SESSION</span><span class="p">[</span><span class="s1">&#39;user_admin&#39;</span><span class="p">])</span> <span class="o">?</span> <span class="nv">$_SESSION</span><span class="p">[</span><span class="s1">&#39;user_admin&#39;</span><span class="p">]</span> <span class="o">:</span> <span class="s2">&quot;&quot;</span><span class="p">,</span>
                <span class="s1">&#39;&quot;, &quot;initial_url&quot; : &quot;&#39;</span><span class="o">.@</span><span class="nv">$_SESSION</span><span class="p">[</span><span class="s1">&#39;initial_url&#39;</span><span class="p">]</span><span class="o">.</span><span class="s1">&#39;&quot;,</span>
<span class="s1">                &quot;error&quot; : &quot;&#39;</span><span class="o">.</span><span class="nv">$logError</span><span class="o">.</span><span class="s1">&#39;&quot;}]&#39;</span><span class="p">;</span>

                <span class="k">exit</span><span class="p">();</span>
            <span class="p">}</span>
</pre></div>
</div>
</div>
<div class="section" id="case-typo3-structures-sameconditions">
<span id="id115"></span><h4><span class="section-number">5.2.89.2. </span>Typo3<a class="headerlink" href="#case-typo3-structures-sameconditions" title="Permalink to this headline">¶</a></h4>
<p><a class="reference internal" href="Rules.html#same-conditions-in-condition"><span class="std std-ref">Same Conditions In Condition</span></a>, in typo3/sysext/recordlist/Classes/RecordList/DatabaseRecordList.php:1696.</p>
<p><cite>$table == ‘pages</cite> is caught initially, and if it fails, it is tested again in the final else. This won’t happen.</p>
<div class="highlight-php notranslate"><div class="highlight"><pre><span></span><span class="p">}</span> <span class="k">elseif</span> <span class="p">(</span><span class="nv">$table</span> <span class="o">===</span> <span class="s1">&#39;pages&#39;</span><span class="p">)</span> <span class="p">{</span>
                                <span class="nv">$parameters</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;id&#39;</span> <span class="o">=&gt;</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">id</span><span class="p">,</span> <span class="s1">&#39;pagesOnly&#39;</span> <span class="o">=&gt;</span> <span class="mi">1</span><span class="p">,</span> <span class="s1">&#39;returnUrl&#39;</span> <span class="o">=&gt;</span> <span class="nx">GeneralUtility</span><span class="o">::</span><span class="na">getIndpEnv</span><span class="p">(</span><span class="s1">&#39;REQUEST_URI&#39;</span><span class="p">)];</span>
                                <span class="nv">$href</span> <span class="o">=</span> <span class="p">(</span><span class="nx">string</span><span class="p">)</span><span class="nv">$uriBuilder</span><span class="o">-&gt;</span><span class="na">buildUriFromRoute</span><span class="p">(</span><span class="s1">&#39;db_new&#39;</span><span class="p">,</span> <span class="nv">$parameters</span><span class="p">);</span>
                                <span class="nv">$icon</span> <span class="o">=</span> <span class="s1">&#39;&lt;a class=&quot;btn btn-default&quot; href=&quot;&#39;</span> <span class="o">.</span> <span class="nb">htmlspecialchars</span><span class="p">(</span><span class="nv">$href</span><span class="p">)</span> <span class="o">.</span> <span class="s1">&#39;&quot; title=&quot;&#39;</span> <span class="o">.</span> <span class="nb">htmlspecialchars</span><span class="p">(</span><span class="nv">$lang</span><span class="o">-&gt;</span><span class="na">getLL</span><span class="p">(</span><span class="s1">&#39;new&#39;</span><span class="p">))</span> <span class="o">.</span> <span class="s1">&#39;&quot;&gt;&#39;</span>
                                    <span class="o">.</span> <span class="nv">$spriteIcon</span><span class="o">-&gt;</span><span class="na">render</span><span class="p">()</span> <span class="o">.</span> <span class="s1">&#39;&lt;/a&gt;&#39;</span><span class="p">;</span>
                            <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
                                <span class="nv">$params</span> <span class="o">=</span> <span class="s1">&#39;&amp;edit[&#39;</span> <span class="o">.</span> <span class="nv">$table</span> <span class="o">.</span> <span class="s1">&#39;][&#39;</span> <span class="o">.</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">id</span> <span class="o">.</span> <span class="s1">&#39;]=new&#39;</span><span class="p">;</span>
                                <span class="k">if</span> <span class="p">(</span><span class="nv">$table</span> <span class="o">===</span> <span class="s1">&#39;pages&#39;</span><span class="p">)</span> <span class="p">{</span>
                                    <span class="nv">$params</span> <span class="o">.=</span> <span class="s1">&#39;&amp;overrideVals[pages][doktype]=&#39;</span> <span class="o">.</span> <span class="p">(</span><span class="nx">int</span><span class="p">)</span><span class="nv">$this</span><span class="o">-&gt;</span><span class="na">pageRow</span><span class="p">[</span><span class="s1">&#39;doktype&#39;</span><span class="p">];</span>
                                <span class="p">}</span>
                                <span class="nv">$icon</span> <span class="o">=</span> <span class="s1">&#39;&lt;a class=&quot;btn btn-default&quot; href=&quot;#&quot; onclick=&quot;&#39;</span> <span class="o">.</span> <span class="nb">htmlspecialchars</span><span class="p">(</span><span class="nx">BackendUtility</span><span class="o">::</span><span class="na">editOnClick</span><span class="p">(</span><span class="nv">$params</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">))</span>
                                    <span class="o">.</span> <span class="s1">&#39;&quot; title=&quot;&#39;</span> <span class="o">.</span> <span class="nb">htmlspecialchars</span><span class="p">(</span><span class="nv">$lang</span><span class="o">-&gt;</span><span class="na">getLL</span><span class="p">(</span><span class="s1">&#39;new&#39;</span><span class="p">))</span> <span class="o">.</span> <span class="s1">&#39;&quot;&gt;&#39;</span> <span class="o">.</span> <span class="nv">$spriteIcon</span><span class="o">-&gt;</span><span class="na">render</span><span class="p">()</span> <span class="o">.</span> <span class="s1">&#39;&lt;/a&gt;&#39;</span><span class="p">;</span>
                            <span class="p">}</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="should-chain-exception">
<span id="case-should-chain-exception"></span><h3><span class="section-number">5.2.90. </span>Should Chain Exception<a class="headerlink" href="#should-chain-exception" title="Permalink to this headline">¶</a></h3>
<div class="section" id="case-magento-structures-shouldchainexception">
<span id="id116"></span><h4><span class="section-number">5.2.90.1. </span>Magento<a class="headerlink" href="#case-magento-structures-shouldchainexception" title="Permalink to this headline">¶</a></h4>
<p><a class="reference internal" href="Rules.html#should-chain-exception"><span class="std std-ref">Should Chain Exception</span></a>, in lib/Mage/Backup/Filesystem/Rollback/Ftp.php:81.</p>
<p>Instead of using the exception message as an argument, chaining the exception would send the whole exception, including the message, and other interesting information like file and line.</p>
<div class="highlight-php notranslate"><div class="highlight"><pre><span></span><span class="k">protected</span> <span class="k">function</span> <span class="nf">_initFtpClient</span><span class="p">()</span>
    <span class="p">{</span>
        <span class="k">try</span> <span class="p">{</span>
            <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">_ftpClient</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Mage_System_Ftp</span><span class="p">();</span>
            <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">_ftpClient</span><span class="o">-&gt;</span><span class="na">connect</span><span class="p">(</span><span class="nv">$this</span><span class="o">-&gt;</span><span class="na">_snapshot</span><span class="o">-&gt;</span><span class="na">getFtpConnectString</span><span class="p">());</span>
        <span class="p">}</span> <span class="k">catch</span> <span class="p">(</span><span class="nx">Exception</span> <span class="nv">$e</span><span class="p">)</span> <span class="p">{</span>
            <span class="k">throw</span> <span class="k">new</span> <span class="nx">Mage_Backup_Exception_FtpConnectionFailed</span><span class="p">(</span><span class="nv">$e</span><span class="o">-&gt;</span><span class="na">getMessage</span><span class="p">());</span>
        <span class="p">}</span>
    <span class="p">}</span>
</pre></div>
</div>
</div>
<div class="section" id="case-tine20-structures-shouldchainexception">
<span id="id117"></span><h4><span class="section-number">5.2.90.2. </span>Tine20<a class="headerlink" href="#case-tine20-structures-shouldchainexception" title="Permalink to this headline">¶</a></h4>
<p><a class="reference internal" href="Rules.html#should-chain-exception"><span class="std std-ref">Should Chain Exception</span></a>, in tine20/Setup/Controller.php:81.</p>
<p>Here, the new exception gets an hardcoded message. More details about the reasons are already available in the $e exception, but they are not logged, not chained for later processing.</p>
<div class="highlight-php notranslate"><div class="highlight"><pre><span></span><span class="k">try</span> <span class="p">{</span>
            <span class="nv">$dirIterator</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">DirectoryIterator</span><span class="p">(</span><span class="nv">$this</span><span class="o">-&gt;</span><span class="na">_baseDir</span><span class="p">);</span>
        <span class="p">}</span> <span class="k">catch</span> <span class="p">(</span><span class="nx">Exception</span> <span class="nv">$e</span><span class="p">)</span> <span class="p">{</span>
            <span class="nx">Setup_Core</span><span class="o">::</span><span class="na">getLogger</span><span class="p">()</span><span class="o">-&gt;</span><span class="na">warn</span><span class="p">(</span><span class="no">__METHOD__</span> <span class="o">.</span> <span class="s1">&#39;::&#39;</span> <span class="o">.</span> <span class="no">__LINE__</span> <span class="o">.</span> <span class="s1">&#39; Could not open base dir: &#39;</span> <span class="o">.</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">_baseDir</span><span class="p">);</span>
            <span class="k">throw</span> <span class="k">new</span> <span class="nx">Tinebase_Exception_AccessDenied</span><span class="p">(</span><span class="s1">&#39;Could not open Tine 2.0 root directory.&#39;</span><span class="p">);</span>
        <span class="p">}</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="should-make-ternary">
<span id="case-should-make-ternary"></span><h3><span class="section-number">5.2.91. </span>Should Make Ternary<a class="headerlink" href="#should-make-ternary" title="Permalink to this headline">¶</a></h3>
<div class="section" id="case-churchcrm-structures-shouldmaketernary">
<span id="id118"></span><h4><span class="section-number">5.2.91.1. </span>ChurchCRM<a class="headerlink" href="#case-churchcrm-structures-shouldmaketernary" title="Permalink to this headline">¶</a></h4>
<p><a class="reference internal" href="Rules.html#should-make-ternary"><span class="std std-ref">Should Make Ternary</span></a>, in src/CartToFamily.php:57.</p>
<p>$sState could be the receiving part of a ternary operator.</p>
<div class="highlight-php notranslate"><div class="highlight"><pre><span></span><span class="k">if</span> <span class="p">(</span><span class="nv">$sCountry</span> <span class="o">==</span> <span class="s1">&#39;United States&#39;</span> <span class="o">||</span> <span class="nv">$sCountry</span> <span class="o">==</span> <span class="s1">&#39;Canada&#39;</span><span class="p">)</span> <span class="p">{</span>
            <span class="nv">$sState</span> <span class="o">=</span> <span class="nx">InputUtils</span><span class="o">::</span><span class="na">LegacyFilterInput</span><span class="p">(</span><span class="nv">$_POST</span><span class="p">[</span><span class="s1">&#39;State&#39;</span><span class="p">]);</span>
        <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
            <span class="nv">$sState</span> <span class="o">=</span> <span class="nx">InputUtils</span><span class="o">::</span><span class="na">LegacyFilterInput</span><span class="p">(</span><span class="nv">$_POST</span><span class="p">[</span><span class="s1">&#39;StateTextbox&#39;</span><span class="p">]);</span>
        <span class="p">}</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="strpos-like-comparison">
<span id="case-strpos-like-comparison"></span><h3><span class="section-number">5.2.92. </span>Strpos()-like Comparison<a class="headerlink" href="#strpos-like-comparison" title="Permalink to this headline">¶</a></h3>
<div class="section" id="case-piwigo-structures-strposcompare">
<span id="id119"></span><h4><span class="section-number">5.2.92.1. </span>Piwigo<a class="headerlink" href="#case-piwigo-structures-strposcompare" title="Permalink to this headline">¶</a></h4>
<p><a class="reference internal" href="Rules.html#strpos-like-comparison"><span class="std std-ref">Strpos()-like Comparison</span></a>, in admin/include/functions.php:2585.</p>
<p>preg_match may return 0 if not found, and null if the $pattern is erroneous. While hardcoded regex may be checked at compile time, dynamically built regex may fail at execution time. This is particularly important here, since the function may be called with incoming data for maintenance : ‘clear_derivative_cache($_GET[‘type’]);’ is in the /admin/maintenance.php.</p>
<div class="highlight-php notranslate"><div class="highlight"><pre><span></span><span class="k">function</span> <span class="nf">clear_derivative_cache_rec</span><span class="p">(</span><span class="nv">$path</span><span class="p">,</span> <span class="nv">$pattern</span><span class="p">)</span>
<span class="p">{</span>
  <span class="nv">$rmdir</span> <span class="o">=</span> <span class="k">true</span><span class="p">;</span>
  <span class="nv">$rm_index</span> <span class="o">=</span> <span class="k">false</span><span class="p">;</span>

  <span class="k">if</span> <span class="p">(</span><span class="nv">$contents</span> <span class="o">=</span> <span class="nb">opendir</span><span class="p">(</span><span class="nv">$path</span><span class="p">))</span>
  <span class="p">{</span>
    <span class="k">while</span> <span class="p">((</span><span class="nv">$node</span> <span class="o">=</span> <span class="nb">readdir</span><span class="p">(</span><span class="nv">$contents</span><span class="p">))</span> <span class="o">!==</span> <span class="k">false</span><span class="p">)</span>
    <span class="p">{</span>
      <span class="k">if</span> <span class="p">(</span><span class="nv">$node</span> <span class="o">==</span> <span class="s1">&#39;.&#39;</span> <span class="k">or</span> <span class="nv">$node</span> <span class="o">==</span> <span class="s1">&#39;..&#39;</span><span class="p">)</span>
        <span class="k">continue</span><span class="p">;</span>
      <span class="k">if</span> <span class="p">(</span><span class="nb">is_dir</span><span class="p">(</span><span class="nv">$path</span><span class="o">.</span><span class="s1">&#39;/&#39;</span><span class="o">.</span><span class="nv">$node</span><span class="p">))</span>
      <span class="p">{</span>
        <span class="nv">$rmdir</span> <span class="o">&amp;=</span> <span class="nx">clear_derivative_cache_rec</span><span class="p">(</span><span class="nv">$path</span><span class="o">.</span><span class="s1">&#39;/&#39;</span><span class="o">.</span><span class="nv">$node</span><span class="p">,</span> <span class="nv">$pattern</span><span class="p">);</span>
      <span class="p">}</span>
      <span class="k">else</span>
      <span class="p">{</span>
        <span class="k">if</span> <span class="p">(</span><span class="nb">preg_match</span><span class="p">(</span><span class="nv">$pattern</span><span class="p">,</span> <span class="nv">$node</span><span class="p">))</span>
</pre></div>
</div>
</div>
<div class="section" id="case-thelia-structures-strposcompare">
<span id="id120"></span><h4><span class="section-number">5.2.92.2. </span>Thelia<a class="headerlink" href="#case-thelia-structures-strposcompare" title="Permalink to this headline">¶</a></h4>
<p><a class="reference internal" href="Rules.html#strpos-like-comparison"><span class="std std-ref">Strpos()-like Comparison</span></a>, in core/lib/Thelia/Controller/Admin/FileController.php:198.</p>
<p>preg_match is used here to identify files with a forbidden extension. The actual list of extension is provided to the method via the parameter $extBlackList, which is an array. In case of mis-configuration by the user of this array, preg_match may fail : for example, when regex special characters are provided. At that point, the whole filter becomes invalid, and can’t distinguish good files (returning false) and other files (returning NULL). It is safe to use === false in this situation.</p>
<div class="highlight-php notranslate"><div class="highlight"><pre><span></span><span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="k">empty</span><span class="p">(</span><span class="nv">$extBlackList</span><span class="p">))</span> <span class="p">{</span>
            <span class="nv">$regex</span> <span class="o">=</span> <span class="s2">&quot;#^(.+)\.(&quot;</span><span class="o">.</span><span class="nb">implode</span><span class="p">(</span><span class="s2">&quot;|&quot;</span><span class="p">,</span> <span class="nv">$extBlackList</span><span class="p">)</span><span class="o">.</span><span class="s2">&quot;)$#i&quot;</span><span class="p">;</span>

            <span class="k">if</span> <span class="p">(</span><span class="nb">preg_match</span><span class="p">(</span><span class="nv">$regex</span><span class="p">,</span> <span class="nv">$realFileName</span><span class="p">))</span> <span class="p">{</span>
                <span class="nv">$message</span> <span class="o">=</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">getTranslator</span><span class="p">()</span>
                    <span class="o">-&gt;</span><span class="na">trans</span><span class="p">(</span>
                        <span class="s1">&#39;Files with the following extension are not allowed: %extension, please do an archive of the file if you want to upload it&#39;</span><span class="p">,</span>
                        <span class="p">[</span>
                            <span class="s1">&#39;%extension&#39;</span> <span class="o">=&gt;</span> <span class="nv">$fileBeingUploaded</span><span class="o">-&gt;</span><span class="na">getClientOriginalExtension</span><span class="p">(),</span>
                        <span class="p">]</span>
                    <span class="p">);</span>
            <span class="p">}</span>
        <span class="p">}</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="switch-without-default">
<span id="case-switch-without-default"></span><h3><span class="section-number">5.2.93. </span>Switch Without Default<a class="headerlink" href="#switch-without-default" title="Permalink to this headline">¶</a></h3>
<div class="section" id="case-zencart-structures-switchwithoutdefault">
<span id="id121"></span><h4><span class="section-number">5.2.93.1. </span>Zencart<a class="headerlink" href="#case-zencart-structures-switchwithoutdefault" title="Permalink to this headline">¶</a></h4>
<p><a class="reference internal" href="Rules.html#switch-without-default"><span class="std std-ref">Switch Without Default</span></a>, in admin/tax_rates.php:15.</p>
<p>The ‘action’ is collected from $_GET and then, compared with various strings to handle the different actions to be taken. The default behavior is implicit here : if no ‘action’, display the initial form for taxes to be changed. This has to be understood as a general philosophy of ZenCart project, or by reading the rest of the HTML code. Adding a ‘default’ case here would help understand what happens in case ‘action’ is absent or unrecognized.</p>
<div class="highlight-php notranslate"><div class="highlight"><pre><span></span><span class="nv">$action</span> <span class="o">=</span> <span class="p">(</span><span class="nb">isset</span><span class="p">(</span><span class="nv">$_GET</span><span class="p">[</span><span class="s1">&#39;action&#39;</span><span class="p">])</span> <span class="o">?</span> <span class="nv">$_GET</span><span class="p">[</span><span class="s1">&#39;action&#39;</span><span class="p">]</span> <span class="o">:</span> <span class="s1">&#39;&#39;</span><span class="p">);</span>

  <span class="k">if</span> <span class="p">(</span><span class="nx">zen_not_null</span><span class="p">(</span><span class="nv">$action</span><span class="p">))</span> <span class="p">{</span>
    <span class="k">switch</span> <span class="p">(</span><span class="nv">$action</span><span class="p">)</span> <span class="p">{</span>
      <span class="k">case</span> <span class="s1">&#39;insert&#39;</span><span class="o">:</span>
        <span class="c1">// PHP code</span>
        <span class="k">break</span><span class="p">;</span>
      <span class="k">case</span> <span class="s1">&#39;save&#39;</span><span class="o">:</span>
        <span class="c1">// PHP code</span>
        <span class="k">break</span><span class="p">;</span>
      <span class="k">case</span> <span class="s1">&#39;deleteconfirm&#39;</span><span class="o">:</span>
        <span class="c1">// PHP code</span>
        <span class="k">break</span><span class="p">;</span>
    <span class="p">}</span>
  <span class="p">}</span>
<span class="cp">?&gt;</span><span class="x"> .... HTML code</span>
</pre></div>
</div>
</div>
<div class="section" id="case-traq-structures-switchwithoutdefault">
<span id="id122"></span><h4><span class="section-number">5.2.93.2. </span>Traq<a class="headerlink" href="#case-traq-structures-switchwithoutdefault" title="Permalink to this headline">¶</a></h4>
<p><a class="reference internal" href="Rules.html#switch-without-default"><span class="std std-ref">Switch Without Default</span></a>, in src/Helpers/Ticketlist.php:311.</p>
<p>The default case is actually processed after the switch, by the next if/then structure. The structure deals with the customFields, while the else deals with any unknown situations. This if/then could be wrapped in the ‘default’ case of switch, for consistent processing. The if/then condition would be hard to use as a ‘case’ (possible, though).</p>
<div class="highlight-php notranslate"><div class="highlight"><pre><span></span><span class="k">public</span> <span class="k">static</span> <span class="k">function</span> <span class="nf">dataFor</span><span class="p">(</span><span class="nv">$column</span><span class="p">,</span> <span class="nv">$ticket</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="k">switch</span> <span class="p">(</span><span class="nv">$column</span><span class="p">)</span> <span class="p">{</span>
            <span class="c1">// Ticket ID column</span>
            <span class="k">case</span> <span class="s1">&#39;ticket_id&#39;</span><span class="o">:</span>
                <span class="k">return</span> <span class="nv">$ticket</span><span class="p">[</span><span class="s1">&#39;ticket_id&#39;</span><span class="p">];</span>
                <span class="k">break</span><span class="p">;</span>

            <span class="c1">// Status column</span>
            <span class="k">case</span> <span class="s1">&#39;status&#39;</span><span class="o">:</span>
            <span class="k">case</span> <span class="s1">&#39;type&#39;</span><span class="o">:</span>
            <span class="k">case</span> <span class="s1">&#39;component&#39;</span><span class="o">:</span>
            <span class="k">case</span> <span class="s1">&#39;priority&#39;</span><span class="o">:</span>
            <span class="k">case</span> <span class="s1">&#39;severity&#39;</span><span class="o">:</span>
                <span class="k">return</span> <span class="nv">$ticket</span><span class="p">[{</span><span class="nv">$column</span><span class="p">}</span><span class="nx">_name</span><span class="p">];</span>
                <span class="k">break</span><span class="p">;</span>

            <span class="c1">// Votes</span>
            <span class="k">case</span> <span class="s1">&#39;votes&#39;</span><span class="o">:</span>
                <span class="k">return</span> <span class="nv">$ticket</span><span class="p">[</span><span class="s1">&#39;votes&#39;</span><span class="p">];</span>
                <span class="k">break</span><span class="p">;</span>
        <span class="p">}</span>

        <span class="c1">// If we&#39;re still here, it may be a custom field</span>
        <span class="k">if</span> <span class="p">(</span><span class="nv">$value</span> <span class="o">=</span> <span class="nv">$ticket</span><span class="o">-&gt;</span><span class="na">customFieldValue</span><span class="p">(</span><span class="nv">$column</span><span class="p">))</span> <span class="p">{</span>
            <span class="k">return</span> <span class="nv">$value</span><span class="o">-&gt;</span><span class="na">value</span><span class="p">;</span>
        <span class="p">}</span>

        <span class="c1">// Nothing!</span>
        <span class="k">return</span> <span class="s1">&#39;&#39;</span><span class="p">;</span>
    <span class="p">}</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="ternary-in-concat">
<span id="case-ternary-in-concat"></span><h3><span class="section-number">5.2.94. </span>Ternary In Concat<a class="headerlink" href="#ternary-in-concat" title="Permalink to this headline">¶</a></h3>
<div class="section" id="case-teampass-structures-ternaryinconcat">
<span id="id123"></span><h4><span class="section-number">5.2.94.1. </span>TeamPass<a class="headerlink" href="#case-teampass-structures-ternaryinconcat" title="Permalink to this headline">¶</a></h4>
<p><a class="reference internal" href="Rules.html#ternary-in-concat"><span class="std std-ref">Ternary In Concat</span></a>, in includes/libraries/protect/AntiXSS/UTF8.php:5409.</p>
<p>The concatenations in the initial comparison are disguised casting. When $str2 is empty too, the ternary operator yields a 0, leading to a systematic failure.</p>
<div class="highlight-php notranslate"><div class="highlight"><pre><span></span><span class="nv">$str1</span> <span class="o">.</span> <span class="s1">&#39;&#39;</span> <span class="o">===</span> <span class="nv">$str2</span> <span class="o">.</span> <span class="s1">&#39;&#39;</span> <span class="o">?</span> <span class="mi">0</span> <span class="o">:</span> <span class="nb">strnatcmp</span><span class="p">(</span><span class="nx">self</span><span class="o">::</span><span class="na">strtonatfold</span><span class="p">(</span><span class="nv">$str1</span><span class="p">),</span> <span class="nx">self</span><span class="o">::</span><span class="na">strtonatfold</span><span class="p">(</span><span class="nv">$str2</span><span class="p">))</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="timestamp-difference">
<span id="case-timestamp-difference"></span><h3><span class="section-number">5.2.95. </span>Timestamp Difference<a class="headerlink" href="#timestamp-difference" title="Permalink to this headline">¶</a></h3>
<div class="section" id="case-zurmo-structures-timestampdifference">
<span id="id124"></span><h4><span class="section-number">5.2.95.1. </span>Zurmo<a class="headerlink" href="#case-zurmo-structures-timestampdifference" title="Permalink to this headline">¶</a></h4>
<p><a class="reference internal" href="Rules.html#timestamp-difference"><span class="std std-ref">Timestamp Difference</span></a>, in app/protected/modules/import/jobs/ImportCleanupJob.php:73.</p>
<p>This is wrong twice a year, in countries that has day-ligth saving time. One of the weeks will be too short, and the other will be too long.</p>
<div class="highlight-php notranslate"><div class="highlight"><pre><span></span><span class="sd">/**</span>
<span class="sd">         * Get all imports where the modifiedDateTime was more than 1 week ago.  Then</span>
<span class="sd">         * delete the imports.</span>
<span class="sd">         * (non-PHPdoc)</span>
<span class="sd">         * @see BaseJob::run()</span>
<span class="sd">         */</span>
        <span class="k">public</span> <span class="k">function</span> <span class="nf">run</span><span class="p">()</span>
        <span class="p">{</span>
            <span class="nv">$oneWeekAgoTimeStamp</span> <span class="o">=</span> <span class="nx">DateTimeUtil</span><span class="o">::</span><span class="na">convertTimestampToDbFormatDateTime</span><span class="p">(</span><span class="nb">time</span><span class="p">()</span> <span class="o">-</span> <span class="mi">60</span> <span class="o">*</span> <span class="mi">60</span> <span class="o">*</span><span class="mi">24</span> <span class="o">*</span> <span class="mi">7</span><span class="p">);</span>
</pre></div>
</div>
</div>
<div class="section" id="case-shopware-structures-timestampdifference">
<span id="id125"></span><h4><span class="section-number">5.2.95.2. </span>shopware<a class="headerlink" href="#case-shopware-structures-timestampdifference" title="Permalink to this headline">¶</a></h4>
<p><a class="reference internal" href="Rules.html#timestamp-difference"><span class="std std-ref">Timestamp Difference</span></a>, in engine/Shopware/Controllers/Backend/Newsletter.php:150.</p>
<p>When daylight saving strike, the email may suddenly be locked for 1 hour minus 30 seconds ago. The lock will be set for the rest of the hour, until the server catch up.</p>
<div class="highlight-php notranslate"><div class="highlight"><pre><span></span><span class="c1">// Check lock time. Add a buffer of 30 seconds to the lock time (default request time)</span>
            <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="k">empty</span><span class="p">(</span><span class="nv">$mailing</span><span class="p">[</span><span class="s1">&#39;locked&#39;</span><span class="p">])</span> <span class="o">&amp;&amp;</span> <span class="nb">strtotime</span><span class="p">(</span><span class="nv">$mailing</span><span class="p">[</span><span class="s1">&#39;locked&#39;</span><span class="p">])</span> <span class="o">&gt;</span> <span class="nb">time</span><span class="p">()</span> <span class="o">-</span> <span class="mi">30</span><span class="p">)</span> <span class="p">{</span>
                <span class="k">echo</span> <span class="s2">&quot;Current mail: &#39;&quot;</span> <span class="o">.</span> <span class="nv">$subjectCurrentMailing</span> <span class="o">.</span> <span class="s2">&quot;&#39;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">;</span>
                <span class="k">echo</span> <span class="s2">&quot;Wait &quot;</span> <span class="o">.</span> <span class="p">(</span><span class="nb">strtotime</span><span class="p">(</span><span class="nv">$mailing</span><span class="p">[</span><span class="s1">&#39;locked&#39;</span><span class="p">])</span> <span class="o">+</span> <span class="mi">30</span> <span class="o">-</span> <span class="nb">time</span><span class="p">())</span> <span class="o">.</span> <span class="s2">&quot; seconds ...</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">;</span>
                <span class="k">return</span><span class="p">;</span>
            <span class="p">}</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="unconditional-break-in-loop">
<span id="case-unconditional-break-in-loop"></span><h3><span class="section-number">5.2.96. </span>Unconditional Break In Loop<a class="headerlink" href="#unconditional-break-in-loop" title="Permalink to this headline">¶</a></h3>
<div class="section" id="case-livezilla-structures-unconditionloopbreak">
<span id="id126"></span><h4><span class="section-number">5.2.96.1. </span>LiveZilla<a class="headerlink" href="#case-livezilla-structures-unconditionloopbreak" title="Permalink to this headline">¶</a></h4>
<p><a class="reference internal" href="Rules.html#unconditional-break-in-loop"><span class="std std-ref">Unconditional Break In Loop</span></a>, in wp-admin/includes/misc.php:74.</p>
<p>Only one row is read from the DBManager, and the rest is ignored. The result has no more than one result, basedd on the <cite>LIMIT 1</cite> clause in the SQL. The while loop may be removed.</p>
<div class="highlight-php notranslate"><div class="highlight"><pre><span></span><span class="nv">$result</span> <span class="o">=</span> <span class="nx">DBManager</span><span class="o">::</span><span class="na">Execute</span><span class="p">(</span><span class="k">true</span><span class="p">,</span> <span class="s2">&quot;SELECT * FROM `&quot;</span> <span class="o">.</span> <span class="nx">DB_PREFIX</span> <span class="o">.</span> <span class="nx">DATABASE_STATS_AGGS</span> <span class="o">.</span> <span class="s2">&quot;` WHERE `month`&gt;0 AND ((`year`=&#39;&quot;</span> <span class="o">.</span> <span class="nx">DBManager</span><span class="o">::</span><span class="na">RealEscape</span><span class="p">(</span><span class="nb">date</span><span class="p">(</span><span class="s2">&quot;Y&quot;</span><span class="p">))</span> <span class="o">.</span> <span class="s2">&quot;&#39; AND `month`&lt;&#39;&quot;</span> <span class="o">.</span> <span class="nx">DBManager</span><span class="o">::</span><span class="na">RealEscape</span><span class="p">(</span><span class="nb">date</span><span class="p">(</span><span class="s2">&quot;n&quot;</span><span class="p">))</span> <span class="o">.</span> <span class="s2">&quot;&#39;) OR (`year`&lt;&#39;&quot;</span> <span class="o">.</span> <span class="nx">DBManager</span><span class="o">::</span><span class="na">RealEscape</span><span class="p">(</span><span class="nb">date</span><span class="p">(</span><span class="s2">&quot;Y&quot;</span><span class="p">))</span> <span class="o">.</span> <span class="s2">&quot;&#39;)) AND (`aggregated`=0 OR `aggregated`&gt;&quot;</span> <span class="o">.</span> <span class="p">(</span><span class="nb">time</span><span class="p">()</span> <span class="o">-</span> <span class="mi">300</span><span class="p">)</span> <span class="o">.</span> <span class="s2">&quot;) AND `day`=0 ORDER BY `year` ASC,`month` ASC LIMIT 1;&quot;</span><span class="p">);</span>
        <span class="k">if</span> <span class="p">(</span><span class="nv">$result</span><span class="p">)</span>
            <span class="k">while</span> <span class="p">(</span><span class="nv">$row</span> <span class="o">=</span> <span class="nx">DBManager</span><span class="o">::</span><span class="na">FetchArray</span><span class="p">(</span><span class="nv">$result</span><span class="p">))</span> <span class="p">{</span>
                <span class="k">if</span> <span class="p">(</span><span class="k">empty</span><span class="p">(</span><span class="nv">$row</span><span class="p">[</span><span class="s2">&quot;aggregated&quot;</span><span class="p">]))</span> <span class="p">{</span>
                    <span class="nx">DBManager</span><span class="o">::</span><span class="na">Execute</span><span class="p">(</span><span class="k">true</span><span class="p">,</span> <span class="s2">&quot;UPDATE `&quot;</span> <span class="o">.</span> <span class="nx">DB_PREFIX</span> <span class="o">.</span> <span class="nx">DATABASE_STATS_AGGS</span> <span class="o">.</span> <span class="s2">&quot;` SET `aggregated`=&quot;</span> <span class="o">.</span> <span class="nb">time</span><span class="p">()</span> <span class="o">.</span> <span class="s2">&quot; WHERE `year`=&quot;</span> <span class="o">.</span> <span class="nv">$row</span><span class="p">[</span><span class="s2">&quot;year&quot;</span><span class="p">]</span> <span class="o">.</span> <span class="s2">&quot; AND `month`=&quot;</span> <span class="o">.</span> <span class="nv">$row</span><span class="p">[</span><span class="s2">&quot;month&quot;</span><span class="p">]</span> <span class="o">.</span> <span class="s2">&quot; AND `day`=0 LIMIT 1;&quot;</span><span class="p">);</span>
                    <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">AggregateMonth</span><span class="p">(</span><span class="nv">$row</span><span class="p">[</span><span class="s2">&quot;year&quot;</span><span class="p">],</span> <span class="nv">$row</span><span class="p">[</span><span class="s2">&quot;month&quot;</span><span class="p">]);</span>
                <span class="p">}</span>
                <span class="k">return</span> <span class="k">false</span><span class="p">;</span>
            <span class="p">}</span>
</pre></div>
</div>
</div>
<div class="section" id="case-mediawiki-structures-unconditionloopbreak">
<span id="id127"></span><h4><span class="section-number">5.2.96.2. </span>MediaWiki<a class="headerlink" href="#case-mediawiki-structures-unconditionloopbreak" title="Permalink to this headline">¶</a></h4>
<p><a class="reference internal" href="Rules.html#unconditional-break-in-loop"><span class="std std-ref">Unconditional Break In Loop</span></a>, in includes/htmlform/HTMLFormField.php:138.</p>
<p>The final break is useless : the execution has already reached the end of the loop.</p>
<div class="highlight-php notranslate"><div class="highlight"><pre><span></span><span class="k">for</span> <span class="p">(</span> <span class="nv">$i</span> <span class="o">=</span> <span class="nb">count</span><span class="p">(</span> <span class="nv">$thisKeys</span> <span class="p">)</span> <span class="o">-</span> <span class="mi">1</span><span class="p">;</span> <span class="nv">$i</span> <span class="o">&gt;=</span> <span class="mi">0</span><span class="p">;</span> <span class="nv">$i</span><span class="o">--</span> <span class="p">)</span> <span class="p">{</span>
                    <span class="nv">$keys</span> <span class="o">=</span> <span class="nb">array_merge</span><span class="p">(</span> <span class="nb">array_slice</span><span class="p">(</span> <span class="nv">$thisKeys</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="nv">$i</span> <span class="p">),</span> <span class="nv">$nameKeys</span> <span class="p">);</span>
                    <span class="nv">$data</span> <span class="o">=</span> <span class="nv">$alldata</span><span class="p">;</span>
                    <span class="k">foreach</span> <span class="p">(</span> <span class="nv">$keys</span> <span class="k">as</span> <span class="nv">$key</span> <span class="p">)</span> <span class="p">{</span>
                            <span class="k">if</span> <span class="p">(</span> <span class="o">!</span><span class="nb">is_array</span><span class="p">(</span> <span class="nv">$data</span> <span class="p">)</span> <span class="o">||</span> <span class="o">!</span><span class="nb">array_key_exists</span><span class="p">(</span> <span class="nv">$key</span><span class="p">,</span> <span class="nv">$data</span> <span class="p">)</span> <span class="p">)</span> <span class="p">{</span>
                                    <span class="k">continue</span> <span class="mi">2</span><span class="p">;</span>
                            <span class="p">}</span>
                            <span class="nv">$data</span> <span class="o">=</span> <span class="nv">$data</span><span class="p">[</span><span class="nv">$key</span><span class="p">];</span>
                    <span class="p">}</span>
                    <span class="nv">$testValue</span> <span class="o">=</span> <span class="p">(</span><span class="nx">string</span><span class="p">)</span><span class="nv">$data</span><span class="p">;</span>
                    <span class="k">break</span><span class="p">;</span>
            <span class="p">}</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="useless-brackets">
<span id="case-useless-brackets"></span><h3><span class="section-number">5.2.97. </span>Useless Brackets<a class="headerlink" href="#useless-brackets" title="Permalink to this headline">¶</a></h3>
<div class="section" id="case-churchcrm-structures-uselessbrackets">
<span id="id128"></span><h4><span class="section-number">5.2.97.1. </span>ChurchCRM<a class="headerlink" href="#case-churchcrm-structures-uselessbrackets" title="Permalink to this headline">¶</a></h4>
<p><a class="reference internal" href="Rules.html#useless-brackets"><span class="std std-ref">Useless Brackets</span></a>, in src/Menu.php:72.</p>
<p>Difficut to guess what was before the block here. It doesn’t have any usage for control flow.</p>
<div class="highlight-php notranslate"><div class="highlight"><pre><span></span><span class="nv">$new_row</span> <span class="o">=</span> <span class="k">false</span><span class="p">;</span>
        <span class="nv">$count_people</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>

        <span class="p">{</span>
            <span class="k">foreach</span> <span class="p">(</span><span class="nv">$peopleWithBirthDays</span> <span class="k">as</span> <span class="nv">$peopleWithBirthDay</span><span class="p">)</span> <span class="p">{</span>
                <span class="k">if</span> <span class="p">(</span><span class="nv">$new_row</span> <span class="o">==</span> <span class="k">false</span><span class="p">)</span> <span class="p">{</span>
                    <span class="cp">?&gt;</span><span class="x"></span>

<span class="x">                    &lt;div class=row&gt;</span>
<span class="x">                </span><span class="cp">&lt;?php</span>
                    <span class="nv">$new_row</span> <span class="o">=</span> <span class="k">true</span><span class="p">;</span>
                <span class="p">}</span> <span class="cp">?&gt;</span><span class="x"></span>
<span class="x">                &lt;div class=col-sm-3&gt;</span>
</pre></div>
</div>
</div>
<div class="section" id="case-piwigo-structures-uselessbrackets">
<span id="id129"></span><h4><span class="section-number">5.2.97.2. </span>Piwigo<a class="headerlink" href="#case-piwigo-structures-uselessbrackets" title="Permalink to this headline">¶</a></h4>
<p><a class="reference internal" href="Rules.html#useless-brackets"><span class="std std-ref">Useless Brackets</span></a>, in picture.php:342.</p>
<p>There is no need for block braces with case. In fact, it does give a false sense of break, while the case will still fall over to the next one.</p>
<div class="highlight-php notranslate"><div class="highlight"><pre><span></span><span class="k">case</span> <span class="s1">&#39;rate&#39;</span> <span class="o">:</span>
    <span class="p">{</span>
      <span class="k">include_once</span><span class="p">(</span><span class="nx">PHPWG_ROOT_PATH</span><span class="o">.</span><span class="s1">&#39;include/functions_rate.inc.php&#39;</span><span class="p">);</span>
      <span class="nx">rate_picture</span><span class="p">(</span><span class="nv">$page</span><span class="p">[</span><span class="s1">&#39;image_id&#39;</span><span class="p">],</span> <span class="nv">$_POST</span><span class="p">[</span><span class="s1">&#39;rate&#39;</span><span class="p">]);</span>
      <span class="nx">redirect</span><span class="p">(</span><span class="nv">$url_self</span><span class="p">);</span>
    <span class="p">}</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="useless-type-casting">
<span id="case-useless-type-casting"></span><h3><span class="section-number">5.2.98. </span>Useless Type Casting<a class="headerlink" href="#useless-type-casting" title="Permalink to this headline">¶</a></h3>
<div class="section" id="case-fuelcms-structures-uselesscasting">
<span id="id130"></span><h4><span class="section-number">5.2.98.1. </span>FuelCMS<a class="headerlink" href="#case-fuelcms-structures-uselesscasting" title="Permalink to this headline">¶</a></h4>
<p><a class="reference internal" href="Rules.html#useless-type-casting"><span class="std std-ref">Useless Type Casting</span></a>, in fuel/codeigniter/core/URI.php:214.</p>
<p>substr() always returns a string, so there is no need to enforce this.</p>
<div class="highlight-php notranslate"><div class="highlight"><pre><span></span><span class="k">if</span> <span class="p">(</span><span class="nb">isset</span><span class="p">(</span><span class="nv">$_SERVER</span><span class="p">[</span><span class="s1">&#39;SCRIPT_NAME&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">]))</span>
            <span class="p">{</span>
                    <span class="k">if</span> <span class="p">(</span><span class="nb">strpos</span><span class="p">(</span><span class="nv">$uri</span><span class="p">,</span> <span class="nv">$_SERVER</span><span class="p">[</span><span class="s1">&#39;SCRIPT_NAME&#39;</span><span class="p">])</span> <span class="o">===</span> <span class="mi">0</span><span class="p">)</span>
                    <span class="p">{</span>
                            <span class="nv">$uri</span> <span class="o">=</span> <span class="p">(</span><span class="nx">string</span><span class="p">)</span> <span class="nb">substr</span><span class="p">(</span><span class="nv">$uri</span><span class="p">,</span> <span class="nb">strlen</span><span class="p">(</span><span class="nv">$_SERVER</span><span class="p">[</span><span class="s1">&#39;SCRIPT_NAME&#39;</span><span class="p">]));</span>
                    <span class="p">}</span>
                    <span class="k">elseif</span> <span class="p">(</span><span class="nb">strpos</span><span class="p">(</span><span class="nv">$uri</span><span class="p">,</span> <span class="nb">dirname</span><span class="p">(</span><span class="nv">$_SERVER</span><span class="p">[</span><span class="s1">&#39;SCRIPT_NAME&#39;</span><span class="p">]))</span> <span class="o">===</span> <span class="mi">0</span><span class="p">)</span>
                    <span class="p">{</span>
                            <span class="nv">$uri</span> <span class="o">=</span> <span class="p">(</span><span class="nx">string</span><span class="p">)</span> <span class="nb">substr</span><span class="p">(</span><span class="nv">$uri</span><span class="p">,</span> <span class="nb">strlen</span><span class="p">(</span><span class="nb">dirname</span><span class="p">(</span><span class="nv">$_SERVER</span><span class="p">[</span><span class="s1">&#39;SCRIPT_NAME&#39;</span><span class="p">])));</span>
                    <span class="p">}</span>
            <span class="p">}</span>
</pre></div>
</div>
</div>
<div class="section" id="case-thinkphp-structures-uselesscasting">
<span id="id131"></span><h4><span class="section-number">5.2.98.2. </span>ThinkPHP<a class="headerlink" href="#case-thinkphp-structures-uselesscasting" title="Permalink to this headline">¶</a></h4>
<p><a class="reference internal" href="Rules.html#useless-type-casting"><span class="std std-ref">Useless Type Casting</span></a>, in ThinkPHP/Library/Think/Db/Driver/Sqlsrv.class.php:67.</p>
<p>A comparison always returns a boolean, except for the spaceship operator.</p>
<div class="highlight-php notranslate"><div class="highlight"><pre><span></span><span class="k">foreach</span> <span class="p">(</span><span class="nv">$result</span> <span class="k">as</span> <span class="nv">$key</span> <span class="o">=&gt;</span> <span class="nv">$val</span><span class="p">)</span> <span class="p">{</span>
                <span class="nv">$info</span><span class="p">[</span><span class="nv">$val</span><span class="p">[</span><span class="s1">&#39;column_name&#39;</span><span class="p">]]</span> <span class="o">=</span> <span class="k">array</span><span class="p">(</span>
                    <span class="s1">&#39;name&#39;</span>    <span class="o">=&gt;</span> <span class="nv">$val</span><span class="p">[</span><span class="s1">&#39;column_name&#39;</span><span class="p">],</span>
                    <span class="s1">&#39;type&#39;</span>    <span class="o">=&gt;</span> <span class="nv">$val</span><span class="p">[</span><span class="s1">&#39;data_type&#39;</span><span class="p">],</span>
                    <span class="s1">&#39;notnull&#39;</span> <span class="o">=&gt;</span> <span class="p">(</span><span class="nx">bool</span><span class="p">)</span> <span class="p">(</span><span class="s1">&#39;&#39;</span> <span class="o">===</span> <span class="nv">$val</span><span class="p">[</span><span class="s1">&#39;is_nullable&#39;</span><span class="p">]),</span> <span class="c1">// not null is empty, null is yes</span>
                    <span class="s1">&#39;default&#39;</span> <span class="o">=&gt;</span> <span class="nv">$val</span><span class="p">[</span><span class="s1">&#39;column_default&#39;</span><span class="p">],</span>
                    <span class="s1">&#39;primary&#39;</span> <span class="o">=&gt;</span> <span class="k">false</span><span class="p">,</span>
                    <span class="s1">&#39;autoinc&#39;</span> <span class="o">=&gt;</span> <span class="k">false</span><span class="p">,</span>
                <span class="p">);</span>
            <span class="p">}</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="useless-check">
<span id="case-useless-check"></span><h3><span class="section-number">5.2.99. </span>Useless Check<a class="headerlink" href="#useless-check" title="Permalink to this headline">¶</a></h3>
<div class="section" id="case-magento-structures-uselesscheck">
<span id="id132"></span><h4><span class="section-number">5.2.99.1. </span>Magento<a class="headerlink" href="#case-magento-structures-uselesscheck" title="Permalink to this headline">¶</a></h4>
<p><a class="reference internal" href="Rules.html#useless-check"><span class="std std-ref">Useless Check</span></a>, in wp-admin/includes/misc.php:74.</p>
<p>This code assumes that $delete is an array, then checks if it empty. Foreach will take care of the empty check.</p>
<div class="highlight-php notranslate"><div class="highlight"><pre><span></span><span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="k">empty</span><span class="p">(</span><span class="nv">$delete</span><span class="p">))</span> <span class="p">{</span>
            <span class="k">foreach</span> <span class="p">(</span><span class="nv">$delete</span> <span class="k">as</span> <span class="nv">$categoryId</span><span class="p">)</span> <span class="p">{</span>
                <span class="nv">$where</span> <span class="o">=</span> <span class="k">array</span><span class="p">(</span>
                    <span class="s1">&#39;product_id = ?&#39;</span>  <span class="o">=&gt;</span> <span class="p">(</span><span class="nx">int</span><span class="p">)</span><span class="nv">$object</span><span class="o">-&gt;</span><span class="na">getId</span><span class="p">(),</span>
                    <span class="s1">&#39;category_id = ?&#39;</span> <span class="o">=&gt;</span> <span class="p">(</span><span class="nx">int</span><span class="p">)</span><span class="nv">$categoryId</span><span class="p">,</span>
                <span class="p">);</span>

                <span class="nv">$write</span><span class="o">-&gt;</span><span class="na">delete</span><span class="p">(</span><span class="nv">$this</span><span class="o">-&gt;</span><span class="na">_productCategoryTable</span><span class="p">,</span> <span class="nv">$where</span><span class="p">);</span>
            <span class="p">}</span>
        <span class="p">}</span>
</pre></div>
</div>
</div>
<div class="section" id="case-phinx-structures-uselesscheck">
<span id="id133"></span><h4><span class="section-number">5.2.99.2. </span>Phinx<a class="headerlink" href="#case-phinx-structures-uselesscheck" title="Permalink to this headline">¶</a></h4>
<p><a class="reference internal" href="Rules.html#useless-check"><span class="std std-ref">Useless Check</span></a>, in src/Phinx/Migration/Manager.php:828.</p>
<p>If $dependencies is not empty, foreach() skips the loops.</p>
<div class="highlight-php notranslate"><div class="highlight"><pre><span></span><span class="k">private</span> <span class="k">function</span> <span class="nf">getSeedDependenciesInstances</span><span class="p">(</span><span class="nx">AbstractSeed</span> <span class="nv">$seed</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="nv">$dependenciesInstances</span> <span class="o">=</span> <span class="p">[];</span>
        <span class="nv">$dependencies</span> <span class="o">=</span> <span class="nv">$seed</span><span class="o">-&gt;</span><span class="na">getDependencies</span><span class="p">();</span>
        <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="k">empty</span><span class="p">(</span><span class="nv">$dependencies</span><span class="p">))</span> <span class="p">{</span>
            <span class="k">foreach</span> <span class="p">(</span><span class="nv">$dependencies</span> <span class="k">as</span> <span class="nv">$dependency</span><span class="p">)</span> <span class="p">{</span>
                <span class="k">foreach</span> <span class="p">(</span><span class="nv">$this</span><span class="o">-&gt;</span><span class="na">seeds</span> <span class="k">as</span> <span class="nv">$seed</span><span class="p">)</span> <span class="p">{</span>
                    <span class="k">if</span> <span class="p">(</span><span class="nb">get_class</span><span class="p">(</span><span class="nv">$seed</span><span class="p">)</span> <span class="o">===</span> <span class="nv">$dependency</span><span class="p">)</span> <span class="p">{</span>
                        <span class="nv">$dependenciesInstances</span><span class="p">[</span><span class="nb">get_class</span><span class="p">(</span><span class="nv">$seed</span><span class="p">)]</span> <span class="o">=</span> <span class="nv">$seed</span><span class="p">;</span>
                    <span class="p">}</span>
                <span class="p">}</span>
            <span class="p">}</span>
        <span class="p">}</span>

        <span class="k">return</span> <span class="nv">$dependenciesInstances</span><span class="p">;</span>
    <span class="p">}</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="useless-parenthesis">
<span id="case-useless-parenthesis"></span><h3><span class="section-number">5.2.100. </span>Useless Parenthesis<a class="headerlink" href="#useless-parenthesis" title="Permalink to this headline">¶</a></h3>
<div class="section" id="case-mautic-structures-uselessparenthesis">
<span id="id134"></span><h4><span class="section-number">5.2.100.1. </span>Mautic<a class="headerlink" href="#case-mautic-structures-uselessparenthesis" title="Permalink to this headline">¶</a></h4>
<p><a class="reference internal" href="Rules.html#useless-parenthesis"><span class="std std-ref">Useless Parenthesis</span></a>, in code/app/bundles/EmailBundle/Controller/AjaxController.php:85.</p>
<p>Parenthesis are useless around $progress[1], and around the division too.</p>
<div class="highlight-php notranslate"><div class="highlight"><pre><span></span><span class="nv">$dataArray</span><span class="p">[</span><span class="s1">&#39;percent&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="nv">$progress</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span> <span class="o">?</span> <span class="nb">ceil</span><span class="p">((</span><span class="nv">$progress</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">/</span> <span class="nv">$progress</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span> <span class="o">*</span> <span class="mi">100</span><span class="p">)</span> <span class="o">:</span> <span class="mi">100</span><span class="p">;</span>
</pre></div>
</div>
</div>
<div class="section" id="case-woocommerce-structures-uselessparenthesis">
<span id="id135"></span><h4><span class="section-number">5.2.100.2. </span>Woocommerce<a class="headerlink" href="#case-woocommerce-structures-uselessparenthesis" title="Permalink to this headline">¶</a></h4>
<p><a class="reference internal" href="Rules.html#useless-parenthesis"><span class="std std-ref">Useless Parenthesis</span></a>, in includes/class-wc-coupon.php:437.</p>
<p>Parenthesis are useless for calculating $discount_percent, as it is a divisition. Moreover, it is not needed with $discount, (float) applies to the next element, but it does make the expression more readable.</p>
<div class="highlight-php notranslate"><div class="highlight"><pre><span></span><span class="k">if</span> <span class="p">(</span> <span class="nx">wc_prices_include_tax</span><span class="p">()</span> <span class="p">)</span> <span class="p">{</span>
    <span class="nv">$discount_percent</span> <span class="o">=</span> <span class="p">(</span> <span class="nx">wc_get_price_including_tax</span><span class="p">(</span> <span class="nv">$cart_item</span><span class="p">[</span><span class="s1">&#39;data&#39;</span><span class="p">]</span> <span class="p">)</span> <span class="o">*</span> <span class="nv">$cart_item_qty</span> <span class="p">)</span> <span class="o">/</span> <span class="nx">WC</span><span class="p">()</span><span class="o">-&gt;</span><span class="na">cart</span><span class="o">-&gt;</span><span class="na">subtotal</span><span class="p">;</span>
<span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
    <span class="nv">$discount_percent</span> <span class="o">=</span> <span class="p">(</span> <span class="nx">wc_get_price_excluding_tax</span><span class="p">(</span> <span class="nv">$cart_item</span><span class="p">[</span><span class="s1">&#39;data&#39;</span><span class="p">]</span> <span class="p">)</span> <span class="o">*</span> <span class="nv">$cart_item_qty</span> <span class="p">)</span> <span class="o">/</span> <span class="nx">WC</span><span class="p">()</span><span class="o">-&gt;</span><span class="na">cart</span><span class="o">-&gt;</span><span class="na">subtotal_ex_tax</span><span class="p">;</span>
<span class="p">}</span>
<span class="nv">$discount</span> <span class="o">=</span> <span class="p">(</span> <span class="p">(</span><span class="nx">float</span><span class="p">)</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">get_amount</span><span class="p">()</span> <span class="o">*</span> <span class="nv">$discount_percent</span> <span class="p">)</span> <span class="o">/</span> <span class="nv">$cart_item_qty</span><span class="p">;</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="useless-unset">
<span id="case-useless-unset"></span><h3><span class="section-number">5.2.101. </span>Useless Unset<a class="headerlink" href="#useless-unset" title="Permalink to this headline">¶</a></h3>
<div class="section" id="case-tine20-structures-uselessunset">
<span id="id136"></span><h4><span class="section-number">5.2.101.1. </span>Tine20<a class="headerlink" href="#case-tine20-structures-uselessunset" title="Permalink to this headline">¶</a></h4>
<p><a class="reference internal" href="Rules.html#useless-unset"><span class="std std-ref">Useless Unset</span></a>, in tine20/Felamimail/Controller/Message.php:542.</p>
<p>$_rawContent is unset after being sent to the stream. The variable is a parameter, and will be freed at the end of the call of the method. No need to do it explicitly.</p>
<div class="highlight-php notranslate"><div class="highlight"><pre><span></span><span class="k">protected</span> <span class="k">function</span> <span class="nf">_createMimePart</span><span class="p">(</span><span class="nv">$_rawContent</span><span class="p">,</span> <span class="nv">$_partStructure</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="k">if</span> <span class="p">(</span><span class="nx">Tinebase_Core</span><span class="o">::</span><span class="na">isLogLevel</span><span class="p">(</span><span class="nx">Zend_Log</span><span class="o">::</span><span class="na">TRACE</span><span class="p">))</span> <span class="nx">Tinebase_Core</span><span class="o">::</span><span class="na">getLogger</span><span class="p">()</span><span class="o">-&gt;</span><span class="na">trace</span><span class="p">(</span><span class="no">__METHOD__</span> <span class="o">.</span> <span class="s1">&#39;::&#39;</span> <span class="o">.</span> <span class="no">__LINE__</span> <span class="o">.</span> <span class="s1">&#39; Content: &#39;</span> <span class="o">.</span> <span class="nv">$_rawContent</span><span class="p">);</span>

        <span class="nv">$stream</span> <span class="o">=</span> <span class="nb">fopen</span><span class="p">(</span><span class="nx">php</span><span class="o">://</span><span class="nx">temp</span><span class="p">,</span> <span class="s1">&#39;r+&#39;</span><span class="p">);</span>
        <span class="nb">fputs</span><span class="p">(</span><span class="nv">$stream</span><span class="p">,</span> <span class="nv">$_rawContent</span><span class="p">);</span>
        <span class="nb">rewind</span><span class="p">(</span><span class="nv">$stream</span><span class="p">);</span>

        <span class="nb">unset</span><span class="p">(</span><span class="nv">$_rawContent</span><span class="p">);</span>
        <span class="c1">//..... More code, no usage of $_rawContent</span>
    <span class="p">}</span>
</pre></div>
</div>
</div>
<div class="section" id="case-typo3-structures-uselessunset">
<span id="id137"></span><h4><span class="section-number">5.2.101.2. </span>Typo3<a class="headerlink" href="#case-typo3-structures-uselessunset" title="Permalink to this headline">¶</a></h4>
<p><a class="reference internal" href="Rules.html#useless-unset"><span class="std std-ref">Useless Unset</span></a>, in typo3/sysext/frontend/Classes/Page/PageRepository.php:708.</p>
<p>$row is unset under certain conditions : here, we can read it in the comments. Eventually, the $row will be returned, and turned into a NULL, by default. This will also create a notice in the logs. Here, the best would be to set a null value, instead of unsetting the variable.</p>
<div class="highlight-php notranslate"><div class="highlight"><pre><span></span><span class="k">public</span> <span class="k">function</span> <span class="nf">getRecordOverlay</span><span class="p">(</span><span class="nv">$table</span><span class="p">,</span> <span class="nv">$row</span><span class="p">,</span> <span class="nv">$sys_language_content</span><span class="p">,</span> <span class="nv">$OLmode</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span><span class="p">)</span>
    <span class="p">{</span>
<span class="c1">//....  a lot more code, with usage of $row, and several unset($row)</span>
<span class="c1">//...... Reduced for simplicity</span>
                    <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
                        <span class="c1">// When default language is displayed, we never want to return a record carrying</span>
                        <span class="c1">// another language!</span>
                        <span class="k">if</span> <span class="p">(</span><span class="nv">$row</span><span class="p">[</span><span class="nv">$GLOBALS</span><span class="p">[</span><span class="s1">&#39;TCA&#39;</span><span class="p">][</span><span class="nv">$table</span><span class="p">][</span><span class="s1">&#39;ctrl&#39;</span><span class="p">][</span><span class="s1">&#39;languageField&#39;</span><span class="p">]]</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
                            <span class="nb">unset</span><span class="p">(</span><span class="nv">$row</span><span class="p">);</span>
                        <span class="p">}</span>
                    <span class="p">}</span>
                <span class="p">}</span>
            <span class="p">}</span>
        <span class="p">}</span>
        <span class="k">foreach</span> <span class="p">(</span><span class="nv">$GLOBALS</span><span class="p">[</span><span class="s1">&#39;TYPO3_CONF_VARS&#39;</span><span class="p">][</span><span class="s1">&#39;SC_OPTIONS&#39;</span><span class="p">][</span><span class="s1">&#39;t3lib/class.t3lib_page.php&#39;</span><span class="p">][</span><span class="s1">&#39;getRecordOverlay&#39;</span><span class="p">]</span> <span class="o">??</span> <span class="p">[]</span> <span class="k">as</span> <span class="nv">$className</span><span class="p">)</span> <span class="p">{</span>
            <span class="nv">$hookObject</span> <span class="o">=</span> <span class="nx">GeneralUtility</span><span class="o">::</span><span class="na">makeInstance</span><span class="p">(</span><span class="nv">$className</span><span class="p">);</span>
            <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nv">$hookObject</span> <span class="nx">instanceof</span> <span class="nx">PageRepositoryGetRecordOverlayHookInterface</span><span class="p">)</span> <span class="p">{</span>
                <span class="k">throw</span> <span class="k">new</span> <span class="nx">\UnexpectedValueException</span><span class="p">(</span><span class="nv">$className</span> <span class="o">.</span> <span class="s1">&#39; must implement interface &#39;</span> <span class="o">.</span> <span class="nx">PageRepositoryGetRecordOverlayHookInterface</span><span class="o">::</span><span class="na">class</span><span class="p">,</span> <span class="mi">1269881659</span><span class="p">);</span>
            <span class="p">}</span>
            <span class="nv">$hookObject</span><span class="o">-&gt;</span><span class="na">getRecordOverlay_postProcess</span><span class="p">(</span><span class="nv">$table</span><span class="p">,</span> <span class="nv">$row</span><span class="p">,</span> <span class="nv">$sys_language_content</span><span class="p">,</span> <span class="nv">$OLmode</span><span class="p">,</span> <span class="nv">$this</span><span class="p">);</span>
        <span class="p">}</span>
        <span class="k">return</span> <span class="nv">$row</span><span class="p">;</span>
    <span class="p">}</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="var-dump-usage">
<span id="case-var-dump-usage"></span><h3><span class="section-number">5.2.102. </span>var_dump()… Usage<a class="headerlink" href="#var-dump-usage" title="Permalink to this headline">¶</a></h3>
<div class="section" id="case-tine20-structures-vardumpusage">
<span id="id138"></span><h4><span class="section-number">5.2.102.1. </span>Tine20<a class="headerlink" href="#case-tine20-structures-vardumpusage" title="Permalink to this headline">¶</a></h4>
<p><a class="reference internal" href="Rules.html#var-dump-usage"><span class="std std-ref">var_dump()… Usage</span></a>, in tine20/library/Ajam/Connection.php:122.</p>
<p>Two usage of var_dump(). They are protected by configuration, since the debug property must be set to ‘true’. Yet, it is safer to avoid them altogether, and log the information to an external file.</p>
<div class="highlight-php notranslate"><div class="highlight"><pre><span></span><span class="k">if</span><span class="p">(</span><span class="nv">$this</span><span class="o">-&gt;</span><span class="na">debug</span> <span class="o">===</span> <span class="k">true</span><span class="p">)</span> <span class="p">{</span>
            <span class="nb">var_dump</span><span class="p">(</span><span class="nv">$this</span><span class="o">-&gt;</span><span class="na">getLastRequest</span><span class="p">());</span>
            <span class="nb">var_dump</span><span class="p">(</span><span class="nv">$response</span><span class="p">);</span>
        <span class="p">}</span>
</pre></div>
</div>
</div>
<div class="section" id="case-piwigo-structures-vardumpusage">
<span id="id139"></span><h4><span class="section-number">5.2.102.2. </span>Piwigo<a class="headerlink" href="#case-piwigo-structures-vardumpusage" title="Permalink to this headline">¶</a></h4>
<p><a class="reference internal" href="Rules.html#var-dump-usage"><span class="std std-ref">var_dump()… Usage</span></a>, in include/ws_core.inc.php:273.</p>
<p>This is a hidden debug system : when the response format is not available, the whole object is dumped in the output.</p>
<div class="highlight-php notranslate"><div class="highlight"><pre><span></span><span class="k">function</span> <span class="nf">run</span><span class="p">()</span>
  <span class="p">{</span>
    <span class="k">if</span> <span class="p">(</span> <span class="nb">is_null</span><span class="p">(</span><span class="nv">$this</span><span class="o">-&gt;</span><span class="na">_responseEncoder</span><span class="p">)</span> <span class="p">)</span>
    <span class="p">{</span>
      <span class="nx">set_status_header</span><span class="p">(</span><span class="mi">400</span><span class="p">);</span>
      <span class="o">@</span><span class="nb">header</span><span class="p">(</span><span class="s2">&quot;Content-Type: text/plain&quot;</span><span class="p">);</span>
      <span class="k">echo</span> <span class="p">(</span><span class="s2">&quot;Cannot process your request. Unknown response format.</span>
<span class="s2">Request format: &quot;</span><span class="o">.@</span><span class="nv">$this</span><span class="o">-&gt;</span><span class="na">_requestFormat</span><span class="o">.</span><span class="s2">&quot; Response format: &quot;</span><span class="o">.@</span><span class="nv">$this</span><span class="o">-&gt;</span><span class="na">_responseFormat</span><span class="o">.</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">);</span>
      <span class="nb">var_export</span><span class="p">(</span><span class="nv">$this</span><span class="p">);</span>
      <span class="k">die</span><span class="p">(</span><span class="mi">0</span><span class="p">);</span>
    <span class="p">}</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="while-list-each">
<span id="case-while-list-each"></span><h3><span class="section-number">5.2.103. </span>While(List() = Each())<a class="headerlink" href="#while-list-each" title="Permalink to this headline">¶</a></h3>
<div class="section" id="case-openemr-structures-whilelisteach">
<span id="id140"></span><h4><span class="section-number">5.2.103.1. </span>OpenEMR<a class="headerlink" href="#case-openemr-structures-whilelisteach" title="Permalink to this headline">¶</a></h4>
<p><a class="reference internal" href="Rules.html#while-list-each"><span class="std std-ref">While(List() = Each())</span></a>, in library/report.inc:153.</p>
<p>The first while() is needed, to read the arbitrary long list returned by the SQL query. The second list may be upgraded with a foreach, to read both the key and the value. This is certainly faster to execute and to read.</p>
<div class="highlight-php notranslate"><div class="highlight"><pre><span></span><span class="k">function</span> <span class="nf">getInsuranceReport</span><span class="p">(</span><span class="nv">$pid</span><span class="p">,</span> <span class="nv">$type</span> <span class="o">=</span> <span class="nx">primary</span><span class="p">)</span>
<span class="p">{</span>
    <span class="nv">$sql</span> <span class="o">=</span> <span class="nx">select</span> <span class="o">*</span> <span class="nx">from</span> <span class="nx">insurance_data</span> <span class="nx">where</span> <span class="nx">pid</span><span class="o">=?</span> <span class="k">and</span> <span class="nx">type</span><span class="o">=?</span> <span class="nx">order</span> <span class="nx">by</span> <span class="nb">date</span> <span class="nx">ASC</span><span class="p">;</span>
    <span class="nv">$res</span> <span class="o">=</span> <span class="nx">sqlStatement</span><span class="p">(</span><span class="nv">$sql</span><span class="p">,</span> <span class="k">array</span><span class="p">(</span><span class="nv">$pid</span><span class="p">,</span> <span class="nv">$type</span><span class="p">));</span>
    <span class="k">while</span> <span class="p">(</span><span class="nv">$list</span> <span class="o">=</span> <span class="nx">sqlFetchArray</span><span class="p">(</span><span class="nv">$res</span><span class="p">))</span> <span class="p">{</span>
        <span class="k">while</span> <span class="p">(</span><span class="k">list</span><span class="p">(</span><span class="nv">$key</span><span class="p">,</span> <span class="nv">$value</span><span class="p">)</span> <span class="o">=</span> <span class="nb">each</span><span class="p">(</span><span class="nv">$list</span><span class="p">))</span> <span class="p">{</span>
            <span class="k">if</span> <span class="p">(</span><span class="nv">$ret</span><span class="p">[</span><span class="nv">$key</span><span class="p">][</span><span class="s1">&#39;content&#39;</span><span class="p">]</span> <span class="o">!=</span> <span class="nv">$value</span> <span class="o">&amp;&amp;</span> <span class="nv">$ret</span><span class="p">[</span><span class="nv">$key</span><span class="p">][</span><span class="s1">&#39;date&#39;</span><span class="p">]</span> <span class="o">&lt;</span> <span class="nv">$list</span><span class="p">[</span><span class="s1">&#39;date&#39;</span><span class="p">])</span> <span class="p">{</span>
                <span class="nv">$ret</span><span class="p">[</span><span class="nv">$key</span><span class="p">][</span><span class="s1">&#39;content&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="nv">$value</span><span class="p">;</span>
                <span class="nv">$ret</span><span class="p">[</span><span class="nv">$key</span><span class="p">][</span><span class="s1">&#39;date&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="nv">$list</span><span class="p">[</span><span class="s1">&#39;date&#39;</span><span class="p">];</span>
            <span class="p">}</span>
        <span class="p">}</span>
    <span class="p">}</span>

    <span class="k">return</span> <span class="nv">$ret</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>
</div>
</div>
<div class="section" id="case-dolphin-structures-whilelisteach">
<span id="id141"></span><h4><span class="section-number">5.2.103.2. </span>Dolphin<a class="headerlink" href="#case-dolphin-structures-whilelisteach" title="Permalink to this headline">¶</a></h4>
<p><a class="reference internal" href="Rules.html#while-list-each"><span class="std std-ref">While(List() = Each())</span></a>, in Dolphin-v.7.3.5/modules/boonex/forum/classes/Forum.php:1875.</p>
<p>This clever use of while() and list() is actually a foreach($a as $r) (the keys are ignored)</p>
<div class="highlight-php notranslate"><div class="highlight"><pre><span></span><span class="k">function</span> <span class="nf">getRssUpdatedTopics</span> <span class="p">()</span>
    <span class="p">{</span>
        <span class="k">global</span> <span class="nv">$gConf</span><span class="p">;</span>

        <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">_rssPrepareConf</span> <span class="p">();</span>

        <span class="nv">$a</span> <span class="o">=</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">fdb</span><span class="o">-&gt;</span><span class="na">getRecentTopics</span> <span class="p">(</span><span class="mi">0</span><span class="p">);</span>

        <span class="nv">$items</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span><span class="p">;</span>
        <span class="nv">$lastBuildDate</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span><span class="p">;</span>
        <span class="nv">$ui</span> <span class="o">=</span> <span class="k">array</span><span class="p">();</span>
        <span class="nb">reset</span> <span class="p">(</span><span class="nv">$a</span><span class="p">);</span>
        <span class="k">while</span> <span class="p">(</span> <span class="k">list</span> <span class="p">(,</span><span class="nv">$r</span><span class="p">)</span> <span class="o">=</span> <span class="nb">each</span> <span class="p">(</span><span class="nv">$a</span><span class="p">)</span> <span class="p">)</span> <span class="p">{</span>
            <span class="c1">// acquire user info</span>
            <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nb">isset</span><span class="p">(</span><span class="nv">$ui</span><span class="p">[</span><span class="nv">$r</span><span class="p">[</span><span class="s1">&#39;last_post_user&#39;</span><span class="p">]])</span> <span class="o">&amp;&amp;</span> <span class="p">(</span><span class="nv">$aa</span> <span class="o">=</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">_getUserInfoReadyArray</span> <span class="p">(</span><span class="nv">$r</span><span class="p">[</span><span class="s1">&#39;last_post_user&#39;</span><span class="p">],</span> <span class="k">false</span><span class="p">)))</span>
                <span class="nv">$ui</span><span class="p">[</span><span class="nv">$r</span><span class="p">[</span><span class="s1">&#39;last_post_user&#39;</span><span class="p">]]</span> <span class="o">=</span> <span class="nv">$aa</span><span class="p">;</span>

            <span class="nv">$td</span> <span class="o">=</span> <span class="nx">orca_mb_replace</span><span class="p">(</span><span class="s1">&#39;/#/&#39;</span><span class="p">,</span> <span class="nv">$r</span><span class="p">[</span><span class="s1">&#39;count_posts&#39;</span><span class="p">],</span> <span class="s1">&#39;[L[# posts]]&#39;</span><span class="p">)</span> <span class="o">.</span> <span class="s1">&#39; &amp;#183; &#39;</span> <span class="o">.</span> <span class="nx">orca_mb_replace</span><span class="p">(</span><span class="s1">&#39;/#/&#39;</span><span class="p">,</span> <span class="nv">$ui</span><span class="p">[</span><span class="nv">$r</span><span class="p">[</span><span class="s1">&#39;last_post_user&#39;</span><span class="p">]][</span><span class="s1">&#39;title&#39;</span><span class="p">],</span> <span class="s1">&#39;[L[last reply by #]]&#39;</span><span class="p">)</span> <span class="o">.</span> <span class="s1">&#39; &amp;#183; &#39;</span> <span class="o">.</span> <span class="nv">$r</span><span class="p">[</span><span class="s1">&#39;cat_name&#39;</span><span class="p">]</span> <span class="o">.</span> <span class="s1">&#39; &amp;#187; &#39;</span> <span class="o">.</span> <span class="nv">$r</span><span class="p">[</span><span class="s1">&#39;forum_title&#39;</span><span class="p">];</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="preg-replace-with-option-e">
<span id="case-preg-replace-with-option-e"></span><h3><span class="section-number">5.2.104. </span>preg_replace With Option e<a class="headerlink" href="#preg-replace-with-option-e" title="Permalink to this headline">¶</a></h3>
<div class="section" id="case-edusoho-structures-pregoptione">
<span id="id142"></span><h4><span class="section-number">5.2.104.1. </span>Edusoho<a class="headerlink" href="#case-edusoho-structures-pregoptione" title="Permalink to this headline">¶</a></h4>
<p><a class="reference internal" href="Rules.html#preg-replace-with-option-e"><span class="std std-ref">preg_replace With Option e</span></a>, in vendor_user/uc_client/lib/uccode.class.php:32.</p>
<p>This call extract text between [code] tags, then process it with $this-&gt;codedisp() and nest it again in the original string. preg_replace_callback() is a drop-in replacement for this piece of code.</p>
<div class="highlight-php notranslate"><div class="highlight"><pre><span></span><span class="nv">$message</span> <span class="o">=</span> <span class="nb">preg_replace</span><span class="p">(</span><span class="s2">&quot;/\s*\[code\](.+?)\[\/code\]\s*/ies&quot;</span><span class="p">,</span> <span class="s2">&quot;</span><span class="si">$this-&gt;codedisp</span><span class="s2">(&#39;</span><span class="se">\1</span><span class="s2">&#39;)&quot;</span><span class="p">,</span> <span class="nv">$message</span><span class="p">);</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="no-real-comparison">
<span id="case-no-real-comparison"></span><h3><span class="section-number">5.2.105. </span>No Real Comparison<a class="headerlink" href="#no-real-comparison" title="Permalink to this headline">¶</a></h3>
<div class="section" id="case-magento-type-norealcomparison">
<span id="id143"></span><h4><span class="section-number">5.2.105.1. </span>Magento<a class="headerlink" href="#case-magento-type-norealcomparison" title="Permalink to this headline">¶</a></h4>
<p><a class="reference internal" href="Rules.html#no-real-comparison"><span class="std std-ref">No Real Comparison</span></a>, in app/code/core/Mage/XmlConnect/Block/Catalog/Product/Options/Configurable.php:74.</p>
<p>Compare prices and physical quantities with a difference, so as to avoid rounding errors.</p>
<div class="highlight-php notranslate"><div class="highlight"><pre><span></span><span class="k">if</span> <span class="p">((</span><span class="nx">float</span><span class="p">)</span><span class="nv">$option</span><span class="p">[</span><span class="s1">&#39;price&#39;</span><span class="p">]</span> <span class="o">!=</span> <span class="mf">0.00</span><span class="p">)</span> <span class="p">{</span>
                        <span class="nv">$valueNode</span><span class="o">-&gt;</span><span class="na">addAttribute</span><span class="p">(</span><span class="s1">&#39;price&#39;</span><span class="p">,</span> <span class="nv">$option</span><span class="p">[</span><span class="s1">&#39;price&#39;</span><span class="p">]);</span>
                        <span class="nv">$valueNode</span><span class="o">-&gt;</span><span class="na">addAttribute</span><span class="p">(</span><span class="s1">&#39;formated_price&#39;</span><span class="p">,</span> <span class="nv">$option</span><span class="p">[</span><span class="s1">&#39;formated_price&#39;</span><span class="p">]);</span>
                    <span class="p">}</span>
</pre></div>
</div>
</div>
<div class="section" id="case-spip-type-norealcomparison">
<span id="id144"></span><h4><span class="section-number">5.2.105.2. </span>SPIP<a class="headerlink" href="#case-spip-type-norealcomparison" title="Permalink to this headline">¶</a></h4>
<p><a class="reference internal" href="Rules.html#no-real-comparison"><span class="std std-ref">No Real Comparison</span></a>, in ecrire/maj/v017.php:37.</p>
<p>Here, the current version number is stored as a real number. With a string, though a longer value, it may be compared using the version_compare() function.</p>
<div class="highlight-php notranslate"><div class="highlight"><pre><span></span><span class="nv">$version_installee</span> <span class="o">==</span> <span class="mf">1.701</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="one-variable-string">
<span id="case-one-variable-string"></span><h3><span class="section-number">5.2.106. </span>One Variable String<a class="headerlink" href="#one-variable-string" title="Permalink to this headline">¶</a></h3>
<div class="section" id="case-tikiwiki-type-onevariablestrings">
<span id="id145"></span><h4><span class="section-number">5.2.106.1. </span>Tikiwiki<a class="headerlink" href="#case-tikiwiki-type-onevariablestrings" title="Permalink to this headline">¶</a></h4>
<p><a class="reference internal" href="Rules.html#one-variable-string"><span class="std std-ref">One Variable String</span></a>, in lib/wiki-plugins/wikiplugin_addtocart.php:228.</p>
<p>Double-quotes are not needed here. If casting to string is important, the (string) would be more explicit.</p>
<div class="highlight-php notranslate"><div class="highlight"><pre><span></span><span class="k">foreach</span> <span class="p">(</span><span class="nv">$plugininfo</span><span class="p">[</span><span class="s1">&#39;params&#39;</span><span class="p">]</span> <span class="k">as</span> <span class="nv">$key</span> <span class="o">=&gt;</span> <span class="nv">$param</span><span class="p">)</span> <span class="p">{</span>
            <span class="nv">$default</span><span class="p">[</span><span class="s2">&quot;</span><span class="si">$key</span><span class="s2">&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="nv">$param</span><span class="p">[</span><span class="s1">&#39;default&#39;</span><span class="p">];</span>
    <span class="p">}</span>
</pre></div>
</div>
</div>
<div class="section" id="case-nextcloud-type-onevariablestrings">
<span id="id146"></span><h4><span class="section-number">5.2.106.2. </span>NextCloud<a class="headerlink" href="#case-nextcloud-type-onevariablestrings" title="Permalink to this headline">¶</a></h4>
<p><a class="reference internal" href="Rules.html#one-variable-string"><span class="std std-ref">One Variable String</span></a>, in build/integration/features/bootstrap/BasicStructure.php:349.</p>
<p>Both concatenations could be merged, independantly. If readability is important, why not put them inside curly brackets?</p>
<div class="highlight-php notranslate"><div class="highlight"><pre><span></span><span class="k">public</span> <span class="k">static</span> <span class="k">function</span> <span class="nf">removeFile</span><span class="p">(</span><span class="nv">$path</span><span class="p">,</span> <span class="nv">$filename</span><span class="p">)</span> <span class="p">{</span>
            <span class="k">if</span> <span class="p">(</span><span class="nb">file_exists</span><span class="p">(</span><span class="s2">&quot;</span><span class="si">$path</span><span class="s2">&quot;</span> <span class="o">.</span> <span class="s2">&quot;</span><span class="si">$filename</span><span class="s2">&quot;</span><span class="p">))</span> <span class="p">{</span>
                    <span class="nb">unlink</span><span class="p">(</span><span class="s2">&quot;</span><span class="si">$path</span><span class="s2">&quot;</span> <span class="o">.</span> <span class="s2">&quot;</span><span class="si">$filename</span><span class="s2">&quot;</span><span class="p">);</span>
            <span class="p">}</span>
    <span class="p">}</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="should-typecast">
<span id="case-should-typecast"></span><h3><span class="section-number">5.2.107. </span>Should Typecast<a class="headerlink" href="#should-typecast" title="Permalink to this headline">¶</a></h3>
<div class="section" id="case-xataface-type-shouldtypecast">
<span id="id147"></span><h4><span class="section-number">5.2.107.1. </span>xataface<a class="headerlink" href="#case-xataface-type-shouldtypecast" title="Permalink to this headline">¶</a></h4>
<p><a class="reference internal" href="Rules.html#should-typecast"><span class="std std-ref">Should Typecast</span></a>, in Dataface/Relationship.php:1612.</p>
<p>This is an exact example. A little further, the same applies to intval($max))</p>
<div class="highlight-php notranslate"><div class="highlight"><pre><span></span><span class="nb">intval</span><span class="p">(</span><span class="nv">$min</span><span class="p">);</span>
</pre></div>
</div>
</div>
<div class="section" id="case-openconf-type-shouldtypecast">
<span id="id148"></span><h4><span class="section-number">5.2.107.2. </span>OpenConf<a class="headerlink" href="#case-openconf-type-shouldtypecast" title="Permalink to this headline">¶</a></h4>
<p><a class="reference internal" href="Rules.html#should-typecast"><span class="std std-ref">Should Typecast</span></a>, in author/upload.php:62.</p>
<p>This is another exact example.</p>
<div class="highlight-php notranslate"><div class="highlight"><pre><span></span><span class="nb">intval</span><span class="p">(</span><span class="nv">$_POST</span><span class="p">[</span><span class="s1">&#39;pid&#39;</span><span class="p">]);</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="silently-cast-integer">
<span id="case-silently-cast-integer"></span><h3><span class="section-number">5.2.108. </span>Silently Cast Integer<a class="headerlink" href="#silently-cast-integer" title="Permalink to this headline">¶</a></h3>
<div class="section" id="case-mediawiki-type-silentlycastinteger">
<span id="id149"></span><h4><span class="section-number">5.2.108.1. </span>MediaWiki<a class="headerlink" href="#case-mediawiki-type-silentlycastinteger" title="Permalink to this headline">¶</a></h4>
<p><a class="reference internal" href="Rules.html#silently-cast-integer"><span class="std std-ref">Silently Cast Integer</span></a>, in includes/debug/logger/monolog/AvroFormatter.php:167.</p>
<p>Too many ff in the masks.</p>
<div class="highlight-php notranslate"><div class="highlight"><pre><span></span><span class="k">private</span> <span class="k">function</span> <span class="nf">encodeLong</span><span class="p">(</span> <span class="nv">$id</span> <span class="p">)</span> <span class="p">{</span>
            <span class="nv">$high</span>   <span class="o">=</span> <span class="p">(</span> <span class="nv">$id</span> <span class="o">&amp;</span> <span class="mh">0xffffffff00000000</span> <span class="p">)</span> <span class="o">&gt;&gt;</span> <span class="mi">32</span><span class="p">;</span>
            <span class="nv">$low</span>    <span class="o">=</span> <span class="nv">$id</span> <span class="o">&amp;</span> <span class="mh">0x00000000ffffffff</span><span class="p">;</span>
            <span class="k">return</span> <span class="nb">pack</span><span class="p">(</span> <span class="s1">&#39;NN&#39;</span><span class="p">,</span> <span class="nv">$high</span><span class="p">,</span> <span class="nv">$low</span> <span class="p">);</span>
    <span class="p">}</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="strings-with-strange-space">
<span id="case-strings-with-strange-space"></span><h3><span class="section-number">5.2.109. </span>Strings With Strange Space<a class="headerlink" href="#strings-with-strange-space" title="Permalink to this headline">¶</a></h3>
<div class="section" id="case-openemr-type-stringwithstrangespace">
<span id="id150"></span><h4><span class="section-number">5.2.109.1. </span>OpenEMR<a class="headerlink" href="#case-openemr-type-stringwithstrangespace" title="Permalink to this headline">¶</a></h4>
<p><a class="reference internal" href="Rules.html#strings-with-strange-space"><span class="std std-ref">Strings With Strange Space</span></a>, in library/globals.inc.php:3270.</p>
<p>The name of the contry contains both an unsecable space (the first, after Tonga), and a normal space (between Tonga and Islands). Translations are stored in a database, which preserves the unbreakable spaces. This also means that fixing the translation must be applied to every piece of data at the same time. The xl() function, which handles the translations, is also a good place to clean the spaces before searching for the right translation.</p>
<div class="highlight-php notranslate"><div class="highlight"><pre><span></span><span class="s1">&#39;to&#39;</span> <span class="o">=&gt;</span> <span class="nx">xl</span><span class="p">(</span><span class="s1">&#39;Tonga (Tonga Islands)&#39;</span><span class="p">),</span>
</pre></div>
</div>
</div>
<div class="section" id="case-thelia-type-stringwithstrangespace">
<span id="id151"></span><h4><span class="section-number">5.2.109.2. </span>Thelia<a class="headerlink" href="#case-thelia-type-stringwithstrangespace" title="Permalink to this headline">¶</a></h4>
<p><a class="reference internal" href="Rules.html#strings-with-strange-space"><span class="std std-ref">Strings With Strange Space</span></a>, in templates/backOffice/default/I18n/fr_FR.php:647.</p>
<p>This is another example with a translation sentence. Here, the unbreakable space is before the question mark : this is a typography rule, that is common to many language. This would be a false positive, unless typography is handled by another part of the software.</p>
<div class="highlight-php notranslate"><div class="highlight"><pre><span></span><span class="s1">&#39;Mot de passe oublié ?&#39;</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="used-once-variables-in-scope">
<span id="case-used-once-variables-in-scope"></span><h3><span class="section-number">5.2.110. </span>Used Once Variables (In Scope)<a class="headerlink" href="#used-once-variables-in-scope" title="Permalink to this headline">¶</a></h3>
<div class="section" id="case-shopware-variables-variableusedoncebycontext">
<span id="id152"></span><h4><span class="section-number">5.2.110.1. </span>shopware<a class="headerlink" href="#case-shopware-variables-variableusedoncebycontext" title="Permalink to this headline">¶</a></h4>
<p><a class="reference internal" href="Rules.html#used-once-variables-in-scope"><span class="std std-ref">Used Once Variables (In Scope)</span></a>, in _sql/migrations/438-add-email-template-header-footer-fields.php:115.</p>
<p>In the updateEmailTemplate method, $generatedQueries collects all the generated SQL queries. $generatedQueries is not initialized, and never used after initialization.</p>
<div class="highlight-php notranslate"><div class="highlight"><pre><span></span><span class="k">private</span> <span class="k">function</span> <span class="nf">updateEmailTemplate</span><span class="p">(</span><span class="nv">$name</span><span class="p">,</span> <span class="nv">$content</span><span class="p">,</span> <span class="nv">$contentHtml</span> <span class="o">=</span> <span class="k">null</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="nv">$sql</span> <span class="o">=</span> <span class="s">&lt;&lt;&lt;</span><span class="dl">SQL</span><span class="s"></span>
<span class="s">UPDATE `s_core_config_mails` SET `content` = &quot;$content&quot; WHERE `name` = &quot;$name&quot; AND dirty = 0</span>
<span class="dl">SQL</span><span class="p">;</span>
        <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">addSql</span><span class="p">(</span><span class="nv">$sql</span><span class="p">);</span>

        <span class="k">if</span> <span class="p">(</span><span class="nv">$contentHtml</span> <span class="o">!=</span> <span class="k">null</span><span class="p">)</span> <span class="p">{</span>
            <span class="nv">$sql</span> <span class="o">=</span> <span class="s">&lt;&lt;&lt;</span><span class="dl">SQL</span><span class="s"></span>
<span class="s">UPDATE `s_core_config_mails` SET `content` = &quot;$content&quot;, `contentHTML` = &quot;$contentHtml&quot; WHERE `name` = &quot;$name&quot; AND dirty = 0</span>
<span class="dl">SQL</span><span class="p">;</span>
            <span class="nv">$generatedQueries</span><span class="p">[]</span> <span class="o">=</span> <span class="nv">$sql</span><span class="p">;</span>
        <span class="p">}</span>

        <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">addSql</span><span class="p">(</span><span class="nv">$sql</span><span class="p">);</span>
    <span class="p">}</span>
</pre></div>
</div>
</div>
</div>
</div>
</div>


           </div>
           
          </div>
          <footer>
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
        <a href="../Administrator/Installation.html" class="btn btn-neutral float-right" title="Installation" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
        <a href="Cobblers.html" class="btn btn-neutral float-left" title="4. Cobblers" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>
        &#169; Copyright 2015-2020, Damien Seguy.

    </p>
  </div>
    
    
    
    Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    
    provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>
        </div>
      </div>

    </section>

  </div>
  

  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
  
    
   

</body>
</html>