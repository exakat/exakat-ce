name = "Datetime Trap";
id = "datetime-trap"
alias[] = ""
description = "When using Datetime objects, be aware that methods that returns the modified date is actually returning the object itself. This means that calculating a difference with ``diff()``, ``add()``, ``modify()`` methods also changes the underlying object. 

This trap is also set in packages that are build on top of Datetime. 

To avoid this trap, use the DatetimeImmutable class. This class is not modified by those methods, but returns a new object each time.

"
code = "<?php

$today = new Datetime('now');
print $today->format('d-m-Y').PHP_EOL;
// 24-11-2023

$tomorrow = $today->add(new DateInterval('P1D'));
print $tomorrow->format('d-m-Y').PHP_EOL;
// 25-11-2023 (as expected)

$twoDaysLater = $today->add(new DateInterval('P2D'));
print $twoDaysLater->format('d-m-Y');
// 27-11-2023 (one day overshoot!)

?>"
documentation = "https://www.php.net/datetime"
analyzers[] = ""
cobblers[] = ""
phpVersionSince = ""
phpVersionDeprecated = ""
phpVersionUntil = ""
related[] = ""
seeAlso[] = "`I just fell into the Date Trap in PHP <https://twitter.com/CodeWithKyrian/status/1727832972303143151>`_"
seeAlso[] = "`PHP DateTime difference – it’s a trap! <https://aiocollective.com/blog/php-datetime-difference-trap/>`_"
seeAlso[] = "`What’s all this “immutable date” stuff, anyway? <https://medium.com/@codebyjeff/whats-all-this-immutable-date-stuff-anyway-72d4130af8ce>`_"
tags[] = "bug"
tags[] = "date"
packagist[] = "nesbot/carbon"
packagist[] = "cakephp/chronos"
popularity = "";
rule = "";
extensions[] = ""