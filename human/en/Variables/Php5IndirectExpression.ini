name = "PHP5 Indirect Variable Expression";
description = "Indirect variable expressions changes between PHP 5 an 7.

The following structures are evaluated differently in PHP 5 and 7. It is recommended to review them or switch to a less ambiguous syntax.

<?php

// PHP 7 
$foo = 'bar';
$bar['bar']['baz'] = 'foobarbarbaz';
echo $$foo['bar']['baz'];
echo ($$foo)['bar']['baz'];

// PHP 5
$foo['bar']['baz'] = 'bar';
$bar = 'foobarbazbar';
echo $$foo['bar']['baz'];
echo \${\$foo['bar']['baz']};

?>

See `Backward incompatible changes PHP 7.0 <https://www.php.net/manual/en/migration70.incompatible.php>`_

+-----------------------+-------------------------+-------------------------+
| Expression            | PHP 5 interpretation    | PHP 7 interpretation    |
+-----------------------+-------------------------+-------------------------+
|\$\$foo['bar']['baz']    |\${\$foo['bar']['baz']}    |(\$\$foo)['bar']['baz']    |
|\$foo->\$bar['baz']      |\$foo->{\$bar['baz']}      |(\$foo->\$bar)['baz']      |
|\$foo->\$bar['baz']()    |\$foo->{\$bar['baz']}()    |(\$foo->\$bar)['baz']()    |
|Foo::\$bar['baz']()   |Foo::{\$bar['baz']}()   |(Foo::\$bar)['baz']()   |
+-----------------------+-------------------------+-------------------------+

";
clearphp = "";
phpVersion = "7.0-";
severity = "S_MAJOR";
timetofix = "T_SLOW";
exakatSince = "0.8.4";

modifications[] = "Avoid using complex expressions, mixing ``\$\$\``, ``[0]`` and ``->`` in the same expression"
modifications[] = "Add curly braces {} to ensure that the precedence is the same between PHP 5 and 7. For example, ``\$\$v`` becomes ``\${\$v}``";

precision = 'P_VERY_HIGH'

features[] = 'global'

seeAlso[] = ""

phpErrors[] = ""

