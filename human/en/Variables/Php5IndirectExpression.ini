name = "PHP5 Indirect Variable Expression";
description = "Indirect variable expressions changes between PHP 5 an 7.

The following structures are evaluated differently in PHP 5 and 7. It is recommended to review them or switch to a less ambiguous syntax.
+-----------------------+-------------------------+-------------------------+
| Expression            | PHP 5 interpretation    | PHP 7 interpretation    |
+-----------------------+-------------------------+-------------------------+
|\$\$foo['bar']['baz']    |\$\{\$foo['bar']['baz']\}    |(\$\$foo)['bar']['baz']    |
|\$foo->\$bar['baz']      |\$foo->\{\$bar['baz']\}      |(\$foo->\$bar)['baz']      |
|\$foo->\$bar['baz']()    |\$foo->\{\$bar['baz']\}()    |(\$foo->\$bar)['baz']()    |
|Foo::\$bar['baz']()   |Foo::{\$bar['baz']}()   |(Foo::\$bar)['baz']()   |
+-----------------------+-------------------------+-------------------------+";
code = "<?php

// PHP 7 
$foo = 'bar';
$bar['bar']['baz'] = 'foobarbarbaz';
echo $$foo['bar']['baz'];
echo ($$foo)['bar']['baz'];

// PHP 5
$foo['bar']['baz'] = 'bar';
$bar = 'foobarbazbar';
echo $$foo['bar']['baz'];
echo \$\{\$foo['bar']['baz']\};

?>";
clearphp = "";
severity = "S_MAJOR";
; from : S_NONE, S_MINOR, S_MAJOR, S_CRITICAL
timetofix = "T_SLOW";
; from : T_INSTANT, T_QUICK, T_SLOW
exakatSince = "0.8.4";
precision = "P_VERY_HIGH";
; from : P_VERY_HIGH, P_HIGH, P_MEDIUM, P_LOW, P_UNKNOWN
modifications[] = "Avoid using complex expressions, mixing ``\$\$\``, ``[0]`` and ``->`` in the same expression";
modifications[] = "Add curly braces \{\} to ensure that the precedence is the same between PHP 5 and 7. For example, ``\$\$v`` becomes ``\$\{\$v\}``";
; Alternative to make this code go away. 
; One by possible solution

features[] = "global";
; Name of a PHP feature. 
; This should match one of the available feature description in humane/en/Features

seeAlso[] = "`Backward incompatible changes PHP 7.0 <https://www.php.net/manual/en/migration70.incompatible.php>`_";
; List of links of interest

related[] = "";
; Possible other rules that might be related to this one. 
; Use "Folder/Name" format, one each
phpVersion = "7.0-";
; Versions when this feature was deprecated. Beyond is removed, and before is fine.
; This might need a range : 7.3-7.4.

phpDeprecation = "";
; Versions when this feature was deprecated. Beyond is removed, and before is fine.
; This might need a range : 7.3-7.4.
phpErrors[] = "";
; A PHP error that may be emitted by the target faulty code

keywords[] = "";
; Human readable keywords for manual glossary

changedBehavior = "";
; Which version did that behavior changed
changedBehavior_details = "";

